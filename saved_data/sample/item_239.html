<!DOCTYPE html><html><div class="item-title">
        Item 239
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Health check for InfluxDB (#5637)
                </div><div><b>message:</b> Health check for InfluxDB (#5637)


                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Add health check for Storage/Cluster management module
                </div><div><b>body:</b> In the previous releases, @hanahmily added the health check module and its implementation for the storage modules(H2, MySQL, and ES), we need to add a similar thing for InfluxDB.

Also, for cluster management, we need to add this too. If 
1. the registration fails 
1. can't get the instance list 
1. can't get itself, then
1. get multiple itself(such as multiple 127.0.0.1/0.0.0.0) in the instance list
The cluster management should be listed as an error 

The health check could be verified through CLI command, https://github.com/apache/skywalking-cli#checkhealth

@xbkaishui Are you going to do this?
                </div></div></li><li><div><div><b>title:</b> Add health check for Storage/Cluster management module
                </div><div><b>body:</b> In the previous releases, @hanahmily added the health check module and its implementation for the storage modules(H2, MySQL, and ES), we need to add a similar thing for InfluxDB.

Also, for cluster management, we need to add this too. If 
1. the registration fails 
1. can't get the instance list 
1. can't get itself, then
1. get multiple itself(such as multiple 127.0.0.1/0.0.0.0) in the instance list
The cluster management should be listed as an error 

The health check could be verified through CLI command, https://github.com/apache/skywalking-cli#checkhealth

@xbkaishui Are you going to do this?
                </div></div></li><li><div><div><b>title:</b> Add health check for Storage/Cluster management module
                </div><div><b>body:</b> In the previous releases, @hanahmily added the health check module and its implementation for the storage modules(H2, MySQL, and ES), we need to add a similar thing for InfluxDB.

Also, for cluster management, we need to add this too. If 
1. the registration fails 
1. can't get the instance list 
1. can't get itself, then
1. get multiple itself(such as multiple 127.0.0.1/0.0.0.0) in the instance list
The cluster management should be listed as an error 

The health check could be verified through CLI command, https://github.com/apache/skywalking-cli#checkhealth

@xbkaishui Are you going to do this?
                </div></div></li><li><div><div><b>title:</b> Add health check for Storage/Cluster management module
                </div><div><b>body:</b> In the previous releases, @hanahmily added the health check module and its implementation for the storage modules(H2, MySQL, and ES), we need to add a similar thing for InfluxDB.

Also, for cluster management, we need to add this too. If 
1. the registration fails 
1. can't get the instance list 
1. can't get itself, then
1. get multiple itself(such as multiple 127.0.0.1/0.0.0.0) in the instance list
The cluster management should be listed as an error 

The health check could be verified through CLI command, https://github.com/apache/skywalking-cli#checkhealth

@xbkaishui Are you going to do this?
                </div></div></li><li><div><div><b>title:</b> Add health check for Storage/Cluster management module
                </div><div><b>body:</b> In the previous releases, @hanahmily added the health check module and its implementation for the storage modules(H2, MySQL, and ES), we need to add a similar thing for InfluxDB.

Also, for cluster management, we need to add this too. If 
1. the registration fails 
1. can't get the instance list 
1. can't get itself, then
1. get multiple itself(such as multiple 127.0.0.1/0.0.0.0) in the instance list
The cluster management should be listed as an error 

The health check could be verified through CLI command, https://github.com/apache/skywalking-cli#checkhealth

@xbkaishui Are you going to do this?
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                Yes, please assign to me.  Thanks 
              </div></li><li><div>
                And you should check the runtime status of the Influxdb client, for instance, the new health checker would mark the storage module unhealthy once some writing, retrieving, and other critical operations failed. 
              </div></li><li><div>
                I will split two pr for this task: 

1. for influxdb
1. for cluster managment 
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li><li><div><div><b>title:</b> Health check for InfluxDB
                </div><div><b>body:</b> Please answer these questions before submitting a pull request

- Why submit this pull request?
- [ ] Bug fix
- [x] New feature provided
- [ ] Improve performance

- Related issues

___
### Bug fix
- Bug description.

- How to fix?

___
### New feature or improvement
- Describe the details and related test reports.
Add health check for influxdb , related #5633
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                # [Codecov](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=h1) Report
&gt; Merging [#5637](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=desc) into [master](https://codecov.io/gh/apache/skywalking/commit/494c146ed5f345412f517af7f23e2f5e0c6153f6?el=desc) will **increase** coverage by `30.20%`.
&gt; The diff coverage is `0.00%`.

[![Impacted file tree graph](https://codecov.io/gh/apache/skywalking/pull/5637/graphs/tree.svg?width=650&amp;height=150&amp;src=pr&amp;token=qrILxY5yA8)](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=tree)

```diff
@@             Coverage Diff             @@
##           master    #5637       +/-   ##
===========================================
+ Coverage    0.00%   30.20%   +30.20%     
===========================================
  Files         190     1530     +1340     
  Lines        4440    32148    +27708     
  Branches      515     4217     +3702     
===========================================
+ Hits            0     9711     +9711     
- Misses       4440    21573    +17133     
- Partials        0      864      +864     
```


| [Impacted Files](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=tree) | Coverage Δ | |
|---|---|---|
| [...p/server/storage/plugin/influxdb/InfluxClient.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-b2FwLXNlcnZlci9zZXJ2ZXItc3RvcmFnZS1wbHVnaW4vc3RvcmFnZS1pbmZsdXhkYi1wbHVnaW4vc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvb2FwL3NlcnZlci9zdG9yYWdlL3BsdWdpbi9pbmZsdXhkYi9JbmZsdXhDbGllbnQuamF2YQ==) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...storage/plugin/influxdb/InfluxStorageProvider.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-b2FwLXNlcnZlci9zZXJ2ZXItc3RvcmFnZS1wbHVnaW4vc3RvcmFnZS1pbmZsdXhkYi1wbHVnaW4vc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvb2FwL3NlcnZlci9zdG9yYWdlL3BsdWdpbi9pbmZsdXhkYi9JbmZsdXhTdG9yYWdlUHJvdmlkZXIuamF2YQ==) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...g/apache/skywalking/apm/agent/SkyWalkingAgent.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50L3NyYy9tYWluL2phdmEvb3JnL2FwYWNoZS9za3l3YWxraW5nL2FwbS9hZ2VudC9Ta3lXYWxraW5nQWdlbnQuamF2YQ==) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...apache/skywalking/apm/agent/core/util/IOUtils.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvdXRpbC9JT1V0aWxzLmphdmE=) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...ache/skywalking/apm/agent/core/util/FileUtils.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvdXRpbC9GaWxlVXRpbHMuamF2YQ==) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...he/skywalking/apm/agent/core/plugin/PluginCfg.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvcGx1Z2luL1BsdWdpbkNmZy5qYXZh) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...skywalking/apm/agent/core/plugin/PluginFinder.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvcGx1Z2luL1BsdWdpbkZpbmRlci5qYXZh) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...skywalking/apm/agent/core/util/CollectionUtil.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvdXRpbC9Db2xsZWN0aW9uVXRpbC5qYXZh) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...ywalking/apm/agent/core/jvm/gc/SerialGCModule.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvanZtL2djL1NlcmlhbEdDTW9kdWxlLmphdmE=) | `0.00% &lt;0.00%&gt; (ø)` | |
| [...ywalking/apm/agent/core/plugin/EnhanceContext.java](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree#diff-YXBtLXNuaWZmZXIvYXBtLWFnZW50LWNvcmUvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL3NreXdhbGtpbmcvYXBtL2FnZW50L2NvcmUvcGx1Z2luL0VuaGFuY2VDb250ZXh0LmphdmE=) | `0.00% &lt;0.00%&gt; (ø)` | |
| ... and [1527 more](https://codecov.io/gh/apache/skywalking/pull/5637/diff?src=pr&amp;el=tree-more) | |

------

[Continue to review full report at Codecov](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=continue).
&gt; **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)
&gt; `Δ = absolute &lt;relative&gt; (impact)`, `ø = not affected`, `? = missing data`
&gt; Powered by [Codecov](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=footer). Last update [494c146...35e3578](https://codecov.io/gh/apache/skywalking/pull/5637?src=pr&amp;el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Grammar related exceptions seem `unhealth` to me. @hanahmily What do you think?
              </div></li><li><div>
                The test of result.hasError is dropped. Maybe some errors are ignored. Pls double check whether it leaves out them.
              </div></li><li><div>
                Ditto 
              </div></li><li><div>
                Why do you ignore grammar relevant errors? They would indicate the version mismatches between OAP and influxdb server.
              </div></li><li><div>
                I have checked the source code of [influx client](https://github.com/influxdata/influxdb-java/blob/bfbbcd0f4ec8bb1a6362e7a36b62d81e13693393/src/main/java/org/influxdb/impl/InfluxDBImpl.java#L804), 
when some errors happens it will throw an exception, no need to check the hasError method

              </div></li><li><div>
                ok will change
              </div></li><li><div>
                done
              </div></li><li><div>
                Same comment as above
              </div></li><li><div>
                @dmsolr Could you confirm the status? Is there some case there could be some errors w/o exception?
              </div></li><li><div><div><b>body:</b> hi @xbkaishui 
I had test some cases. The result show following
1. syntax error/parse error, connection, etc will throw an exception.
2. aggregate function error maybe doesn't throw.

For example:
1. case 1
 ```
Query: SELECT mean("square"),"round" FROM "peg"
Response: QueryResult [results=[Result [series=null, error=mixing aggregate and non-aggregate queries is not supported]], error=null]
```

2. case 2 
```
Query: SELECT sum("square", 2),"round" FROM "peg"

Response: [results=[Result [series=null, error=invalid number of arguments for mean, expected 1, got 2]], error=null]
```

These two examples put error messages in clauses only. :( 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I am not sure that is wrong what I did before. But we need to consider this scenario, right?
              </div></li><li><div>
                Nop, for below sql , in the java client it will throws an exception.  did you use the java client to test ? 
              </div></li><li><div>
                please check me test code [gist](https://gist.github.com/xbkaishui/493009dcb56dd9cda8b8ddd82f53f34f)
              </div></li><li><div>
                @xbkaishui I am curious if all things go through exception, why InfluxDB Java client designs that API? In case the exception has been caught?
              </div></li><li><div>
                from what I test, the error msg is wrapper as an exception in java client
              </div></li><li><div>
                Maybe other client has different implement. 
              </div></li><li><div><div><b>body:</b> &gt; from what I test, the error msg is wrapper as an exception in java client

OK, if so, that we may be able to remove the codes. But in another hand, to do the check seems harmless :)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I've read your code. I think have some issue.

```java
public static void main(String[] args) {
    final InfluxDB influxDB = InfluxDBFactory.connect("http://127.0.0.1:8086");
    String databaseName = "NOAA_water_database";
    try {
        QueryResult result = influxDB.query(new Query("SELECT sum(\"square\", 2),\"round\" FROM \"peg\"\n" +
                                                          ";" + databaseName)); // There is syntax issue, so InfluxDB Client throws an exception. You don't need to append `+ ";" + databaseName`.
        String error = result.getError();
        System.out.println(error);
        influxDB.setDatabase(databaseName);
    } catch (Throwable e) {
        e.printStackTrace();
    }
}
```

You could try the following code.

```java
try {
    influxDB.setDatabase(databaseName);
    QueryResult result = influxDB.query(new Query("SELECT sum(\"square\", 2),\"round\" FROM \"peg\"\n"));
    result.hasError(); // it is false.
    result.getError(); // null

    result.getResults().forEach(series -&gt; {
        series.hasError(); // it is true
        series.getError(); // error message
    });
} catch (Throwable e) {
    e.printStackTrace();
}
```
              </div></li><li><div><div><b>body:</b> Syntax errors can be detected by the client, so the exception is thrown directly.
Some errors, like aggregate function wrong, do not throw the exception.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                &gt; Syntax errors can be detected by the client, so the exception is thrown directly.
&gt; Some errors, like aggregate function wrong, do not throw the exception.

but for the aggregate function, the hasError return false, it will not throws an exception using the orginal code, so the check error logic is take no effect  right ? 
              </div></li><li><div>
                I will revert my changes. thanks
              </div></li><li><div>
                done
              </div></li><li><div>
                Done, this.query already checked the hasError logic, no need to check again
              </div></li><li><div>
                &gt; but for the aggregate function, the hasError return false, it will not throws an exception using the orginal code, so the check error logic is take no effect right ?

It is basically right. Would you like to fix it in this PR?
              </div></li><li><div>
                Do you mean also check the child resuts error ? 
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>