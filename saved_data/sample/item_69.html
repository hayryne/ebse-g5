<!DOCTYPE html><html><div class="item-title">
        Item 69
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 normalize the path
              </div></li><li><div>
                 TODO sanity check col fam
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ACCUMULO-1747 expanded use of default uri and changed how relative paths are handled in code
                </div><div><b>message:</b> ACCUMULO-1747 expanded use of default uri and changed how relative paths are handled in code

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> ServerConstants.getBaseDirs() use fs default name, not instance.dfs.uri
                </div><div><b>description:</b> I've been trying to track down why I'm seeing connection refused to port 9000 in {{accumulo init}} -looks to me like

2013-10-02 19:04:12,600 [util.Initialize] INFO : Hadoop Filesystem is file:/
2013-10-02 19:04:12,678 [Configuration.deprecation] INFO : fs.default.name is deprecated. Instead, use fs.defaultFS
2013-10-02 19:04:12,678 [util.Initialize] INFO : Accumulo data dirs are [hdfs://localhost:9000/Users/stevel/.hoya/cluster/TestAcc

Initialize is picking up instance.dfs.uri value, but the {{ServerConstants.getBaseDirs()}} is picking up the default FS -not even from accumulo-site.xml by the look of things, so fails to work except when instance.dfs.uri==fs.default.name
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                generated site file, has both the 1.x and the (new, changed ) property for the default fs:
{code}
&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;&lt;configuration&gt;
&lt;property&gt;&lt;name&gt;trace.user&lt;/name&gt;&lt;value&gt;root&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;instance.secret&lt;/name&gt;&lt;value&gt;d4483896-76a7-42a2-a0ad-cf93f44d5305&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.memory.maps.native.enabled&lt;/name&gt;&lt;value&gt;false&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.memory.maps.max&lt;/name&gt;&lt;value&gt;80M&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.sort.buffer.size&lt;/name&gt;&lt;value&gt;50M&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;logger.dir.walog&lt;/name&gt;&lt;value&gt;walogs&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;instance.dfs.uri&lt;/name&gt;&lt;value&gt;file:/&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.walog.max.size&lt;/name&gt;&lt;value&gt;100M&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;monitor.port.client&lt;/name&gt;&lt;value&gt;50095&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;hoya.template.origin&lt;/name&gt;&lt;value&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;trace.token.property.password&lt;/name&gt;&lt;value&gt;secret&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;instance.zookeeper.host&lt;/name&gt;&lt;value&gt;127.0.0.1:64731&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;instance.dfs.dir&lt;/name&gt;&lt;value&gt;/Users/stevel/.hoya/cluster/TestAccM1T0/database&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.cache.index.size&lt;/name&gt;&lt;value&gt;20M&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;master.port.client&lt;/name&gt;&lt;value&gt;9999&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;fs.defaultFS&lt;/name&gt;&lt;value&gt;file:///&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;tserver.cache.data.size&lt;/name&gt;&lt;value&gt;7M&lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;trace.port.client&lt;/name&gt;&lt;value&gt;0&lt;/value&gt;&lt;source&gt;programatically&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;general.classpaths&lt;/name&gt;&lt;value&gt;
      $ACCUMULO_HOME/lib/accumulo-server.jar,
      $ACCUMULO_HOME/lib/accumulo-core.jar,
      $ACCUMULO_HOME/lib/accumulo-start.jar,
      $ACCUMULO_HOME/lib/accumulo-fate.jar,
      $ACCUMULO_HOME/lib/accumulo-proxy.jar,
      $ACCUMULO_HOME/lib/[^.].*.jar,
      $ZOOKEEPER_HOME/zookeeper[^.].*.jar,
      $HADOOP_CONF_DIR,
      $HADOOP_PREFIX/[^.].*.jar,
      $HADOOP_PREFIX/lib/[^.].*.jar,
      $HADOOP_PREFIX/share/hadoop/common/.*.jar,
      $HADOOP_PREFIX/share/hadoop/common/lib/.*.jar,
      $HADOOP_PREFIX/share/hadoop/hdfs/.*.jar,
      $HADOOP_PREFIX/share/hadoop/mapreduce/.*.jar,
      $HADOOP_PREFIX/share/hadoop/yarn/.*.jar,
    &lt;/value&gt;&lt;source&gt;file:/Users/stevel/.hoya/cluster/TestAccM1T0/original/accumulo-site.xml&lt;/source&gt;&lt;/property&gt;
&lt;property&gt;&lt;name&gt;fs.default.name&lt;/name&gt;&lt;value&gt;file:///&lt;/value&gt;&lt;/property&gt;
{code}
It does look like I'm not using file:/// as the full URI, but its moot: ServerConstants doesn't use the instance uri:
{code}
hadoopConfig.get("fs.default.name")
{code}
As to why the FS settings aren't being picked up, this test used a core-site.xml pointing to hdfs://local:9000 -which got picked up instead of the site.xml value

-steve
              </div></li><li><div>
                I think fs.defaultFS wasn't introduced until hadoop 2, so this needs to be treaded lightly around.
              </div></li><li><div>
                you can get away without the fs.defaultFS stuff as hadoop2 fallls back to "fs.default.name" -I'm just pushing both down for consistency. What is neededhere is that the base dir for files ought -if I've understood it- be build from {{instance.dfs.uri + instance.dfs.dir}}, but instead it is {{fs.default.namei + instance.dfs.dir}}, so you can't run accumulo against a non-default filesystem
              </div></li><li><div>
                I just ran into this too.  The code is not using instance.dfs.dir and the new prop instance.volumes consistently.  I am going to make the code use these props consistently.
              </div></li><li><div>
                Commit 95cb49043ddfe31631639ccfd6bea70201e2b5e4 in branch refs/heads/master from [~keith_turner]
[ https://git-wip-us.apache.org/repos/asf?p=accumulo.git;h=95cb490 ]

ACCUMULO-1747 fixed, defined, and documented usage of intance.dfs.uri and instance.volumes

              </div></li><li><div>
                Commit cb45e89b0f78d170cb0f5383ab08dea780c9386e in branch refs/heads/master from [~keith_turner]
[ https://git-wip-us.apache.org/repos/asf?p=accumulo.git;h=cb45e89 ]

ACCUMULO-1747 expanded use of default uri and changed how relative paths are handled in code

              </div></li><li><div>
                marking as resolved as the changes are in  &amp; I haven't seen this for a while
              </div></li></ol></div></div></html>