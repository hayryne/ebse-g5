<!DOCTYPE html><html><div class="item-title">
        Item 111
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
 *
 
              </div></li><li><div>
                 response
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div><div><b>comment:</b>  use multiple values for the foo header in the reply
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                *
 *
 
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                 response
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div><div><b>comment:</b>  use multiple values for the foo header in the reply
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 mapping the content-type
              </div></li><li><div>
                 use http helper to extract parameter value as it may contain multiple values
              </div></li><li><div>
                 there may be multiple values for the same name
              </div></li><li><div><div><b>comment:</b>  use an iterator as there can be multiple values. (must not use a delimiter)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 if its a multi value then check each value if we can add it and for multi values they
 should be combined into a single value
              </div></li><li><div><div><b>comment:</b>  use an iterator as there can be multiple values. (must not use a delimiter)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 the value to add as request header
              </div></li><li><div>
                 use the default toString of a ArrayList to create in the form [xxx, yyy]
 if multi valued, for a single value, then just output the value as is
              </div></li><li><div>
                 add the value(s) as a http request header
              </div></li><li><div><div><b>comment:</b>  if we bridge endpoint then we need to skip matching headers with the HTTP_QUERY to avoid sending
 duplicated headers to the receiver, so use this skipRequestHeaders as the list of headers to skip
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 use http helper to extract parameter value as it may contain multiple values
              </div></li><li><div>
                 preserve headers from in by copying any non existing headers
 to avoid overriding existing headers with old values
              </div></li><li><div><div><b>comment:</b>  we should not add headers for the parameters in the uri if we bridge the endpoint
 as then we would duplicate headers on both the endpoint uri, and in HTTP headers as well
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 remove the [ ] markers
              </div></li><li><div>
                 trim value before checking for multiple parameters
              </div></li><li><div>
                *
     * Extracts the parameter value.
     * &lt;p/&gt;
     * This implementation supports HTTP multi value parameters which
     * is based on the syntax of &lt;tt&gt;[value1, value2, value3]&lt;/tt&gt; by returning
     * a {@link List} containing the values.
     * &lt;p/&gt;
     * If the value is not a HTTP mulit value the value is returned as is.
     *
     * @param value the parameter value
     * @return the extracted parameter value, see more details in javadoc.
     
              </div></li><li><div>
                *
     * Appends the key/value to the headers.
     * &lt;p/&gt;
     * This implementation supports keys with multiple values. In such situations the value
     * will be a {@link java.util.List} that contains the multiple values.
     *
     * @param headers  headers
     * @param key      the key
     * @param value    the value
     
              </div></li><li><div>
                 there may be multiple values for the same name
              </div></li><li><div><div><b>comment:</b>  use an iterator as there can be multiple values. (must not use a delimiter)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 must use entrySet to ensure case of keys is preserved
              </div></li><li><div>
                 if its a multi value then check each value if we can add it and for multi values they
 should be combined into a single value
              </div></li><li><div><div><b>comment:</b>  use an iterator as there can be multiple values. (must not use a delimiter)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 the value to add as request header
              </div></li><li><div>
                 use the default toString of a ArrayList to create in the form [xxx, yyy]
 if multi valued, for a single value, then just output the value as is
              </div></li><li><div>
                 add the value(s) as a http request header
              </div></li><li><div><div><b>comment:</b>  if we bridge endpoint then we need to skip matching headers with the HTTP_QUERY to avoid sending
 duplicated headers to the receiver, so use this skipRequestHeaders as the list of headers to skip
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 use http helper to extract parameter value as it may contain multiple values
              </div></li><li><div>
                 preserve headers from in by copying any non existing headers
 to avoid overriding existing headers with old values
              </div></li><li><div><div><b>comment:</b>  we should not add headers for the parameters in the uri if we bridge the endpoint
 as then we would duplicate headers on both the endpoint uri, and in HTTP headers as well
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 remove the [ ] markers
              </div></li><li><div>
                 trim value before checking for multiple parameters
              </div></li><li><div>
                *
     * Extracts the parameter value.
     * &lt;p/&gt;
     * This implementation supports HTTP multi value parameters which
     * is based on the syntax of &lt;tt&gt;[value1, value2, value3]&lt;/tt&gt; by returning
     * a {@link List} containing the values.
     * &lt;p/&gt;
     * If the value is not a HTTP mulit value the value is returned as is.
     *
     * @param value the parameter value
     * @return the extracted parameter value, see more details in javadoc.
     
              </div></li><li><div>
                *
     * Appends the key/value to the headers.
     * &lt;p/&gt;
     * This implementation supports keys with multiple values. In such situations the value
     * will be a {@link java.util.List} that contains the multiple values.
     *
     * @param headers  headers
     * @param key      the key
     * @param value    the value
     
              </div></li><li><div>
                 must use response fields to get the http headers as
 httpExchange.getHeaders() does not work well with multi valued headers
              </div></li><li><div>
                 preserve headers from in by copying any non existing headers
 to avoid overriding existing headers with old values
              </div></li><li><div>
                 if its a multi value then check each value if we can add it and for multi values they
 should be combined into a single value
              </div></li><li><div><div><b>comment:</b>  use an iterator as there can be multiple values. (must not use a delimiter)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 propagate headers as HTTP headers
              </div></li><li><div>
                 use the default toString of a ArrayList to create in the form [xxx, yyy]
 if multi valued, for a single value, then just output the value as is
              </div></li><li><div>
                 add the value(s) as a http request header
              </div></li><li><div><div><b>comment:</b>  if we bridge endpoint then we need to skip matching headers with the HTTP_QUERY to avoid sending
 duplicated headers to the receiver, so use this skipRequestHeaders as the list of headers to skip
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 the values to add as a request header
              </div></li><li><div><div><b>comment:</b>  we should not add headers for the parameters in the uri if we bridge the endpoint
 as then we would duplicate headers on both the endpoint uri, and in HTTP headers as well
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 these tests does not run well on Windows
              </div></li><li><div><div><b>comment:</b>  response
 use multiple values for the foo header in the reply
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 give Jetty time to startup properly
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> CAMEL-4212: Add support for multi value headers for the http related components.
                </div><div><b>message:</b> CAMEL-4212: Add support for multi value headers for the http related components.

git-svn-id: https://svn.apache.org/repos/asf/camel/trunk@1146782 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div><div><b>label:</b> requirement
                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div></div></li><li><div><div><b>summary:</b> http components should support parameters with multiple values when mapping to Camel headers
                </div><div><b>description:</b> All the http components in Camel should support mapping HttpServletRequest parameters to Camel Message headers where there can be multiple values for the same key. So in that case the value of the Camel Message header should be a List.


                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Work in progress patch
                </div><div><b>label:</b> requirement
                </div></div></li><li><div><div><b>body:</b> I have attached a patch. It covers most of the stuff. It needs a bit polishing in the HttpHelper in the extractParameterName method etc.

The camel-ahc, and camel-http4 components has not been migrated.
And I think a few more unit tests would be appropriate.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> This also applies for HTTP headers. 

And on the producer side, you may have a Camel Message that has a header which contains a list with multiple values.
It seems so the idiom is to do a .toString on the value. Which in Java outputs a: [xxx, yyy, zzz] for an ArrayList.


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Okay was a bit more icky to implement as we have in Camel
- 4 http producers
- 2 consumers

And they all got a bit different API, and some works better out of the box with multi values and others dont.

Even Jetty on the consumer side had issues, so I had to use a different API to grab multi values.

camel-ahc worked the best out of the box, as it supported it without any code changes needed.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                
This was fixed between the original 2.8.0 release attempt and the redo so it's part of 2.8.0
              </div></li></ol></div></div></html>