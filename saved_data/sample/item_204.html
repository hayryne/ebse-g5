<!DOCTYPE html><html><div class="item-title">
        Item 204
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>message:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns

arrow is now pandas datetime timezone aware

Author: ahnj &lt;ahnj@yahoo.com&gt;

Closes #287 from ahnj/timestamp-aware and squashes the following commits:

0221ed0 [ahnj] ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li><li><div><div><b>title:</b> ARROW-378: Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>body:</b> arrow is now pandas datetime timezone aware
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                I left a comment on https://issues.apache.org/jira/browse/ARROW-378
              </div></li><li><div>
                @ahnj can you rebase on the the lastest master? this is based on a commit from 10 days ago https://github.com/ahnj/arrow/commits/timestamp-aware
              </div></li><li><div>
                @wesm - rebased with the latest master.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                To my knowledge, all pandas data having a time zone is UTC -- if data is time zone naive, then we may assume UTC in Arrow. I don't think any conversions are necessary here
              </div></li><li><div><div><b>body:</b> It would be better to put this in a `Notes` section, or in the Sphinx documentation
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                From my comment above, you can look at `x.values.view(np.int64)` before and after `tz_convert('US/Eastern')` to check that the internal values are not modified. If you localize with a non-UTC timestamp, that actually changes the values
              </div></li><li><div>
                Can you combine the null and non-null test case?
              </div></li><li><div>
                I still don't believe this is necessary. 

```python
In [11]: dr = pd.date_range('2000-01-01', periods=10)

In [12]: dr_utc = dr.tz_localize('UTC')

In [13]: dr_utc.values.view(np.int64)
Out[13]: 
array([946684800000000000, 946771200000000000, 946857600000000000,
       946944000000000000, 947030400000000000, 947116800000000000,
       947203200000000000, 947289600000000000, 947376000000000000,
       947462400000000000])

In [14]: dr_utc.tz_convert('US/Eastern').values.view(np.int64)
Out[14]: 
array([946684800000000000, 946771200000000000, 946857600000000000,
       946944000000000000, 947030400000000000, 947116800000000000,
       947203200000000000, 947289600000000000, 947376000000000000,
       947462400000000000])
```
              </div></li><li><div>
                Oops..  now I see what you mean!  let me go back and fix, and re-rebase.
              </div></li><li><div>
                Can you revert the code changes in this function? 
              </div></li><li><div>
                Can you revise to say "Localized timestamps will currently be returned as UTC (pandas's native representation). Timezone-naive data will be implicitly interpreted as UTC".
              </div></li><li><div>
                Revised with suggested note.
              </div></li><li><div>
                Reverted and rebased.  Thanks.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li><li><div><div><b>summary:</b> Python: Respect timezone on conversion of Pandas datetime columns
                </div><div><b>description:</b> Currently we convert columns irrespectively of their timezone directly to timestamps in Arrow. While in Pandas you are able to specify timezones, in Arrow we have the assumptions that a Timestamp is always the time of the specified unit since 00:00:00.000 on 1 January 1970, UTC. Thus we have to check if {{df['column‘].tz}}&nbsp;is set and convert if necessary to UTC before converting to an Arrow column. 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                PR: https://github.com/apache/arrow/pull/287
              </div></li><li><div><div><b>body:</b> [~xhochy] I think there is some confusion because pandas stores timestamps internally as UTC. I am not sure what needs to be done exactly
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                If the values are internally stored as UTC there is nothing to do then. I wasn't aware of that fact.
              </div></li><li><div>
                [~ahnj] sorry for the confusion, could you close your pull request? Thanks
              </div></li><li><div>
                No worries.  I'm happy to do so, but please consider taking the current pull request as this 'implicit conversion' to UTC by numpy is documented and explicitly tested.  It may help others in the future avoid being fooled in a similar manner.  :)
              </div></li><li><div>
                I agree having the extra test is useful -- I left a comment on the PR. Can you rebase and then I can merge? Thanks
              </div></li></ol></div></div></html>