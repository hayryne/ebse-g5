<!DOCTYPE html><html><div class="item-title">
        Item 237
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
* Licensed to the Apache Software Foundation (ASF) under one or more
* contributor license agreements.  See the NOTICE file distributed with
* this work for additional information regarding copyright ownership.
* The ASF licenses this file to You under the Apache License, Version 2.0
* (the "License"); you may not use this file except in compliance with
* the License.  You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                
* Licensed to the Apache Software Foundation (ASF) under one or more
* contributor license agreements.  See the NOTICE file distributed with
* this work for additional information regarding copyright ownership.
* The ASF licenses this file to You under the Apache License, Version 2.0
* (the "License"); you may not use this file except in compliance with
* the License.  You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                 Ignore this test when TDE is enabled, since there is internal cache group id change without corresponding
 encryption keys change.
              </div></li><li><div>
                
* Licensed to the Apache Software Foundation (ASF) under one or more
* contributor license agreements.  See the NOTICE file distributed with
* this work for additional information regarding copyright ownership.
* The ASF licenses this file to You under the Apache License, Version 2.0
* (the "License"); you may not use this file except in compliance with
* the License.  You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                *
 * WAL recovery test with WAL page compression enabled and PDS disk page compression disabled.
 
              </div></li><li><div>
                
* Licensed to the Apache Software Foundation (ASF) under one or more
* contributor license agreements.  See the NOTICE file distributed with
* this work for additional information regarding copyright ownership.
* The ASF licenses this file to You under the Apache License, Version 2.0
* (the "License"); you may not use this file except in compliance with
* the License.  You may obtain a copy of the License at
*
*      http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                *
     *
     
              </div></li><li><div>
                 Write any WAL record to get current WAL pointers.
              </div></li><li><div>
                 Ignite instance with compressed WAL page records.
              </div></li><li><div>
                 Set new IP finder for each node to start independent clusters.
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 *
 
              </div></li><li><div>
                 Reference ignite instance with uncompressed WAL page records.
              </div></li><li><div>
                / &lt;summary&gt;
/ Compression disabled.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Disk page compression options.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Snappy compression.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Zstd compression.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Lz4 compression.
/ &lt;/summary&gt;
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                / &lt;summary&gt;
/ Retain only useful data from half-filled pages, but do not apply any compression.
/ &lt;/summary&gt;
              </div></li><li><div>
                *
     * @param page Page buffer.
     * @param pageSize Page size.
     * @return Compacted page buffer.
     
              </div></li><li><div>
                 Direct buffer is required as output of this method.
              </div></li><li><div>
                 Page size will be less than page limit when TDE is enabled. To make compaction and compression work
 correctly we need to set limit to real page size.
              </div></li><li><div>
                 No-op.
              </div></li><li><div>
                 WAL page records compression.
              </div></li><li><div>
                * Default disk page compression algorithm. 
              </div></li><li><div>
                * Default compression algorithm for WAL page snapshot records. 
              </div></li><li><div>
                * Compression level for WAL page snapshot records. 
              </div></li><li><div>
                *
     * Gets compression algorithm for WAL page snapshot records.
     *
     * @return Page compression algorithm.
     
              </div></li><li><div>
                *
     * Gets {@link #getWalPageCompression algorithm} specific WAL page compression level.
     *
     * @return WAL page snapshots compression level or {@code null} for default.
     
              </div></li><li><div>
                *
     * Sets {@link #setWalPageCompression algorithm} specific page compression level.
     *
     * @param walPageCompressionLevel Disk page compression level or {@code null} to use default.
     *      {@link DiskPageCompression#ZSTD Zstd}: from {@code -131072} to {@code 22} (default {@code 3}).
     *      {@link DiskPageCompression#LZ4 LZ4}: from {@code 0} to {@code 17} (default {@code 0}).
     * @return {@code this} for chaining.
     
              </div></li><li><div>
                * Compression algorithm for WAL page snapshot records. 
              </div></li><li><div>
                *
     * Sets compression algorithm for WAL page snapshot records.
     *
     * @param walPageCompression Page compression algorithm.
     * @return {@code this} for chaining.
     
              </div></li><li><div>
                * Compression disabled. 
              </div></li><li><div>
                 In case of direct buffer copy buffer content to new array.
              </div></li><li><div>
                *
     * @return PageSize without encryption overhead.
     
              </div></li><li><div>
                *
     * @return Page data byte buffer.
     
              </div></li><li><div>
                *
     * @return Size of page data.
     
              </div></li><li><div>
                 In the case of compressed pages we can miss the tail of the page.
              </div></li><li><div>
                *
     * @param pageAddr Page address.
     * @return Compression type.
     
              </div></li><li><div>
                *
     * @param pageAddr Page address.
     * @return Compacted size.
     
              </div></li><li><div>
                *
     * @param pageAddr Page address.
     * @return Compressed size.
     
              </div></li><li><div>
                 Do page snapshots compression if configured.
              </div></li><li><div>
                * Page snapshot records compression algorithm. 
              </div></li><li><div>
                * Page snapshot records compression level. 
              </div></li><li><div>
                 pageId 
              </div></li><li><div>
                 cacheId 
              </div></li><li><div>
                *
     * Checks weither page compression is supported.
     *
     * @throws IgniteCheckedException If compression is not supported.
     
              </div></li><li><div>
                *
     * @param pageSize Page size.
     
              </div></li><li><div><div><b>comment:</b>  Skip tracking pages.
 Compaction/restoring page can left some trash in unused space, so we need to compare
 compacted pages in case of compaction is used.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                * WAL page snapshots records compression method. 
              </div></li><li><div>
                / &lt;summary&gt;
/ Gets or sets the compression level for WAL page snapshot records.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Default value for &lt;see cref="WalPageCompression"/&gt;.
/ &lt;/summary&gt;
              </div></li><li><div>
                / &lt;summary&gt;
/ Gets or sets the compression algorithm for WAL page snapshot records.
/ &lt;/summary&gt;
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> IGNITE-11336 Implement WAL page snapshot records compression - Fixes #6116.
                </div><div><b>message:</b> IGNITE-11336 Implement WAL page snapshot records compression - Fixes #6116.

Signed-off-by: Dmitriy Govorukhin &lt;dmitriy.govorukhin@gmail.com&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> IGNITE-11336 WAL page snapshot records compression
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> IGNITE-11336 WAL page snapshot records compression
                </div><div><b>body:</b> 
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li><li><div><div><b>summary:</b> Implement WAL page snapshot records compression
                </div><div><b>description:</b> We already have page compression implementation, so we can extend this approach to compress WAL page snapshot records (leaving other record types uncompressed) at relatively low cost.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                {panel:title=--&amp;gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&amp;gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=3202508&amp;amp;buildTypeId=IgniteTests24Java8_RunAll]
              </div></li><li><div><div><b>body:</b> Benchmarks: [^wal-compression-benchmarks.zip]

UPD: Attached results are not correct. The environment was not tuned correctly and I get too often checkpoints for runs without WAL compression and this leads to bad results for "compdisabled" runs. But I've benchmarked it again later and there is still performance boost about 20-30% on our synthetic tests on our environment.

&nbsp;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                {panel:title=--&amp;gt; Run :: All: Possible Blockers|borderStyle=dashed|borderColor=#ccc|titleBGColor=#F7D6C1}
{color:#d04437}JDBC Driver{color} [[tests 0 TIMEOUT , Exit Code |https://ci.ignite.apache.org/viewLog.html?buildId=3702122]]

{color:#d04437}Platform .NET (Core Linux){color} [[tests 0 Exit Code |https://ci.ignite.apache.org/viewLog.html?buildId=3702120]]

{panel}
[TeamCity *--&amp;gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=3678120&amp;amp;buildTypeId=IgniteTests24Java8_RunAll]
              </div></li><li><div>
                {{JDBC Driver}} and {{Platform .NET (Core Linux)}}&nbsp;are failing in master too.
              </div></li><li><div>
                [~alex_pl] LGTM, merged to master.
              </div></li></ol></div></div></html>