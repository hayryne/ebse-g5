<!DOCTYPE html><html><div class="item-title">
        Item 189
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [hotfix][coordination] Fix MiniCluster#closeAsync to correctly close all components and services
                </div><div><b>message:</b> [hotfix][coordination] Fix MiniCluster#closeAsync to correctly close all components and services

This closes #9743.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [hotfix][coordination] Fix MiniCluster#closeAsync to correctly close all components and services
                </div><div><b>body:</b> ## What is the purpose of the change

1. Wait for completion of `MiniCluster#terminateExecutors`.
2. Tolerate failure of `MiniCluster#closeMetricSystem`.
3. Narrow signature of  `MiniCluster#closeMetricSystem` to fits `FutureUtils` requirement while no obvious drawback.

## Verifying this change

This change is a trivial rework / code cleanup without any test coverage.

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (no)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)
  - The serializers: (no)
  - The runtime per-record code paths (performance sensitive): (no)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)
  - The S3 file system connector: (no)

## Documentation

  - Does this pull request introduce a new feature? (no)
  - If yes, how is the feature documented? (not applicable)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Thanks a lot for your contribution to the Apache Flink project. I'm the @flinkbot. I help the community
to review your pull request. We will use this comment to track the progress of the review.


## Automated Checks
Last check on commit fac45a7be4ede2c627f68135e926784943c677a3 (Wed Oct 16 08:28:57 UTC 2019)

**Warnings:**
 * No documentation files were touched! Remember to keep the Flink docs up to date!


&lt;sub&gt;Mention the bot in a comment to re-run the automated checks.&lt;/sub&gt;
## Review Progress

* ❓ 1. The [description] looks good.
* ❓ 2. There is [consensus] that the contribution should go into to Flink.
* ❓ 3. Needs [attention] from.
* ❓ 4. The change fits into the overall [architecture].
* ❓ 5. Overall code [quality] is good.

Please see the [Pull Request Review Guide](https://flink.apache.org/contributing/reviewing-prs.html) for a full explanation of the review process.&lt;details&gt;
 The Bot is tracking the review progress through labels. Labels are applied according to the order of the review items. For consensus, approval by a Flink committer of PMC member is required &lt;summary&gt;Bot commands&lt;/summary&gt;
  The @flinkbot bot supports the following commands:

 - `@flinkbot approve description` to approve one or more aspects (aspects: `description`, `consensus`, `architecture` and `quality`)
 - `@flinkbot approve all` to approve all aspects
 - `@flinkbot approve-until architecture` to approve everything until `architecture`
 - `@flinkbot attention @username1 [@username2 ..]` to require somebody's attention
 - `@flinkbot disapprove architecture` to remove an approval you gave earlier
&lt;/details&gt;
              </div></li><li><div>
                &lt;!--
Meta data
Hash:0ff3661a4946c47acc4ea362a869b9885e5712b6 Status:SUCCESS URL:https://travis-ci.com/flink-ci/flink/builds/128695210 TriggerType:PUSH TriggerID:0ff3661a4946c47acc4ea362a869b9885e5712b6
Hash:3a2882b20f794fde7f3254ca46d22f8f3ebd4081 Status:FAILURE URL:https://travis-ci.com/flink-ci/flink/builds/128901462 TriggerType:PUSH TriggerID:3a2882b20f794fde7f3254ca46d22f8f3ebd4081
Hash:fac45a7be4ede2c627f68135e926784943c677a3 Status:SUCCESS URL:https://travis-ci.com/flink-ci/flink/builds/128904622 TriggerType:PUSH TriggerID:fac45a7be4ede2c627f68135e926784943c677a3
--&gt;
## CI report:

* 0ff3661a4946c47acc4ea362a869b9885e5712b6 : SUCCESS [Build](https://travis-ci.com/flink-ci/flink/builds/128695210)
* 3a2882b20f794fde7f3254ca46d22f8f3ebd4081 : FAILURE [Build](https://travis-ci.com/flink-ci/flink/builds/128901462)
* fac45a7be4ede2c627f68135e926784943c677a3 : SUCCESS [Build](https://travis-ci.com/flink-ci/flink/builds/128904622)

              </div></li><li><div>
                Merging now.
              </div></li><li><div>
                Merged via 8b85715cfb9d9927c7d2fb82593be0bcaf084502
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                I think it should be `FutureUtils.composeAfterwards(remainingServicesTerminationFuture, () -&gt; terminateExecutors(shutdownTimeoutMillis)`. Otherwise `terminateExecutors` would not be executed in case of an exceptional completion of `remainingServicesTerminationFuture`.
              </div></li><li><div>
                Right. Updating...
              </div></li><li><div>
                Also I update the calls to `thenCompose` with `closeMetricSystem`. Correspondingly update pull request description and commit info.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>