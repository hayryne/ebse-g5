<!DOCTYPE html><html><div class="item-title">
        Item 332
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * Configuration strings class.
   * required for SCMSecurityProtocol where the KerberosInfo references
   * the old configuration with
   * the annotation shown below:-
   * @KerberosInfo(serverPrincipal = ScmConfigKeys
   *    .HDDS_SCM_KERBEROS_PRINCIPAL_KEY)
   
              </div></li><li><div>
                *
 * The configuration class for the SCM service.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 *  with the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 
              </div></li><li><div>
                *
   * This static class is required to support other classes
   * that reference the key names and also require attributes.
   * Example: SCMSecurityProtocol where the KerberosInfo references
   * the old configuration with the annotation shown below:-
   * @KerberosInfo(serverPrincipal =
   *    ScmConfigKeys.HDDS_SCM_KERBEROS_PRINCIPAL_KEY)
   
              </div></li><li><div>
                *
 * SCM HTTP Server configuration in Java style configuration class.
 
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding
 * copyright ownership. The ASF licenses this file to you under the Apache
 * License, Version 2.0 (the
 * "License"); you may not use this file except in compliance with the
 * License. You may obtain a
 * copy of the License at
 *
 * &lt;p&gt;http://www.apache.org/licenses/LICENSE-2.0
 *
 * &lt;p&gt;Unless required by applicable law or agreed to in writing, software
 * distributed under the
 * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and
 * limitations under the License.
 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent (#115)
                </div><div><b>message:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent (#115)



                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div></div></li><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div></div></li><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div></div></li><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div></div></li><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> HDDS-1847: Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>body:</b> Refactored some configuration to Java style configuration classes.

Changes pass rat, checkstyle and unit tests.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                /label ozone
              </div></li><li><div>
                /retest
              </div></li><li><div>
                Can you please make sure this test is not failing because of this change ? 
org.apache.hadoop.ozone.TestSecureOzoneCluster 

If the failure is not due to this test, then I can go ahead and commit this. Thanks

              </div></li><li><div>
                /retest
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Datanode Kerberos principal and keytab config key looks inconsistent
                </div><div><b>description:</b> Ozone Kerberos configuration can be very confusing:

| config name | Description |
| hdds.scm.kerberos.principal | SCM service principal |
| hdds.scm.kerberos.keytab.file | SCM service keytab file |
| ozone.om.kerberos.principal | Ozone Manager service principal |
| ozone.om.kerberos.keytab.file | Ozone Manager keytab file |
| hdds.scm.http.kerberos.principal | SCM service spnego principal |
| hdds.scm.http.kerberos.keytab.file | SCM service spnego keytab file |
| ozone.om.http.kerberos.principal | Ozone Manager spnego principal |
| ozone.om.http.kerberos.keytab.file | Ozone Manager spnego keytab file |
| hdds.datanode.http.kerberos.keytab | Datanode spnego keytab file |
| hdds.datanode.http.kerberos.principal | Datanode spnego principal |
| dfs.datanode.kerberos.principal | Datanode service principal |
| dfs.datanode.keytab.file | Datanode service keytab file |

The prefix are very different for each of the datanode configuration.  It would be nice to have some consistency for datanode.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Good catch, we should move to the Ozone Configuration format, Defined at the following Link

https://cwiki.apache.org/confluence/display/HADOOP/Java-based+configuration+API
              </div></li><li><div>
                Also, we should add a tag called "Kerberos" because it will allow us to find all Kerberos related settings easily.
              </div></li><li><div>
                I'm unclear on this issue. The bottom 2 keys are HDFS specific, not Ozone, changing those keys means affecting HDFS project and not HDDS project?. Can I please get more clarification on what is required?
              </div></li><li><div><div><b>body:</b> [~chris.teoh@gmail.com] Hadoop 3.3.0+ has changed back to use hadoop.http.authentication.kerberos.keytab for securing HTTP protocol with Kerberos.  Hadoop unified the SPNEGO settings to make sure that all HTTP ports are secured by one global setting.  Ozone is departing from Hadoop, hence, some changes may not apply where other changes are worth considering.  There are three usability improvements that might help Ozone Kerberos configuration to be easier to use.
This ticket is focusing on three problems in Ozone Kerberos config names:

1. Datanode keytab files and principal names are inconsistent.  SPNEGO files are prefixed with hdds, but Ozone datanodes are still using dfs prefix.  It maybe useful to separate out Ozone deployed datanode config from HDFS to prevent confusion.
2. Datanode SPNEGO keytab file name is suffixed with keytab (look like Hadoop convention, but other Ozone processes are not suffixed with keytab.file.)
3. Should all SPNEGO keytab file uses the same prefix like Hadoop to prevent programming errors?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  1m 17s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} dupname {color} | {color:green}  0m  0s{color} | {color:green} No case conflicting files found. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
|| || || || {color:brown} trunk Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 59s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:red}-1{color} | {color:red} mvninstall {color} | {color:red}  0m 36s{color} | {color:red} hadoop-hdds in trunk failed. {color} |
| {color:red}-1{color} | {color:red} mvninstall {color} | {color:red}  0m 40s{color} | {color:red} hadoop-ozone in trunk failed. {color} |
| {color:red}-1{color} | {color:red} compile {color} | {color:red}  0m 18s{color} | {color:red} hadoop-hdds in trunk failed. {color} |
| {color:red}-1{color} | {color:red} compile {color} | {color:red}  0m 13s{color} | {color:red} hadoop-ozone in trunk failed. {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 56s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m  0s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 15m 55s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:red}-1{color} | {color:red} javadoc {color} | {color:red}  0m 18s{color} | {color:red} hadoop-hdds in trunk failed. {color} |
| {color:red}-1{color} | {color:red} javadoc {color} | {color:red}  0m 16s{color} | {color:red} hadoop-ozone in trunk failed. {color} |
| {color:blue}0{color} | {color:blue} spotbugs {color} | {color:blue} 17m 21s{color} | {color:blue} Used deprecated FindBugs config; considering switching to SpotBugs. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 30s{color} | {color:red} hadoop-hdds in trunk failed. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 17s{color} | {color:red} hadoop-ozone in trunk failed. {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 24s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:red}-1{color} | {color:red} mvninstall {color} | {color:red}  0m 32s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} mvninstall {color} | {color:red}  0m 35s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
| {color:red}-1{color} | {color:red} compile {color} | {color:red}  0m 21s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} compile {color} | {color:red}  0m 15s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
| {color:red}-1{color} | {color:red} javac {color} | {color:red}  0m 21s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} javac {color} | {color:red}  0m 15s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 26s{color} | {color:orange} hadoop-hdds: The patch generated 43 new + 0 unchanged - 0 fixed = 43 total (was 0) {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 27s{color} | {color:orange} hadoop-ozone: The patch generated 5 new + 0 unchanged - 0 fixed = 5 total (was 0) {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m  0s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 13m 38s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:red}-1{color} | {color:red} javadoc {color} | {color:red}  0m 20s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} javadoc {color} | {color:red}  0m 16s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 29s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 16s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:red}-1{color} | {color:red} unit {color} | {color:red}  0m 24s{color} | {color:red} hadoop-hdds in the patch failed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red}  0m 23s{color} | {color:red} hadoop-ozone in the patch failed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 29s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 43m 28s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=19.03.4 Server=19.03.4 base: https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/Dockerfile |
| GITHUB PR | https://github.com/apache/hadoop/pull/1678 |
| JIRA Issue | HDDS-1847 |
| Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient findbugs checkstyle |
| uname | Linux 5736d78e1d6f 4.15.0-66-generic #75-Ubuntu SMP Tue Oct 1 05:24:09 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | personality/hadoop.sh |
| git revision | trunk / 8625265 |
| Default Java | 1.8.0_222 |
| mvninstall | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-mvninstall-hadoop-hdds.txt |
| mvninstall | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-mvninstall-hadoop-ozone.txt |
| compile | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-compile-hadoop-hdds.txt |
| compile | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-compile-hadoop-ozone.txt |
| javadoc | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-javadoc-hadoop-hdds.txt |
| javadoc | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-javadoc-hadoop-ozone.txt |
| findbugs | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-findbugs-hadoop-hdds.txt |
| findbugs | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/branch-findbugs-hadoop-ozone.txt |
| mvninstall | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-mvninstall-hadoop-hdds.txt |
| mvninstall | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-mvninstall-hadoop-ozone.txt |
| compile | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-compile-hadoop-hdds.txt |
| compile | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-compile-hadoop-ozone.txt |
| javac | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-compile-hadoop-hdds.txt |
| javac | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-compile-hadoop-ozone.txt |
| checkstyle | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/diff-checkstyle-hadoop-hdds.txt |
| checkstyle | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/diff-checkstyle-hadoop-ozone.txt |
| javadoc | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-javadoc-hadoop-hdds.txt |
| javadoc | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-javadoc-hadoop-ozone.txt |
| findbugs | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-findbugs-hadoop-hdds.txt |
| findbugs | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-findbugs-hadoop-ozone.txt |
| unit | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-unit-hadoop-hdds.txt |
| unit | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/artifact/out/patch-unit-hadoop-ozone.txt |
|  Test Results | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/testReport/ |
| Max. process+thread count | 305 (vs. ulimit of 5500) |
| modules | C: hadoop-hdds/common hadoop-hdds/container-service hadoop-hdds/server-scm hadoop-ozone/integration-test U: . |
| Console output | https://builds.apache.org/job/hadoop-multibranch/job/PR-1678/1/console |
| versions | git=2.7.4 maven=3.3.9 |
| Powered by | Apache Yetus 0.10.0 http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                I have committed this patch to the master branch. 
              </div></li><li><div>
                Looks like this commit breaks {{TestKeyManagerImpl}} in {{setUp()}} and {{cleanup()}}. Run {{TestKeyManagerImpl#testListStatus()}} to steadily repro. I believe there could be other tests that are broken by this.

{code}
java.lang.NullPointerException
	at org.apache.hadoop.hdds.scm.server.StorageContainerManagerHttpServer.getSpnegoPrincipal(StorageContainerManagerHttpServer.java:74)
	at org.apache.hadoop.hdds.server.BaseHttpServer.&lt;init&gt;(BaseHttpServer.java:81)
	at org.apache.hadoop.hdds.scm.server.StorageContainerManagerHttpServer.&lt;init&gt;(StorageContainerManagerHttpServer.java:36)
	at org.apache.hadoop.hdds.scm.server.StorageContainerManager.&lt;init&gt;(StorageContainerManager.java:330)
	at org.apache.hadoop.hdds.scm.TestUtils.getScm(TestUtils.java:544)
	at org.apache.hadoop.ozone.om.TestKeyManagerImpl.setUp(TestKeyManagerImpl.java:150)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:24)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
{code}

{code}
java.lang.NullPointerException
	at org.apache.hadoop.ozone.om.TestKeyManagerImpl.cleanup(TestKeyManagerImpl.java:176)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:33)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
{code}
              </div></li><li><div>
                interesting, [~chris.teoh@gmail.com] can you please take a look when you get a chance.?
              </div></li><li><div>
                Looks like this commit did not get a full Anzix CI run in GitHub.

I propose reverting this and rolling up the changes to fix the unit tests in a new commit.
              </div></li><li><div>
                I've reverted this to unblock other CI runs which may get stuck on the failing tests.

We can recommit with UT fixes.
              </div></li><li><div>
                It was my mistake. I saw this patch did not have the CI run. The patch was posted against hadoop repo instead of hadoop-ozone.
Chris works out of Australia and is quite new to Ozone. So I am made a call that we will commit this and follow up with other patches that will fix the issue. I think he has already filed the follow up patches.

Now that it is reverted, it might be better to recommit with the patch against hadoop-ozone.
              </div></li><li><div>
                [~chris.teoh@gmail.com] Thanks for the contribution. [~elek] Thanks for retesting this patch. I have committed this change to the master branch.
              </div></li><li><div>
                Thanks very much for your help [~aengineer]. Really appreciate it! :)(y)
              </div></li></ol></div></div></html>