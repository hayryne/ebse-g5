<!DOCTYPE html><html><div class="item-title">
        Item 53
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> KAFKA-7833: Add missing test (#8847)
                </div><div><b>message:</b> KAFKA-7833: Add missing test (#8847)

Reviewers: Guozhang Wang &lt;guozhang@confluent.io&gt;, John Roesler &lt;john@confluent.io&gt;
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> KAFKA-7833: Add missing test
                </div><div><b>body:</b> Quick follow up to #8825 

Call for review @guozhangwang @vvcephei 
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Merged to `trunk` and cherry-picked to `2.6` branch.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Minor improvement for the error message
              </div></li><li><div>
                Just renaming the store to make the error message in the tests easier to read.
              </div></li><li><div>
                Just refactoring:
 - add missing generic types
 - use `assertThrows`
 - add check for error message
              </div></li><li><div>
                As above
              </div></li><li><div>
                As above (the diff is just weird... this is an existing test; cf. below)
              </div></li><li><div>
                This is the missing test case.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> StreamsBuilder should throw an exception if addGlobalStore and addStateStore is called for the same store builder
                </div><div><b>description:</b> {{StoreBuilder&lt;KeyValueStore&lt;String, String&gt;&gt; storeBuilder =}}
{{ Stores.keyValueStoreBuilder(Stores.inMemoryKeyValueStore("global-store"), null, null);}}


{{ builder.addGlobalStore(}}
{{ storeBuilder,}}
{{ "global-topic",}}
{{ Consumed.with(null, null),}}
{{ new KTableSource(storeBuilder.name())}}
{{ );}}

{{builder.addStateStore(storeBuilder); }}

{{builder.build();}}

&nbsp;

&nbsp;

Does not throw an exception.

&nbsp;

cc [~mjsax]
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Could you elaborate a bit more on why we should not allow the same StoreBuilder to be used? The StoreBuilder.build() call is expected to return different store upon each triggering, so the two stores used for these two places should be distinct.

The problem is with the store name: same store names are not expected.
              </div></li><li><div>
                {quote}The problem is with the store name: same store names are not expected.
{quote}
That is the exact problem. The store name is returned by the StoreBuilder, and thus adding the same StoreBuilder twice, results is a naming conflict that is not detected atm.
              </div></li><li><div>
                I'm looking for my first issue to tackle. It sounds like adding a duplicated name check on the StreamsBuilder build path should suffice. Can I take this one?

I'm thinking a node name conflict check at&nbsp;[https://github.com/apache/kafka/blob/43a9e39983bc3fc2363723b9c555e49b016c1ae2/streams/src/main/java/org/apache/kafka/streams/kstream/internals/graph/StreamsGraphNode.java#L79-L81]

&nbsp;

Or would that be too restrictive, and the check should be implemented at InternalStreamsBuilder level?
              </div></li><li><div>
                PR:&nbsp;[https://github.com/apache/kafka/pull/8825]
              </div></li><li><div>
                Thanks for the PR. Will take a look.

Also added you to the list of contributors and assigned the ticket to you. You can now also self-assign tickets.
              </div></li></ol></div></div></html>