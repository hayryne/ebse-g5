<!DOCTYPE html><html><div class="item-title">
        Item 48
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [BEAM-9164] Re-enable UnboundedSourceWrapper#testWatermarkEmission test
                </div><div><b>message:</b> [BEAM-9164] Re-enable UnboundedSourceWrapper#testWatermarkEmission test

The stability issues should be resolved by d106f263e625e5d7c4f3848f16da301871f65142.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div></div></li><li><div><div><b>summary:</b> [PreCommit_Java] [Flake] UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest
                </div><div><b>description:</b> Test:

org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest &gt;&gt;&nbsp;testWatermarkEmission[numTasks = 1; numSplits=1]

Fails with the following exception:
{code:java}
org.junit.runners.model.TestTimedOutException:&nbsp;test timed out after 30000 milliseconds{code}
Affected Jenkins job:&nbsp;[https://builds.apache.org/job/beam_PreCommit_Java_Phrase/1665/]

Gradle build scan:&nbsp;[https://scans.gradle.com/s/nvgeb425fe63q]
                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Same thing happened on https://builds.apache.org/job/beam_PreCommit_Java_Commit/9726
              </div></li><li><div><div><b>body:</b> I tried to reproduce the flakiness in my workstation by running the {{UnboundedSourceWrapperTest}} 100 times, but could not reproduce the failure.

{noformat}
    @Parameterized.Parameters(name = "numTasks = {0}; numSplits={1}")
    public static Collection&lt;Object[]&gt; data() {
      /*
       * Parameters for initializing the tests:
       * {numTasks, numSplits}
       * The test currently assumes powers of two for some assertions.
       */

      ImmutableList.Builder&lt;Object[]&gt; list = ImmutableList.builder();
      for (int i=0; i&lt; 100; ++i) {
        list.addAll(Arrays.asList(new Object[][] {
            {1, 1}, {1, 2}, {1, 4},
            {2, 1}, {2, 2}, {2, 4},
            {4, 1}, {4, 2}, {4, 4},
        }));
      }
      return list.build();
    }

{noformat}

Memo: what if the test is interfered by other tests? How can we verify a fix is correct solution?
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                Saw a timeout on  org.apache.beam.runners.flink.translation.wrappers.streaming.io.UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest.testWatermarkEmission[numTasks = 4; numSplits=1].
              </div></li><li><div>
                Note that we are ignoring this test for now: https://github.com/apache/beam/pull/11614.

I ran UnboundedSourceWrapperTest a great many times on my desktop as well, but I was unable to reproduce the error. [~mxm] Have you investigated this?
              </div></li><li><div><div><b>body:</b> I was not aware that tests had been disabled. I'm a bit shocked that we just disabled them without mentioning relevant folks or at least posting in the JIRA.

I changed logic around the watermark propagation in BEAM-9900 which could have removed the flakiness. I'll re-enable the tests.
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                This should be fixed but feel free to re-open if it pops up again.
              </div></li><li><div>
                Just saw this again here: https://builds.apache.org/job/beam_PreCommit_Java_Commit/11773/testReport/junit/org.apache.beam.runners.flink.translation.wrappers.streaming.io/UnboundedSourceWrapperTest$ParameterizedUnboundedSourceWrapperTest/testWatermarkEmission_numTasks___4__numSplits_2_/
              </div></li><li><div>
                Do you have time to take a look [~mxm]?
              </div></li><li><div>
                Finally had a look at the code. I was able to find the race condition. PR: https://github.com/apache/beam/pull/12025
              </div></li><li><div>
                The root cause has been investigated and fixed per https://github.com/apache/beam/pull/12025.
              </div></li></ol></div></div></html>