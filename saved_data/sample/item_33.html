<!DOCTYPE html><html><div class="item-title">
        Item 33
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 8 Test - special case, begin inside last slice block but outside asset len
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> slice/handleFirstServerHeader: return sooner on requested range errors (#7486)
                </div><div><b>message:</b> slice/handleFirstServerHeader: return sooner on requested range errors (#7486)

(cherry picked from commit df01ace2b0bdffd3ddcc5b2c7587b6d6fed5234c)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> slice/server: handleFirstServerHeader exit sooner on detected requested range errors.
                </div><div><b>body:</b> When examining the first server response header with a bad range request the function should exit sooner.

I was able to recreate a crash and added a test case for it.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Why is that? I've never heard that claim before. Testing with g++ back to 8.3, `std::numeric_limits&lt;in64_t&gt;::max()` works as a `constexpr`, e.g. use of it causes a load immediate instruction, even at "-O0".

If you want to be absolute certain, do this:
```
#include &lt;type_traits&gt;
static_assert(std::integral_constant&lt;int64_t, Range::maxval&gt;::value);
```
If that compiles, it's a compile time constant.
              </div></li><li><div>
                I believe per the standard numeric_limits are constexpr. https://en.cppreference.com/w/cpp/types/numeric_limits/max lists it as constexpr. I'd say numeric_limits are more idiomatic for C++ than the _MAX macros.

Out of curiosity, @traeak , did you run into an issue with numeric_limits that motivated this?

Thanks,
              </div></li><li><div>
                Looks like the handleFirstServerHeader should return sooner when range errors are detected.

backtrace seemed to indicate that this static var pointed to the same address as the first data member in that Range instance.  That sent me in the wrong direction.  std::numeric_limits has sometimes not behaved not very well with msvc, especially when used for default arg values.
              </div></li><li><div>
                Cherry-picked to v9.0.x branch.
Cherry-picked to v9.1.x branch.

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                These probably get optimized out but it's worthwhile cleanup.
              </div></li><li><div>
                It's not clear why this is being changed from max / 4 to max / 2, or really why it's not just max.  But I'll take it on faith.
              </div></li><li><div>
                it just has to be sufficiently large but not max64.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>