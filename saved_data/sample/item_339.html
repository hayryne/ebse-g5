<!DOCTYPE html><html><div class="item-title">
        Item 339
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Remove conscrypt as security provider.  (#7056)
                </div><div><b>message:</b> Remove conscrypt as security provider.  (#7056)

* Add an experimental flag to disable conscrypt SSL.
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Remove conscrypt as security provider. 
                </div><div><b>body:</b> Remove conscrypt as security provider.  This security provider causes hangs in certain cases.

------------------------

Follow this checklist to help us incorporate your contribution quickly and easily:

 - [ ] Format the pull request title like `[BEAM-XXX] Fixes bug in ApproximateQuantiles`, where you replace `BEAM-XXX` with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.
 - [ ] If this contribution is large, please file an Apache [Individual Contributor License Agreement](https://www.apache.org/licenses/icla.pdf).

It will help us expedite review of your Pull Request if you tag someone (e.g. `@username`) to look at it.

Post-Commit Tests Status (on master branch)
------------------------------------------------------------------------------------------------

Lang | SDK | Apex | Dataflow | Flink | Gearpump | Samza | Spark
--- | --- | --- | --- | --- | --- | --- | ---
Go | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Go_GradleBuild/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Go_GradleBuild/lastCompletedBuild/) | --- | --- | --- | --- | --- | ---
Java | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_GradleBuild/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_GradleBuild/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Apex_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Apex_Gradle/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Dataflow_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Dataflow_Gradle/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Flink_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Flink_Gradle/lastCompletedBuild/) [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Gearpump_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Gearpump_Gradle/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Samza_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Samza_Gradle/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark_Gradle/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark_Gradle/lastCompletedBuild/)
Python | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Python_Verify/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python_Verify/lastCompletedBuild/) | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Py_VR_Dataflow/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Py_VR_Dataflow/lastCompletedBuild/) &lt;/br&gt; [![Build Status](https://builds.apache.org/job/beam_PostCommit_Py_ValCont/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Py_ValCont/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Python_VR_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python_VR_Flink/lastCompletedBuild/) | --- | --- | ---





                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                I changed this to use an experiment to disable instead of removing totally. Because this provider has some performance advantages.

@swegner is this the right way to use the experiment framework?

              </div></li><li><div>
                Jobs failed with `Failed to retrieve staged files: ...` errors. Not sure if it is related, re-running tests.
              </div></li><li><div>
                Run JavaPortabilityApi PreCommit
              </div></li><li><div>
                Run Python PreCommit
              </div></li><li><div>
                Run Python PostCommit
              </div></li><li><div>
                &gt; @swegner is this the right way to use the experiment framework?

Yes, this looks good. I wasn't previously familiar with the `ExperimentContext` helper; this is just a friendly wrapper around parsing [`ExperimentalOptions`](https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/options/ExperimentalOptions.java) directly.
              </div></li><li><div>
                Run Java PostCommit
              </div></li><li><div>
                FYI, Java post-commits are currently blocked on https://issues.apache.org/jira/browse/BEAM-6080. I'm working on a rollback now; you'll need to merge master into this branch

              </div></li><li><div>
                Ack, thank you @swegner.
              </div></li><li><div>
                Run Java PostCommit
              </div></li><li><div>
                This optimization was introduced on June 7 (before this code was open sourced). Data from that was "This improves Dataflow Avro source benchmark by ~15%.". So enabling the experiment would result in that much of a regression roughly.

It would only affect Dataflow runner, since the change is in the dataflow worker harness.
I do not know about its impact in relation to JVM.
              </div></li><li><div>
                Thanks for the context. I see no problem merging this as-is since it is behind an experiment and doesn't change the default behavior. LGTM

If we want to make this default we should discuss more about the pros/cons, particularly with respect to performance delta.
              </div></li><li><div>
                Feel free to squash and merge
              </div></li><li><div>
                Thanks @swegner, will do. 

Do you think we should add an info log inside the if? I think this will help with debugging conscrypt issues.
              </div></li><li><div>
                Yes, a log could be useful for debugging. Note that most pipelines won't really care about this, so make sure it is low-verbosity.

I believe the default for Dataflow runner is to upload everything INFO and above to Stackdriver; DEBUG logs get dropped unless explicitly configured.
              </div></li><li><div>
                Run Java PostCommit
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>