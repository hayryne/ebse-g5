<!DOCTYPE html><html><div class="item-title">
        Item 107
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                Conserve mode is irrelevant on L2 network offerings as there are no resources to conserve, do not pass it, true by default on server side
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ui: do not send conserve mode on L2 network offering creation from the UI (#2694)
                </div><div><b>message:</b> ui: do not send conserve mode on L2 network offering creation from the UI (#2694)

Do not send conserve mode param on L2 network offering creation from the UI. Fix config drive NPE issue on L2 network.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div></div></li><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div></div></li><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div></div></li><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div></div></li><li><div><div><b>title:</b> L2 network offerings are not returned if zoneId is passed in listNetworkOfferings
                </div><div><b>body:</b> &lt;!--
Verify first that your issue/request is not already reported on GitHub.
Also test if the latest release and master branch are affected too.
Always add information AFTER of these HTML comments, but no need to delete the comments.
--&gt;

##### ISSUE TYPE
&lt;!-- Pick one below and delete the rest --&gt;
 * Bug Report

##### COMPONENT NAME
&lt;!--
Categorize the issue, e.g. API, VR, VPN, UI, etc.
--&gt;
~~~
API
~~~

##### CLOUDSTACK VERSION
&lt;!--
New line separated list of affected versions, commit ID for issues on master branch.
--&gt;

~~~
4.11.0
~~~

##### CONFIGURATION
&lt;!--
Information about the configuration if relevant, e.g. basic network, advanced networking, etc.  N/A otherwise
--&gt;
CloudStack with 4.11.0 installed

##### OS / ENVIRONMENT
&lt;!--
Information about the environment if relevant, N/A otherwise
--&gt;
N/A

##### SUMMARY
&lt;!-- Explain the problem/feature briefly --&gt;


##### STEPS TO REPRODUCE
&lt;!--
For bugs, show exactly how to reproduce the problem, using a minimal test-case. Use Screenshots if accurate.

For new features, show how the feature would be used.
--&gt;

&lt;!-- Paste example playbooks or commands between quotes below --&gt;
~~~
Create an L2 network offering and enable it.
then either:

- use cloudmonkey to list network offerings (including a zoneid): 
list networkofferings guestiptype=L2 zoneid=&lt;your zone uui&gt; # i.e. da6b6a69-f823-4cb6-be4d-e714fd3bb926 in the example given below

- go to UI and try to create an L2 network

~~~

&lt;!-- You can also paste gist.github.com links for larger files --&gt;

##### EXPECTED RESULTS
&lt;!-- What did you expect to happen when running the steps above? --&gt;

~~~
cloudmonkey should return the L2 network created earlier
AND
UI dropdown should include the L2 network offering created earlier
~~~

##### ACTUAL RESULTS
&lt;!-- What actually happened? --&gt;

&lt;!-- Paste verbatim command output between quotes below --&gt;
~~~
cloudmonkey returns no network offerings
and
UI dropdown should include the network offering created earlier

_NB if zoneid argument is not passed then response is as expected
list networkofferings guestiptype=L2
{
  "count": 1,
  "networkoffering": [
    {
      "availability": "Optional",
      "conservemode": false,
      "displaytext": "L2-with-ConfigDrive",
      "egressdefaultpolicy": true,
      "forvpc": false,
      "guestiptype": "L2",
      "id": "da6b6a69-f823-4cb6-be4d-e714fd3bb926",
      "isdefault": false,
      "ispersistent": false,
      "name": "L2-with-ConfigDrive",
      "networkrate": 200,
      "service": [
        {
          "name": "UserData",
          "provider": [
            {
              "name": "ConfigDrive"
            }
          ]
        }
      ],
      "serviceofferingid": "579c5e08-048a-4f27-8676-89a41370d806",
      "specifyipranges": false,
      "specifyvlan": false,
      "state": "Enabled",
      "supportspublicaccess": false,
      "supportsstrechedl2subnet": false,
      "traffictype": "Guest"
    }
  ]
}_

~~~

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                @blueoranguntan package
              </div></li><li><div>
                @PaulAngus I don't think the ape will package issues ;)
              </div></li><li><div><div><b>body:</b> shame, i'd like to package issues up and send them somewhere else.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                :) 🥇
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Do not send conserve mode param on L2 network offering creation from the UI
                </div><div><b>body:</b> ## Description
Prevent creation of L2 network offerings with conserve mode = false. As conserve mode is irrelevant for L2 networks as there are no resources to conserve, we do not send the Conserve mode parameter to network offering creation, as it will be True by default. Conserve mode = false caused that L2 network offerings in a zone were not listed, as described in the issue below.

## Types of changes
- [ ] Breaking change (fix or feature that would cause existing functionality to change)
- [ ] New feature (non-breaking change which adds functionality)
- [x] Bug fix (non-breaking change which fixes an issue)
- [ ] Enhancement (improves an existing feature and functionality)
- [ ] Cleanup (Code refactoring and cleanup, that may add test cases)

## GitHub Issue/PRs
This fixes the issue #2690 

## Screenshots (if appropriate):
No Conserve mode checkbox when L2 is selected:
![image](https://user-images.githubusercontent.com/5295080/41046413-bc2cd1ee-6980-11e8-991f-8cb3e665b7bb.png)
List zone L2 network offerings:
![image](https://user-images.githubusercontent.com/5295080/41046566-08ab2f16-6981-11e8-9ddc-b224a1294b2e.png)

## How Has This Been Tested?
Create an L2 network offering (check that Conserve mode checkbox is not visible). Check that conserve mode is true for the created offering

## Checklist:
- [x] I have read the [CONTRIBUTING](https://github.com/apache/cloudstack/blob/master/CONTRIBUTING.md) document.
- [x] My code follows the code style of this project.
- [ ] My change requires a change to the documentation.
- [ ] I have updated the documentation accordingly.
Testing
- [ ] I have added tests to cover my changes.
- [x] All relevant new and existing integration tests have passed.
- [ ] A full integration testsuite with all test that can run on my environment has passed.


                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @blueorangutan package
              </div></li><li><div>
                @nvazquez a Jenkins job has been kicked to build packages. I'll keep you posted as I make progress.
              </div></li><li><div>
                Packaging result: ✔centos6 ✔centos7 ✔debian. JID-2092
              </div></li><li><div>
                @blueorangutan test
              </div></li><li><div>
                @nvazquez a Trillian-Jenkins test job (centos7 mgmt + kvm-centos7) has been kicked to run smoke tests
              </div></li><li><div>
                &lt;b&gt;Trillian test result (tid-2726)&lt;/b&gt;
Environment: kvm-centos7 (x2), Advanced Networking with Mgmt server 7
Total time taken: 25692 seconds
Marvin logs: https://github.com/blueorangutan/acs-prs/releases/download/trillian/pr2694-t2726-kvm-centos7.zip
Intermitten failure detected: /marvin/tests/smoke/test_deploy_virtio_scsi_vm.py
Intermitten failure detected: /marvin/tests/smoke/test_privategw_acl.py
Intermitten failure detected: /marvin/tests/smoke/test_vm_life_cycle.py
Intermitten failure detected: /marvin/tests/smoke/test_host_maintenance.py
Intermitten failure detected: /marvin/tests/smoke/test_hostha_kvm.py
Smoke tests completed. 62 look OK, 5 have error(s)
Only failed tests results shown below:


Test | Result | Time (s) | Test File
--- | --- | --- | ---
ContextSuite context=TestDeployVirtioSCSIVM&gt;:setup | `Error` | 0.00 | test_deploy_virtio_scsi_vm.py
test_03_vpc_privategw_restart_vpc_cleanup | `Failure` | 163.80 | test_privategw_acl.py
test_01_secured_vm_migration | `Error` | 1.15 | test_vm_life_cycle.py
test_02_not_secured_vm_migration | `Error` | 1.16 | test_vm_life_cycle.py
test_03_secured_to_nonsecured_vm_migration | `Error` | 1.16 | test_vm_life_cycle.py
test_04_nonsecured_to_secured_vm_migration | `Error` | 1.15 | test_vm_life_cycle.py
test_08_migrate_vm | `Error` | 6.37 | test_vm_life_cycle.py
test_01_cancel_host_maintenace_with_no_migration_jobs | `Failure` | 0.15 | test_host_maintenance.py
test_02_cancel_host_maintenace_with_migration_jobs | `Error` | 41.44 | test_host_maintenance.py
test_hostha_enable_ha_when_host_in_maintenance | `Error` | 2.64 | test_hostha_kvm.py

              </div></li><li><div>
                @nvazquez can you add screenshots to show that it works?
              </div></li><li><div>
                Sure @DaanHoogland, I've added them to the PR description. 
              </div></li><li><div>
                @blueorangutan package
              </div></li><li><div>
                @nvazquez a Jenkins job has been kicked to build packages. I'll keep you posted as I make progress.
              </div></li><li><div>
                Packaging result: ✔centos6 ✔centos7 ✔debian. JID-2096
              </div></li><li><div>
                @PaulAngus @DaanHoogland @rhtyd after the fix for config drive, I can see the iso gets created but somehow not available through deployed VM:

````
2018-06-07 00:22:06,885 DEBUG [o.a.c.e.o.NetworkOrchestrator] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Asking ConfigDrive to prepare for Nic[12-8-13e0ae61-72f5-4471-983b-060574212266-null]
2018-06-07 00:22:06,899 DEBUG [c.c.n.e.ConfigDriveNetworkElement] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Creating config drive ISO for vm: i-2-8-VM
2018-06-07 00:22:06,901 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=service-offering, content=Small Instance
2018-06-07 00:22:06,901 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=availability-zone, content=trl-1430-k-cs411-nvazquez
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=local-hostname, content=cfg-drv-2
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=local-ipv4, content=null
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=public-ipv4, content=null
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=public-hostname, content=null
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=instance-id, content=b899c153-e3d6-4e00-af46-2721bc7afc92
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=vm-id, content=b899c153-e3d6-4e00-af46-2721bc7afc92
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=public-keys, content=null
2018-06-07 00:22:06,902 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) [createConfigDriveIsoForVM] dataType=metadata, filename=cloud-identifier, content=CloudStack-{8a11dd95-c350-4f99-9bdb-78bc17a8e9fc}
2018-06-07 00:22:06,903 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Executing config drive creation command: /usr/bin/genisoimage -o /tmp/configdrive8808714705692880737/configdrive.iso -ldots -allow-lowercase -allow-multidot -cache-inodes -l -quiet -J -r -V config-2 /tmp/configdrive8808714705692880737 
2018-06-07 00:22:06,904 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Executing: /usr/bin/genisoimage -o /tmp/configdrive8808714705692880737/configdrive.iso -ldots -allow-lowercase -allow-multidot -cache-inodes -l -quiet -J -r -V config-2 /tmp/configdrive8808714705692880737 
2018-06-07 00:22:06,906 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Executing while with timeout : 300000
2018-06-07 00:22:06,915 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Execution is successful.
2018-06-07 00:22:06,915 DEBUG [o.a.c.s.c.ConfigDriveBuilder] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Warning: creating filesystem that does not conform to ISO-9660.

2018-06-07 00:22:06,938 DEBUG [c.c.a.t.Request] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Seq 3-5477503046789366214: Sending  { Cmd , MgmtId: 6819703490805, via: 3(s-1-VM), Ver: v1, Flags: 100011, [{"com.cloud.agent.api.HandleConfigDriveIsoCommand":{"isoFile":"configdrive/i-2-8-VM/configdrive.iso","create":true,"destStore":{"com.cloud.agent.api.to.NfsTO":{"_url":"NFS://10.2.0.16/acs/secondary/trl-1430-k-cs411-nvazquez/trl-1430-k-cs411-nvazquez-sec1","_role":"Image"}},"wait":0}}] }
2018-06-07 00:22:07,314 DEBUG [c.c.a.t.Request] (AgentManager-Handler-20:null) (logid:) Seq 3-5477503046789366214: Processing:  { Ans: , MgmtId: 6819703490805, via: 3, Ver: v1, Flags: 10, [{"com.cloud.agent.api.Answer":{"result":true,"details":"Successfully saved config drive at secondary storage","wait":0}}] }
2018-06-07 00:22:07,314 DEBUG [c.c.a.t.Request] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Seq 3-5477503046789366214: Received:  { Ans: , MgmtId: 6819703490805, via: 3(s-1-VM), Ver: v1, Flags: 10, { Answer } }
2018-06-07 00:22:07,314 DEBUG [c.c.a.m.AgentManagerImpl] (Work-Job-Executor-2:ctx-5bf307a3 job-47/job-48 ctx-9e793f3b) (logid:28315433) Details from executing class com.cloud.agent.api.HandleConfigDriveIsoCommand: Successfully saved config drive at secondary storage
````

![image](https://user-images.githubusercontent.com/5295080/41071838-b3d7e150-69d0-11e8-9621-a28ff43d0b68.png)

              </div></li><li><div>
                @nvazquez can you try listing using blkid -o list instead. It's possible that the cdrom is not always at the device you're trying to mount/access. It sometimes can be on /dev/sr1 etc.
@blueorangutan package
              </div></li><li><div>
                @rhtyd a Jenkins job has been kicked to build packages. I'll keep you posted as I make progress.
              </div></li><li><div>
                @nvazquez /cc @PaulAngus 
I did a manual end to end testing of the config drive feature with this PR, LGTM. To mount on the default centos5 template, use `-o loop`, such as `mount -o loop /dev/cdrom /mnt`. I also tested the primary vs secondary storage to host config drive isos.
![screenshot from 2018-06-07 11-13-32](https://user-images.githubusercontent.com/95203/41080380-db3a6fc4-6a43-11e8-9f07-09e11ee9335f.png)

              </div></li><li><div>
                Merging this based on code reviews and manual testing, as well as travis and smoketests/trillian. Some of the smoketests failings are not caused by this PR but are env caused.
              </div></li><li><div>
                Packaging result: ✔centos6 ✔centos7 ✔debian. JID-2100
              </div></li><li><div>
                Packaging result: ✔centos6 ✔centos7 ✔debian. JID-2105
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                This could be isBlank to return, but isEmpty is okay too.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>