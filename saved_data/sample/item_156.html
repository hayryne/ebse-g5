<!DOCTYPE html><html><div class="item-title">
        Item 156
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. See accompanying LICENSE file.

              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> YARN-7328. ResourceUtils allows yarn.nodemanager.resource-types.memory-mb and .vcores to override yarn.nodemanager.resource.memory-mb and .cpu-vcores. (lovekesh bansal via wangda)
                </div><div><b>message:</b> YARN-7328. ResourceUtils allows yarn.nodemanager.resource-types.memory-mb and .vcores to override yarn.nodemanager.resource.memory-mb and .cpu-vcores. (lovekesh bansal via wangda)

Change-Id: Ibb1faf0beefec079dae2208986976b2f64650672

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> ResourceUtils allows yarn.nodemanager.resource-types.memory-mb and .vcores to override yarn.nodemanager.resource.memory-mb and .cpu-vcores
                </div><div><b>description:</b> We will throw an exception if yarn.nodemanager.resource-types.memory is configured, but not if .memory-mb or .vcores is configured.  We should be consistent.  We should not allow resource types to redefine something for which we already have a property to set. 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [~templedf] If you are not working on it, can I contribute here?
              </div></li><li><div>
                Thanks [~templedf] for filing the JIRA.

[~lovekesh.bansal], it's better to get this done before 3.1.0 release, do you have bandwidth to get a patch shortly? 
              </div></li><li><div>
                [~leftnoteasy] I'll do it in&nbsp;this week most probably by Wednesday.
              </div></li><li><div>
                [~lovekesh.bansal], thanks a lot!
              </div></li><li><div><div><b>body:</b> [~templedf]&nbsp; [~leftnoteasy] I&nbsp;think some of the things have changed since when the Jira was filed:&nbsp;
 # We are currently&nbsp;throwing that exception in&nbsp;checkMandatoryResources for if it contains memory. By making this change we will be limiting it to be defined in both resource-types.xml and node-resources.xml. Is&nbsp;that the intent here?&nbsp;
 # Now we have some more reosurces in MANDATORY_RESOURCES, so should&nbsp;not allow of them to be defined in node-resources.xml?&nbsp;
 # ResourceUtils.getNodeResourceInformation(conf) is called by&nbsp;NodeManagerHardwareUtils.

getNodeResources which&nbsp;after calling function checks if(memResInfo.getValue() == 0) \{ret.setMemorySize(getContainerMemoryMB(conf))}

So then&nbsp;if check would become redundant and we would always be setting the memory by calling&nbsp;

ret.setMemorySize(getContainerMemoryMB(conf)) .

Let me know your&nbsp;thoughts?&nbsp;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I&nbsp;have attached the first patch&nbsp;with just disabling memory-mb and vcores. And since we are throwing&nbsp;exception for all mandatory resources, we should addMandatoryResources only after&nbsp;checkMandatoryResources in&nbsp;getNodeResourceInformation. Please let me know your thoughts, accordingly I'll change the test cases.
              </div></li><li><div>
                Thanks [~lovekesh.bansal], the uploaded change looks good to me. Could you update test cases accordingly?
              </div></li><li><div>
                Submitting the first patch
              </div></li><li><div><div><b>body:</b> [~lovekesh.bansal], in general the patch looks good, could you please add test cases?

Thanks,

&nbsp;
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                Thanks&nbsp;[~leftnoteasy] Ya I'll add test cases shortly.
              </div></li><li><div>
                [~leftnoteasy] Uploading the second patch with the test cases. Please review. Also Not sure but&nbsp;auto build&nbsp;was not triggered after the first upload,&nbsp;am I missing something?
              </div></li><li><div>
                | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 30s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 4 new or modified test files. {color} |
|| || || || {color:brown} trunk Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 48s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 15m 33s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  7m 35s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 54s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 18s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m  4s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  1m 12s{color} | {color:red} hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api in trunk has 1 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 16s{color} | {color:green} trunk passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 11s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m  4s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  6m 27s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  6m 27s{color} | {color:green} the patch passed {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 56s{color} | {color:orange} hadoop-yarn-project/hadoop-yarn: The patch generated 8 new + 13 unchanged - 0 fixed = 21 total (was 13) {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 19s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  4s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 18s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  2m 43s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 14s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 44s{color} | {color:green} hadoop-yarn-api in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m 19s{color} | {color:green} hadoop-yarn-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 32s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 71m  1s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:5b98639 |
| JIRA Issue | YARN-7328 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12910739/YARN-7328_trunk.002.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  xml  |
| uname | Linux e83a676a08c2 4.4.0-89-generic #112-Ubuntu SMP Mon Jul 31 19:38:41 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 6ea7d78 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
| findbugs | v3.1.0-RC1 |
| findbugs | https://builds.apache.org/job/PreCommit-YARN-Build/19705/artifact/out/branch-findbugs-hadoop-yarn-project_hadoop-yarn_hadoop-yarn-api-warnings.html |
| checkstyle | https://builds.apache.org/job/PreCommit-YARN-Build/19705/artifact/out/diff-checkstyle-hadoop-yarn-project_hadoop-yarn.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/19705/testReport/ |
| Max. process+thread count | 410 (vs. ulimit of 5500) |
| modules | C: hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common U: hadoop-yarn-project/hadoop-yarn |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/19705/console |
| Powered by | Apache Yetus 0.8.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                jenkins seems fine. I could help commit this tomorrow if no objections. cc/ [~leftnoteasy]
              </div></li><li><div>
                Committed to trunk/branch-3.1, thanks [~lovekesh.bansal] and thanks review from [~sunilg]
              </div></li><li><div>
                SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #13675 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/13675/])
YARN-7328. ResourceUtils allows (wangda: rev ca1043ab9030339d7cdd3275c3f8f4713b8bff59)
* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api/src/main/java/org/apache/hadoop/yarn/util/resource/ResourceUtils.java
* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/resources/resource-types/resource-types-error-2.xml
* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/resources/resource-types/node-resources-2.xml
* (add) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/resources/resource-types/node-resources-error-1.xml
* (edit) hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common/src/test/java/org/apache/hadoop/yarn/util/resource/TestResourceUtils.java

              </div></li></ol></div></div></html>