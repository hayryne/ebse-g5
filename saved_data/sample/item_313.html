<!DOCTYPE html><html><div class="item-title">
        Item 313
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [MXNET-258] Improve flaky test_random.test_shuffle (#10313)
                </div><div><b>message:</b> [MXNET-258] Improve flaky test_random.test_shuffle (#10313)

* Fix random seed for test_shuffle

* A Comment for the fixed seed is added

* Set random seed to reproduce the failure of test_random.test_shuffle

* Add a link to the github issue on the discussion for the fixed seed

* Testing with the failed random seed and increased number of samples

* Increase the number of samples instead of fixing the random seed for test_shuffle

* Increase the number of samples instead of fixing the random seed for test_shuffle

                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div></div></li><li><div><div><b>title:</b> Flaky test_random.test_shuffle
                </div><div><b>body:</b> http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/master/542/pipeline

```
======================================================================

FAIL: test_random.test_shuffle

----------------------------------------------------------------------

Traceback (most recent call last):

  File "C:\Anaconda3\envs\py2\lib\site-packages\nose\case.py", line 197, in runTest

    self.test(*self.arg)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\common.py", line 157, in test_new

    orig_test(*args, **kwargs)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 625, in test_shuffle

    testSmall(mx.nd.arange(0, 3), 100, 20000)

  File "C:\jenkins_slave\workspace\ut-python-gpu\tests\python\unittest\test_random.py", line 599, in testSmall

    assert abs(1. * count[str(mx.nd.array(p))] / repeat2 - 1. / math.factorial(data.shape[0])) &lt; 0.01

AssertionError: 

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------

common: INFO: Setting test np/mx/python random seeds, use MXNET_TEST_SEED=1485655931 to reproduce.

--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------
```

https://issues.apache.org/jira/browse/MXNET-236
                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                https://github.com/apache/incubator-mxnet/pull/10048

@reminisce @asitstands
              </div></li><li><div>
                @asitstands Could you verify whether 0.01 threshold is too small for checking the uniform distribution?
              </div></li><li><div><div><b>body:</b> @reminisce The probability that the test fails is approximately 0.001 with the 0.01 criterion even if `shuffle` is implemented correctly, assuming the quality of the random numbers are good enough. So it could fail every 1000 runs of the test in average. It looks somewhat high probability. To lower the probability we can increase the number of samples to test uniformity of the shuffling. It is currently 20000. If we increase it as 40000, the failure probability is less than 10^-6 but the running time also increases. In my mahcine the running time increases from 40s to 55s. If this is not acceptable, another way is to relax the criterion as 0.015, which also makes the failure probability as less than 10^-6 but the test becomes less strict. I think that increasing the number of samples would be better. If the test again fails frequently with this increased number of samples, then there must be some problem in the implementation of `shuffle` or the random number generators. How do you think?
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                @asitstands Can you try feeding a fixed seed to the decorator `with_seed` and see whether the result distribution is fixed? If so, we can make that unit test deterministic.
              </div></li><li><div><div><b>body:</b> @reminisce Seeding with `with_seed` produces a deterministic result. The test becomes significantly weaker comparing to the collective result produced by repeats with different seeds. However, if time consumption is important, I think that fixing the seed is reasonable. I'll make the change.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Time consumption for tests is not *that* important, but I think we should ask another question: If the generation of random numbers takes such a significant amount of time, wouldn't this also harm runtime performance in real applications?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> @marcoabreu In the case of `shuffle`, the time consumption is mainly from the memory copy and not from the generation of random numbers. Random shuffling of `n` elements needs `O(n)` swaps of elements (e.g. exactly `n` for Fisher-Yates algorithm). The memory copy is the "nature" of shuffling. We cannot avoid it if we want to shuffle something. Testing statistical validity of the random shuffling needs a lot of samplings and this is also the nature of the problem. We cannot avoid it without sacrificing something such as running time or strictness. Basically _serious_ statistical testing of shuffling may not be considered as a part of unit tests and needs to be a separate test. But practically we need to settle down with somewhat less strict test as a part of unit tests.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I see, thanks for elaborating, this definitely makes sense. I assume we can't improve this with parallelisation, right?
              </div></li><li><div>
                @marcoabreu The implementation of `shuffle` already uses parallelism. On GPU, it utilizes a parallel sorting algorithm and the memory swap is also parallelized. On CPU it uses GNU's parallel implementation of `std::random_shuffle` if the array is 1D. It is much faster on GPU than CPU and you can find the gain of parallelization in CPU by controlling OMP_NUM_THREADS.
Only for higher dimensional arrays in CPU, the implementation is sequential. The optimization in this case is not trivial due to the diversity of data shape and hardware. I have tested a naive parallelization of the memory copy for the case. You can see the result in this [comment](https://github.com/apache/incubator-mxnet/pull/10048#discussion_r173857649). You have asked the test but I forgot mentioning you at the comment :)
              </div></li><li><div><div><b>body:</b> Thanks for this great explanation and the detailed benchmarks, great job! In that case, I'd propose to go with the increase to 40000 samples - we can go even higher if you would like, the slaves have 72 vCPUs available (while I can't judge the GPU performance for this use-case) and since this task is IO-bound, we should not really see that much of an increase in time consumption as all threads can prepare the data in parallel and do something different while they're waiting for the memory controller. What do you think? 

While pinning the seed makes things more comfortable, we have found quite a lot of issues in the past due to the random seeding. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> As longer running time is allowed, I agree that using 40000 samples would be better than fixing the random seed. More strict tests are better as long as we have available resources for them. In the other hand, I think that 0.01 criterion and 40000 samples are practically enough. More strict test requires much more cost. I repoduced the failure with the reported seed and confirmed that the test is ok with 40000 samples. This test will fail again someday even with the increased number of samples, but the frequency is very low. How do you think @reminisce ?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I think 1^-6 sounds quite reasonable and the time consumption is still within acceptable boundaries :) 

@reminisce please review the PR as you have more in-depth knowledge
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> [MXNET-258] Improve flaky test_random.test_shuffle
                </div><div><b>body:</b> ## Description ##

See the discussion in #10277. &lt;strike&gt;This sets a random seed for `test_random.test_shuffle`. As discussed in #10277, the test requires too long running time to be both strict and not flaky. Fixing the seed for the random numbers would be a practical workaround assuming that the random number sequence by the seed is not special.&lt;/strike&gt;

## Checklist ##
### Essentials ###
Please feel free to remove inapplicable items for your PR.
- [ ] The PR title starts with [MXNET-$JIRA_ID], where $JIRA_ID refers to the relevant [JIRA issue](https://issues.apache.org/jira/projects/MXNET/issues) created (except PRs with tiny changes)
- [x] Changes are complete (i.e. I finished coding on this PR)
- [x] All changes have test coverage:
- Unit tests are added for small changes to verify correctness (e.g. adding a new operator)
- Nightly tests are added for complicated/long-running ones (e.g. changing distributed kvstore)
- Build tests will be added for build configuration changes (e.g. adding a new build option with NCCL)
- [x] Code is well-documented: 
- For user-facing API changes, API doc string has been updated. 
- For new C++ functions in header files, their functionalities and arguments are documented. 
- For new examples, README.md is added to explain the what the example does, the source of the dataset, expected performance on test set and reference to the original paper if applicable
- Check the API doc at http://mxnet-ci-doc.s3-accelerate.dualstack.amazonaws.com/PR-$PR_ID/$BUILD_ID/index.html
- [x] To the my best knowledge, examples are either not affected by this change, or have been fixed to be compatible with this change


                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                In the last commit, I increased the number of samples and removed the fixed seed. The assertion is also updated to print the difference from the expectation if it fails.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> Could you add a comment with a link to the issue in order to let other developers know why we're fixing the seed?
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Have you tried seed that makes the test fail? seed=1 seems too special.
              </div></li><li><div>
                @reminisce I have tried the failed seed but the test passed. It could be from the difference of the environment. The failure was on Windows but I don't have a Windows machine. My test was on linux gcc. Seed 1 is not special at all. If it is special, that means the random number generator is very poor. There must be no special seed for good random number generators. Moreover, `mx.random.seed` does not hand over 1 to the underlying random generators. It transforms the number with the device id and a magic number before seeding the underlying generators.
              </div></li><li><div>
                @marcoabreu I added a comment for the fixed seed.
              </div></li><li><div>
                Aaah I remember, the device id which makes the entire fixed seeding on GPUs pointless :/ Is the device id a sequential number (e.g. 0-7 for GPU0-7) and thus consistent in between environments or is it some type of unique or arbitrary ID?

Could you try submitting a commit with the failing seed? Ideally, the test should always fail.
              </div></li><li><div>
                Please add a link to ensure that developers are able to resolve the reference in future - e.g. when we change bug trackers
              </div></li><li><div>
                @marcoabreu I submitted the commit with the failed seed. The test fails again on Windows but is ok on linux (http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/incubator-mxnet/detail/PR-10313/4/pipeline/601). The failed test is on CPU. I cannot find the test result on Windows/GPU from the log. The test might exited before `test_operator_gpu` run. GPU uses different kind of random number generator so it could succeed on Windows with the same seed. I'm not sure why the same generator `mt19937` produces different random sequence in Windows and linux. Maybe VC++ and gcc has different implementation of `mt19937`.
              </div></li><li><div>
                I added the link.
              </div></li><li><div>
                @marcoabreu I figured out why it succeeds in linux but fails in Windows with the same seed. It is simply `shuffle` uses different implementations for linux and Windows. For linux it uses GNU's parallel version of `std::random_shuffle` and for windows it uses sequential `std::shuffle`. The two are based on totally different algorithms.
              </div></li><li><div><div><b>body:</b> Aaah this makes sense, thanks for diving deep on this! I guess the Windows version is a *lot* slower than the parallelized GNU version, right? Is this something we can change easily or is this out of our control and better not to change?

Seems like this test definitely brought us some knowledge. What do you think about adding a comment to the random generators documentation, describing that two different implementation are being used, depending on the platform? Also, it'd be great if we could modify that assert to not only fail but also print the distribution in relation to the threshold - right now, it just fails and I don't know by how much the distribution is off.
                </div><div><b>label:</b> documentation
                </div></div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Improve flaky test_random.test_shuffle
                </div><div><b>description:</b> Improve flaky test_random.test_shuffle. See #10277 ([https://github.com/apache/incubator-mxnet/issues/10277)] ,
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>