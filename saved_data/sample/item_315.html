<!DOCTYPE html><html><div class="item-title">
        Item 315
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 'bar': false
              </div></li><li><div>
                 axisLabel: {
     show: false
 },
              </div></li><li><div>
                 orient: 'vertical',
 x: 'right',
 y: 'bottom',
              </div></li><li><div>
                 title: {
 },
              </div></li><li><div>
                 If bars are placed on a base axis of type time or interval account for axis boundary overflow and current axis is base axis
              </div></li><li><div>
                 Calulate required buffer based on old range and overflow
              </div></li><li><div>
                 Adjust axis min and max to account for overflow
              </div></li><li><div>
                 Get bars on current base axis and calculate min and max overflow
              </div></li><li><div>
                 Calculate placement of bars on axis
              </div></li><li><div>
                 Get Axis Length
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Merge pull request #6728 from c-okelly/master
                </div><div><b>message:</b> Merge pull request #6728 from c-okelly/master

Fix bar overflow issues #4862 Bug fix
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li><li><div><div><b>title:</b> Time axis - bar chart start position moving out of x-axis
                </div><div><b>body:</b> ### One-line summary [问题简述]

When using Time Axis for bar chart, If the value available for the start position then it moves left to the x-start axis to keep bar position centered(same for end position or stacked bar). pl check the screenshots attached.

![device_vmnic0_at_01_00_0_bnx2](https://cloud.githubusercontent.com/assets/3069381/21643464/67313c6c-d2ae-11e6-8eb3-5166e7220be9.png)
![intel_r__pro_1000_mt_network_connection__2_symantec_endpoint_protection_firewall_0000](https://cloud.githubusercontent.com/assets/3069381/21643465/675fb7c2-d2ae-11e6-9183-489b3dabb5b9.png)

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                I hope that [boundaryGap](https://ecomfe.github.io/echarts-doc/public/en/option.html#xAxis.boundaryGap) can help you ~
              </div></li><li><div>
                This issue persits when axis is continous **```value```** or **```time```**, boundary gap is sufficient for end points, but this problems occurs again when we zoom inside

Example code from documentation has similar issue:

```javascript
option = {
    dataZoom: [
        {
            id: 'dataZoomX',
            type: 'slider',
            xAxisIndex: [0],
            filterMode: 'empty'
        },
        {
            id: 'dataZoomY',
            type: 'slider',
            yAxisIndex: [0],
            filterMode: 'empty'
        }
    ],
    xAxis: {type: 'value'},
    yAxis: {type: 'value'},
    series:{
        type: 'bar',
        data: [
            // The first column corresponds to xAxis,
            // and the second coloum corresponds to yAxis.
            [12, 24, 36],
            [90, 80, 70],
            [3, 9, 27],
            [1, 11, 111]
        ]
    }
}
```
              </div></li><li><div>
                Are there any solutions to this problem?
              </div></li><li><div>
                Hi @100pah 

Any update on the issue discussed above ? 
              </div></li><li><div>
                @100pah @haiyanghe @c-okelly I have a similar issues when using bar graph and time values for the xAxis. Using boundary gap does fix the issues when the chart is loaded but once you zoom in the issues appears again as mentioned by akansal1. 

Also using boundary gap wouldn't really take into account how different data might be displayed and would have to be adjusted for different data sets.

I am happy to work on the issue on the eCharts repo if I could get a bit of direction on it?
              </div></li><li><div><div><b>body:</b> @100pah @haiyanghe @vij1ay  I have implemented a proposed fix in a fork I have created at https://github.com/c-okelly/echarts. My idea is to make the chart start slightly earlier and finished slightly later when the presence of bars on a time graph is detected. 

The following code is added to axisHelper.js

```
numberBarPlots = model.getModel().ecModel.getSeriesByType("bar").length;
        if (scaleType == 'time' &amp;&amp; numberBarPlots &gt; 0){
            var buffer = (max - min) * (0.01 * numberBarPlots);
            max += buffer;
            min -= buffer;
        }
```

While this seems to fix the use case of as described above the issues reappears when the chart is zoomed in as show in the pictures below. No 1. No 2.

I have spend a good bit of time going over your code and trying to get to grips with the overall architecture you are using.

I would propose make the bug fix more intelligent first calculating to see if an overflow exists and then adjusting the start and end point of the xAxis to account for this (should ensure that the bars are within the Axis).

I am currently trying to understand how to calculate the box that would exist around each point on the graph. Red box in No 3.

I would very much appreciate any feedback you could provide or guidance on how I could adjust my fix to better fit in with your own overall plan. Or if you have a better idea to approach this problem.

Thanks,

Conor
 
No 0. - Before fix
![screen shot 2017-09-14 at 15 00 38](https://user-images.githubusercontent.com/8889083/30433883-93a3a28c-995d-11e7-925e-03b6701e512c.png)

No 1. - Proposed current fix
![screen shot 2017-09-13 at 18 03 10](https://user-images.githubusercontent.com/8889083/30390583-7e3f0ddc-98ae-11e7-9671-0edfe49498fc.png)

No 2. - Issue reappear when zooming
![screen shot 2017-09-13 at 18 03 32](https://user-images.githubusercontent.com/8889083/30390607-91198482-98ae-11e7-9fba-57c59aae785f.png)


No 3. - Area I am trying to calculate to adjust for
![screen shot 2017-09-13 at 18 03 32](https://user-images.githubusercontent.com/8889083/30390651-bd5d29a4-98ae-11e7-8261-57f3e722e6d9.png)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I have opened a pull request that fixes this issues and works for zooming as well. #6728 
              </div></li><li><div>
                @100pah Can we please close the issue.

Thanks,

C
              </div></li><li><div>
                is this issue fixed?I am still seeing it in 3.3.4
              </div></li><li><div>
                @liujiong1982 This bug has been fixed in echarts version 4.0.3
              </div></li><li><div>
                Version 4.2.1 the issue persists
              </div></li><li><div><div><b>body:</b> Issue does not persists it was fixed. This is a regression due to lack of testing for the use case.

Looking at the original fix and reworking it would be a reasonable starting point for someone looking to fix it
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                This issue is neither stale or closed.

This is a regression on a previous fix.

Could we please re-open this and I will try do the fix when I have some free time
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Fix bar overflow issues #4862 Bug fix
                </div><div><b>body:</b> I would like to propose the following pull request in reference to issue fixing #4862
针对问题 #4862， 我想提供一个合并请求。

**Summary**
**概述**

Rescale relevant base axis (of time and interval) to account for overflow of bars beyond chart.
伸缩相关的坐标轴（时间和区间）来解决长条溢出图表的问题

**Overview of changes**
**修改简述**

Two files edited.
共修改了两个文件

AxisHelper.js =&gt; has additional function to rescale axis
AxisHelper.js =&gt; 添加了伸缩坐标的函数

barGrid.js =&gt; export calBarWidthAndOffset
barGrid.js =&gt; 添加了calBarWidthAndOffset

**Proposed changes**
**所做的修改**

1. If axis is (time or interval) and has more then one bar and is a base axis
=&gt; Recalculate axis min / max to account for bar overflow
如果坐标轴是时间或区间，并且有多个长条，并且次坐标为基本坐标，
那么伸缩坐标的最小最大值来解决长条溢出问题
2. Calculate physical length of current axis
计算现有坐标的物理长度
3. Calculate placement of bars on current axis
计算长条在坐标上的位置
4. Use current baseAxis to select bars on relevant axis
用当前的基本坐标来选择在相应坐标上的长条
=&gt; If no bars on current axis return current max / min
如果，没有长条，那么返回当前的最大最小值
5. Rescale axis to account for overflow on each side of the chart
伸缩坐标来解决溢出问题
6. Return new axis min / max
返回新的最大最小值

**Test**
I have updated to include a test in file bar-overflow-time-plot.html

**Extra**
This issue also occurs with candlestick plotting on ordinal axis.
This could also be corrected with a similar function.
This can be seen in&nbsp;https://ecomfe.github.io/echarts-examples/public/editor.html?c=candlestick-sh

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @100pah @pissang Is there any changes / refactoring you would like done? As would be very keen to see this integrated into the main echarts repo if you think the fix is adequate! 

Thanks,

Conor
              </div></li><li><div>
                Please merge, this is fantastic! @c-okelly @hanleyt @graysr89 
              </div></li><li><div>
                Hi @c-okelly, Sorry for the late reply.

This is really an ancient issue from the very beginning. Thank your effort for solving this issue!! The solution is neat. 

Some suggestions:
```js
model.ecModel._componentsMap._ec_series
```
It is not suggested to access the private properties which start with '_'. Instead you can use 
`model.ecModel.getSeries()` to get the all the series

And there is no need to import the whole `barGrid` module. Instead you can only import the `calBarWidthAndOffset` method and let rollup do the tree shaking.
```js
import { calBarWidthAndOffset } from '../layout/barGrid'
```

We will check if it will affect other test cases later. Thanks again!

              </div></li><li><div>
                Hi @pissang , 

Thank you very much for getting back to me and thank you for the clear feedback on changes.

I have updated the pull request to include all the changes that you have requested. 

1. Replace private property accessors with getters
2. Import single function from barGrid instead of whole module

Please let me know if you would like anything else changed!

Thanks,

Conor
              </div></li><li><div>
                Hi @pissang @100pah,

I have just noticed that the build script build.js throws an assertion error on barGrid as I am both exporting a function and doing a default export.

This occurs when I run npm install;

Specifically =&gt; `node build/build.js --prepublish`

Error
```
[transform]  /Users/conorokelly/Desktop/echarts/src/layout/barGrid.js ...
assert.js:41
  throw new errors.AssertionError({
  ^

AssertionError [ERR_ASSERTION]: Forbiden that both export default and others.
```

I am currently working on a solution.

Apologies,

Conor
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>