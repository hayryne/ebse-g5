<!DOCTYPE html><html><div class="item-title">
        Item 320
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                remotes[0].execute('sudo su %s -l -c ckillall' % TRAF_USER, chkerr=False)
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [TRAFODION-2518] pyinstaller - remove unused db_admin settings.
                </div><div><b>message:</b> [TRAFODION-2518] pyinstaller - remove unused db_admin settings.

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> pyinstaller - remove unused db_admin settings.
                </div><div><b>description:</b> clean up unused db_admin settings since there's no DB__ADMIN user in Trafodion.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> pyinstaller - remove unused db_admin settings.
                </div><div><b>description:</b> clean up unused db_admin settings since there's no DB__ADMIN user in Trafodion.
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                GitHub user mkby opened a pull request:

    https://github.com/apache/incubator-trafodion/pull/991

    [TRAFODION-2518] pyinstaller - remove unused db_admin settings.

    [TRAFODION-2519] pyinstaller - uninstaller should kill all trafodion processes.

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/mkby/incubator-trafodion r21-2518

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/incubator-trafodion/pull/991.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #991
    
----
commit dc6e7bd4081cdf885cba3708c9d7cf727515a6c4
Author: Eason &lt;hfutmkby@gmail.com&gt;
Date:   2017-03-06T16:28:09Z

    [TRAFODION-2518] pyinstaller - remove unused db_admin settings.

----

              </div></li><li><div>
                Github user svarnau commented on a diff in the pull request:

    https://github.com/apache/incubator-trafodion/pull/991#discussion_r104473719
  
    --- Diff: install/python-installer/db_uninstall.py ---
    @@ -96,13 +96,13 @@ def main():
     
         remotes = [Remote(node, pwd=pwd) for node in nodes]
         # stop trafodion on the first node
    -    remotes[0].execute('sudo su %s -l -c ckillall' % TRAF_USER, chkerr=False)
    +    #remotes[0].execute('sudo su %s -l -c ckillall' % TRAF_USER, chkerr=False)
     
         # remove trafodion userid and group on all trafodion nodes, together with folders
         for remote in remotes:
             info('Remove Trafodion on node [%s] ...' % remote.host)
             remote.execute('ps -ef|grep ^%s|awk \'{print $2}\'|xargs sudo kill -9' % TRAF_USER, chkerr=False)
    -        remote.execute('ps -ef|grep krb5check|awk \'{print $2}\'|xargs sudo kill -9', chkerr=False) # traf kerberos service
    +        remote.execute('trafid=`getent passwd %s|awk -F: \'{print $3}\'`; if [[ -n $trafid ]]; then ps -ef|grep ^$trafid|awk \'{print $2}\'|xargs sudo kill -9; fi' % TRAF_USER, chkerr=False)
             remote.execute('sudo -n /usr/sbin/userdel -rf %s' % TRAF_USER, chkerr=False)
    --- End diff --
    
    on lines 104,105, instead of doing ps -ef and grep for TRAF_USER, wouldn't it be better to do 
    
    'ps -f -u %s' % TRAF_USER

              </div></li><li><div>
                Github user mkby commented on a diff in the pull request:

    https://github.com/apache/incubator-trafodion/pull/991#discussion_r104580774
  
    --- Diff: install/python-installer/db_uninstall.py ---
    @@ -96,13 +96,13 @@ def main():
     
         remotes = [Remote(node, pwd=pwd) for node in nodes]
         # stop trafodion on the first node
    -    remotes[0].execute('sudo su %s -l -c ckillall' % TRAF_USER, chkerr=False)
    +    #remotes[0].execute('sudo su %s -l -c ckillall' % TRAF_USER, chkerr=False)
     
         # remove trafodion userid and group on all trafodion nodes, together with folders
         for remote in remotes:
             info('Remove Trafodion on node [%s] ...' % remote.host)
             remote.execute('ps -ef|grep ^%s|awk \'{print $2}\'|xargs sudo kill -9' % TRAF_USER, chkerr=False)
    -        remote.execute('ps -ef|grep krb5check|awk \'{print $2}\'|xargs sudo kill -9', chkerr=False) # traf kerberos service
    +        remote.execute('trafid=`getent passwd %s|awk -F: \'{print $3}\'`; if [[ -n $trafid ]]; then ps -ef|grep ^$trafid|awk \'{print $2}\'|xargs sudo kill -9; fi' % TRAF_USER, chkerr=False)
             remote.execute('sudo -n /usr/sbin/userdel -rf %s' % TRAF_USER, chkerr=False)
    --- End diff --
    
    good suggestion, thanks.

              </div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/incubator-trafodion/pull/991

              </div></li></ol></div></div></html>