<!DOCTYPE html><html><div class="item-title">
        Item 38
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 * Raised if the correlationId in a response header does not match
 * the expected value from the request header.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                 Fast-forward buffer to start of the request as `RequestChannel.Request` expects
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> MINOR: Factor out common response parsing logic (#9617)
                </div><div><b>message:</b> MINOR: Factor out common response parsing logic (#9617)

This patch factors out some common parsing logic from `NetworkClient.parseResponse` and `AbstractResponse.parseResponse`. As a result of this refactor, we are now verifying the correlationId in forwarded requests. This patch also adds a test case to verify handling in this case.

Reviewers: Chia-Ping Tsai &lt;chia7712@gmail.com&gt;, Boyang Chen &lt;boyang@confluent.io&gt;
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> MINOR: Factor out common response parsing logic
                </div><div><b>body:</b> This patch factors out some common parsing logic from `NetworkClient.parseResponse` and `AbstractResponse.parseResponse`. As a result of this refactor, we are now verifying the correlationId in forwarded requests. This patch also adds a test case to verify handling in this case.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                This is a follow-up from #9563. cc @chia7712 @abbccdda 

While I was working on this patch, I noticed this: https://issues.apache.org/jira/browse/KAFKA-10743. In this patch, I have just removed the metric. 
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                nit: we could put this exception into `common/internals` to indicate that we don't plan to let external user catch it. 
              </div></li><li><div>
                This field is not used.
              </div></li><li><div>
                nit: I don't think we need to remove this helper
              </div></li><li><div>
                As ```ForwardingManager``` does not extend ```BrokerToControllerChannelManagerImpl```, the ```requestQueue``` can be declared as private now.

https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/BrokerToControllerChannelManagerImpl.scala#L58
              </div></li><li><div>
                Why do you want to keep it if it is not used?
              </div></li><li><div>
                Yeah, I added it for completeness. It is a little odd if the mismatch exception only tells you what the response correlationId was.
              </div></li><li><div>
                Yeah, I was debating the location. I decided to put it in `common/requests` since it is not a public package and the error is specific to the request protocol.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>