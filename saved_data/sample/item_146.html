<!DOCTYPE html><html><div class="item-title">
        Item 146
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [SPARK-30724][SQL] Support 'LIKE ANY' and 'LIKE ALL' operators
                </div><div><b>message:</b> [SPARK-30724][SQL] Support 'LIKE ANY' and 'LIKE ALL' operators

### What changes were proposed in this pull request?

`LIKE ANY/SOME` and `LIKE ALL` operators are mostly used when we are matching a text field with numbers of patterns. For example:

Teradata / Hive 3.0 / Snowflake:
```sql
--like any
select 'foo' LIKE ANY ('%foo%','%bar%');

--like all
select 'foo' LIKE ALL ('%foo%','%bar%');
```
PostgreSQL:
```sql
-- like any
select 'foo' LIKE ANY (array['%foo%','%bar%']);

-- like all
select 'foo' LIKE ALL (array['%foo%','%bar%']);
```

This PR add support these two operators.

More details:
https://docs.teradata.com/reader/756LNiPSFdY~4JcCCcR5Cw/4~AyrPNmDN0Xk4SALLo6aQ
https://issues.apache.org/jira/browse/HIVE-15229
https://docs.snowflake.net/manuals/sql-reference/functions/like_any.html

### Why are the changes needed?

To smoothly migrate SQLs to Spark SQL.

### Does this PR introduce any user-facing change?
No

### How was this patch tested?
Unit test.

Closes #27477 from wangyum/SPARK-30724.

Authored-by: Yuming Wang &lt;yumwang@ebay.com&gt;
Signed-off-by: Takeshi Yamamuro &lt;yamamuro@apache.org&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [SPARK-30724][SQL] Support 'LIKE ANY' and 'LIKE ALL' operators
                </div><div><b>body:</b> ### What changes were proposed in this pull request?

`LIKE ANY/SOME` and `LIKE ALL` operators are mostly used when we are matching a text field with numbers of patterns. For example:

Teradata / Hive 3.0 / Snowflake:
```sql
--like any
select 'foo' LIKE ANY ('%foo%','%bar%');

--like all
select 'foo' LIKE ALL ('%foo%','%bar%');
```
PostgreSQL:
```sql
-- like any
select 'foo' LIKE ANY (array['%foo%','%bar%']);

-- like all
select 'foo' LIKE ALL (array['%foo%','%bar%']);
```

This PR add support these two operators.

More details:
https://docs.teradata.com/reader/756LNiPSFdY~4JcCCcR5Cw/4~AyrPNmDN0Xk4SALLo6aQ
https://issues.apache.org/jira/browse/HIVE-15229
https://docs.snowflake.net/manuals/sql-reference/functions/like_any.html

### Why are the changes needed?

To smoothly migrate SQLs to Spark SQL.


### Does this PR introduce any user-facing change?
No


### How was this patch tested?
Unit test.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                **[Test build #117992 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/117992/testReport)** for PR 27477 at commit [`4548b0f`](https://github.com/apache/spark/commit/4548b0fb35550b1fdf8fa93c279debabb57153cf).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #117994 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/117994/testReport)** for PR 27477 at commit [`5475675`](https://github.com/apache/spark/commit/5475675617e7575b1c0f27544e2f7c100a551c5d).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #118015 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/118015/testReport)** for PR 27477 at commit [`de7c398`](https://github.com/apache/spark/commit/de7c398b25008004dc3feeb3be2475ba0639baa1).
 * This patch **fails due to an unknown error code, -9**.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #118025 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/118025/testReport)** for PR 27477 at commit [`caea82a`](https://github.com/apache/spark/commit/caea82a5a8108b5012071b54b07691bca226e52d).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #118038 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/118038/testReport)** for PR 27477 at commit [`88ca4c2`](https://github.com/apache/spark/commit/88ca4c2de2fe64a29092f92198baea28674cd1c6).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #118302 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/118302/testReport)** for PR 27477 at commit [`1c3d98c`](https://github.com/apache/spark/commit/1c3d98cb847f76e17c687743e55e8143c47fb4a9).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                cc @cloud-fan 
              </div></li><li><div>
                This would be good to have since both Teradata and Snowflake support it. 

cc @maryannxue @hvanhovell @cloud-fan 


              </div></li><li><div>
                **[Test build #121127 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/121127/testReport)** for PR 27477 at commit [`0656b05`](https://github.com/apache/spark/commit/0656b051a3b85dd0ba02f57b9dc30a99848e7bc0).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                retest this please
              </div></li><li><div>
                Looks fine to me
              </div></li><li><div>
                **[Test build #121622 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/121622/testReport)** for PR 27477 at commit [`0656b05`](https://github.com/apache/spark/commit/0656b051a3b85dd0ba02f57b9dc30a99848e7bc0).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                Looks fine except for the existing comments.
              </div></li><li><div>
                **[Test build #121684 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/121684/testReport)** for PR 27477 at commit [`cf4666f`](https://github.com/apache/spark/commit/cf4666ff2c80c4cc34185970054346ab06db4b05).
 * This patch **fails Spark unit tests**.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                **[Test build #121713 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/121713/testReport)** for PR 27477 at commit [`f9af131`](https://github.com/apache/spark/commit/f9af131410fe52ca36453ceb9a5636d9d48b6dc5).
 * This patch **fails due to an unknown error code, -9**.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                retest this please
              </div></li><li><div>
                **[Test build #121733 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/121733/testReport)** for PR 27477 at commit [`f9af131`](https://github.com/apache/spark/commit/f9af131410fe52ca36453ceb9a5636d9d48b6dc5).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                @wangyum btw, we need to update the SQL document for this new syntax. Follow-up PR is alright, though. cc: @huaxingao 
              </div></li><li><div>
                Thanks, all! Merged to master.
              </div></li><li><div>
                @maropu Since this is for 3.1, I will not include this new syntax in 3.0 sql ref. 
              </div></li><li><div>
                Yea, we need to update it only in master.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                So, we don't need to support `ESCAPE`. Did I understand correctly?
              </div></li><li><div>
                Do we need this `ctx.expression.isEmpty`? It seems that the parser rule guarantee at least one expression.
              </div></li><li><div>
                Ditto.
              </div></li><li><div>
                nit: space after `--`
              </div></li><li><div>
                nit: newline at the end.
              </div></li><li><div>
                Yes.
![download](https://user-images.githubusercontent.com/5399861/73996505-b6433000-4996-11ea-99cf-9e0f7bb6802f.png)

https://docs.teradata.com/reader/756LNiPSFdY~4JcCCcR5Cw/4~AyrPNmDN0Xk4SALLo6aQ

              </div></li><li><div>
                Got it~
              </div></li><li><div>
                Teradata's exception:
![image](https://user-images.githubusercontent.com/5399861/74003270-fb725c80-49ac-11ea-853a-2a41cde80b64.png)

              </div></li><li><div>
                Fixed it.
              </div></li><li><div>
                What happened previously when we didn't have `'('')' | ` here? I guessed that it was also a `Parse Exception`.
              </div></li><li><div>
                Otherwise it will throw `AnalysisException`:
```
-- !query
select company from like_any_table where company like any ()
-- !query schema
struct&lt;&gt;
-- !query output
org.apache.spark.sql.AnalysisException
Invalid number of arguments for function any. Expected: 1; Found: 0; line 1 pos 54
```
              </div></li><li><div>
                nit: could you capitalize SQL keywords, e.g., SELECT, FROM ..., where possible?
              </div></li><li><div>
                Done
              </div></li><li><div>
                Done
              </div></li><li><div>
                Done
              </div></li><li><div>
                Oh, it's considered as `function`. I got it.
              </div></li><li><div>
                I think should remove `Syntax error: `, because `ParseException` could replace it.
              </div></li><li><div>
                shall we support `SOME` as well? The `BoolOr` agg func can be called with `any` and `some`.
              </div></li><li><div>
                Nit: contains -&gt; contain ?
              </div></li><li><div>
                Nit: getLikeQuantifierExps -&gt; getLikeQuantifierExprs ?
              </div></li><li><div>
                Could you add two more tests for error handling for L1396 and L1422 in AstBuilder.scala?
              </div></li><li><div>
                note: I've checked that the output is the same with PostgreSQL output: https://gist.github.com/maropu/fa4bd6491e21751d6bbc44c545390b0c
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> 'like any' and 'like all' operators in hive
                </div><div><b>description:</b> In Teradata 'like any' and 'like all' operators are mostly used when we are matching a text field with numbers of patterns.

'like any' and 'like all' operator are equivalents of multiple like operator like example below.

{noformat}
--like any
select col1 from table1 where col2 like any ('%accountant%', '%accounting%', '%retail%', '%bank%', '%insurance%');

--Can be written using multiple like condition 
select col1 from table1 where col2 like '%accountant%' or col2 like '%accounting%' or col2 like '%retail%' or col2 like '%bank%' or col2 like '%insurance%' ;

--like all
select col1 from table1 where col2 like all ('%accountant%', '%accounting%', '%retail%', '%bank%', '%insurance%');

--Can be written using multiple like operator 
select col1 from table1 where col2 like '%accountant%' and col2 like '%accounting%' and col2 like '%retail%' and col2 like '%bank%' and col2 like '%insurance%' ;
{noformat}

Problem statement:

Now a days so many data warehouse projects are being migrated from Teradata to Hive.
Always Data engineer and Business analyst are searching for these two operator.
If we introduce these two operator in hive then so many scripts will be migrated smoothly instead of converting these operators to multiple like operators.


Result:

1. 'LIKE ANY' operator return true if a text(column value) matches to any pattern.
2. 'LIKE ALL' operator return true if a text(column value) matches to all patterns.
3. 'LIKE ANY' and 'LIKE ALL' returns NULL not only if the expression on the left hand side is NULL, but also if one of the pattern in the list is NULL.

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Hi [~cwsteinbach],

Could you please review this and provide your comments?

Thanks,
Simanchal
              </div></li><li><div>
                RB added
https://reviews.apache.org/r/53845/
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12839354/HIVE-15229.1.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10688 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[show_functions] (batchId=66)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=91)
org.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=93)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2166/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2166/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2166/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12839354 - PreCommit-HIVE-Build
              </div></li><li><div>
                [~simanchal], thanks for your patch. Did u try "rlike"? If rlike and like have the same function, a simple rewrite in parser would finish the job.
              </div></li><li><div>
                [~simanchal] Can you add tests for NOT LIKE ANY and NOT LIKE ALL with null values ? e.g. {noformat} Select col1 from table1 where col2 NOT LIKE ALL (null, ....) {noformat}. If there is null it should return zero results.
              </div></li><li><div>
                Thank you [~pxiong] for you comment.

'rlike' takes constant string as pattern, I think that will not work if we provide both constant and field value as pattern like below.

{noformat}
select col1 from table1 where col2 like any ('%abc%',col3);
{noformat}


              </div></li><li><div>
                Hi [~vgarg] thanks for the review I have added the test cases for NOT LIKE ANY ,NOT LIKE ALL and null checks.

According to your suggestion if any pattern have null value then zero results will come.

Thanks.
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12839787/HIVE-15229.2.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10739 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[show_functions] (batchId=66)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_like] (batchId=8)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=151)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=146)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5] (batchId=91)
org.apache.hive.spark.client.TestSparkClient.testJobSubmission (batchId=273)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2224/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2224/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2224/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12839787 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12842338/HIVE-15229.2.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 11 failed/errored test(s), 10792 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[show_functions] (batchId=66)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_like] (batchId=8)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[columnstats_part_coltype] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery (batchId=215)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2489/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2489/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2489/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12842338 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12851824/HIVE-15229.2.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3465/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3465/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3465/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2017-02-09 16:46:02.411
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-3465/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2017-02-09 16:46:02.413
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at 27613f0 HIVE-15792 : Hive should raise SemanticException when LPAD/RPAD pad character's length is 0 (Nanda Kumar via Thejas Nair)
+ git clean -f -d
Removing ql/src/test/queries/clientpositive/view_cbo.q
Removing ql/src/test/results/clientpositive/view_cbo.q.out
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at 27613f0 HIVE-15792 : Hive should raise SemanticException when LPAD/RPAD pad character's length is 0 (Nanda Kumar via Thejas Nair)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2017-02-09 16:46:04.011
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/HiveParser.g:393
error: ql/src/java/org/apache/hadoop/hive/ql/parse/HiveParser.g: patch does not apply
error: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g:92
error: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g: patch does not apply
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12851824 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12852042/HIVE-15229.2.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3489/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3489/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3489/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2017-02-10 12:56:16.800
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-3489/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2017-02-10 12:56:16.803
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at c0198e5 HIVE-15850: Proper handling of timezone in Druid storage handler (Jesus Camacho Rodriguez, reviewed by Ashutosh Chauhan)
+ git clean -f -d
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at c0198e5 HIVE-15850: Proper handling of timezone in Druid storage handler (Jesus Camacho Rodriguez, reviewed by Ashutosh Chauhan)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2017-02-10 12:56:17.734
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/HiveParser.g:393
error: ql/src/java/org/apache/hadoop/hive/ql/parse/HiveParser.g: patch does not apply
error: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g:92
error: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g: patch does not apply
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12852042 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12852514/HIVE-15229.3.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 10248 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[show_functions] (batchId=67)
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=223)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3535/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3535/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3535/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12852514 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12852560/HIVE-15229.4.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 10248 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[show_functions] (batchId=67)
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=140)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=223)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[semijoin] (batchId=105)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[skewjoinopt9] (batchId=105)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[smb_mapjoin_3] (batchId=105)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[stats10] (batchId=105)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3539/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3539/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3539/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12852560 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12852751/HIVE-15229.4.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 10248 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join1] (batchId=3)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join31] (batchId=81)
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multiMapJoin2] (batchId=152)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=223)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[join31] (batchId=133)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3563/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3563/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3563/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12852751 - PreCommit-HIVE-Build
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12855640/HIVE-15229.5.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10296 tests executed
*Failed tests:*
{noformat}
TestDbTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestDummyTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestHiveInputSplitComparator - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestSplitFilter - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=229)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[schema_evol_text_vec_table] (batchId=147)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vector_between_in] (batchId=119)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3895/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3895/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3895/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12855640 - PreCommit-HIVE-Build
              </div></li><li><div>
                +1
              </div></li><li><div>
                [~simanchal], the change to HiveParser no longer applies cleanly. Can you please refresh the patch? Thanks.
              </div></li><li><div>
                [~simanchal] [~vgarg] [~pxiong]

This appears to be a Teradata extension to the SQL standard (not a bad one I'd say). My question is whether this will contribute to generic quantified comparison predicate support, possibly as a followup.

First, on the Teradata specific stuff, I'm referring to Teradata document "SQL Functions, Operators, Expressions and Predicates", Release 14.10, page 928.

Teradata supports subqueries in addition to pattern expressions. I didn't see any tests with subqueries so it's not clear to me that subqueries are supported. In my experience with quantified predicates, they are typically used with subqueries. That may be different for this TD specific extension but with standard features it is almost always the case.

Also: With quantified comparison predicates SOME and ANY are aliases. The Teradata documentation confirms that a user can specify either SOME or ANY.

I expect that Hive will eventually support full quantified comparison predicates, all the commercial analytical databases already do. For an example:

where x = any ( select y from table where table.field = x );

IOW instead of like I could say =, &lt;&gt;, &gt;, &lt;, &gt;=, &lt;=. Based on the patch it looks like the any/all is tied specifically to like. Maybe that's the Hive way I honestly don't know since I hardly ever get below the SQL layer. All I want to ask is whether this sets us down the right path to supporting these comparison operators.

              </div></li><li><div>
                Hi [~cartershanklin] Thank your for adding all TD functionality related to  'ALL','ANY' and 'SOME' key words.
Altogether it is big task to add every thing in change. Better we can add all TD functionalities incrementally. 
              </div></li><li><div>
                [~cartershanklin] I don't think this patch will help much for supporting quantified comparison predicates since this patch is catering to only  'like any'. For quantified comparison predicate we will need more generic UDF to deal with all datatypes and operators or may be rewrite it to avoid adding UDF. 
Is there a JIRA for supporting quantified comparison predicates?
              </div></li><li><div>
                [~vgarg] the quantified comparison predicate ticket is HIVE-13582
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12864628/HIVE-15229.6.patch

{color:green}SUCCESS:{color} +1 due to 6 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 10632 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_index] (batchId=225)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[smb_mapjoin_7] (batchId=234)
org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver.org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver (batchId=236)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/4844/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/4844/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-4844/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12864628 - PreCommit-HIVE-Build
              </div></li><li><div>
                Hi [~cwsteinbach] I have refreshed the patch with latest code.
              </div></li><li><div>
                Committed to master. Thanks Simanchal!
              </div></li><li><div>
                Doc note:  This needs to be documented in the wiki for release 3.0.0.

* [Hive Operators and UDFs -- Relational Operators | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-RelationalOperators]

Added a TODOC3.0 label.
              </div></li><li><div>
                Hive 3.0.0 has been released so closing this jira.
              </div></li></ol></div></div></html>