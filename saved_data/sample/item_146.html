<!DOCTYPE html><html><div class="item-title">
        Item 146
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 renameTo() fails on Windows if the destination
 file exists.

              </div></li><li><div>
                 update the fstime file here. renameTo fails on Windows
 if the destination file already exists.
              </div></li><li><div>
                 renameTo fails on Windows if the destination file 
 already exists.
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HADOOP-959.  Fix namenode snapshot code added in HADOOP-227 to work on Windows.  Contributed by Dhruba.
                </div><div><b>message:</b> HADOOP-959.  Fix namenode snapshot code added in HADOOP-227 to work on Windows.  Contributed by Dhruba.

git-svn-id: https://svn.apache.org/repos/asf/lucene/hadoop/trunk@501942 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li><li><div><div><b>summary:</b> TestCheckpoint fails on Windows
                </div><div><b>description:</b> The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits

File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593

I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 

 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Here is a patch for review.
              </div></li><li><div>
                The comments "//renameTo fails on windows" should be more descriptive, e.g. // renameTo fails on windows if the destination exists
              </div></li><li><div><div><b>body:</b> Added additional documentation.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Code reviewed by Milind.
              </div></li><li><div>
                +1, because http://issues.apache.org/jira/secure/attachment/12349969/renameToWindows2.patch applied and successfully tested against trunk revision r501616.
              </div></li><li><div>
                I just committed this.  Thanks, Dhruba!
              </div></li></ol></div></div></html>