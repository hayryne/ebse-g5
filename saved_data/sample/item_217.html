<!DOCTYPE html><html><div class="item-title">
        Item 217
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 pylint: disable=E0611
              </div></li><li><div>
                 Create hook
 or slack_hook = SlackHook(slack_conn_id="slack")
              </div></li><li><div>
                 Call generic API with parameters (errors are handled by hook)
  For more details check https://api.slack.com/methods/chat.postMessage
              </div></li><li><div>
                 Call method from Slack SDK (you have to handle errors yourself)
  For more details check https://slack.dev/python-slackclient/basic_usage.html#sending-a-message
              </div></li><li><div>
                 Mock
 Assert
              </div></li><li><div>
                 Mock
 Run
              </div></li><li><div>
                 Given
              </div></li><li><div>
                 Run
              </div></li><li><div>
                 Assert
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2 (#5519)
                </div><div><b>message:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2 (#5519)

Co-authored-by: Kaxil Naik &lt;kaxilnaik@gmail.com&gt;
Co-authored-by: Kaxil Naik &lt;8811558+kaxil@users.noreply.github.com&gt;
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Support slackclient v2 with 2.0
                </div><div><b>body:</b> **Description**
Slack migrated their Python client to v2. In v1 they ended support for Python 2.7 with its EOL.

Airflow 2.0 will also end support for Python 2.7, so there's no need for the outdated dependency to stick around.

**Use case / motivation**
The [Python Slack SDK documentation](https://slack.dev/python-slackclient/) for v1 of the SDK is nowhere to be found, taking all the fun out of using it.

Furthermore, [Slack does not add new features to the v1 SDK](https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x#minimum-python-versions).

**Related Issues / PR**
PR https://github.com/apache/airflow/pull/5519 already implemented the change for the Slack operators, but was not merged because Python 2 was still supported at the time.

The corresponding [AIRFLOW-4543](https://issues.apache.org/jira/browse/AIRFLOW-4543) ticket is closed and cannot be reopened.

                </div></div></li><li><div><div><b>title:</b> Support slackclient v2 with 2.0
                </div><div><b>body:</b> **Description**
Slack migrated their Python client to v2. In v1 they ended support for Python 2.7 with its EOL.

Airflow 2.0 will also end support for Python 2.7, so there's no need for the outdated dependency to stick around.

**Use case / motivation**
The [Python Slack SDK documentation](https://slack.dev/python-slackclient/) for v1 of the SDK is nowhere to be found, taking all the fun out of using it.

Furthermore, [Slack does not add new features to the v1 SDK](https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x#minimum-python-versions).

**Related Issues / PR**
PR https://github.com/apache/airflow/pull/5519 already implemented the change for the Slack operators, but was not merged because Python 2 was still supported at the time.

The corresponding [AIRFLOW-4543](https://issues.apache.org/jira/browse/AIRFLOW-4543) ticket is closed and cannot be reopened.

                </div></div></li><li><div><div><b>title:</b> Support slackclient v2 with 2.0
                </div><div><b>body:</b> **Description**
Slack migrated their Python client to v2. In v1 they ended support for Python 2.7 with its EOL.

Airflow 2.0 will also end support for Python 2.7, so there's no need for the outdated dependency to stick around.

**Use case / motivation**
The [Python Slack SDK documentation](https://slack.dev/python-slackclient/) for v1 of the SDK is nowhere to be found, taking all the fun out of using it.

Furthermore, [Slack does not add new features to the v1 SDK](https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x#minimum-python-versions).

**Related Issues / PR**
PR https://github.com/apache/airflow/pull/5519 already implemented the change for the Slack operators, but was not merged because Python 2 was still supported at the time.

The corresponding [AIRFLOW-4543](https://issues.apache.org/jira/browse/AIRFLOW-4543) ticket is closed and cannot be reopened.

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                Thanks for opening your first issue here! Be sure to follow the issue template!

              </div></li><li><div>
                Resolved in https://github.com/apache/airflow/pull/5519 and released in [slack provider ](https://pypi.org/project/apache-airflow-backport-providers-slack/)&gt;= 2020.6.24
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-4543] Update slack operator to support slackclient v2
                </div><div><b>body:</b> Make sure you have checked _all_ steps below.

### Jira

- [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
  - https://issues.apache.org/jira/browse/AIRFLOW-4543

### Description

- [x] Here are some details about my PR, including screenshots of any UI changes:

* Support (exclusively) official slack library v2.
* Retain existing functionality and interface
* Slightly change structure (eg remove some properties)
* Remove a redundant check that was made in both Hook and Operator
This PR addresses issue #8433

### Tests

- [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
* tests.operators.test_slack_operator
* tests.hooks.test_slack_hook.SlackHookTestCase
### Commits

- [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
  1. Subject is separated from body by a blank line
  1. Subject is limited to 50 characters (not including Jira issue reference)
  1. Subject does not end with a period
  1. Subject uses the imperative mood ("add", not "adding")
  1. Body wraps at 72 characters
  1. Body explains "what" and "why", not "how"

### Documentation

- [x] In case of new functionality, my PR adds documentation that describes how to use it.
  - All the public functions and the classes in the PR contain docstrings that explain what it does
  - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release

### Code Quality

- [x] Passes `flake8`

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Closing this PR as https://pypi.org/project/slackclient/ requires py36.
              </div></li><li><div>
                &gt; Closing this PR as https://pypi.org/project/slackclient/ requires py36.

Is there a roadmap regarding this Operator (and dependency) now that Python 2.x is EOL? 

We're having problems with slackclient 1.x on an Airflow 1.10.7 instance running on Python 3.7. Afaik, slackclient 1.x is now without support due to the EOL: https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x#minimum-python-versions
              </div></li><li><div>
                Airflow 2.0 will only support Python 3+, so we can now update this library.  If you do it quite quickly, they will be available in the [backport package](https://lists.apache.org/thread.html/rf6f2de8056b00ad084c96a9428670c14421a89ba2bbbd362d833bb50%40%3Cdev.airflow.apache.org%3E).
              </div></li><li><div>
                With Python 2.x EOL and slackclient 1.x being deprecated for a while now, can this issue be re-opened, @serkef ?
              </div></li><li><div>
                @serkef Would you like to reopen and work on this PR? Airflow Master requires Python 3.6+ so this would be a good fit.
              </div></li><li><div>
                @kaxil can you help a bit? Why are the CI actions not running? Also I see conflicts on the files that I resolved when I rebased. I'm probably missing something...
              </div></li><li><div>
                &gt; @kaxil can you help a bit? Why are the CI actions not running? Also I see conflicts on the files that I resolved when I rebased. I'm probably missing something...

That is strange. Can you rebase on latest Master please, looks like there are some conflicts. Hopefully once you do that, GA should run
              </div></li><li><div>
                Unfortunately, our tests didn't catch this too :( 

Can you fix the error please
              </div></li><li><div>
                Check this out: https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x


**Before 2.0**:

```python
from slackclient import SlackClient

client = SlackClient(os.environ["SLACK_API_TOKEN"])
client.api_call('chat.postMessage',
    timeout=30,
    channel='C0123456',
    text="Hi!")
```

**After 2.0**:
```python
import slack

client = slack.WebClient(os.environ["SLACK_API_TOKEN"], timeout=30)
client.api_call('chat.postMessage', json={
    'channel': 'C0123456',
    'text': 'Hi!'})

# Note: That while the above is allowed, the more efficient way to call that API is like this:
client.chat_postMessage(
    channel='C0123456',
    text='Hi!')
```
              </div></li><li><div>
                The following diff should also check and fix the issue:

```diff
diff --git a/airflow/providers/slack/hooks/slack.py b/airflow/providers/slack/hooks/slack.py
index 3a0cd693c..d4d558e7a 100644
--- a/airflow/providers/slack/hooks/slack.py
+++ b/airflow/providers/slack/hooks/slack.py
@@ -80,7 +80,7 @@ class SlackHook(BaseHook):
         :param api_params: parameters of the API
         """
         slack_client = WebClient(self.token, **self.client_args)
-        return_code = slack_client.api_call(method, **api_params)
+        return_code = slack_client.api_call(method, json=api_params)

         try:
             return_code.validate()
diff --git a/tests/providers/slack/hooks/test_slack.py b/tests/providers/slack/hooks/test_slack.py
index 1594d8b1d..cfb5c79dc 100644
--- a/tests/providers/slack/hooks/test_slack.py
+++ b/tests/providers/slack/hooks/test_slack.py
@@ -160,3 +160,13 @@ class TestSlackHook(unittest.TestCase):
         except AirflowException as exc:
             self.assertIn("foo", str(exc))
             self.assertIn("bar", str(exc))
+
+    @mock.patch('airflow.providers.slack.hooks.slack.WebClient.api_call', autospec=True)
+    @mock.patch('airflow.providers.slack.hooks.slack.WebClient')
+    def test_api_call(self, mock_slack_client, mock_slack_api_call):
+        slack_hook = SlackHook(token='test_token')
+        test_api_params = {'channel': 'test_channel'}
+
+        slack_hook.call("chat.postMessage", test_api_params)
+        mock_slack_api_call.assert_called_once_with(
+            mock_slack_client, "chat.postMessage", json=test_api_params)
```
              </div></li><li><div>
                @kaxil thanks for testing this. I made the required changes.

&gt; Have you tested that the `SlackAPIPostOperator` still works with attachments?

Yes, I tested an example DAG locally with the follow task:
```
run_this = SlackAPIPostOperator(
    task_id="post_hello",
    dag=dag,
    token="xxx",
    text="Hello",
    channel="#welcome",
    attachments=[{"pretext": "pre-hello", "text": "text-world"}],
)
```
And result 
![image](https://user-images.githubusercontent.com/3225779/81100218-7562a500-8f0c-11ea-8ad1-b57c319f3966.png)

              </div></li><li><div>
                Docs build is failing: https://github.com/apache/airflow/pull/5519/checks?check_run_id=647041208
              </div></li><li><div>
                Thanks for finishing this up @kaxil 
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> PRs are _much_ easier to review if you don't make un-necessary/stylistic changes like this. Please back this sort of change out :)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                ok, reverted.
              </div></li><li><div>
                v.2.5.0 is already out. Shall I restrict minimum version?
              </div></li><li><div>
                ```suggestion
    :type use_session: bool
```
              </div></li><li><div>
                ```suggestion
        ``https://www.slack.com/api/``
```
              </div></li><li><div>
                Let's not create a client in `__init__` 
              </div></li><li><div><div><b>body:</b> Done.
I would assume it's more efficient to create the connection on init to possibly reuse. Do we have a common pattern in airflow hooks to create the connections during the call?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I had a brain-fade moment actually 🤦 . I thought the client creation was inside Operator's init method, so to avoid DB calls while DAG Parsing I suggested to move it outside `__init__`. It won't matter with Hook 
              </div></li><li><div>
                Happy to merge it now as it is. 
              </div></li><li><div>
                It worked for me after the following change:

```suggestion
        return_code = slack_client.api_call(method, json=api_params)
```
              </div></li><li><div>
                I moved this back to init, to give the possibility to operators to use the client directly.
              </div></li><li><div>
                I mean creating SlackHook is fine isn't it ? As the WebClient does not call any external service by itself until `WebClient.call` is run
              </div></li><li><div><div><b>body:</b> I want to test the `get_token` which is called in the `__init__` so this is why I'm creating a dummy subclass with empty init. Is there a better way to do it?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                There is no need of dummy subclasses, you can initialize the Slack directly, it is not calling slack API in the __init__ is it?
              </div></li><li><div>
                ```suggestion
        self.token = self.__get_token(token, slack_conn_id)
```
              </div></li><li><div>
                Pushed a commit to PR: https://github.com/apache/airflow/pull/5519/commits/d81d6e947ba364b0dd9e730507e51ff2a0d3d3e2


              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Update slack operator to support slackclient v2
                </div><div><b>description:</b> Official [Slack API for python|https://pypi.org/project/slackclient/] has recently released [v.2|https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x0]

Among others some important points:
 * Async IO
 * SSL and Proxy
 * Dropping 2.7 support

Opening this ticket to work on the upgrade. Current functionalities will be migrated and will try to extend functionalities, if possible.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                serkef commented on pull request #5519: [AIRFLOW-4543] Update slack operator to support slackclient v2
URL: https://github.com/apache/airflow/pull/5519
 
 
   Make sure you have checked _all_ steps below.
   
   ### Jira
   
   - [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
     - https://issues.apache.org/jira/browse/AIRFLOW-4543
   
   ### Description
   
   - [ ] Here are some details about my PR, including screenshots of any UI changes:
   
   * Support (exclusively) official slack library v2.
   * Retain existing functionality and interface
   * Slightly change structure (eg remove some properties)
   * Remove a redundant check that was made in both Hook and Operator
   
   ### Tests
   
   - [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
   * tests.operators.test_slack_operator
   * tests.hooks.test_slack_hook.SlackHookTestCase
   ### Commits
   
   - [ ] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
     1. Subject is separated from body by a blank line
     1. Subject is limited to 50 characters (not including Jira issue reference)
     1. Subject does not end with a period
     1. Subject uses the imperative mood ("add", not "adding")
     1. Body wraps at 72 characters
     1. Body explains "what" and "why", not "how"
   
   ### Documentation
   
   - [ ] In case of new functionality, my PR adds documentation that describes how to use it.
     - All the public functions and the classes in the PR contain docstrings that explain what it does
     - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release
   
   ### Code Quality
   
   - [ ] Passes `flake8`
   
 
----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.
 
For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                Unfortunately v2 requires 3.6 [https://pypi.org/project/slackclient/|https://pypi.org/project/slackclient//]

I think we can close this
              </div></li><li><div>
                serkef commented on pull request #5519: [AIRFLOW-4543] Update slack operator to support slackclient v2
URL: https://github.com/apache/airflow/pull/5519
 
 
   
 
----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.
 
For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                Closing because 3.5 cannot be supported
              </div></li><li><div>
                kaxil commented on issue #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-617128959


   @serkef Would like to reopen and work on this PR? Airflow Master requires Python 3.6+ so this would be a good fit.


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil edited a comment on issue #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-617128959


   @serkef Would you like to reopen and work on this PR? Airflow Master requires Python 3.6+ so this would be a good fit.


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef opened a new pull request #5519:
URL: https://github.com/apache/airflow/pull/5519


   Make sure you have checked _all_ steps below.
   
   ### Jira
   
   - [x] My PR addresses the following [Airflow Jira](https://issues.apache.org/jira/browse/AIRFLOW/) issues and references them in the PR title. For example, "\[AIRFLOW-XXX\] My Airflow PR"
     - https://issues.apache.org/jira/browse/AIRFLOW-4543
   
   ### Description
   
   - [x] Here are some details about my PR, including screenshots of any UI changes:
   
   * Support (exclusively) official slack library v2.
   * Retain existing functionality and interface
   * Slightly change structure (eg remove some properties)
   * Remove a redundant check that was made in both Hook and Operator
   
   ### Tests
   
   - [ x ] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
   * tests.operators.test_slack_operator
   * tests.hooks.test_slack_hook.SlackHookTestCase
   ### Commits
   
   - [x] My commits all reference Jira issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
     1. Subject is separated from body by a blank line
     1. Subject is limited to 50 characters (not including Jira issue reference)
     1. Subject does not end with a period
     1. Subject uses the imperative mood ("add", not "adding")
     1. Body wraps at 72 characters
     1. Body explains "what" and "why", not "how"
   
   ### Documentation
   
   - [x] In case of new functionality, my PR adds documentation that describes how to use it.
     - All the public functions and the classes in the PR contain docstrings that explain what it does
     - If you implement backwards incompatible changes, please leave a note in the [Updating.md](https://github.com/apache/airflow/blob/master/UPDATING.md) so we can assign it to a appropriate release
   
   ### Code Quality
   
   - [x] Passes `flake8`
   


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on issue #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-617329045


   @kaxil can you help a bit? Why are the CI actions not running? Also I see conflicts on the files that I resolved when I rebased. I'm probably missing something...


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r412384446



##########
File path: setup.py
##########
@@ -256,7 +256,7 @@ def write_version(filename: str = os.path.join(*["airflow", "git_version"])):
 segment = ['analytics-python&gt;=1.2.9']
 sendgrid = ['sendgrid&gt;=5.2.0,&lt;6']
 sentry = ['sentry-sdk&gt;=0.8.0', "blinker&gt;=1.1"]
-slack = ['slackclient&gt;=1.0.0,&lt;2.0.0']
+slack = ['slackclient&gt;=2.0.0,&lt;3.0.0']

Review comment:
       v.2.5.0 is already out. Shall I restrict minimum version?




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on issue #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-617341114


   &gt; @kaxil can you help a bit? Why are the CI actions not running? Also I see conflicts on the files that I resolved when I rebased. I'm probably missing something...
   
   That is strange. Can you rebase on latest Master please, looks like there are some conflicts. Hopefully once you do that, GA should run


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418718000



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool

Review comment:
       ```suggestion
       :type use_session: bool
   ```




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418718102



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`

Review comment:
       ```suggestion
           ``https://www.slack.com/api/``
   ```




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418718905



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack.
+        Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)
+        self.client = WebClient(token, **client_args)

Review comment:
       Let's not create a client in `__init__` 




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418941185



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack.
+        Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)
+        self.client = WebClient(token, **client_args)

Review comment:
       Done.
   I would assume it's more efficient to create the connection on init to possibly reuse. Do we have a common pattern in airflow hooks to create the connections during the call?




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418982750



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack.
+        Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)
+        self.client = WebClient(token, **client_args)

Review comment:
       I had a brain-fade moment actually 🤦 . I thought the client creation was inside Operator's init method, so to avoid DB calls while DAG Parsing I suggested to move it outside `__init__`. It won't matter with Hook 




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418983365



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack.
+        Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)
+        self.client = WebClient(token, **client_args)

Review comment:
       Happy to merge it now as it is. 




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-622989485


   Unfortunately, our tests didn't catch this too :( 
   
   Can you fix the error please


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-622989835


   Check this out: https://github.com/slackapi/python-slackclient/wiki/Migrating-to-2.x
   
   
   **Before 2.0**:
   
   ```python
   from slackclient import SlackClient
   
   client = SlackClient(os.environ["SLACK_API_TOKEN"])
   client.api_call('chat.postMessage',
       timeout=30,
       channel='C0123456',
       text="Hi!")
   ```
   
   **After 2.0**:
   ```python
   import slack
   
   client = slack.WebClient(os.environ["SLACK_API_TOKEN"], timeout=30)
   client.api_call('chat.postMessage', json={
       'channel': 'C0123456',
       'text': 'Hi!'})
   
   # Note: That while the above is allowed, the more efficient way to call that API is like this:
   client.chat_postMessage(
       channel='C0123456',
       text='Hi!')
   ```


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r418987364



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,40 +28,62 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type use_session: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        ``https://www.slack.com/api/``
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack. Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
         self.token = self.__get_token(token, slack_conn_id)
+        self.client_args = client_args
 
     def __get_token(self, token, slack_conn_id):
         if token is not None:
             return token
-        elif slack_conn_id is not None:
+
+        if slack_conn_id is not None:
             conn = self.get_connection(slack_conn_id)
 
             if not getattr(conn, 'password', None):
                 raise AirflowException('Missing token(password) in Slack connection')
             return conn.password
-        else:
-            raise AirflowException('Cannot get token: '
-                                   'No valid Slack token nor slack_conn_id supplied.')
+
+        raise AirflowException('Cannot get token: '
+                               'No valid Slack token nor slack_conn_id supplied.')
 
     def call(self, method: str, api_params: dict) -&gt; None:
         """
-        Calls the Slack client.
+        Creates and calls the Slack client.
 
         :param method: method
         :param api_params: parameters of the API
         """
-        slack_client = SlackClient(self.token)
+        slack_client = WebClient(self.token, **self.client_args)
         return_code = slack_client.api_call(method, **api_params)

Review comment:
       It worked for me after the following change:
   
   ```suggestion
           return_code = slack_client.api_call(method, json=api_params)
   ```




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-622995610


   The following diff should also check and fix the issue:
   
   ```diff
   diff --git a/airflow/providers/slack/hooks/slack.py b/airflow/providers/slack/hooks/slack.py
   index 3a0cd693c..d4d558e7a 100644
   --- a/airflow/providers/slack/hooks/slack.py
   +++ b/airflow/providers/slack/hooks/slack.py
   @@ -80,7 +80,7 @@ class SlackHook(BaseHook):
            :param api_params: parameters of the API
            """
            slack_client = WebClient(self.token, **self.client_args)
   -        return_code = slack_client.api_call(method, **api_params)
   +        return_code = slack_client.api_call(method, json=api_params)
   
            try:
                return_code.validate()
   diff --git a/tests/providers/slack/hooks/test_slack.py b/tests/providers/slack/hooks/test_slack.py
   index 1594d8b1d..cfb5c79dc 100644
   --- a/tests/providers/slack/hooks/test_slack.py
   +++ b/tests/providers/slack/hooks/test_slack.py
   @@ -160,3 +160,13 @@ class TestSlackHook(unittest.TestCase):
            except AirflowException as exc:
                self.assertIn("foo", str(exc))
                self.assertIn("bar", str(exc))
   +
   +    @mock.patch('airflow.providers.slack.hooks.slack.WebClient.api_call', autospec=True)
   +    @mock.patch('airflow.providers.slack.hooks.slack.WebClient')
   +    def test_api_call(self, mock_slack_client, mock_slack_api_call):
   +        slack_hook = SlackHook(token='test_token')
   +        test_api_params = {'channel': 'd'}
   +
   +        slack_hook.call("chat.postMessage", test_api_params)
   +        mock_slack_api_call.assert_called_once_with(
   +            mock_slack_client, "chat.postMessage", json=test_api_params)
   ```


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil edited a comment on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-622995610


   The following diff should also check and fix the issue:
   
   ```diff
   diff --git a/airflow/providers/slack/hooks/slack.py b/airflow/providers/slack/hooks/slack.py
   index 3a0cd693c..d4d558e7a 100644
   --- a/airflow/providers/slack/hooks/slack.py
   +++ b/airflow/providers/slack/hooks/slack.py
   @@ -80,7 +80,7 @@ class SlackHook(BaseHook):
            :param api_params: parameters of the API
            """
            slack_client = WebClient(self.token, **self.client_args)
   -        return_code = slack_client.api_call(method, **api_params)
   +        return_code = slack_client.api_call(method, json=api_params)
   
            try:
                return_code.validate()
   diff --git a/tests/providers/slack/hooks/test_slack.py b/tests/providers/slack/hooks/test_slack.py
   index 1594d8b1d..cfb5c79dc 100644
   --- a/tests/providers/slack/hooks/test_slack.py
   +++ b/tests/providers/slack/hooks/test_slack.py
   @@ -160,3 +160,13 @@ class TestSlackHook(unittest.TestCase):
            except AirflowException as exc:
                self.assertIn("foo", str(exc))
                self.assertIn("bar", str(exc))
   +
   +    @mock.patch('airflow.providers.slack.hooks.slack.WebClient.api_call', autospec=True)
   +    @mock.patch('airflow.providers.slack.hooks.slack.WebClient')
   +    def test_api_call(self, mock_slack_client, mock_slack_api_call):
   +        slack_hook = SlackHook(token='test_token')
   +        test_api_params = {'channel': 'test_channel'}
   +
   +        slack_hook.call("chat.postMessage", test_api_params)
   +        mock_slack_api_call.assert_called_once_with(
   +            mock_slack_client, "chat.postMessage", json=test_api_params)
   ```


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-624219960


   @kaxil thanks for testing this. I made the required changes.
   
   &gt; Have you tested that the `SlackAPIPostOperator` still works with attachments?
   
   Yes, I tested an example DAG locally with the follow task:
   ```
   run_this = SlackAPIPostOperator(
       task_id="post_hello",
       dag=dag,
       token="xxx",
       text="Hello",
       channel="#welcome",
       attachments=[{"pretext": "pre-hello", "text": "text-world"}],
   )
   ```
   And result 
   ![image](https://user-images.githubusercontent.com/3225779/81100218-7562a500-8f0c-11ea-8ad1-b57c319f3966.png)
   


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r420312499



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,29 +28,50 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type base_url: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        `https://www.slack.com/api/`
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack.
+        Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)
+        self.client = WebClient(token, **client_args)

Review comment:
       I moved this back to init, to give the possibility to operators to use the client directly.




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#issuecomment-624234996


   Docs build is failing: https://github.com/apache/airflow/pull/5519/checks?check_run_id=647041208


----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r421153513



##########
File path: tests/providers/slack/hooks/test_slack.py
##########
@@ -19,82 +19,154 @@
 import unittest
 
 import mock
+from slack.errors import SlackApiError
 
 from airflow.exceptions import AirflowException
 from airflow.providers.slack.hooks.slack import SlackHook
 
 
 class TestSlackHook(unittest.TestCase):
-    def test_init_with_token_only(self):
+
+    def test___get_token_with_token_only(self):
+        """ tests `__get_token` method when only token is provided """
+        # Given
         test_token = 'test_token'
-        slack_hook = SlackHook(token=test_token, slack_conn_id=None)
+        test_conn_id = None
+
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass
 
-        self.assertEqual(slack_hook.token, test_token)
+        # Run
+        hook = DummySlackHook()
+
+        # Assert
+        output = hook._SlackHook__get_token(test_token, test_conn_id)  # pylint: disable=E1101
+        expected = test_token
+        self.assertEqual(output, expected)
 
     @mock.patch('airflow.providers.slack.hooks.slack.SlackHook.get_connection')
-    def test_init_with_valid_slack_conn_id_only(self, get_connection_mock):
+    def test___get_token_with_valid_slack_conn_id_only(self, get_connection_mock):
+        """ tests `__get_token` method when only connection is provided """
+        # Given
+        test_token = None
+        test_conn_id = 'x'
         test_password = 'test_password'
+
+        # Mock
         get_connection_mock.return_value = mock.Mock(password=test_password)
 
-        test_slack_conn_id = 'test_slack_conn_id'
-        slack_hook = SlackHook(token=None, slack_conn_id=test_slack_conn_id)
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass

Review comment:
       I mean creating SlackHook is fine isn't it ? As the WebClient does not call any external service by itself until `WebClient.call` is run




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                serkef commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r421559066



##########
File path: tests/providers/slack/hooks/test_slack.py
##########
@@ -19,82 +19,154 @@
 import unittest
 
 import mock
+from slack.errors import SlackApiError
 
 from airflow.exceptions import AirflowException
 from airflow.providers.slack.hooks.slack import SlackHook
 
 
 class TestSlackHook(unittest.TestCase):
-    def test_init_with_token_only(self):
+
+    def test___get_token_with_token_only(self):
+        """ tests `__get_token` method when only token is provided """
+        # Given
         test_token = 'test_token'
-        slack_hook = SlackHook(token=test_token, slack_conn_id=None)
+        test_conn_id = None
+
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass
 
-        self.assertEqual(slack_hook.token, test_token)
+        # Run
+        hook = DummySlackHook()
+
+        # Assert
+        output = hook._SlackHook__get_token(test_token, test_conn_id)  # pylint: disable=E1101
+        expected = test_token
+        self.assertEqual(output, expected)
 
     @mock.patch('airflow.providers.slack.hooks.slack.SlackHook.get_connection')
-    def test_init_with_valid_slack_conn_id_only(self, get_connection_mock):
+    def test___get_token_with_valid_slack_conn_id_only(self, get_connection_mock):
+        """ tests `__get_token` method when only connection is provided """
+        # Given
+        test_token = None
+        test_conn_id = 'x'
         test_password = 'test_password'
+
+        # Mock
         get_connection_mock.return_value = mock.Mock(password=test_password)
 
-        test_slack_conn_id = 'test_slack_conn_id'
-        slack_hook = SlackHook(token=None, slack_conn_id=test_slack_conn_id)
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass

Review comment:
       I want to test the `get_token` which is called in the `__init__` so this is why I'm creating a dummy subclass with empty init. Is there a better way to do it?




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r421892012



##########
File path: tests/providers/slack/hooks/test_slack.py
##########
@@ -19,82 +19,154 @@
 import unittest
 
 import mock
+from slack.errors import SlackApiError
 
 from airflow.exceptions import AirflowException
 from airflow.providers.slack.hooks.slack import SlackHook
 
 
 class TestSlackHook(unittest.TestCase):
-    def test_init_with_token_only(self):
+
+    def test___get_token_with_token_only(self):
+        """ tests `__get_token` method when only token is provided """
+        # Given
         test_token = 'test_token'
-        slack_hook = SlackHook(token=test_token, slack_conn_id=None)
+        test_conn_id = None
+
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass
 
-        self.assertEqual(slack_hook.token, test_token)
+        # Run
+        hook = DummySlackHook()
+
+        # Assert
+        output = hook._SlackHook__get_token(test_token, test_conn_id)  # pylint: disable=E1101
+        expected = test_token
+        self.assertEqual(output, expected)
 
     @mock.patch('airflow.providers.slack.hooks.slack.SlackHook.get_connection')
-    def test_init_with_valid_slack_conn_id_only(self, get_connection_mock):
+    def test___get_token_with_valid_slack_conn_id_only(self, get_connection_mock):
+        """ tests `__get_token` method when only connection is provided """
+        # Given
+        test_token = None
+        test_conn_id = 'x'
         test_password = 'test_password'
+
+        # Mock
         get_connection_mock.return_value = mock.Mock(password=test_password)
 
-        test_slack_conn_id = 'test_slack_conn_id'
-        slack_hook = SlackHook(token=None, slack_conn_id=test_slack_conn_id)
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass

Review comment:
       There is no need of dummy subclasses, you can initialize the Slack directly, it is not calling slack API in the __init__ is it?




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r421892088



##########
File path: airflow/providers/slack/hooks/slack.py
##########
@@ -27,40 +28,88 @@
 # noinspection PyAbstractClass
 class SlackHook(BaseHook):
     """
+    Creates a Slack connection, to be used for calls.
     Takes both Slack API token directly and connection that has Slack API token.
-
     If both supplied, Slack API token will be used.
+    Exposes also the rest of slack.WebClient args.
+
+    Examples:
+
+    .. code-block:: python
+
+        # Create hook
+        slack_hook = SlackHook(token="xxx")  # or slack_hook = SlackHook(slack_conn_id="slack")
+
+        # Call generic API with parameters (errors are handled by hook)
+        #  For more details check https://api.slack.com/methods/chat.postMessage
+        slack_hook.call("chat.postMessage", json={"channel": "#random", "text": "Hello world!"})
+
+        # Call method from Slack SDK (you have to handle errors yourself)
+        #  For more details check https://slack.dev/python-slackclient/basic_usage.html#sending-a-message
+        slack_hook.client.chat_postMessage(channel="#random", text="Hello world!")
 
     :param token: Slack API token
+    :type token: str
     :param slack_conn_id: connection that has Slack API token in the password field
+    :type slack_conn_id: str
+    :param use_session: A boolean specifying if the client should take advantage of
+        connection pooling. Default is True.
+    :type use_session: bool
+    :param base_url: A string representing the Slack API base URL. Default is
+        ``https://www.slack.com/api/``
+    :type base_url: str
+    :param timeout: The maximum number of seconds the client will wait
+        to connect and receive a response from Slack. Default is 30 seconds.
+    :type timeout: int
     """
-    def __init__(self, token: Optional[str] = None, slack_conn_id: Optional[str] = None) -&gt; None:
+
+    def __init__(
+        self,
+        token: Optional[str] = None,
+        slack_conn_id: Optional[str] = None,
+        **client_args: Any,
+    ) -&gt; None:
         super().__init__()
-        self.token = self.__get_token(token, slack_conn_id)
+        token = self.__get_token(token, slack_conn_id)

Review comment:
       ```suggestion
           self.token = self.__get_token(token, slack_conn_id)
   ```




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                kaxil commented on a change in pull request #5519:
URL: https://github.com/apache/airflow/pull/5519#discussion_r421892844



##########
File path: tests/providers/slack/hooks/test_slack.py
##########
@@ -19,82 +19,154 @@
 import unittest
 
 import mock
+from slack.errors import SlackApiError
 
 from airflow.exceptions import AirflowException
 from airflow.providers.slack.hooks.slack import SlackHook
 
 
 class TestSlackHook(unittest.TestCase):
-    def test_init_with_token_only(self):
+
+    def test___get_token_with_token_only(self):
+        """ tests `__get_token` method when only token is provided """
+        # Given
         test_token = 'test_token'
-        slack_hook = SlackHook(token=test_token, slack_conn_id=None)
+        test_conn_id = None
+
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass
 
-        self.assertEqual(slack_hook.token, test_token)
+        # Run
+        hook = DummySlackHook()
+
+        # Assert
+        output = hook._SlackHook__get_token(test_token, test_conn_id)  # pylint: disable=E1101
+        expected = test_token
+        self.assertEqual(output, expected)
 
     @mock.patch('airflow.providers.slack.hooks.slack.SlackHook.get_connection')
-    def test_init_with_valid_slack_conn_id_only(self, get_connection_mock):
+    def test___get_token_with_valid_slack_conn_id_only(self, get_connection_mock):
+        """ tests `__get_token` method when only connection is provided """
+        # Given
+        test_token = None
+        test_conn_id = 'x'
         test_password = 'test_password'
+
+        # Mock
         get_connection_mock.return_value = mock.Mock(password=test_password)
 
-        test_slack_conn_id = 'test_slack_conn_id'
-        slack_hook = SlackHook(token=None, slack_conn_id=test_slack_conn_id)
+        # Creating a dummy subclass is the easiest way to avoid running init
+        #  which is actually using the method we are testing
+        class DummySlackHook(SlackHook):
+            def __init__(self, *args, **kwargs):  # pylint: disable=W0231
+                pass

Review comment:
       Pushed a commit to PR: https://github.com/apache/airflow/pull/5519/commits/d81d6e947ba364b0dd9e730507e51ff2a0d3d3e2
   
   




----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.

For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                Commit 578fc514cd325b7d190bdcfb749a384d101238fa in airflow's branch refs/heads/master from Sergio Kefalas
[ https://gitbox.apache.org/repos/asf?p=airflow.git;h=578fc51 ]

[AIRFLOW-4543] Update slack operator to support slackclient v2 (#5519)

Co-authored-by: Kaxil Naik &lt;kaxilnaik@gmail.com&gt;
Co-authored-by: Kaxil Naik &lt;8811558+kaxil@users.noreply.github.com&gt;
              </div></li></ol></div></div></html>