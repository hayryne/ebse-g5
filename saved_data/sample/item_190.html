<!DOCTYPE html><html><div class="item-title">
        Item 190
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.

              </div></li><li><div>
                *
 * Factory of dummy FileSystem. See documentation of {@link AnotherDummyFSFileSystem}.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                 ------------------------------------------------------------------------
              </div></li><li><div>
                *
 * A FileSystem implementation for integration testing purposes. Supports and serves read-only content from static
 * key value map.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.

              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [FLINK-14382][e2e] Add another dummy fs for e2e test. It is same as dummy fs with different schema.
                </div><div><b>message:</b> [FLINK-14382][e2e] Add another dummy fs for e2e test. It is same as dummy fs with different schema.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li><li><div><div><b>summary:</b> Incorrect handling of FLINK_PLUGINS_DIR on Yarn
                </div><div><b>description:</b> *(This ticket is a blocker for 1.10 release while critical for 1.9.x)*

When creating and starting up the yarn containers there are two issues with how the {{FLINK_PLUGINS_DIR}} is being handled.
 # Content of the {{plugins}} directory is currently added to the class path, braking the encapsulation of the plugins from one another
 # {{FLINK_PLUGINS_DIR}} is passed to the container as an absolute path as seen by the client. Because of that TaskManager or JobManager can not use it.

Both bugs are probably contained to {{YarnClusterDescriptor#startAppMaster}} method (which calls relevant {{addEnvironmentFoldersToShipFiles}} and {{uploadAndRegisterFiles}} methods)

(original description)

If we do not set FLINK_PLUGINS_DIR in flink-conf.yaml, it will be set to [flink configuration|https://github.com/apache/flink/blob/9e6ff81e22d6f5f04abb50ca1aea84fd2542bf9d/flink-core/src/main/java/org/apache/flink/configuration/GlobalConfiguration.java#L158] according to the environment.

In yarn mode, the local path will be set in flink-conf.yaml and used by jobmanager and taskmanager. We will find the warning log like below.
{code:java}
2019-10-12 19:24:58,165 WARN  org.apache.flink.core.plugin.PluginConfig                     - Environment variable [FLINK_PLUGINS_DIR] is set to [/Users/wangy/IdeaProjects/apache-flink/flink-dist/target/flink-1.10-SNAPSHOT-bin/flink-1.10-SNAPSHOT/plugins] but the directory doesn't exist
{code}
It was in introduced by FLINK-12143.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [~1u0] could you take a look at this problem?
              </div></li><li><div>
                [~fly_in_gis] what is the issue? That we see this warning message? 
              </div></li><li><div>
                [~pnowojski]

What i mean is a local FLINK_PLUGINS_DIR has been set to flink-conf.yaml and used by flink jobmanager and taskmanager in yarn mode. So the user will find the warning log.
              </div></li><li><div>
                Thanks for the answer [~fly_in_gis], but unfortunately I still do not understand the issue. As far as I understand it, the warning message you posted is being logged even before JobManager/TaskManager are started up in {{YarnClusterDescriptor#addPluginsFoldersToShipFiles}}. This code tries to assemble jar files from both {{lib}} AND {{plugins}} directories, to upload them to the TM/JM. At this stage presence of {{plugins}} directory is indeed optional, as users might not be using any plugins. And also it is perfectly fine, if this points to a local filesystem directory - that should be the whole point of preparing the containers. Or am I missing something? 
              </div></li><li><div>
                I think Yang means that we write the locally configured plugins directory via the FLINK_PLUGINS_DIR env variable into the configuration we use to send to the Yarn JM and TM processes [~pnowojski]. This path is then not available in the Yarn container if one has specified an absolute path, for example. I think this sounds like a bug.
              </div></li><li><div>
                [~trohrmann]

Exactly. The local&nbsp;FLINK_PLUGINS_DIR should not be taken to jobmanager and taskmanager. It is not available for them.
              </div></li><li><div>
                Thanks for the explanation [~trohrmann], I think I get the problem. We should handle this in a similar way how are we relativizing the paths in {{YarnClusterDescriptor#uploadAndRegisterFiles}}.

Also now I see, that there is one more bug. Currently in yarn mode {{plugins}} directory is not only shipped to the cluster, but also added to the class path, which definitely should not be the case. 

I will update the ticket to reflect both of the issues.
              </div></li><li><div>
                Thanks for updating the ticket [~pnowojski]. I think we just need to ship the plugin directory only and do

not add to classpath. Also the environment `ENV_FLINK_PLUGINS_DIR` should be set for job manager and task manager container.

Are you working on this issue, [~pnowojski]&nbsp;? If not, would you mind to assign this ticket to me? I have some time to fix it.
              </div></li><li><div><div><b>body:</b> &gt;&nbsp;I think we just need to ship the plugin directory only and do not add to classpath

Yes, exactly.&nbsp;

&gt;&nbsp;Also the environment `ENV_FLINK_PLUGINS_DIR` should be set for job manager and task manager container.

It was a conscious decision discussed by me, [~trohrmann]&nbsp; and couple of other people, to not relay&nbsp; environment variables from the entry points (for example flink-cli), but read them once and pass them programatically via a config file, so I would keep it as it is. Environment variables have all the drawbacks of using global variables plus some more (hard to search usages for example). Also it's not nice that we have a multiple ways how to configure Flink. In the long run we will probably want to unify everything and pass all of the configuration in the same way, and moving away from relaying on environment variables (unless we have to).

I'm not saying that we can not change the direction, but I'm just writing down our reasoning behind this.&nbsp;

&gt;&nbsp;Are you working on this issue,&nbsp;[~pnowojski]&nbsp;? If not, would you mind to assign this ticket to me? I have some time to fix it.

Sure :)&nbsp;Done. Keep in mind that this probably needs some good test coverage (probably both unit test + maybe an end to end test).
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                [~pnowojski] [~trohrmann]

&gt; About the environment

What i mean is to set `ENV_FLINK_PLUGINS_DIR` to `$PWD/plugins` for job manager in `YarnClusterDescriptor`. Then it will be parsed by `GlobalConfiguration#loadConfiguration` in `YarnJobClusterEntrypoint` and set to configuration. So we could use it from flink configuration just like `configuration.getString(ConfigConstants.ENV_FLINK_PLUGINS_DIR)` later.&nbsp;

Are you suggesting to set `ConfigConstants.ENV_FLINK_PLUGINS_DIR` directly to a relative path(./plugins) to flink configuration in client?

&nbsp;

&gt; About the test

Do you mean to add an end to end test to cover the plugins function? Or just check the correct classpath and flink configuration have been set.
              </div></li><li><div>
                &gt;&nbsp;Are you suggesting to set `ConfigConstants.ENV_FLINK_PLUGINS_DIR` directly to a relative path(./plugins) to flink configuration in client?

Yes, that's the idea, unless this is for some reason much more difficult or has some other issues. Or at least create a copy of the client's configuration, that will be used only inside the yarn containers with the paths correctly converted to ones that are visible/valid from within the container.

&gt;&nbsp;Do you mean to add an end to end test to cover the plugins function? Or just check the correct classpath and flink configuration have been set.

The first one. I think the biggest issue here is that the whole plugins system was not working as designed in yarn. It was loading the classes, but not via the plugins mechanism and without the separation. There is already an end-to-end test coverage of plugins, including yarn (introduced by [this commit|https://github.com/apache/flink/commit/b1d5bf963e9ce062b2e349f5296a56da6816340e]), but it's clearly not sufficient - current test is checking whether we can read a {{--input dummy://localhost/words}} file provided by a {{DummyFS}} configured as a plugin. And this works, however it doesn't test the essence of the Plugins.

I think probably we need to repeat in end-to-end test the similar logic that is already implemented by the unit test {{org.apache.flink.test.plugin.PluginLoaderTest}}.

For example in the end to end test load not only one file from one dummy FIleSystem, but from two ({{DummyFSFactory}} and {{AnotherDummyFSFactory}}). Each of this dummy FileSystem should validate that there they can not see any classes from the other FileSystem ({{DummyFSFactory}} shouldn't be visible when loading {{AnotherDummyFSFactory}} and vice versa). I guess for this we would also need to modify {{WordCount}} example to union multiple inputs.
              </div></li><li><div>
                [~fly_in_gis] for your information. I intend to remove the part where we write the env variable into Flink's {{Configuration}}. Instead I want to directly read the env variable in the {{PluginConfig}}. If the variable has not been set, then it falls back to {{./plugins}}. See FLINK-14561 for more information.
              </div></li><li><div>
                Hi [~trohrmann],
I agree with you that we should not set the env `FLINK_PLUGIN_DIR` in flink configuration. Instead, make the `PluginConfig` to get the plugin directory from environment. So we will need to set the `FLINK_PLUGIN_DIR` environment in Yarn and mesos submission.

This jira will focus on only ship plugins on Yarn and check the plugin mechanism that classes of different plugins are isolated.
              </div></li><li><div>
                &gt; So we will need to set the `FLINK_PLUGIN_DIR` environment in Yarn and mesos submission.

There is another option. Flink could check if {{FLINK_PLUGIN_DIR}} is set, and if not, just fall back to checking {{$CWD/plugins}} (current working directory). This would give us an option in Yarn to just ship the plugins to the {{$CWD}}, to avoid setting and relaying on the environment variable.
              </div></li><li><div>
                &gt; There is another option. Flink could check if FLINK_PLUGIN_DIR is set, and if not, just fall back to checking $CWD/plugins (current working directory). This would give us an option in Yarn to just ship the plugins to the $CWD, to avoid setting and relaying on the environment variable.

That's how I intend to solve the problem in FLINK-14561.
              </div></li><li><div>
                [~pnowojski] [~trohrmann]

I have attached a PR to fix this issue. Please help to review.

[https://github.com/apache/flink/pull/10084]
              </div></li><li><div>
                Merged to master as 468415b85a59706c8e06b851ed792c5f5146b1ed..bc4e2458fc2a9be11fd2defbdba74ca0dd7b1ddf
              </div></li><li><div>
                Can this issue be closed now?
              </div></li><li><div>
                [~aljoscha] it was being back-ported to 1.9 release branch.

Merged to release-1.9 as {{2cecd2b17035d663281ab33fb45e8c7eb54511df..7d0455168ce5cb451ee6d0df6e96c9adf98d2b8b}}.
              </div></li></ol></div></div></html>