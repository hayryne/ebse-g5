<!DOCTYPE html><html><div class="item-title">
        Item 267
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 Go to brute force mode of scanning all partitions
              </div></li><li><div>
                *
   * Use Incremental Mode for finding partition paths.
   * @param cleanMetadata
   * @param newInstantToRetain
   * @return
   
              </div></li><li><div>
                *
   * Scan and list all paritions for cleaning.
   * @return all partitions paths for the dataset.
   * @throws IOException
   
              </div></li><li><div>
                *
   * Return partition paths for cleaning by commits mode.
   * @param instantToRetain Earliest Instant to retain
   * @return list of partitions
   * @throws IOException
   
              </div></li><li><div>
                 We no longer write empty cleaner plans when there are not enough commits present
              </div></li><li><div>
                 NOTE: See CleanPlanner#getFilesToCleanKeepingLatestCommits. We explicitly keep one commit before earliest
 commit
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode (#1576)
                </div><div><b>message:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode (#1576)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div></div></li><li><div><div><b>title:</b> [HUDI-850] Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>body:</b> We are unnecessarily scanning partitions for cleans_by_commit mode when there are no sufficient commits accumulated for cleaning. 
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Let me resolve the conflicts and ping back
              </div></li><li><div>
                # [Codecov](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=h1) Report
&gt; Merging [#1576](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=desc) into [master](https://codecov.io/gh/apache/incubator-hudi/commit/c4b71622b90fc66f20f361d4c083b0a396572b75&amp;el=desc) will **decrease** coverage by `0.00%`.
&gt; The diff coverage is `80.00%`.

[![Impacted file tree graph](https://codecov.io/gh/apache/incubator-hudi/pull/1576/graphs/tree.svg?width=650&amp;height=150&amp;src=pr&amp;token=VTTXabwbs2)](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=tree)

```diff
@@             Coverage Diff              @@
##             master    #1576      +/-   ##
============================================
- Coverage     71.81%   71.81%   -0.01%     
  Complexity      294      294              
============================================
  Files           385      385              
  Lines         16542    16549       +7     
  Branches       1661     1661              
============================================
+ Hits          11880    11885       +5     
+ Misses         3932     3931       -1     
- Partials        730      733       +3     
```


| [Impacted Files](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=tree) | Coverage Δ | Complexity Δ | |
|---|---|---|---|
| [...g/apache/hudi/table/action/clean/CleanPlanner.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvdGFibGUvYWN0aW9uL2NsZWFuL0NsZWFuUGxhbm5lci5qYXZh) | `86.13% &lt;80.00%&gt; (-1.57%)` | `0.00 &lt;0.00&gt; (ø)` | |
| [...le/action/rollback/BaseRollbackActionExecutor.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvdGFibGUvYWN0aW9uL3JvbGxiYWNrL0Jhc2VSb2xsYmFja0FjdGlvbkV4ZWN1dG9yLmphdmE=) | `70.83% &lt;0.00%&gt; (-6.95%)` | `0.00% &lt;0.00%&gt; (ø%)` | |
| [...n/java/org/apache/hudi/index/hbase/HBaseIndex.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvaW5kZXgvaGJhc2UvSEJhc2VJbmRleC5qYXZh) | `82.77% &lt;0.00%&gt; (-0.48%)` | `0.00% &lt;0.00%&gt; (ø%)` | |
| [...able/action/restore/BaseRestoreActionExecutor.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvdGFibGUvYWN0aW9uL3Jlc3RvcmUvQmFzZVJlc3RvcmVBY3Rpb25FeGVjdXRvci5qYXZh) | `93.75% &lt;0.00%&gt; (+3.12%)` | `0.00% &lt;0.00%&gt; (ø%)` | |
| [...src/main/java/org/apache/hudi/metrics/Metrics.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvbWV0cmljcy9NZXRyaWNzLmphdmE=) | `67.56% &lt;0.00%&gt; (+10.81%)` | `0.00% &lt;0.00%&gt; (ø%)` | |
| [...g/apache/hudi/metrics/InMemoryMetricsReporter.java](https://codecov.io/gh/apache/incubator-hudi/pull/1576/diff?src=pr&amp;el=tree#diff-aHVkaS1jbGllbnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2h1ZGkvbWV0cmljcy9Jbk1lbW9yeU1ldHJpY3NSZXBvcnRlci5qYXZh) | `80.00% &lt;0.00%&gt; (+40.00%)` | `0.00% &lt;0.00%&gt; (ø%)` | |

------

[Continue to review full report at Codecov](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=continue).
&gt; **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)
&gt; `Δ = absolute &lt;relative&gt; (impact)`, `ø = not affected`, `? = missing data`
&gt; Powered by [Codecov](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=footer). Last update [c4b7162...1f66e51](https://codecov.io/gh/apache/incubator-hudi/pull/1576?src=pr&amp;el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).

              </div></li><li><div>
                @vinothchandar : Ready for review
              </div></li><li><div>
                @vinothchandar : There is a followup on fixing the quality of unit-tests  (filed HUDI-857). Otherwise, good to review and merge.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Collections.emptyList()? 
              </div></li><li><div><div><b>body:</b> can we break this method up into two, based on the policy? it feels very overloaded now..
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> do we have enough tests that now test when a valid cleaner plan?
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                Yes, this particular check is when inserting first batch of data. There are other checks present which validates the effect of valid clean operations 
              </div></li><li><div>
                Done
              </div></li><li><div>
                Done
              </div></li><li><div>
                move to separate lines? 
              </div></li><li><div>
                we don't need the second check anymore , due to the switch above? 
              </div></li><li><div>
                rename: `getPartitionPathsForIncrementalCleaning()` ? 
              </div></li><li><div>
                rename: `getPartitionPathsForFullCleaning()` 
              </div></li><li><div>
                Fixed
              </div></li><li><div>
                Done
              </div></li><li><div>
                done
              </div></li><li><div>
                done
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>description:</b> Came up during https://github.com/apache/incubator-hudi/issues/1552 

Even with incremental cleaning turned on, we would have a scenario where there are no commits yet to clean, but we end up listing needlessly 
                </div></div></li><li><div><div><b>summary:</b> Avoid unnecessary listings in incremental cleaning mode
                </div><div><b>description:</b> Came up during https://github.com/apache/incubator-hudi/issues/1552 

Even with incremental cleaning turned on, we would have a scenario where there are no commits yet to clean, but we end up listing needlessly 
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>