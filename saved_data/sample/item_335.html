<!DOCTYPE html><html><div class="item-title">
        Item 335
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * The number of invisible segment info which will be preserved in tablestatus file,
   * if it exceeds this value, they will be removed and write to tablestatus.history file.
   
              </div></li><li><div>
                *
   * default value is 200, it means that it will preserve 200 invisible segment info
   * in tablestatus file.
   * The size of one segment info is about 500 bytes, so the size of tablestatus file
   * will remain at 100KB.
   
              </div></li><li><div>
                 if execute command 'clean files' or the number of invisible segment info
 exceeds the value of 'carbon.invisible.segments.preserve.count',
 it need to append the invisible segment list to 'tablestatus.history' file.
              </div></li><li><div>
                *
   * Separate visible and invisible segments into two array.
   
              </div></li><li><div>
                *
   * This method reads the load history metadata file
   *
   * @param metadataFolderPath
   * @return
   
              </div></li><li><div>
                *
   * Return an array containing all invisible segment entries in appendList and historyList.
   
              </div></li><li><div>
                 can not remove segment 0, there are some info will be used later
 for example: updateStatusFileName
              </div></li><li><div>
                *
   * Get the number of invisible segment info from segment info list.
   
              </div></li><li><div>
                *
   * Get the number of invisible segment info which will be preserved in tablestatus file.
   
              </div></li><li><div>
                *
   * Return table status history file path based on `tablePath`
   
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [CARBONDATA-2258] Separate visible and invisible segments info into two files to reduce the size of tablestatus file.
                </div><div><b>message:</b> [CARBONDATA-2258] Separate visible and invisible segments info into two files to reduce the size of tablestatus file.

The size of the tablestatus file is getting larger, there are many places will scan this file and it will impact the performance of reading this file.
According to the discussion on thread, it can append the
invisible segment list to the file called 'tablestatus.history' when execute
command 'CLEAN FILES FOR TABLE' (in method 'SegmentStatusManager.deleteLoadsAndUpdateMetadata') every time, separate visible and invisible segments into two files(tablestatus file and tablestatus.history file).

This closes #2091

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [CARBONDATA-2258] Separate visible and invisible segments info into two files to reduce the size of tablestatus file.
                </div><div><b>body:</b> The size of the tablestatus file is getting larger, there are many places will scan this file and it will impact the performance of reading this file.
According to the discussion on [thread](http://apache-carbondata-dev-mailing-list-archive.1130556.n5.nabble.com/The-size-of-the-tablestatus-file-is-getting-larger-does-it-impact-the-performance-of-reading-this-fi-td41941.html), it can *append* the
invisible segment list to the file called 'tablestatus.history' when execute
command 'CLEAN FILES FOR TABLE' (in method 'SegmentStatusManager.deleteLoadsAndUpdateMetadata') every time, separate visible and invisible segments into two files(tablestatus file and tablestatus.history file).

Be sure to do all of the following checklist to help us incorporate 
your contribution quickly and easily:

 - [ ] Any interfaces changed? No
 
 - [ ] Any backward compatibility impacted?  No
 
 - [ ] Document update required?

 - [x] Testing done
        Please provide details on 
        - Whether new unit test cases have been added or why no new tests are required?
        - How it is tested? Please attach test report.
        - Is it a performance related change? Please attach the performance test report.
        - Any additional information to help reviewers in testing this change.
       
 - [ ] For large changes, please consider breaking it into sub-tasks under an umbrella JIRA. 


                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Build Failed with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3283/

              </div></li><li><div>
                Build Failed  with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4511/

              </div></li><li><div>
                SDV Build Fail , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4017/

              </div></li><li><div>
                retest this please
              </div></li><li><div>
                Build Failed with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3288/

              </div></li><li><div>
                Build Failed  with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4516/

              </div></li><li><div>
                Build Failed with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3303/

              </div></li><li><div>
                Build Failed  with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4531/

              </div></li><li><div>
                retest sdv please.
              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4031/

              </div></li><li><div>
                Build Failed with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3308/

              </div></li><li><div>
                Build Failed  with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4536/

              </div></li><li><div>
                Build Success with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4542/

              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4035/

              </div></li><li><div>
                retest this please
              </div></li><li><div>
                retest sdv please
              </div></li><li><div>
                Build Failed with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3318/

              </div></li><li><div>
                Build Success with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4545/

              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4040/

              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4043/

              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4044/

              </div></li><li><div>
                retest this please
              </div></li><li><div>
                Build Success with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4549/

              </div></li><li><div>
                Build Success with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3322/

              </div></li><li><div>
                @jackylk @ravipesala  please help to review, thanks
              </div></li><li><div>
                Build Success with Spark 2.2.1, Please check CI http://88.99.58.216:8080/job/ApacheCarbonPRBuilder/3339/

              </div></li><li><div>
                Build Success with Spark 2.1.0, Please check CI http://136.243.101.176:8080/job/ApacheCarbonPRBuilder1/4565/

              </div></li><li><div>
                SDV Build Success , Please check CI http://144.76.159.231:8080/job/ApacheSDVTests/4061/

              </div></li><li><div>
                LGTM
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                The default is 200 right. Please update comment
              </div></li><li><div>
                change to `Return an array containing all invisible segment entries in appendList and historyList`
              </div></li><li><div>
                Done
              </div></li><li><div>
                Done
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Separate visible and invisible segments info into two files to reduce the size of tablestatus file.
                </div><div><b>description:</b> The size of the tablestatus file is getting larger, there are many places will scan this file and it will impact the performance of reading this file.
According to the discussion on [thread|http://apache-carbondata-dev-mailing-list-archive.1130556.n5.nabble.com/The-size-of-the-tablestatus-file-is-getting-larger-does-it-impact-the-performance-of-reading-this-fi-td41941.html], it can *append* the 
invisible segment list to the file called 'tablestatus.history' when execute 
command 'CLEAN FILES FOR TABLE' (in method 'SegmentStatusManager.deleteLoadsAndUpdateMetadata') every time, separate visible and invisible segments into two files(tablestatus file and tablestatus.history file). 
If later it needs to support listing all segments(include visible and invisible) list when execute 'SHOW SEGMENTS FOR TABLE', it just need to read from two files.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>