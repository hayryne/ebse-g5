<!DOCTYPE html><html><div class="item-title">
        Item 1
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> do not recalculate cache capacity post-compaction if it's been manually modified.  patch by jbellis; reviewed by Ryan King for CASSANDRA-1079
                </div><div><b>message:</b> do not recalculate cache capacity post-compaction if it's been manually modified.  patch by jbellis; reviewed by Ryan King for CASSANDRA-1079

git-svn-id: https://svn.apache.org/repos/asf/cassandra/branches/cassandra-0.6@945315 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li><li><div><div><b>summary:</b> Cache capacity settings done via nodetool get reset on memtable flushes
                </div><div><b>description:</b> In an experiment we set cache capacities via nodetool. The config file had the KeyCache for this CF at 1000000, we set the RowCache to 10000000 via nodetool.

The next time we flushed a memtable for that CF, the cache capacity settings got reverted to what is in the conf file. We repeated the experiment with the same results.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                this is working as designed.  the config file is The Source Of Truth for settings it contains.
              </div></li><li><div><div><b>body:</b> If we're not going to let the jmx-based setting live longer than one memtable, we should probably remove the ability to set it that way. The current behavior is too surprising.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> It's not surprising if you remember that the conf is The Source Of Truth. :)

I'm big on "there should only be one way to do it" but restarting to test cache size effects is too painful.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> ??I'm big on "there should only be one way to do it" but restarting to test cache size effects is too painful.??

I'm confused. Did you mean "isn't"?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I think the disconnect is that Ryan and Jeff would like to be able to tune cache sizes on a cluster that is receiving writes, which is difficult when it is reset per-memtable.
              </div></li><li><div>
                Oh.  Sometimes I need to read things twice -- yes, it's a bug if it's not persisting between flushes.  (I'm saying that it's not supposed to persist b/t restarts, unless you change the conf file too.)
              </div></li><li><div>
                Yes, "not persisting  between restarts" is expected, it currently gets reset when at every flush.
              </div></li><li><div>
                It appears the problem is that SSTableTracker's replace method calls updateCacheSizes, which reads the cache settings from DatabaseDescriptor (which doesn't get updated by the jmx command).
              </div></li><li><div>
                patch to not recalculate cache capacity if it's been manually modified
              </div></li><li><div>
                Patch looks good to me.
              </div></li><li><div>
                committed
              </div></li></ol></div></div></html>