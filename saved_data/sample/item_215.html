<!DOCTYPE html><html><div class="item-title">
        Item 215
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 now set non db backed vars on ti
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>message:</b> [AIRFLOW-437] Send TI context in kill zombies

Fix to provide proper TI context while calling ti.handle_failure during
kill_zombies, as without the context handler_failure is of no use and
its equivalent of marking those TIs as failed directly.

This patch had conflicts when merged, resolved by
Committer: Ash Berlin-Taylor
&lt;ash_github@firemirror.com&gt;

Closes #1796 from msumit/AIRFLOW-437-2

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li><li><div><div><b>title:</b> [AIRFLOW-437] Send TI context in kill zombies
                </div><div><b>body:</b> Dear Airflow Maintainers,

Please accept this PR that addresses the following issues:
- _https://issues.apache.org/jira/browse/AIRFLOW-437_

`Fix to provide proper TI context while calling ti.handle_failure
during kill_zombies, as without the context handler_failure is of
no use and its equivalent of marking those TIs as failed directly.`

Testing Done:
- Done manual testing and added an unittest as well.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                ## [Current coverage](https://codecov.io/gh/apache/incubator-airflow/pull/1796?src=pr) is 65.71% (diff: 100%)

&gt; Merging [#1796](https://codecov.io/gh/apache/incubator-airflow/pull/1796?src=pr) into [master](https://codecov.io/gh/apache/incubator-airflow/branch/master?src=pr) will increase coverage by **0.31%**

``` diff
@@             master      #1796   diff @@
==========================================
  Files           143        124    -19   
  Lines          9883       9589   -294   
  Methods           0          0          
  Messages          0          0          
  Branches          0          0          
==========================================
- Hits           6463       6301   -162   
+ Misses         3420       3288   -132   
  Partials          0          0          
```

&gt; Powered by [Codecov](https://codecov.io?src=pr). Last update [afed622...6bebe73](https://codecov.io/gh/apache/incubator-airflow/compare/afed622d83cb833b1ac5202ba0247e92bca8b890...6bebe73874b5a9d6a246ded9aa3191a39546c938?src=pr)

              </div></li><li><div>
                @bolkedebruin @r39132 plz check again and let me know if its fine, then I can do a final rebase. 

              </div></li><li><div><div><b>body:</b> caveat a few minor nit-picks, +1

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @msumit please update within the next 5 days else this will be closed for inactivity

              </div></li><li><div>
                @r39132 as per me this PR is complete (we are running this code in prod from past 3months).. plz let me know when to do final rebase.. 

              </div></li><li><div>
                @jlowin @criccomini @bolkedebruin What are your thoughts on this PR?

              </div></li><li><div>
                @msumit If this is still active, can you rebase? Or would you like to close this and reopen a fresh PR?
              </div></li><li><div>
                @r39132 yeah the change is still relevant and valid, and we are using the same in our prod from past 1.5+yrs. I can rebase if the community thinks it's useful for them, otherwise, we can close this PR. 
              </div></li><li><div>
                Looks relevant.. why not send an email to the dev list to get some votes on this PR.. and proceed from there? 
              </div></li><li><div>
                Folks, facing a strange issue, the spec I wrote is working on my laptop, but not on travis.
```
$ nosetests tests/models.py:DagBagTest.test_kill_zombies
.
----------------------------------------------------------------------
Ran 1 test in 0.180s

OK
[2018-06-03 22:19:22,250] {settings.py:188} DEBUG - Disposing DB connection pool (PID 98334)
```

It used to work earlier, when I had `job_id` as a param in `__init__` of `TaskInstance`, which I removed and setting it explicitly from the tests. Could Travis is using somekind of DB caching while doing join calls, cause in Rails world its quite common with RSpec. 
              </div></li><li><div>
                I see the same failure as Travis on my laptop:

```
(airflow) (themisto python/incuba‚Ä¶irflow PR_TOOL_MERGE_PR_1796_MASTER:*)% nosetests tests.models:DagBagTest.test_kill_zombies
F
======================================================================
FAIL: Test that kill zombies call TIs failure handler with proper context
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/ash/.virtualenvs/airflow/lib/python3.5/site-packages/mock/mock.py", line 1305, in patched
    return func(*args, **keywargs)
  File "/Users/ash/code/python/incubator-airflow/tests/models.py", line 1420, in test_kill_zombies
    ANY)
  File "/Users/ash/.virtualenvs/airflow/lib/python3.5/site-packages/mock/mock.py", line 925, in assert_called_with
    raise AssertionError('Expected call: %s\nNot called' % (expected,))
AssertionError: Expected call: handle_failure(&lt;ANY&gt;, True, &lt;ANY&gt;)
Not called
```


              </div></li><li><div>
                @ashb fixed the spec. Travis is all green except one K8 spec, something which is not even touched in this PR. 
              </div></li><li><div>
                I got the specs passed in my personal build though https://travis-ci.org/msumit/airflow/builds/388172642
              </div></li><li><div>
                Thanks, all merged to master now.
              </div></li><li><div>
                Thanks @ashb
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> Why is this hardcoded?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                As the variable `ti` is coming out of a db query and doesn't flow through TIs `__init__` method, cause of that all fields which are not backed by db didn't get initialise and throws error in `ti.get_template_context` later. 

              </div></li><li><div>
                Sure but that does answer my question. What if test_mode needs to be true? Can that be the case?

              </div></li><li><div>
                yeah, may be.. changed it to fetch from config.. 

              </div></li><li><div>
                test_mode is set per instance and not by the configuration, eg. by run. I'm not sure how "test_mode" behaves in context of killing a zombie. Is it really required? If it is it needs to be derived differently

              </div></li><li><div>
                @bolkedebruin I believe that if `test_mode` is true then that `ti` would never have been picked by `kill_zombie` code, so I'd it `False` initially. 

              </div></li><li><div><div><b>body:</b> Could also be

``` python
'Marked zombie job {ti} as {ti.state}'.format(ti=ti)
```

to stick with `{}` style formatting.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                There should be a space after `TI,` and before `'handle_failure'`

              </div></li><li><div><div><b>body:</b> @gwax read somewhere (may be in landsacpe warnings) to use `%s` instead of `format` with loggers. 

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                will do that

              </div></li><li><div>
                üëç, I missed this was in a logger call.

              </div></li><li><div>
                @bolkedebruin can we take a decision on this? As per my understanding it should be always `False` here , otherwise that `TI` won't end up in `kill_zombie` method. 

@mistercrunch  @r39132 @criccomini can you guys throw some more light on it. 

              </div></li><li><div>
                @msumit stick with .format . Landscape is old fashioned here. 

              </div></li><li><div>
                @msumit It should definitely not come the global config. Please explain why it would always be False here (you could be right, didn't trace it throughout the code).

              </div></li><li><div>
                @bolkedebruin as per my understanding, if a task ran in `test_mode` it would not have db entries... and as `kill_zombie` picks up `TIs` via a db query, its guaranteed that all entries it picked are not of `test_mode`...

              </div></li><li><div><div><b>body:</b> @bolkedebruin : even if we are using `{}` style, we would want to update logger and pass the arguments separately. The advantage to using `%` style with the current logger configuration is that it is possible to use structured logging and access the parameters separately from the string.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @gwax Format provides support for specifying format params both positionally and via named (i.e. keyword) params : http://stackoverflow.com/questions/17895835/format-strings-and-named-arguments-in-python

              </div></li><li><div>
                @msumit not sure I see how `job_id` is being used

              </div></li><li><div>
                @jlowin `job_id` is being used only for testing purposes (see line 216 at tests/models.py).. as `kill_zombie` do a db query against `TI` and `LJ` tables, and I need a valid value there to return some rows out of query.. 

              </div></li><li><div>
                Got it. Looks ok to me.

              </div></li><li><div>
                @mistercrunch what does `TaskInstance.job_id` do? it seems to be used in a few places but I can't find any place that sets it... is it a foreign key of some kind?

              </div></li><li><div>
                It's important, the Job absctraction is actually the one looking for an external kill signal when clearing running tasks
              </div></li><li><div>
                What's this change for? It seems somewhat related to the this PR?
              </div></li><li><div>
                Won't handle failure already emit a log line saying it's marking the task as up for retry/failed?
              </div></li><li><div>
                Rather: you add a param to the constructor but don't seem to use it (and the pattern the rest of the code uses is just to set `ti.job_id = job_id`
              </div></li><li><div>
                Okay, I saw the previous comments on this. Rather than adding a new form to the constructor we should just set the property on the instance in the tests (around line 1363)
              </div></li><li><div>
                @ashb yes it does, but in `handle_failure` we call `task.on_failure_callback(context)` which might change the state of the `ti` (which happens in our case). Hence a final msg about status of zombie job would be helpful. 
              </div></li><li><div>
                What do the log lines look like with this in place please?
              </div></li><li><div>
                @ashb here you go. 
```
{models.py:367} INFO - Finding 'running' jobs without a recent heartbeat
{models.py:371} INFO - Failing jobs without heartbeat after 2018-06-03 11:48:43.206777+00:00
{models.py:1694} ERROR - &lt;TaskInstance: example_python_operator.sleep_for_0 2018-06-03 10:41:18+00:00 [running]&gt; detected as zombie
{models.py:1722} INFO - Marking task as FAILED.
{models.py:398} INFO - Marked zombie job &lt;TaskInstance: example_python_operator.sleep_for_0 2018-06-03 10:41:18+00:00 [failed]&gt; as failed
```

In one of our case we use `handle_failure` to change the state of TI to success (4th log line), which eventually changes the line 5 accordingly. 
              </div></li><li><div>
                @ashb thanks for the suggestion. Changed the spec code, so no changes required in here. 
              </div></li><li><div>
                This looks incorrect - log.exception basically does this already (but includes useful traceback). Is there some reason we need this change?
              </div></li><li><div><div><b>body:</b> Oh were we actually logging the error twice? I think this line should stay (unmodified) and the log at the end just removed.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                sorry, I somehow thought that `error` is just a string (prolly it was when I first wrote it), and as we are passing a string error message, was seeing `NoneType: None` at the end of the log. Will revert it back. And yes, we were printing the same message twice so removed the last one. 
              </div></li><li><div>
                Oh - I now see what is going on with the `log.error` vs `log.exception` - the other place handle_failure is used is for a task actually failing, after an exception has been raised. `log.exception` is the same as `log.error(..., exc_info=True)` which just automatically includes exception info.

If this produces sensible logging output now I think this PR looks good now.
              </div></li><li><div>
                yeah, the log is giving correct msg, that we `got a zombie` instead of announcing it dead already. As at this point no one is sure what task's handle_failure would be doing, so finally we are stating that after we are pass through it. Here is one such [example](https://github.com/apache/incubator-airflow/blob/master/airflow/contrib/hooks/qubole_hook.py#L98).
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li><li><div><div><b>summary:</b> Provide task context while calling ti.handle_failure during kill_zombies
                </div><div><b>description:</b> Without proper context {{ti.handler_failure}} is of no use and its as good as marking those TIs failed directly. 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Commit df05546f8d4676ff3651e6a4c093ad068c7f5bbc in incubator-airflow's branch refs/heads/master from [~msumit]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-airflow.git;h=df05546 ]

[AIRFLOW-437] Send TI context in kill zombies

Fix to provide proper TI context while calling ti.handle_failure during
kill_zombies, as without the context handler_failure is of no use and
its equivalent of marking those TIs as failed directly.

This patch had conflicts when merged, resolved by
Committer: Ash Berlin-Taylor
&lt;ash_github@firemirror.com&gt;

Closes #1796 from msumit/AIRFLOW-437-2

              </div></li><li><div>
                Commit df05546f8d4676ff3651e6a4c093ad068c7f5bbc in incubator-airflow's branch refs/heads/master from [~msumit]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-airflow.git;h=df05546 ]

[AIRFLOW-437] Send TI context in kill zombies

Fix to provide proper TI context while calling ti.handle_failure during
kill_zombies, as without the context handler_failure is of no use and
its equivalent of marking those TIs as failed directly.

This patch had conflicts when merged, resolved by
Committer: Ash Berlin-Taylor
&lt;ash_github@firemirror.com&gt;

Closes #1796 from msumit/AIRFLOW-437-2

              </div></li><li><div>
                Issue resolved by pull request #1796
[https://github.com/apache/incubator-airflow/pull/1796]
              </div></li><li><div>
                User 'msumit' has created a pull request for this issue:
https://github.com/apache/incubator-airflow/pull/1796
              </div></li></ol></div></div></html>