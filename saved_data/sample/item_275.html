<!DOCTYPE html><html><div class="item-title">
        Item 275
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> PHOENIX-3482 Provide a work around for HBASE-17096
                </div><div><b>message:</b> PHOENIX-3482 Provide a work around for HBASE-17096

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Provide a work around for HBASE-17096
                </div><div><b>description:</b> HBASE-17096 causes failures in UpgradeIT#testAcquiringAndReleasingUpgradeMutex. Essentially releasing of the upgrade mutex by using the checkAndMutate api isn't working correctly. A simple though not ideal work around would be to not call releaseMutex() and let the lock expire by the virtue of TTL set on the cell. The side effect is that if a client encounters and exception while executing the upgrade code, then a new client won't be able to initiate the upgrade till the TTL expires.  
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Agreed, [~samarthjain], we'll need to do that unless you can come up with a work around. Is it the Delete that's not working? Maybe we can set to a different value and adjust the checkAndPut condition? See if you can come up with a workaround.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Did you come up with a work around, [~samarthjain]?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                [~jamestaylor], please review. I am not sure if having separate code path for different HBase versions is worth it. So I took the approach of doing two different checkAndPut calls in acquireUpgradeMutex().
              </div></li><li><div>
                How about just doing a Put with the unlock value when we create the SYSTEM.MUTEX table? Then you'd only need a single checkAndPut call.
              </div></li><li><div>
                Good idea, [~jamestaylor]. That makes the patch simpler and the solution independent of the HBase version we are running.
              </div></li><li><div>
                +1
              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-master #1493 (See [https://builds.apache.org/job/Phoenix-master/1493/])
PHOENIX-3482 Provide a work around for HBASE-17096 (Samarth: rev 7cdd7ca00574a6d815d367be883952bc30d006fc)
* (edit) phoenix-core/src/main/java/org/apache/phoenix/query/ConnectionQueryServicesImpl.java

              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-master #1495 (See [https://builds.apache.org/job/Phoenix-master/1495/])
PHOENIX-3482 Addendum to fix the test failure (Samarth: rev f1ecd4f7d809c037c8b716672faf5f3b6f3d452f)
* (edit) phoenix-core/src/it/java/org/apache/phoenix/end2end/UpgradeIT.java

              </div></li></ol></div></div></html>