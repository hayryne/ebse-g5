<!DOCTYPE html><html><div class="item-title">
        Item 80
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> SOLR-12881: Remove unneeded import statements
                </div><div><b>message:</b> SOLR-12881: Remove unneeded import statements

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Remove unneeded import statements
                </div><div><b>description:</b> There are unnecessary import statements:
 * import from java.lang
 * import from same package
 * unused import
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Hmm, there should be no unused imports in master, since the build disallows that by rule by precommit? And won't the IDEs add back those other&nbsp;imports automatically?
              </div></li><li><div><div><b>body:</b> Most of the imports that I removed were from the same package, so technically they are not unused import but not required. There were a couple of occurrences where wildcard imports were used and additionally a class was imported from the same package. There were only a few import which were [unused|https://github.com/apache/lucene-solr/pull/475/commits/3584ef30f1c3c5cddc19fcd510731ac0846654c0#diff-11a7bf85508185a5104561dffb3da648].

&nbsp;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 62 new or modified test files. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 52s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m  9s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m  9s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Release audit (RAT) {color} | {color:green}  2m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Check forbidden APIs {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Validate source patterns {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 25s{color} | {color:green} common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 19s{color} | {color:green} icu in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 30s{color} | {color:green} kuromoji in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 15s{color} | {color:green} phonetic in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 36s{color} | {color:green} stempel in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 22s{color} | {color:green} backward-codecs in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 44s{color} | {color:green} codecs in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 31m  9s{color} | {color:green} core in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 17s{color} | {color:green} expressions in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 25s{color} | {color:green} facet in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m  2s{color} | {color:green} misc in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m  8s{color} | {color:green} spatial3d in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m  3s{color} | {color:green} suggest in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  4m 45s{color} | {color:green} test-framework in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red}  0m 15s{color} | {color:red} tools in the patch failed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 33s{color} | {color:green} analytics in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m 27s{color} | {color:green} dataimporthandler in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m  9s{color} | {color:green} ltr in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 84m  6s{color} | {color:red} core in the patch failed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red}  7m 17s{color} | {color:red} solrj in the patch failed. {color} |
| {color:black}{color} | {color:black} {color} | {color:black}194m 59s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| Failed junit tests | solr.schema.TestManagedSchemaAPI |
|   | solr.handler.TestSolrConfigHandlerConcurrent |
|   | solr.client.solrj.io.stream.MathExpressionTest |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Issue | SOLR-12881 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12944415/SOLR-12881.patch |
| Optional Tests |  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  |
| uname | Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | ant |
| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh |
| git revision | master / 5a4fd86 |
| ant | version: Apache Ant(TM) version 1.9.6 compiled on July 20 2018 |
| Default Java | 1.8.0_172 |
| unit | https://builds.apache.org/job/PreCommit-SOLR-Build/205/artifact/out/patch-unit-lucene_tools.txt |
| unit | https://builds.apache.org/job/PreCommit-SOLR-Build/205/artifact/out/patch-unit-solr_core.txt |
| unit | https://builds.apache.org/job/PreCommit-SOLR-Build/205/artifact/out/patch-unit-solr_solrj.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-SOLR-Build/205/testReport/ |
| modules | C: lucene/analysis/common lucene/analysis/icu lucene/analysis/kuromoji lucene/analysis/phonetic lucene/analysis/stempel lucene/backward-codecs lucene/codecs lucene/core lucene/expressions lucene/facet lucene/misc lucene/spatial3d lucene/suggest lucene/test-framework lucene/tools solr solr/contrib/analytics solr/contrib/dataimporthandler solr/contrib/ltr solr/core solr/solrj U: . |
| Console output | https://builds.apache.org/job/PreCommit-SOLR-Build/205/console |
| Powered by | Apache Yetus 0.7.0   http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                The test errors&nbsp;are&nbsp;unrelated because none of them has compilation error caused my missing import.

Failure in lucene/tools is also unrelated. I created LUCENE-8537 to fix that build problem.
              </div></li><li><div>
                LUCENE-8537 was committed which fixes the build failure&nbsp;in lucene/tools. Rebased patch is&nbsp;attached.
              </div></li><li><div>
                | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 62 new or modified test files. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 53s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 53s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  9m 53s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Release audit (RAT) {color} | {color:green}  4m 10s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Check forbidden APIs {color} | {color:green}  1m 25s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} Validate source patterns {color} | {color:green}  1m 25s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  5m 40s{color} | {color:green} common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 18s{color} | {color:green} icu in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 51s{color} | {color:green} kuromoji in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 23s{color} | {color:green} phonetic in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 11s{color} | {color:green} stempel in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 25s{color} | {color:green} backward-codecs in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  7m 37s{color} | {color:green} codecs in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 31m 28s{color} | {color:green} core in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 25s{color} | {color:green} expressions in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m  1s{color} | {color:green} facet in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  1m 56s{color} | {color:green} misc in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 35s{color} | {color:green} spatial3d in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 24s{color} | {color:green} suggest in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m 45s{color} | {color:green} test-framework in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 15s{color} | {color:green} tools in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  3m 31s{color} | {color:green} analytics in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 32s{color} | {color:green} dataimporthandler in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  2m 31s{color} | {color:green} ltr in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 78m 17s{color} | {color:red} core in the patch failed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  7m 23s{color} | {color:green} solrj in the patch passed. {color} |
| {color:black}{color} | {color:black} {color} | {color:black}185m 45s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| Failed junit tests | solr.cloud.api.collections.TestHdfsCloudBackupRestore |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Issue | SOLR-12881 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12947693/SOLR-12881.patch |
| Optional Tests |  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  |
| uname | Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | ant |
| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh |
| git revision | master / 4e2481b |
| ant | version: Apache Ant(TM) version 1.9.6 compiled on July 20 2018 |
| Default Java | 1.8.0_191 |
| unit | https://builds.apache.org/job/PreCommit-SOLR-Build/223/artifact/out/patch-unit-solr_core.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-SOLR-Build/223/testReport/ |
| modules | C: lucene/analysis/common lucene/analysis/icu lucene/analysis/kuromoji lucene/analysis/phonetic lucene/analysis/stempel lucene/backward-codecs lucene/codecs lucene/core lucene/expressions lucene/facet lucene/misc lucene/spatial3d lucene/suggest lucene/test-framework lucene/tools solr solr/contrib/analytics solr/contrib/dataimporthandler solr/contrib/ltr solr/core solr/solrj U: . |
| Console output | https://builds.apache.org/job/PreCommit-SOLR-Build/223/console |
| Powered by | Apache Yetus 0.7.0   http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                So how is precommit passing with all these unused imports?

Is there something about Java 8 that is magic&nbsp;that precommit doesn't take into account? For instance, FrenchLightStemmerFilterFactory has the line:

return new FrenchLightStemFilter(input)

Yet importing&nbsp;org.apache.lucene.analysis.fr.FrenchLightStemFilter apparently isn't necessary to compile at least.

I applied this patch and it all compiles, so I'm puzzled. I'm running some other tests ATM, but I'll run precommit and the full test suite this evening.

&nbsp;
              </div></li><li><div>
                The import&nbsp;of FrenchLightStemFilter is unnecessary since&nbsp;FrenchLightStemFilterFactory is in the same package. Technically it isn't unused import that precommit should catch. This is the same with java.lang imports. [1]

[1] [https://github.com/apache/lucene-solr/pull/475/commits/b9aaefca8f20d0fc5a2dbec2b7033e68c7c9d57a#diff-b4e598ff612440d99ba93005076f1601L22]&nbsp;
              </div></li><li><div><div><b>body:</b> My question is, why remove these if they are not really unused after all?

And for every new class added, the IDE will (obviously) add imports for java.lang and same-package classes, so even if we "clean up" now, the next commit will re-introduce such imports again. So unless we find a way to enforce this in IDE's and precommit I don't think there is any benefit in doing this?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> {quote}My question is, why remove these if they are not really unused after all?
{quote}
Code cleanup. You would probably remove unused methods if you find in the codebase. This imports are similarly&nbsp;superfluous in my opinion.

My assumption is the same-package imports were introduced with refactoring and moving classes to different packages. The now-redundant import statements stayed in these files. IntelliJ wouldn't add back these import later and I think Eclipse wouldn't do that either.

If you think this cleanup is not needed I'm fine with that.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I’ll not stop it. Less is more. And if IDEs won’t add them back by default it is a real improvement imo.
              </div></li><li><div>
                bq. ... cleanup ...

+1

Could we perhaps also do something to prevent re-introductions i.e. to keep things shiny after cleanup?
* Perhaps https://github.com/apache/lucene-solr/blob/master/lucene/tools/src/groovy/check-source-patterns.groovy (or [~thetaphi]'s https://github.com/apache/lucene-solr/tree/master/lucene/tools/forbiddenApis ?) could guard against {{import java.lang}} re-introduction?
* In https://github.com/apache/lucene-solr/blob/releases/lucene-solr/7.5.0/dev-tools/eclipse/dot.settings/org.eclipse.jdt.core.prefs#L34 and https://github.com/apache/lucene-solr/blob/releases/lucene-solr/7.5.0/lucene/tools/javadoc/ecj.javadocs.prefs#L85 we currently have
{{org.eclipse.jdt.core.compiler.problem.unusedImport=error}} and the latter file is used by precommit. Not sure if something equivalent specifically looking for same-package imports exists?


              </div></li><li><div>
                Hi,

- Forbiddenapis does not work on source level, so we won't see imports.
- check-source-pattern.groovy would work, just add a regex there.

About ECJ, we can read the documentation. The setting should be visible in the Eclipse GUI. If you won't find it there, we can't configure it!
              </div></li><li><div>
                Thanks for the inputs! I added the pattern to check-source-pattern.groovy file. In Eclipse I did not find any option for imports apart from unusedImport. PR updated and new patchfile is attached.
              </div></li><li><div>
                | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | {color:red} patch {color} | {color:red}  0m  6s{color} | {color:red} SOLR-12881 does not apply to master. Rebase required? Wrong Branch? See https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file for help. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Issue | SOLR-12881 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12947977/SOLR-12881.patch |
| Console output | https://builds.apache.org/job/PreCommit-SOLR-Build/226/console |
| Powered by | Apache Yetus 0.7.0   http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                Sorry, this slipped off my radar. Let's table the bits about changing precommit and I'll try to get to this by next Monday at the latest (probably over the next couple of days assuming Peter's patch applies cleanly, there's no good reason to let this go stale again.
              </div></li><li><div>
                Commit 763e64260f1ef470e6cc27ad3f0271135fff4a8f in lucene-solr's branch refs/heads/master from [~cp.erickson@gmail.com]
[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=763e642 ]

SOLR-12881: Remove unneeded import statements

              </div></li><li><div>
                Commit c4961d48dfb66223977ce6678f6de94f93f841c9 in lucene-solr's branch refs/heads/branch_7x from [~cp.erickson@gmail.com]
[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c4961d4 ]

SOLR-12881: Remove unneeded import statements

(cherry picked from commit 763e64260f1ef470e6cc27ad3f0271135fff4a8f)

              </div></li><li><div>
                Thanks Peter!
              </div></li><li><div>
                Thank you all for the reviews and Erick for committing!&nbsp;
              </div></li></ol></div></div></html>