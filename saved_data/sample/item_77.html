<!DOCTYPE html><html><div class="item-title">
        Item 77
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> SOLR-13739: Optimized large managed schema modifications
                </div><div><b>message:</b> SOLR-13739: Optimized large managed schema modifications
Internal O(n^2) problem.
Fixes #855

(cherry picked from commit e788024b84b1402295d4fe6e0c8b818ae3772a52)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> SOLR-13739: Improve performance on huge schema updates
                </div><div><b>body:</b> Affects schemas containing ResourceLoaderAware components, increases
creation of a new collection with a huge schema by a factor 60 to 100.

&lt;!--
Before creating a pull request, please file an issue in the ASF Jira system for Lucene or Solr:

* https://issues.apache.org/jira/projects/LUCENE
* https://issues.apache.org/jira/projects/SOLR

You will need to create an account in Jira in order to create an issue.

The title of the PR should reference the Jira issue number in the form:

* LUCENE-####: &lt;short description of problem or changes&gt;
* SOLR-####: &lt;short description of problem or changes&gt;

LUCENE and SOLR must be fully capitalized. A short description helps people scanning pull requests for items they can work on.

Properly referencing the issue in the title ensures that Jira is correctly updated with code review comments and commits. --&gt;


# Description

Please provide a short description of the changes you're making with this pull request.

# Solution

Please provide a short description of the approach taken to implement your solution.

# Tests

Please describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.

# Checklist

Please review the following and check all that apply:

- [x] I have reviewed the guidelines for [How to Contribute](https://wiki.apache.org/solr/HowToContribute) and my code conforms to the standards described there to the best of my ability.
- [x] I have created a Jira issue and added the issue ID to my pull request title.
- [x] I am authorized to contribute this code to the ASF and have removed any code I do not have a license to distribute.
- [x] I have developed this patch against the `master` branch.
- [x] I have run `ant precommit` and the appropriate test suite.
- [ ] I have added tests for my changes.
- [ ] I have added documentation for the [Ref Guide](https://github.com/apache/lucene-solr/tree/master/solr/solr-ref-guide) (for Solr changes only).

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @gerlowskija or @dsmiley: if anyone of you has time to review this very easy fix, that would be great
              </div></li><li><div>
                &gt; Overall looks good. Do "ant precommit" and "ant test" pass?

Yes they pass.

&gt; I presume you did manual inspection to see this has the intended effect. It seems it'll only work for instance-equality of ManagedREsourceObservers.

Instance for sure, and all which are using equals() and hashCode(), but i did not found one
              </div></li><li><div>
                @dsmiley ready to merge?
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> I propose using LinkedHashSet so that these get initialized in a consistent predictable order.  Ideally this doesn't matter but it can help in debugging and in case some custom components are ordering dependent.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> I can change this, i found no test case which will test ordering explicitly.
                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Managed resource observers have to be added only once
                </div><div><b>description:</b> On huge schema modifications, mostly happen due to creation of a new collection, the same observer instance of an ResourceLoaderAware component is added again and again.

This leads to a runtime behaviour of n²/2 where n is is the number of schema operation multiplied by ResourceLoaderAware components instead of the number of containing ResourceLoaderAware components.

E.g. If you have 1000 schema operations and 2 ResourceLoaderAware components this leads to 500000 operations instead of 2000.

Even worse the corresponding resource is registered again and again, which can take some time e.g. ManagedSynonymGraphFilterFactory needs about 5s on each call (depending on the size of synonyms).
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                The improvement on our side results in a creation time of ~30 seconds instead of 30 minutes
              </div></li><li><div>
                Commit e788024b84b1402295d4fe6e0c8b818ae3772a52 in lucene-solr's branch refs/heads/master from Thomas Wöckinger
[ https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e788024 ]

SOLR-13739: Optimized large managed schema modifications
Internal O(n^2) problem.
Fixes #855

              </div></li><li><div>
                Commit f56aacd0a1f4c75936ab6cec779066546a9439f9 in lucene-solr's branch refs/heads/branch_8x from Thomas Wöckinger
[ https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f56aacd ]

SOLR-13739: Optimized large managed schema modifications
Internal O(n^2) problem.
Fixes #855

(cherry picked from commit e788024b84b1402295d4fe6e0c8b818ae3772a52)

              </div></li><li><div>
                Thanks for contributing Thomas!
              </div></li><li><div>
                Thanks for fast review and your input!
              </div></li></ol></div></div></html>