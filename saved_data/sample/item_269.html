<!DOCTYPE html><html><div class="item-title">
        Item 269
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * &lt;p/&gt;
 * http://www.apache.org/licenses/LICENSE-2.0
 * &lt;p/&gt;
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
   Class containing utility methods for test classes to use (in a static
   setup method) for obtaining the values of parameters passed in via
   environment variables or system properties. The parameters are obtained
   by introspecting the {@link org.apache.bigtop.itest.Parameters [Parameters]}
   annotation of the test class.
 
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * &lt;p/&gt;
 * http://www.apache.org/licenses/LICENSE-2.0
 * &lt;p/&gt;
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * &lt;p/&gt;
 * http://www.apache.org/licenses/LICENSE-2.0
 * &lt;p/&gt;
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
   Specifies a parameter to be passed into a test via a system property.
   The parameter may be a String, an int, a long, or a boolean. If the type
   of the parameter is not specified, it defaults to String.
   A default value (String value, int value, long value) may be specified
   for the parameter if its type is not boolean; the default value of a
   boolean parameter is false.

              </div></li><li><div>
                *
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * &lt;p/&gt;
 * http://www.apache.org/licenses/LICENSE-2.0
 * &lt;p/&gt;
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
   Specifies a parameter to be passed into a test via an environment variable.
   The parameter is a String.
   By default, the parameter is required. If it is required and a non-null value
   cannot be found for it, an exception may be thrown.

              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> BIGTOP-685. Provide a way to specify the parameters expected by a test (Wing Yew Poon via Bruno Mahé)
                </div><div><b>message:</b> BIGTOP-685. Provide a way to specify the parameters expected by a test (Wing Yew Poon via Bruno Mahé)

git-svn-id: https://svn.apache.org/repos/asf/incubator/bigtop/trunk@1365886 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> provide a way to specify the parameters expected by a test
                </div><div><b>description:</b> Many tests take parameters. Parameters may be passed into a test via system properties or environment variables. These parameters can be regarded as part of the test's contract. Over time, with increasing number of tests, it becomes hard to keep track of the set of parameters that may be used by the tests.
I propose to address this issue at two levels:
1. Introduce an annotation type for annotating a test class with the list of system properties and environment variables used by it. This allows for the contract to be exposed in the javadoc, as well as to annotation processing tools.
2. Provide utility functions for automatically obtaining the parameters and their values from the above annotation.

Not addressed in this proposal: Injecting 2. into the test runner itself (currently we are running tests through JUnit).

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> I have attached a patch with a concrete prototype. It includes a demonstration of how the annotation is used in a test. I have tested it by running this test. This addresses Bruno's concerns in BIGTOP-678.
I have also tested using environment variables (not demonstrated) in a dummy test.
I am open to calling Parameters Contract and to calling ParameterSetter something else.
There is a performance cost to using introspection or reflection, of course. However, the utility functions are called once per class, and there can be many test methods in one class making use of the same set of parameters.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                +1
Thanks!
              </div></li><li><div><div><b>body:</b> Reopening this to submit improvements on the original prototype.
I uploaded a new patch.
The changes are as follows:
- Renamed Parameters annotation to Contract, to avoid confusion with the org.junit.runners.Parameterized.Parameters annotation.
- Added convenience utility functions for setting parameters, using naming conventions for the static fields, so user does not have to specify them.
- Added detailed javadocs.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I also attached some files (that can be dropped into bigtop-tests/test-artifacts/hive/src/main/groovy/org/apache/bigtop/itest/hivesmoke/) that I used for manually testing this framework feature.
              </div></li><li><div>
                If this is accepted, I'd be happy to open another JIRA to work on porting existing tests that use environment variables and system properties to use this contract feature.

              </div></li><li><div>
                This has now been committed and will be part of the Bigtop 0.5.0 release.

Wing Yew, could you please open individual JIRAs to start converting tests for the Bigtop 0.6.0 release?
              </div></li><li><div>
                Metadata for tests is now en vogue again :) .   We are working bigtop https://issues.apache.org/jira/browse/BIGTOP-1222, gradlelizing the smokes to make them easier to control, and will be pulling in this meta data in some kind of user friendly way. 
              </div></li></ol></div></div></html>