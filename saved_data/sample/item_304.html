<!DOCTYPE html><html><div class="item-title">
        Item 304
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Changes due to comments &amp; changes to PR #994
                </div><div><b>message:</b> Changes due to comments &amp; changes to PR #994

org.apache.brooklyn.util.http.HttpUtils has been renamed to HttpAsserts

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> bump karaf version to get consistent jetty
                </div><div><b>body:</b> #991 broke the feature verification build in `dist`.  seems we need to bump karaf as well as it pullls in a version of jetty, and we want them consistent.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                I changed a few more things as well when looking at this:

In `pom.xml`:
```
&lt;karaf.plugin.version&gt;4.1.6&lt;/karaf.plugin.version&gt;
```

In `karaf/features/pom.xml`:
```
&lt;versionRange&gt;[4.1.6,)&lt;/versionRange&gt;
```

https://github.com/apache/brooklyn-ui/blob/master/modularity-server/features/pom.xml#L179 to version range `[4.1.6,)`. Without this last change, it failed with:
```
[ERROR] Failed to execute goal org.apache.karaf.tooling:karaf-maven-plugin:4.1.2:verify (verify-brooklyn-ui-modularity-feature) on project brooklyn-ui-modularity-features: Verification failures: Verification failures:
[ERROR]         Unable to resolve framework features
[ERROR]         Unable to resolve framework features
[ERROR]         Unable to resolve framework features
```
---
On my old laptop, when trying to build with `mvnf ./ -DscmBranch=master -DbuildNumber=1.0.0-SNAPSHOT`, I also had a weird (unrelated?) error, which went away when I bumped the `swagger-maven-plugin` to 3.1.7 (from 3.1.4). However I didn't hit this error when I built it on my new laptop!
```
[INFO] Brooklyn REST API .................................. FAILURE [  2.858 s]

[ERROR] Failed to execute goal com.github.kongchen:swagger-maven-plugin:3.1.4:generate (default) on project brooklyn-rest-api: Execution default of goal com.github.kongchen:swagger-maven-plugin:3.1.4:generate failed: Plugin com.github.kongchen:swagger-maven-plugin:3.1.4 or one of its dependencies could not be resolved: Failed to collect dependencies at com.github.kongchen:swagger-maven-plugin:jar:3.1.4 -&gt; org.apache.commons:commons-lang3:jar:[3.4,4.0): No versions available for org.apache.commons:commons-lang3:jar:[3.4,4.0) within specified range -&gt;
```
              </div></li><li><div>
                Eye-balling what karaf 4.1.6 ships with, what we have in the brooklyn based on 4.1.2, and what dependencies we declare in the poms, there are a few discrepancies:

```
Karaf 4.1.6 (vanilla)       Broolyn dependency   Previous Brooklyn Karaf distro (4.1.2)        New Brooklyn Karaf distro (4.1.6)
slf4j-api-1.7.12.jar        1.7.25               slf4j-api-1.7.12.jar and jul-to-slf4j-1.7.25  slf4j-api-1.7.12.jar and jul-to-slf4j-1.7.25
asm-all-5.2.jar             5.0.4                asm-all-5.2.jar and asm-all-5.0.2.jar         asm-all-5.2.jar and asm-all-5.0.2.jar
jansi-1.17.1.jar            1.2.1                jansi-1.16.jar                                jansi-1.17.1.jar
org/jline:jline-3.6.2.jar   jline:jline-2.12     jline-3.4.0.jar                               jline-3.6.2.jar
felix.framework-5.6.10.jar  5.6.1                felix.framework-5.6.6                         felix.framework-5.6.10.jar
```

Longer term, it would be good to arrange our pom so it's more obvious which dependencies come pre-installed in karaf, versus which are to match upstream things from jclouds etc, versus our own choice.
              </div></li><li><div>
                Confirmed that with *my* build (with the additional edits I listed above), the `brooklyn-dist/karaf/apache-brooklyn/target/assembly` works.

I suggest we also change the `karaf.plugin.version` and the two version ranges to be 4.1.6. Then everything is more consistent (even if it's not essential on your laptop @ahgittin).

The other version differences we can tackle in separate PRs - they were already out-of-sync.
              </div></li><li><div>
                Suggest we close this, and instead merge:
https://github.com/apache/brooklyn-server/pull/995
https://github.com/apache/brooklyn-ui/pull/70

If jenkins builds work for those, then I'll merge those PRs.
              </div></li><li><div>
                agree the add'l changes in #995 are good to have.  +1 to aligning with karaf versions and watching where we pull in the same JARs at different versions.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>