<!DOCTYPE html><html><div class="item-title">
        Item 255
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 1 seconds wait until subsequent status
 5 minutes timeout for watch mode
              </div></li><li><div>
                 user provided configs
              </div></li><li><div>
                 desired state attained. print and break out of loop
              </div></li><li><div>
                 reported once, so break
              </div></li><li><div>
                 ignore
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HIVE-15217 - LLAP startup: llapstatus should have wait mode instead of being retried
                </div><div><b>message:</b> HIVE-15217 - LLAP startup: llapstatus should have wait mode instead of being retried

Change-Id: I58f47a764ecc4fff6f655acec4b23278fb1b06ad

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Add watch mode to llap status tool
                </div><div><b>description:</b> There is few seconds overhead for launching the llap status command. To avoid we can add "watch" mode to llap status tool that refreshes the status after configured interval. 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [~sseth] Can you please review the patch?
              </div></li><li><div>
                Attaching RB link
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12839100/HIVE-15217.1.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 10679 tests executed
*Failed tests:*
{noformat}
TestSparkCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=108)
	[tez_joins_explain.q,transform2.q,groupby5.q,cbo_semijoin.q,bucketmapjoin13.q,union_remove_6_subq.q,groupby2_map_multi_distinct.q,load_dyn_part9.q,multi_insert_gby2.q,vectorization_11.q,groupby_position.q,avro_compression_enabled_native.q,smb_mapjoin_8.q,join21.q,auto_join16.q]
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver[hbase_bulk] (batchId=89)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=91)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2144/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2144/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2144/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12839100 - PreCommit-HIVE-Build
              </div></li><li><div>
                1) Is it possible to wait for specific status, e.g. "running"?
2) I think the wait interval can be much shorter &lt;1sec. 
              </div></li><li><div><div><b>body:</b> I will add another option that waits/watches until RUNNING (or any state) state.

The problem with keeping shorter refresh interval is with the way we are viewing the output. Currently the output is printed as json which is only machine readable. The output that gets printed is way too much even for 10s of nodes. IMO we should change the output format to something like tez job monitor and update in-place but that's a broader change and optionally output json. I think both formats will be useful. Refreshing too often and spitting json out is completely unreadable. Thoughts?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Why print output at all in wait mode? We can print the last one if anything at all.
              </div></li><li><div>
                i see what you mean. Makes sense. Will update the patch.
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12839662/HIVE-15218.WIP.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2213/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2213/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2213/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2016-11-19 09:45:04.152
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-2213/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2016-11-19 09:45:04.154
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at e2a6273 HIVE-13557: Make interval keyword optional while specifying DAY in interval arithmetic (Zoltan Haindrich reviewed by Pengcheng Xiong)
+ git clean -f -d
Removing metastore/src/java/org/apache/hadoop/hive/metastore/messaging/
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at e2a6273 HIVE-13557: Make interval keyword optional while specifying DAY in interval arithmetic (Zoltan Haindrich reviewed by Pengcheng Xiong)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2016-11-19 09:45:05.121
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: a/ql/src/java/org/apache/hadoop/hive/ql/exec/SerializationUtilities.java: No such file or directory
error: a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java: No such file or directory
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12839662 - PreCommit-HIVE-Build
              </div></li><li><div>
                Addressed [~sershe]'s review comments. [~sershe] Can you please take another look?
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12840225/HIVE-15217.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 10733 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
org.apache.hive.spark.client.TestSparkClient.testJobSubmission (batchId=272)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2259/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2259/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2259/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12840225 - PreCommit-HIVE-Build
              </div></li><li><div><div><b>body:</b> +0.99 why not make the default smaller? 3s is a lot of time. 500ms should be good :) if it's a problem the user can change it
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                +1 other than that
              </div></li><li><div><div><b>body:</b> I tested the patch with 1s refresh interval on a 2 node llap cluster. The way status report is implemented right now is, the tool first connects with yarn to get application status, then to slider to get container status and finally to llap registry to get daemon status which involves connection to zookeeper. Even for 2 node llap setup refreshing every second, the cost of connection is high and the status updates are not instant. If we keep the refresh interval at 1s we will be creating/closing too many connections in short time with not much updates to report. Ideally what we want the tool to do is just connect to zookeeper and watch for new events under the llap namespace. With that we have have a single connection to registry and watch for notifications until the desired state is achieved. We are not there yet :)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Can we avoid closing connections? That is also useless overhead
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Addressed [~sershe]'s comments. Refresh interval is now 1 second. And connections are being reused during refresh.
              </div></li><li><div>
                [~sershe] Can you take another look at the changes?
              </div></li><li><div>
                +1
              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12840327/HIVE-15217.3.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 10714 tests executed
*Failed tests:*
{noformat}
TestMiniSparkOnYarnCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=158)
	[scriptfile1.q,vector_outer_join5.q,file_with_header_footer.q,bucket4.q,input16_cc.q,bucket5.q,infer_bucket_sort_merge.q,constprog_partitioner.q,orc_merge2.q,reduce_deduplicate.q,schemeAuthority2.q,load_fs2.q,orc_merge8.q,orc_merge_incompat2.q,infer_bucket_sort_bucketed_table.q,vector_outer_join4.q,disable_merge_for_bucketing.q,vector_inner_join.q,orc_merge7.q]
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver[hbase_bulk] (batchId=89)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=133)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2270/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2270/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2270/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12840327 - PreCommit-HIVE-Build
              </div></li><li><div>
                This codepath will not be triggered by ptest. The test failures are unrelated to this patch. Committed patch to master.
              </div></li><li><div><div><b>body:</b> Does this need to be documented in the wiki?  (The LLAP status tool still needs to be documented -- see HIVE-13413.)

* [LLAP | https://cwiki.apache.org/confluence/display/Hive/LLAP]
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> Nudging [~prasanth_j] -- should this be documented in the wiki?

If so, please add a TODOC2.2 label.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                [~leftylev] Thanks for the reminder again! Updated "LLAP Status" section in the wiki with all command options for llap status tool.
              </div></li><li><div><div><b>body:</b> Thanks for the docs, Prasanth.  I added some version information:

* [LLAP -- LLAP Status | https://cwiki.apache.org/confluence/display/Hive/LLAP#LLAP-LLAPStatus]
                </div><div><b>label:</b> documentation
                </div></div></li></ol></div></div></html>