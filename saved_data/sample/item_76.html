<!DOCTYPE html><html><div class="item-title">
        Item 76
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                * Adds a new doc in this term. 
   * &lt;code&gt;freq&lt;/code&gt; will be -1 when term frequencies are omitted
   * for the field. 
              </div></li><li><div><div><b>comment:</b> * Finishes the current term; numDocs must be &gt; 0.
   *  &lt;code&gt;stats.totalTermFreq&lt;/code&gt; will be -1 when term 
   *  frequencies are omitted for the field. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>comment:</b> * Called when we are done adding terms to this field.
   *  &lt;code&gt;sumTotalTermFreq&lt;/code&gt; will be -1 when term 
   *  frequencies are omitted for the field. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 we should not have fed any positions!
              </div></li><li><div>
                 we still allow -1 from old 3.x indexes 
              </div></li><li><div>
                 we don't expect any positions here
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> LUCENE-4828: add AssertingPostingsConsumer, fix minor inconsistencies in producers
                </div><div><b>message:</b> LUCENE-4828: add AssertingPostingsConsumer, fix minor inconsistencies in producers

git-svn-id: https://svn.apache.org/repos/asf/lucene/dev/trunk@1364792 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> BooleanQuery.extractTerms should not recurse into MUST_NOT clauses
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [trunk commit] Michael McCandless
http://svn.apache.org/viewvc?view=revision&amp;revision=1456074

LUCENE-4828: BooleanQuery.extractTerms no longer includes terms from MUST_NOT clauses

              </div></li><li><div>
                [branch_4x commit] Michael McCandless
http://svn.apache.org/viewvc?view=revision&amp;revision=1456076

LUCENE-4828: BooleanQuery.extractTerms no longer includes terms from MUST_NOT clauses

              </div></li><li><div>
                This seems highly dependent on what the extractTerms is being used for?

              </div></li><li><div><div><b>body:</b> bq. This seems highly dependent on what the extractTerms is being used for?

True, but as far as I know the dominant use case is for highlighting, where it's confusing to see your MUST_NOT terms highlighted.

And SpanNotQuery doesn't include terms from its excluded query ...

It also causes problems for users, e.g. http://stackoverflow.com/questions/13633409/skipping-terms-of-must-not-clauses-during-term-extraction
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> For highlighting, I've heard it argued both ways (i.e. prohibited terms can be important too).  I wasn't thinking about highlighting as much as something like distributed IDF or other global term statistics.  Depending on what type of query is in the prohibited clause, using global statistics could be important. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                bq. For highlighting, I've heard it argued both ways (i.e. prohibited terms can be important too).

Hmm can you give an example where it's useful to highlight the prohibited terms?

bq. I wasn't thinking about highlighting as much as something like distributed IDF or other global term statistics. Depending on what type of query is in the prohibited clause, using global statistics could be important.

But, normally, prohibited clauses don't contribute to scoring so the stats of terms inside them don't need to be distributed?
              </div></li><li><div><div><b>body:</b> bq. &gt; For highlighting, I've heard it argued both ways (i.e. prohibited terms can be important too).
bq. Hmm can you give an example where it's useful to highlight the prohibited terms?

It wasn't my argument, but I guess it was along the lines that there can be info/relevance in the fact that the user did not want documents with a specific term, and thus it can make sense to highlight them (maybe with a diff color...)

bq. &gt; I wasn't thinking about highlighting as much as something like distributed IDF or other global term statistics.
bq. But, normally, prohibited clauses don't contribute to scoring so the stats of terms inside them don't need to be distributed?

The key word there is "normally".  As I said, it depends on the type of query in the prohibited clause, and the boolean query does not have the knowledge to know if it will matter or not.  Something other than extractTerms could be used for distributed term stats though.


                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> in my opinion SpanNot should be consistent with BQ here (whichever way we go, its no big deal to me).

As far as distributed scoring, i think ideally we would not weight or score MUST_NOT or constant-scored clauses at all. I know this isnt the case today, but I just think its dumb.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                But how do you highlight a term that is not there? :)

              </div></li><li><div><div><b>body:</b> I was about to make the same comment about highlighting forbidden terms, but then realized that you might search on one field and highlight another.

I think that goes against the point of highlighting, which is to make more clear why the engine chose that document, but some people have odd requirements.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                bq. I think ideally we would not weight or score MUST_NOT or constant-scored clauses at all. I know this isnt the case today, but I just think its dumb.

Not weighting prohibited clauses would needlessly break certain types of queries.
              </div></li><li><div>
                What kind of queries would this break? 

Just to be clear, when I say "weight". I mean, similarity. we'd still createWeight, it just wouldnt fetch any term statistics.
              </div></li><li><div>
                [trunk commit] Michael McCandless
http://svn.apache.org/viewvc?view=revision&amp;revision=1458472

LUCENE-4828: move CHANGES entry to 4.2.1

              </div></li><li><div>
                Closed after release.
              </div></li></ol></div></div></html>