<!DOCTYPE html><html><div class="item-title">
        Item 180
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 Check TomEE was effectively shut down after getting the message
 There can be concurrent shutdown operations (catalina shutdown hook for instance),
 so we have to wait here since it is important to be synchronous in this method
              </div></li><li><div>
                Wait at least 1 second to start or stop, but not more than an hour.
              </div></li><li><div>
                *
     * Send the shutdown message to the running server
     *
     * @param attempts How many times to try to send the message before giving up
     * @return True is the message was sent, else false if unable to connect after the defined number of attempts
     
              </div></li><li><div>
                We need to know about this
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> TOMEE-1364 - Allow configuration of shutdown attempts, and use sensible defaults.
                </div><div><b>message:</b> TOMEE-1364 - Allow configuration of shutdown attempts, and use sensible defaults.

git-svn-id: https://svn.apache.org/repos/asf/tomee/tomee/branches/tomee-1.7.x@1627751 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li><li><div><div><b>summary:</b> When using the tomee-maven-plugins stop goal tomee seems to hang forever
                </div><div><b>description:</b> When running Tomee in a setup for UI tests (separate start and stop executions) the stop seems to hang forever. 

When looking through the code, it seems Tomee is correctly shut down (At least the ports it opened closed and the processes are killed), but the maven plugin seems to try to get a connection to the shutdown port for MAXINT times, waiting a second between each try. As far as I understood the code, there is no way not to wait for 78 years in order to gracefully shut down Tomee.

As I already investigated the problem in detail, I'll whip up a patch and attach that to this issue later this day (Will create one for 1.7.x and one for HEAD)
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Unfortunateley I couldn't let the testsuite pass on 2.0.0-SNAPSHOT as I had failures even before comming to the parts I changed. Probably executing a test wouldn't work in making a bug visible as no test testing the stop goal could have been working anyway.
              </div></li><li><div>
                Patch for the 2.0.0-SNAPSHOT version
              </div></li><li><div>
                [~cdutz] Maybe try to avoid to duplicate the logic and just add to connect a parameter to return in case or exception/success, wdyt?
              </div></li><li><div>
                Ok ... so after figuring out that for 1.7.x I have to use java 7 the same patch seems to work fine for 1.7.0, 1.7.1 and 1.7.2-SNAPSHOT so I won't post a second and third patch.
              </div></li><li><div>
                I didn't want to change the logic of the connect method as I saw it was used in other places. After all we want to check if we can't connect. I I think we need two different implementations. One that you can use to connect and one to check if a connection is possible.
              </div></li><li><div>
                Thanks Christofer for pointing this out.
The default number of attempts is now 60 (try for roughly 60 seconds).
Added 'tomee-plugin.shutdown.attempts' property to plugin.
              </div></li><li><div><div><b>body:</b> Did you also apply any change to the logic? As this would still result in a 60 second break at the end of every stop execution as the original code isn't actually doing what it's probably intended to do: It checks until it is able to connect instead of trying to connect until it doesn't work anymore.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Ah ok ... it just took a while to be visible in my git repo ... looks as if this issue should now be fixed. Thanks for the quick response. How long will it probably take till a version with this fix will be released?
              </div></li><li><div>
                No you're right, was a late night ;) - I'll fix it.
              </div></li><li><div>
                Need a reverse connect. Thanks again Christofer.
              </div></li><li><div>
                Looks good to me, Christofer can you confirm that everything is working for you. I'll resolve later today if I get no feedback. Thanks for your time.
              </div></li><li><div>
                Yes ... works like a charm now ... thanks for fixing this that fast :-) Looking forward to the next release so we can remove the SNAPSHOT dependency.
              </div></li><li><div>
                Thanks to Christofer Dutz for work on this issue.
              </div></li><li><div>
                Closed on release of TomEE 7.0.0-M1
              </div></li></ol></div></div></html>