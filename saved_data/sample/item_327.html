<!DOCTYPE html><html><div class="item-title">
        Item 327
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> GUACAMOLE-234: Exclude slf4j from Apache Directory dependency.
                </div><div><b>message:</b> GUACAMOLE-234: Exclude slf4j from Apache Directory dependency.
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Migrate from JLDAP to Apache Directory LDAP API
                </div><div><b>description:</b> The LDAP support currently uses [JLDAP|http://www.openldap.org/jldap/], but that library has been unmaintained for several years now (no changes whatsoever since 2009). Migrating away from such a library might be a good idea. The Apache Directory project has produced an LDAP client API which could serve as a replacement:

http://directory.apache.org/api/

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Was glancing at this, and the Apache Directory LDAP API says it requires Java 7 or later.  IIRC, Guacamole is built against JRE 6 compatibility - is this going to cause any problems trying to move to the this API?
              </div></li><li><div>
                PR very soon.
              </div></li><li><div>
                PR submitted.
              </div></li><li><div>
                Took a new stab at this, PR is ready for review and testing.
              </div></li><li><div>
                Coverity reports the following:

{code:none}
*** CID 1452278:  Resource leaks  (RESOURCE_LEAK)
/extensions/guacamole-auth-ldap/src/main/java/org/apache/guacamole/auth/ldap/ObjectQueryService.java: 226 in org.apache.guacamole.auth.ldap.ObjectQueryService.search(org.apache.directory.ldap.client.api.LdapNetworkConnection, org.apache.directory.api.ldap.model.name.Dn, org.apache.directory.api.ldap.model.filter.ExprNode, int)()
220                         }
221                         
222                     }
223                     
224                 }
225     
&gt;&gt;&gt;     CID 1452278:  Resource leaks  (RESOURCE_LEAK)
&gt;&gt;&gt;     Variable "results" going out of scope leaks the resource it refers to.
226                 return entries;
227     
228             }
229             catch (CursorException | LdapException e) {
230                 throw new GuacamoleServerException("Unable to query list of "
231                         + "objects from LDAP directory.", e);
{code}

{code:none}
*** CID 1452280:  Exceptional resource leaks  (RESOURCE_LEAK)
/extensions/guacamole-auth-ldap/src/main/java/org/apache/guacamole/auth/ldap/LDAPConnectionService.java: 140 in org.apache.guacamole.auth.ldap.LDAPConnectionService.bindAs(org.apache.directory.api.ldap.model.name.Dn, java.lang.String)()
134             try {
135     
136                 // Connect to LDAP server
137                 ldapConnection.connect();
138     
139                 // Explicitly start TLS if requested
&gt;&gt;&gt;     CID 1452280:  Exceptional resource leaks  (RESOURCE_LEAK)
&gt;&gt;&gt;     Variable "ldapConnection" going out of scope leaks the resource it refers to.
140                 if (confService.getEncryptionMethod() == EncryptionMethod.STARTTLS)
141                     ldapConnection.startTls();
142     
143             }
144             catch (LdapException e) {
145                 throw new GuacamoleServerException("Error connecting to LDAP server.", e);
{code}

There's also this, but I believe it's a false positive, seeing as it's a debug-level log message:

{code:none}
*** CID 1452279:  Low impact security  (SENSITIVE_DATA_LEAK)
/extensions/guacamole-auth-ldap/src/main/java/org/apache/guacamole/auth/ldap/ObjectQueryService.java: 189 in org.apache.guacamole.auth.ldap.ObjectQueryService.search(org.apache.directory.ldap.client.api.LdapNetworkConnection, org.apache.directory.api.ldap.model.name.Dn, org.apache.directory.api.ldap.model.filter.ExprNode, int)()
183          *     information required to execute the query cannot be read from
184          *     guacamole.properties.
185          */
186         public List&lt;Entry&gt; search(LdapNetworkConnection ldapConnection,
187                 Dn baseDN, ExprNode query, int searchHop) throws GuacamoleException {
188     
&gt;&gt;&gt;     CID 1452279:  Low impact security  (SENSITIVE_DATA_LEAK)
&gt;&gt;&gt;     Leaking persistent secret data, "baseDN". Passing it to "org.slf4j.Logger.debug(java.lang.String, java.lang.Object, java.lang.Object)" stores it to a log file or displays it on the console.
189             logger.debug("Searching \"{}\" for objects matching \"{}\".", baseDN, query);
190     
191             try {
192     
193                 LdapConnectionConfig ldapConnectionConfig = ldapConnection.getConfig();
194                 
{code}
              </div></li><li><div><div><b>body:</b> Okay, PR submitted to take care of those two resource leaks, I think...
https://github.com/apache/guacamole-client/pull/439
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Hopefully safe to close out, now :-).
              </div></li><li><div>
                Chasing a potential regression on this, per mailing list discussion...

http://apache-guacamole-general-user-mailing-list.2363388.n4.nabble.com/Guacamole-1-1-0-LDAP-issue-td6284.html
              </div></li><li><div>
                I believe the issues related to this have been resolved.  Last reported mailing list issue appears to be related to TOTP implementation without ability to modify underlying DB, and not an issue with the implementation of this extensions.
              </div></li></ol></div></div></html>