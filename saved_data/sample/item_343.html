<!DOCTYPE html><html><div class="item-title">
        Item 343
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ACCUMULO-727 add exponential back-off when bulk loading files
                </div><div><b>message:</b> ACCUMULO-727 add exponential back-off when bulk loading files

git-svn-id: https://svn.apache.org/repos/asf/accumulo/trunk@1457056 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Bulk Import retry time needs to be longer/configurable
                </div><div><b>description:</b> Bulk import retries way too fast (at least under some circumstances).  We had a tablet server that the master killed (we were overloading it with ingest and the hold time got too big so the master killed it).  At the same time, a bulk import operation had begun and several map files were assigned to the server that was just killed.  The bulk import retried three times in an 8 second span, each time failing with a connection refused error, and then gave up, failing the file completely.  Meanwhile, it took the master about 1m 20s to reassign the tablet to another server.

The bulk import process should account for this possibility.  Either it needs to recognize that it can't connect to a tablet server so it must be down and the tablet will be reassigned somewhere else, or it should wait longer (such that the default max wait time is &gt; the average tablet reassignment time).  In the latter case, the retry interval should be made into a configurable option at the same time.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Could use exponential backoff for the retry time and a max number of retries.
              </div></li><li><div>
                made communication timeout for bulk importing configurable
              </div></li><li><div>
                We don't need only configurable timeout, but need to retry slower.  If a tserver dies, bulk can try and fail on the dead tserver before the master ever has a chance to reassign the tablet.
              </div></li><li><div>
                Added exponential back-off, with a maximum wait between retries of 60 seconds.  Set the number of retries to 5, up from 3.

              </div></li><li><div><div><b>body:</b> A possible work around for 1.4 is to up tserver.bulk.retry.max.  1.4 does not have the exponential back off that Eric just added, it just sleeps 4 secs between retries.   So this may need to be set higher.  Like setting it to 120/4 to get at least 2 min of retries.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Integrated in Accumulo-Trunk #778 (See [https://builds.apache.org/job/Accumulo-Trunk/778/])
    ACCUMULO-727 retry more times (Revision 1457060)
ACCUMULO-727 add exponential back-off when bulk loading files (Revision 1457056)

     Result = UNSTABLE
ecn : 
Files : 
* /accumulo/trunk
* /accumulo/trunk/assemble
* /accumulo/trunk/core
* /accumulo/trunk/core/src/main/java/org/apache/accumulo/core/conf/Property.java
* /accumulo/trunk/examples
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/ZooStore.java
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/zookeeper/ZooSession.java
* /accumulo/trunk/server
* /accumulo/trunk/src

ecn : 
Files : 
* /accumulo/trunk
* /accumulo/trunk/assemble
* /accumulo/trunk/core
* /accumulo/trunk/examples
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/ZooStore.java
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/zookeeper/ZooSession.java
* /accumulo/trunk/server
* /accumulo/trunk/server/src/main/java/org/apache/accumulo/server/client/BulkImporter.java
* /accumulo/trunk/src

              </div></li><li><div>
                Integrated in Accumulo-1.5-Hadoop-2.0 #32 (See [https://builds.apache.org/job/Accumulo-1.5-Hadoop-2.0/32/])
    ACCUMULO-727 retry more times (Revision 1457059)
ACCUMULO-727 add exponential back-off when bulk loading files (Revision 1457055)

     Result = UNSTABLE
ecn : 
Files : 
* /accumulo/branches/1.5/core/src/main/java/org/apache/accumulo/core/conf/Property.java

ecn : 
Files : 
* /accumulo/branches/1.5/server/src/main/java/org/apache/accumulo/server/client/BulkImporter.java

              </div></li><li><div>
                Integrated in Accumulo-1.5 #34 (See [https://builds.apache.org/job/Accumulo-1.5/34/])
    ACCUMULO-727 retry more times (Revision 1457059)
ACCUMULO-727 add exponential back-off when bulk loading files (Revision 1457055)

     Result = ABORTED
ecn : 
Files : 
* /accumulo/branches/1.5/core/src/main/java/org/apache/accumulo/core/conf/Property.java

ecn : 
Files : 
* /accumulo/branches/1.5/server/src/main/java/org/apache/accumulo/server/client/BulkImporter.java

              </div></li><li><div>
                Integrated in Accumulo-Trunk-Hadoop-2.0 #137 (See [https://builds.apache.org/job/Accumulo-Trunk-Hadoop-2.0/137/])
    ACCUMULO-727 retry more times (Revision 1457060)
ACCUMULO-727 add exponential back-off when bulk loading files (Revision 1457056)

     Result = ABORTED
ecn : 
Files : 
* /accumulo/trunk
* /accumulo/trunk/assemble
* /accumulo/trunk/core
* /accumulo/trunk/core/src/main/java/org/apache/accumulo/core/conf/Property.java
* /accumulo/trunk/examples
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/ZooStore.java
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/zookeeper/ZooSession.java
* /accumulo/trunk/server
* /accumulo/trunk/src

ecn : 
Files : 
* /accumulo/trunk
* /accumulo/trunk/assemble
* /accumulo/trunk/core
* /accumulo/trunk/examples
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/ZooStore.java
* /accumulo/trunk/fate/src/main/java/org/apache/accumulo/fate/zookeeper/ZooSession.java
* /accumulo/trunk/server
* /accumulo/trunk/server/src/main/java/org/apache/accumulo/server/client/BulkImporter.java
* /accumulo/trunk/src

              </div></li></ol></div></div></html>