<!DOCTYPE html><html><div class="item-title">
        Item 357
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> fix typo (#1439)
                </div><div><b>message:</b> fix typo (#1439)

                </div><div><b>label:</b> documentation
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> A typo in docs/cn/concept.md
                </div><div><b>body:</b> **BUG REPORT**
As title,there is a typo, that is "事物消息", in https://github.com/apache/rocketmq/blob/master/docs/cn/concept.md#9-%E7%94%9F%E4%BA%A7%E8%80%85%E7%BB%84producer-group

Document should be updated to "事务消息".

That`s all.

                </div></div></li><li><div><div><b>title:</b> A typo in docs/cn/concept.md
                </div><div><b>body:</b> **BUG REPORT**
As title,there is a typo, that is "事物消息", in https://github.com/apache/rocketmq/blob/master/docs/cn/concept.md#9-%E7%94%9F%E4%BA%A7%E8%80%85%E7%BB%84producer-group

Document should be updated to "事务消息".

That`s all.

                </div></div></li><li><div><div><b>title:</b> A typo in docs/cn/concept.md
                </div><div><b>body:</b> **BUG REPORT**
As title,there is a typo, that is "事物消息", in https://github.com/apache/rocketmq/blob/master/docs/cn/concept.md#9-%E7%94%9F%E4%BA%A7%E8%80%85%E7%BB%84producer-group

Document should be updated to "事务消息".

That`s all.

                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> A typo in docs/cn/concept.md
                </div><div><b>body:</b> **BUG REPORT**
As title,there is a typo, that is "事物消息", in https://github.com/apache/rocketmq/blob/master/docs/cn/concept.md#9-%E7%94%9F%E4%BA%A7%E8%80%85%E7%BB%84producer-group

Document should be updated to "事务消息".

That`s all.

                </div><div><b>label:</b> documentation
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                @Dennis8274 could you pull a request to fix it?
              </div></li><li><div>
                &gt; @Dennis8274 could you pull a request to fix it?

I've fixed it. 
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [ROCKETMQ-3] Clean up and perfect the unit test of rocketmq-broker
                </div><div><b>body:</b> remove try catch, use assertNotNull etc
                </div></div></li><li><div><div><b>title:</b> [ROCKETMQ-3] Clean up and perfect the unit test of rocketmq-broker
                </div><div><b>body:</b> remove try catch, use assertNotNull etc
                </div></div></li><li><div><div><b>title:</b> [ROCKETMQ-3] Clean up and perfect the unit test of rocketmq-broker
                </div><div><b>body:</b> remove try catch, use assertNotNull etc
                </div></div></li><li><div><div><b>title:</b> [ROCKETMQ-3] Clean up and perfect the unit test of rocketmq-broker
                </div><div><b>body:</b> remove try catch, use assertNotNull etc
                </div></div></li><li><div><div><b>title:</b> [ROCKETMQ-3] Clean up and perfect the unit test of rocketmq-broker
                </div><div><b>body:</b> remove try catch, use assertNotNull etc
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @WillemJiang Thanks for your comments. And a new pull request was created to remove these defects
              </div></li><li><div>
                @dongeforever I had some trouble to resolve the rebase merge conflict just by pulling the changes from your branch( it looks like there some patch are already merged into the master branch).  Can you rebase the master branch and use squash[1]  create a single commit for it.
[1]https://makandracards.com/makandra/527-squash-several-git-commits-into-a-single-commit
              </div></li><li><div>
                @WillemJiang the conflicts were resolved. And I tried squashing the commits, but it seemed does not work for the master branch because i had already pushed it to my 'origin' repository. Maybe you can close this PR, and i create a new one using a fresh branch.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Clean up the unit test of rocketmq
                </div><div><b>description:</b> There are lots of System.out.println and the try...catch exception code in the test of rocketmq-store module. It's better to avoid the usage of System.out.println and just through out the exception to fail the test. 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                It is true for other subprojects too.
              </div></li><li><div>
                GitHub user dongeforever opened a pull request:

    https://github.com/apache/incubator-rocketmq/pull/7

    ROCKETMQ-3 Clean up and perfect the unit test of rocketmq-broker

    Clean up and perfect the unit test of rocketmq-broker.
    Add BrokerTestHarness as a base class to create temporary BrokerController.
    Flush test has three steps:
    1 persist to the disk
    2 clear the in-memory values
    3 load from the disk.
    Used for both testFlushConsumerOffset and testFlushTopicConfig

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/dongeforever/incubator-rocketmq master

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/incubator-rocketmq/pull/7.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #7
    
----
commit 4a35f9575100ca04b379f7903f7134a406c3cd01
Author: zhendongliu.lzd &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T06:49:29Z

    ROCKETMQ-3 Clean up and perfect the unit test of rocketmq-broker

commit b82d36f977dbfa6d966efc3a33d05e50a49c3b7c
Author: zhendongliu.lzd &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T07:14:15Z

    Modify configs in BrokerTestHarness to avoid conflict

----

              </div></li><li><div>
                Github user dongeforever commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/7
  
    https://issues.apache.org/jira/browse/ROCKETMQ-3

              </div></li><li><div>
                Github user vongosling commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/7
  
    That's ok. please @lollipopjin @zhouxinyu review it

              </div></li><li><div>
                Github user lollipopjin commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/7
  
    OK

              </div></li><li><div>
                Github user zhouxinyu commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/7
  
    Good job!

              </div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/incubator-rocketmq/pull/7

              </div></li><li><div>
                Github user WillemJiang commented on a diff in the pull request:

    https://github.com/apache/incubator-rocketmq/pull/7#discussion_r93738207
  
    --- Diff: rocketmq-broker/src/test/java/com/alibaba/rocketmq/broker/topic/TopicConfigManagerTest.java ---
    @@ -20,52 +20,43 @@
      */
     package com.alibaba.rocketmq.broker.topic;
     
    -import com.alibaba.rocketmq.broker.BrokerController;
    -import com.alibaba.rocketmq.common.BrokerConfig;
    +import com.alibaba.rocketmq.broker.BrokerTestHarness;
     import com.alibaba.rocketmq.common.MixAll;
     import com.alibaba.rocketmq.common.TopicConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyClientConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyServerConfig;
    -import com.alibaba.rocketmq.store.config.MessageStoreConfig;
     import org.junit.Test;
     
     import static org.junit.Assert.assertTrue;
     
     
     /**
    - * @author shijia.wxr
    + * @author zander
      */
    -public class TopicConfigManagerTest {
    +public class TopicConfigManagerTest extends BrokerTestHarness {
         @Test
    -    public void test_flushTopicConfig() throws Exception {
    -        BrokerController brokerController = new BrokerController(//
    -                new BrokerConfig(), //
    -                new NettyServerConfig(), //
    -                new NettyClientConfig(), //
    -                new MessageStoreConfig());
    -        boolean initResult = brokerController.initialize();
    -        System.out.println("initialize " + initResult);
    -        brokerController.start();
    -
    +    public void testFlushTopicConfig() throws Exception {
             TopicConfigManager topicConfigManager = new TopicConfigManager(brokerController);
     
    -        TopicConfig topicConfig =
    -                topicConfigManager.createTopicInSendMessageMethod("TestTopic_SEND", MixAll.DEFAULT_TOPIC,
    -                        null, 4, 0);
    -        assertTrue(topicConfig != null);
    -
    -        System.out.println(topicConfig);
    -
             for (int i = 0; i &lt; 10; i++) {
                 String topic = "UNITTEST-" + i;
    -            topicConfig =
    -                    topicConfigManager
    -                            .createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
    +            TopicConfig topicConfig = topicConfigManager.createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
                 assertTrue(topicConfig != null);
             }
    -
             topicConfigManager.persist();
     
    -        brokerController.shutdown();
    +        topicConfigManager.getTopicConfigTable().clear();
    +
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig == null);
    +        }
    +        topicConfigManager.load();
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig != null);
    --- End diff --
    
    Please use assertNotNull directly.

              </div></li><li><div>
                Github user WillemJiang commented on a diff in the pull request:

    https://github.com/apache/incubator-rocketmq/pull/7#discussion_r93738306
  
    --- Diff: rocketmq-broker/src/test/java/com/alibaba/rocketmq/broker/topic/TopicConfigManagerTest.java ---
    @@ -20,52 +20,43 @@
      */
     package com.alibaba.rocketmq.broker.topic;
     
    -import com.alibaba.rocketmq.broker.BrokerController;
    -import com.alibaba.rocketmq.common.BrokerConfig;
    +import com.alibaba.rocketmq.broker.BrokerTestHarness;
     import com.alibaba.rocketmq.common.MixAll;
     import com.alibaba.rocketmq.common.TopicConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyClientConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyServerConfig;
    -import com.alibaba.rocketmq.store.config.MessageStoreConfig;
     import org.junit.Test;
     
     import static org.junit.Assert.assertTrue;
     
     
     /**
    - * @author shijia.wxr
    + * @author zander
      */
    -public class TopicConfigManagerTest {
    +public class TopicConfigManagerTest extends BrokerTestHarness {
         @Test
    -    public void test_flushTopicConfig() throws Exception {
    -        BrokerController brokerController = new BrokerController(//
    -                new BrokerConfig(), //
    -                new NettyServerConfig(), //
    -                new NettyClientConfig(), //
    -                new MessageStoreConfig());
    -        boolean initResult = brokerController.initialize();
    -        System.out.println("initialize " + initResult);
    -        brokerController.start();
    -
    +    public void testFlushTopicConfig() throws Exception {
             TopicConfigManager topicConfigManager = new TopicConfigManager(brokerController);
     
    -        TopicConfig topicConfig =
    -                topicConfigManager.createTopicInSendMessageMethod("TestTopic_SEND", MixAll.DEFAULT_TOPIC,
    -                        null, 4, 0);
    -        assertTrue(topicConfig != null);
    -
    -        System.out.println(topicConfig);
    -
             for (int i = 0; i &lt; 10; i++) {
                 String topic = "UNITTEST-" + i;
    -            topicConfig =
    -                    topicConfigManager
    -                            .createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
    +            TopicConfig topicConfig = topicConfigManager.createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
                 assertTrue(topicConfig != null);
             }
    -
             topicConfigManager.persist();
     
    -        brokerController.shutdown();
    +        topicConfigManager.getTopicConfigTable().clear();
    +
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig == null);
    +        }
    +        topicConfigManager.load();
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig != null);
    +            assertTrue(topicConfig.getTopicSysFlag() == 0);
    --- End diff --
    
    assertEquals could provider more information here.

              </div></li><li><div>
                Github user WillemJiang commented on a diff in the pull request:

    https://github.com/apache/incubator-rocketmq/pull/7#discussion_r93737922
  
    --- Diff: rocketmq-broker/src/test/java/com/alibaba/rocketmq/broker/api/SendMessageTest.java ---
    @@ -20,68 +20,68 @@
      */
     package com.alibaba.rocketmq.broker.api;
     
    -import com.alibaba.rocketmq.broker.BrokerController;
    +import com.alibaba.rocketmq.broker.BrokerTestHarness;
    +import com.alibaba.rocketmq.client.ClientConfig;
     import com.alibaba.rocketmq.client.hook.SendMessageContext;
     import com.alibaba.rocketmq.client.impl.CommunicationMode;
     import com.alibaba.rocketmq.client.impl.MQClientAPIImpl;
     import com.alibaba.rocketmq.client.producer.SendResult;
    -import com.alibaba.rocketmq.common.BrokerConfig;
    +import com.alibaba.rocketmq.client.producer.SendStatus;
     import com.alibaba.rocketmq.common.MixAll;
     import com.alibaba.rocketmq.common.message.Message;
     import com.alibaba.rocketmq.common.message.MessageDecoder;
     import com.alibaba.rocketmq.common.protocol.header.SendMessageRequestHeader;
     import com.alibaba.rocketmq.remoting.netty.NettyClientConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyServerConfig;
    -import com.alibaba.rocketmq.store.config.MessageStoreConfig;
    +import org.junit.After;
    +import org.junit.Before;
     import org.junit.Test;
     
    +import static org.junit.Assert.*;
    +
     
     /**
    - * @author shijia.wxr
    + * @author zander
      */
    -public class SendMessageTest {
    -    @Test
    -    public void test_sendMessage() throws Exception {
    -        BrokerController brokerController = new BrokerController(//
    -                new BrokerConfig(), //
    -                new NettyServerConfig(), //
    -                new NettyClientConfig(), //
    -                new MessageStoreConfig());
    -        boolean initResult = brokerController.initialize();
    -        System.out.println("initialize " + initResult);
    +public class SendMessageTest extends BrokerTestHarness{
     
    -        brokerController.start();
    +    MQClientAPIImpl client = new MQClientAPIImpl(new NettyClientConfig(), null, null, new ClientConfig());
    +    String topic = "UnitTestTopic";
     
    -        MQClientAPIImpl client = new MQClientAPIImpl(new NettyClientConfig(), null, null, null);
    +    @Before
    +    @Override
    +    public void startup() throws Exception {
    +        super.startup();
             client.start();
     
    -        for (int i = 0; i &lt; 100; i++) {
    -            String topic = "UnitTestTopic_" + i % 3;
    -            Message msg = new Message(topic, "TAG1 TAG2", "100200300", ("Hello, Nice world\t" + i).getBytes());
    -            msg.setDelayTimeLevel(i % 3 + 1);
    -
    -            try {
    -                SendMessageRequestHeader requestHeader = new SendMessageRequestHeader();
    -                requestHeader.setProducerGroup("abc");
    -                requestHeader.setTopic(msg.getTopic());
    -                requestHeader.setDefaultTopic(MixAll.DEFAULT_TOPIC);
    -                requestHeader.setDefaultTopicQueueNums(4);
    -                requestHeader.setQueueId(i % 4);
    -                requestHeader.setSysFlag(0);
    -                requestHeader.setBornTimestamp(System.currentTimeMillis());
    -                requestHeader.setFlag(msg.getFlag());
    -                requestHeader.setProperties(MessageDecoder.messageProperties2String(msg.getProperties()));
    -
    -                SendResult result = client.sendMessage("127.0.0.1:10911", "brokerName", msg, requestHeader, 1000 * 5,
    -                        CommunicationMode.SYNC, new SendMessageContext(), null);
    -                System.out.println(i + "\t" + result);
    -            } catch (Exception e) {
    -                e.printStackTrace();
    -            }
    -        }
    +    }
     
    +    @After
    +    @Override
    +    public void shutdown() throws Exception {
             client.shutdown();
    +        super.shutdown();
    +    }
     
    -        brokerController.shutdown();
    +    @Test
    +    public void testSendSingle() throws Exception {
    +        Message msg = new Message(topic, "TAG1 TAG2", "100200300", "body".getBytes());
    +        try {
    +            SendMessageRequestHeader requestHeader = new SendMessageRequestHeader();
    +            requestHeader.setProducerGroup("abc");
    +            requestHeader.setTopic(msg.getTopic());
    +            requestHeader.setDefaultTopic(MixAll.DEFAULT_TOPIC);
    +            requestHeader.setDefaultTopicQueueNums(4);
    +            requestHeader.setQueueId(0);
    +            requestHeader.setSysFlag(0);
    +            requestHeader.setBornTimestamp(System.currentTimeMillis());
    +            requestHeader.setFlag(msg.getFlag());
    +            requestHeader.setProperties(MessageDecoder.messageProperties2String(msg.getProperties()));
    +
    +            SendResult result = client.sendMessage(brokerAddr, BROKER_NAME, msg, requestHeader, 1000 * 5,
    +                    CommunicationMode.SYNC, new SendMessageContext(), null);
    +            assertTrue(result.getSendStatus() == SendStatus.SEND_OK);
    +        } catch (Exception e) {
    --- End diff --
    
    It's not a good practice to catch the exception here, we can just throw the exception out  and JUnit can take care of it. Please remove try ... catch here.

              </div></li><li><div>
                Github user WillemJiang commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/7
  
    @dongeforever Please take look at the comments.

              </div></li><li><div>
                Github user vongosling commented on a diff in the pull request:

    https://github.com/apache/incubator-rocketmq/pull/7#discussion_r93749430
  
    --- Diff: rocketmq-broker/src/test/java/com/alibaba/rocketmq/broker/topic/TopicConfigManagerTest.java ---
    @@ -20,52 +20,43 @@
      */
     package com.alibaba.rocketmq.broker.topic;
     
    -import com.alibaba.rocketmq.broker.BrokerController;
    -import com.alibaba.rocketmq.common.BrokerConfig;
    +import com.alibaba.rocketmq.broker.BrokerTestHarness;
     import com.alibaba.rocketmq.common.MixAll;
     import com.alibaba.rocketmq.common.TopicConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyClientConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyServerConfig;
    -import com.alibaba.rocketmq.store.config.MessageStoreConfig;
     import org.junit.Test;
     
     import static org.junit.Assert.assertTrue;
     
     
     /**
    - * @author shijia.wxr
    + * @author zander
      */
    -public class TopicConfigManagerTest {
    +public class TopicConfigManagerTest extends BrokerTestHarness {
         @Test
    -    public void test_flushTopicConfig() throws Exception {
    -        BrokerController brokerController = new BrokerController(//
    -                new BrokerConfig(), //
    -                new NettyServerConfig(), //
    -                new NettyClientConfig(), //
    -                new MessageStoreConfig());
    -        boolean initResult = brokerController.initialize();
    -        System.out.println("initialize " + initResult);
    -        brokerController.start();
    -
    +    public void testFlushTopicConfig() throws Exception {
             TopicConfigManager topicConfigManager = new TopicConfigManager(brokerController);
     
    -        TopicConfig topicConfig =
    -                topicConfigManager.createTopicInSendMessageMethod("TestTopic_SEND", MixAll.DEFAULT_TOPIC,
    -                        null, 4, 0);
    -        assertTrue(topicConfig != null);
    -
    -        System.out.println(topicConfig);
    -
             for (int i = 0; i &lt; 10; i++) {
                 String topic = "UNITTEST-" + i;
    -            topicConfig =
    -                    topicConfigManager
    -                            .createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
    +            TopicConfig topicConfig = topicConfigManager.createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
                 assertTrue(topicConfig != null);
             }
    -
             topicConfigManager.persist();
     
    -        brokerController.shutdown();
    +        topicConfigManager.getTopicConfigTable().clear();
    +
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig == null);
    +        }
    +        topicConfigManager.load();
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig != null);
    --- End diff --
    
    Serious Men~

              </div></li><li><div>
                Github user vongosling commented on a diff in the pull request:

    https://github.com/apache/incubator-rocketmq/pull/7#discussion_r93749892
  
    --- Diff: rocketmq-broker/src/test/java/com/alibaba/rocketmq/broker/topic/TopicConfigManagerTest.java ---
    @@ -20,52 +20,43 @@
      */
     package com.alibaba.rocketmq.broker.topic;
     
    -import com.alibaba.rocketmq.broker.BrokerController;
    -import com.alibaba.rocketmq.common.BrokerConfig;
    +import com.alibaba.rocketmq.broker.BrokerTestHarness;
     import com.alibaba.rocketmq.common.MixAll;
     import com.alibaba.rocketmq.common.TopicConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyClientConfig;
    -import com.alibaba.rocketmq.remoting.netty.NettyServerConfig;
    -import com.alibaba.rocketmq.store.config.MessageStoreConfig;
     import org.junit.Test;
     
     import static org.junit.Assert.assertTrue;
     
     
     /**
    - * @author shijia.wxr
    + * @author zander
      */
    -public class TopicConfigManagerTest {
    +public class TopicConfigManagerTest extends BrokerTestHarness {
         @Test
    -    public void test_flushTopicConfig() throws Exception {
    -        BrokerController brokerController = new BrokerController(//
    -                new BrokerConfig(), //
    -                new NettyServerConfig(), //
    -                new NettyClientConfig(), //
    -                new MessageStoreConfig());
    -        boolean initResult = brokerController.initialize();
    -        System.out.println("initialize " + initResult);
    -        brokerController.start();
    -
    +    public void testFlushTopicConfig() throws Exception {
             TopicConfigManager topicConfigManager = new TopicConfigManager(brokerController);
     
    -        TopicConfig topicConfig =
    -                topicConfigManager.createTopicInSendMessageMethod("TestTopic_SEND", MixAll.DEFAULT_TOPIC,
    -                        null, 4, 0);
    -        assertTrue(topicConfig != null);
    -
    -        System.out.println(topicConfig);
    -
             for (int i = 0; i &lt; 10; i++) {
                 String topic = "UNITTEST-" + i;
    -            topicConfig =
    -                    topicConfigManager
    -                            .createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
    +            TopicConfig topicConfig = topicConfigManager.createTopicInSendMessageMethod(topic, MixAll.DEFAULT_TOPIC, null, 4, 0);
                 assertTrue(topicConfig != null);
             }
    -
             topicConfigManager.persist();
     
    -        brokerController.shutdown();
    +        topicConfigManager.getTopicConfigTable().clear();
    +
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig == null);
    +        }
    +        topicConfigManager.load();
    +        for (int i = 0; i &lt; 10; i++) {
    +            String topic = "UNITTEST-" + i;
    +            TopicConfig topicConfig = topicConfigManager.selectTopicConfig(topic);
    +            assertTrue(topicConfig != null);
    +            assertTrue(topicConfig.getTopicSysFlag() == 0);
    --- End diff --
    
    It is highly recommended to use AssertJ framework for more details assertion. because Junit hamcrest assert framework is not complete. 

              </div></li><li><div>
                GitHub user dongeforever opened a pull request:

    https://github.com/apache/incubator-rocketmq/pull/9

    ROCKETMQ-3 Clean up and perfect the unit test of rocketmq-broker

    remove try catch, use assertNotNull etc

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/dongeforever/incubator-rocketmq master

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/incubator-rocketmq/pull/9.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #9
    
----
commit 4a35f9575100ca04b379f7903f7134a406c3cd01
Author: zhendongliu.lzd &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T06:49:29Z

    ROCKETMQ-3 Clean up and perfect the unit test of rocketmq-broker

commit b82d36f977dbfa6d966efc3a33d05e50a49c3b7c
Author: zhendongliu.lzd &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T07:14:15Z

    Modify configs in BrokerTestHarness to avoid conflict

commit bc15c7345b58a4acc06c0a050602fed4faf01705
Author: zander &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T07:34:31Z

    Remove unused imports

commit 3f979a8d8500a488a50c1f9830c7e72d27e1d4fa
Author: zander &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-23T10:21:23Z

    ROCKETMQ-3 Clean up and perfect the unit test of rocketmq-broker, remove try catch, use assertNotNull etc

----

              </div></li><li><div>
                Github user dongeforever commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/9
  
    @WillemJiang Thanks for your comments. And a new pull request was created to remove these defects

              </div></li><li><div>
                Github user WillemJiang commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/9
  
    @dongeforever I had some trouble to resolve the rebase merge conflict just by pulling the changes from your branch( it looks like there some patch are already merged into the master branch).  Can you rebase the master branch and use squash[1]  create a single commit for it.
    [1]https://makandracards.com/makandra/527-squash-several-git-commits-into-a-single-commit

              </div></li><li><div>
                Github user dongeforever commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/9
  
    @WillemJiang the conflicts were resolved. And I tried squashing the commits, but it seemed does not work for the master branch because i had already pushed it to my 'origin' repository. Maybe you can close this PR, and i create a new one using a fresh branch.

              </div></li><li><div>
                Github user dongeforever closed the pull request at:

    https://github.com/apache/incubator-rocketmq/pull/9

              </div></li><li><div>
                GitHub user dongeforever opened a pull request:

    https://github.com/apache/incubator-rocketmq/pull/11

    [ROCKETMQ-3] Clean up unit tests, remove try...catch, using assertNull etc

    Remove try...catch, using assertNull etc

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/dongeforever/incubator-rocketmq apache_pr

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/incubator-rocketmq/pull/11.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #11
    
----
commit ec18e3530b7bc3067dcc7df1c04d3f5fff9244f0
Author: zhendongliu.lzd &lt;zhendongliu.lzd@alibaba-inc.com&gt;
Date:   2016-12-26T02:31:45Z

    [ROCKETMQ-3] Remove try...catch, using assertNull etc

----

              </div></li><li><div>
                Github user dongeforever commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/11
  
    @WillemJiang I am sorry to bother you so many times. A new pr is created for squashing. And I will take care of my commits carefully next time. 

              </div></li><li><div>
                Github user WillemJiang commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/11
  
    There is only one line change here after rebasing the codes. I just commit the patch into master branch.  

              </div></li><li><div>
                Github user vongosling commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/11
  
    @shroman cool, we will add code-style parts in website. Every guys could comment it and help us to perfect it :-)

              </div></li><li><div>
                Github user dongeforever commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/11
  
    This PR could be closed for the code has been merged into apache master.

              </div></li><li><div>
                Github user dongeforever closed the pull request at:

    https://github.com/apache/incubator-rocketmq/pull/11

              </div></li><li><div>
                Github user WillemJiang commented on the issue:

    https://github.com/apache/incubator-rocketmq/pull/11
  
    Please using the mailing list to discuss the code-style issue. 

              </div></li></ol></div></div></html>