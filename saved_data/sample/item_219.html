<!DOCTYPE html><html><div class="item-title">
        Item 219
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> #1172, fix test case
                </div><div><b>message:</b> #1172, fix test case

                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div></div></li><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div></div></li><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div></div></li><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div></div></li><li><div><div><b>title:</b> Adjust path tracing of sharding-opentracing
                </div><div><b>body:</b> - [x] Add tracing of getConnection().
- [x] Add tracing of close().
- [x] Add tracing of parse().
- [x] Remove tracing of route().
- [x] Remove tracing of merge().
- [x] Display correctly without a WebServer.
- [x] Display jdbc url in peer tag.
- [x] Vertical dimension sort by time between threads: https://github.com/apache/incubator-skywalking/issues/1657
- [x] Update component name: https://github.com/apache/incubator-skywalking/issues/1658
- [x] Support Sharding-Proxy.
- [x] Change the event mechanism to invoke-chain.
- [x] Rename OverallExecutionEvent and move to a appropriate place.
- [x] Make feature optional for Proxy by configuration.
- [x] Aggregation for sub-threads. (Need to implement in plugin.)
- [x] Use SPI to instead of guava event bus for performance issue
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                Topology
![1b](https://user-images.githubusercontent.com/24643893/45272260-ddb27680-b4de-11e8-97b8-99d1a3a0433b.png)

Tracing
![1a](https://user-images.githubusercontent.com/24643893/45272271-e5721b00-b4de-11e8-91ea-7f6740a0b960.png)

Detail
![1c](https://user-images.githubusercontent.com/24643893/45272277-eb67fc00-b4de-11e8-9592-dcbb2b91e54c.png)

              </div></li><li><div>
                Display jdbc url in peer tag.
![00](https://user-images.githubusercontent.com/24643893/45343234-edab8280-b5d2-11e8-9130-365e110c5fc4.png)

![01](https://user-images.githubusercontent.com/24643893/45343239-f13f0980-b5d2-11e8-8beb-a9e368e641b3.png)

![02](https://user-images.githubusercontent.com/24643893/45343249-f56b2700-b5d2-11e8-9428-72377ea61137.png)

              </div></li><li><div><div><b>body:</b> Guava event bus's performance is really low, I just call directly instead of event bus, the performance is fast 50%.
So I just use SPI to decouple, do not use event bus on online query.

Use guava event bus:

 *Guava event bus (nanos)*  | *SPI (nanos)* | *Get connection(Hikari) (nanos)* |
| -------------------------------- | --------------------------------- | ------------------- |
| 814489                                         | 63190                                             | 345827                     |

event bus is slow than get connection!
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                full time spend for get 2 connection and post a event:

use guava event bus:
post evert--------: ds_0---814489
get connection---: ds_0---452882
get connection---: ds_0---345827
total-------------: ds_0---2847346

post evert-----------: ds_1---792603
get connection------: ds_1---459552
get connection------: ds_1---303029
total---------------- :ds_1---2819832


use SPI:
post evert-----------: ds_0---63190
get connection------:ds_0---618804
get connection------:ds_0---469503
total----------------:ds_0---1326277

post evert-----------:ds_1---69040
get connection------:ds_1---574488
get connection------:ds_1---562666
total-----------------:ds_1---1349838





              </div></li></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>