<!DOCTYPE html><html><div class="item-title">
        Item 65
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 insecure: only use for tests!!!!
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> SOLR-2019: force Jetty to use insecure randomness source when running tests
                </div><div><b>message:</b> SOLR-2019: force Jetty to use insecure randomness source when running tests

git-svn-id: https://svn.apache.org/repos/asf/lucene/dev/branches/branch_3x@981267 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Jetty sometimes randomly takes a long time to start
                </div><div><b>description:</b> I'm hitting this Jetty issue when running Solr's tests that spawn a Jetty:

    http://jira.codehaus.org/browse/JETTY-331

It seems to be caused by this root cause:

    http://bugs.sun.com/view_bug.do?bug_id=6202721

Whereby, somehow, Jetty is trying to use cryptographically secure source of randomness to seed seed its HashSessionIdManager.  My box doesn't have enough entropy so the read blocks for sometimes 10s of seconds!

If I forcefully symlink /dev/random -&gt; /dev/urandom, that fixes the hang.  Likewise, if I edit the JRE's java.security to  set securerandom.source=file:/dev/./urandom, that also fixes it.  But I think we can workaround this more "generally" by doing the workaround suggested in the Jetty issue (pass java.util.Random not java.security.SecureRandom).

However, it's still not clear how widespread / what evns this issue really affects (besides mine)...
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                It is possible to set Random in the SessionIDManager programmatically using the following code:

{code}
Server server = new Server();
HashSessionIdManager idManager = new HashSessionIdManager();
idManager.setRandom(new Random());
server.setSessionIdManager(idManager);
{code}
              </div></li><li><div>
                here is a patch (not for committing) to see if it resolves it. if so i think we should do this from tests...
              </div></li><li><div>
                That patch works for me!!
              </div></li><li><div><div><b>body:</b> seems slightly hackish, but is it ok to check a sysprop in JettySolrRunner to enable this?
we could then set it from ant for tests and be done with it.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                patch that checks sysprop, set from 'ant test'
              </div></li><li><div>
                I see no problem in havin an insecure hash generator for session ids. When tests are running, the jetty is localhost only and never in production. So in my opinion, the first patch without sysprops is perfectly fine. There is nothing insecure in it.
              </div></li><li><div>
                That jetty runner is not a test class.
              </div></li><li><div>
                bq. patch that checks sysprop, set from 'ant test'

This patch works for me too!

I think this is a good approach (set a system prop)... +1 to commit.
              </div></li><li><div>
                bq. That jetty runner is not a test class. 

Ah there are two of them.
              </div></li><li><div>
                This solves some of the test failures I've been seeing.  +1 to commit!
              </div></li><li><div>
                OK I'll commit!
              </div></li><li><div>
                Bulk close for 3.1.0 release
              </div></li></ol></div></div></html>