<!DOCTYPE html><html><div class="item-title">
        Item 174
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [KARAF-1066]add-features-to-repo should honor repository tag content have whitespace tab, etc
                </div><div><b>message:</b> [KARAF-1066]add-features-to-repo should honor repository tag content have whitespace tab, etc

git-svn-id: https://svn.apache.org/repos/asf/karaf/branches/karaf-2.2.x@1372748 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li><li><div><div><b>summary:</b> make features xml parser more forgiving
                </div><div><b>description:</b> features-maven-plugin:2.2.4:add-features-to-repo

1) currently, an entry in features.xml like this works fine:

&lt;repository&gt;mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features&lt;/repository&gt;

2) but plugin blows up with exception, if format is like this

&lt;repository&gt;
mvn:org.apache.karaf.assemblies.features/standard/2.2.4/xml/features
&lt;/repository&gt;

"Error populating repository: Illegal character in scheme name at index 0:"

3) I suggest to make features xml parser more forgiving

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Agree with that ;)
              </div></li><li><div>
                also +1
              </div></li><li><div><div><b>body:</b> the repo parsing now removes all white space and newline/endline using regexp "\\s".

I don't think we can have URI's with spaces, but I could be wrong. 

I implemented a test also that exercised the issue using a repo2.xml file.  
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Hi Heath,

Thanks for this patch
I think in the RepositoryImpl.java, simply using
uri = uri.trim();
is better than 
uri = uri.replaceAll("\\s", ""); 
from your patch.  As String.trim() can trim whitespace, \t\r\n from the string, but won't remove any whitespace in the middle of the string, so it avoid the potential risk if URI have whitespace.

Moreover, you patch is valuable when parse the features.xml during runtime, but this issue is mainly about the features-maven-plugin:add-features-to-repo have issues, so your patch doesn't really fix it, we should fix it in some where like AddToRepositoryMojo.java.

I'll take care of it and fix it soon.

Best Regards


Freeman
              </div></li><li><div>
                Hi,

I'm going to apply your patch with the change I mentioned firstly and then fix the AddToRepositoryMojo issue.

Freeman
              </div></li><li><div>
                apply patch on behalf of Heath Kesler  with thanks
http://svn.apache.org/viewvc?rev=1372740&amp;view=rev
              </div></li><li><div>
                commit fix
http://svn.apache.org/viewvc?rev=1372747&amp;view=rev for trunk
http://svn.apache.org/viewvc?rev=1372749&amp;view=rev for 2.3.x branch
http://svn.apache.org/viewvc?rev=1372748&amp;view=rev for 2.2.x branch
              </div></li><li><div>
                @Freeman - thanks for the feedback, I had thought about using trim but was not sure about white spaces in the uri and since the tests passed I left it with the replaceAll.

The test I wrote fails with white spaces in the URI using trim().  I will look at the patch you wrote and see what you did differently.    

              </div></li><li><div><div><b>body:</b> Freeman, here is a test to exercise the changes you made for the AddToRepositoryMojo class.

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>body:</b> I did test the trim() against a test I have for the RepositoryImpl class and it fails when there is a space in the URI, should I open a different jira for that or just continue to track it here?

Thanks for helping me on this.

I will add the test that fails to this jira so you can verify it.
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                Here is the patch that will exercise the test failure when a non-encoded white space is in the uri. 

Let me know what you think.
              </div></li><li><div><div><b>body:</b> Hi Heath,

First of all, I don't think we should change content of the URI, so if any user has unencoded whitespace inside URI, they should get exception so that they know they do something wrong, just like if users has typo in URI hence can't get files they should know that they do something wrong and they need correct it themselves.

But remove the whitespace \t\r\n  from begining or end of the URI is OK, it doesn't change the URI content, it just get a better format URI.

Btw, I like your AddToRepositoryMojoTest, it prove the trim works, and I will apply it to trunk(with minor change, I don't wanna the space inside URI and actually your test not run into URI parse)

Freeman
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                apply patch which add AddToRepositoryMojoTest on behalf of Heath Kesler with thanks
http://svn.apache.org/viewvc?rev=1373188&amp;view=rev

@Heath,
Do you wanna backport AddToRepositoryMojoTest to Karaf 2.x line?

              </div></li><li><div>
                Hi Freeman, your comments make sense, thanks for the feedback.

I will backport the test to the karaf 2.x also.
              </div></li><li><div>
                Freeman, here is the test for the 2.3 branch
              </div></li><li><div>
                apply patch which add AddFeaturesToRepoMojoTest on behalf of Heath Kesler with thanks
http://svn.apache.org/viewvc?rev=1374896&amp;view=rev for 2.3.x branch
http://svn.apache.org/viewvc?rev=1374897&amp;view=rev for 2.2.x branch
              </div></li></ol></div></div></html>