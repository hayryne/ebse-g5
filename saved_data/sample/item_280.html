<!DOCTYPE html><html><div class="item-title">
        Item 280
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws NullPointerException(Aman Poonia)
                </div><div><b>message:</b> PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws NullPointerException(Aman Poonia)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> IndexHalfStoreFileReaderGenerator throws NullPointerException
                </div><div><b>description:</b> {noformat}
018-08-08 09:15:25,075 FATAL [7,queue=3,port=60020] regionserver.HRegionServer - ABORTING region server phoenix1,60020,1533715370645: The coprocessor org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator threw java.lang.NullPointerException
 java.lang.NullPointerException
 at java.util.ArrayList.addAll(ArrayList.java:577)
 at org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator.getLocalIndexScanners(IndexHalfStoreFileReaderGenerator.java:398)
 at org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator.access$000(IndexHalfStoreFileReaderGenerator.java:73)
 at org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator$1.getScannersNoCompaction(IndexHalfStoreFileReaderGenerator.java:332)
 at org.apache.hadoop.hbase.regionserver.StoreScanner.&lt;init&gt;(StoreScanner.java:214)
 at org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator$1.&lt;init&gt;(IndexHalfStoreFileReaderGenerator.java:327)
 at org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator.preStoreScannerOpen(IndexHalfStoreFileReaderGenerator.java:326)
 at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost$51.call(RegionCoprocessorHost.java:1335)
 at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost$RegionOperation.call(RegionCoprocessorHost.java:1693)
 at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.execOperation(RegionCoprocessorHost.java:1771)
 at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.execOperationWithResult(RegionCoprocessorHost.java:1734)
 at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.preStoreScannerOpen(RegionCoprocessorHost.java:1330)
 at org.apache.hadoop.hbase.regionserver.HStore.getScanner(HStore.java:2169)
 at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.initializeScanners(HRegion.java:5916)
 at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.&lt;init&gt;(HRegion.java:5890)
 at org.apache.hadoop.hbase.regionserver.HRegion.instantiateRegionScanner(HRegion.java:2739)
 at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:2719)
 at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:7197)
 at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:7156)
 at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:7149)
 at org.apache.hadoop.hbase.regionserver.RSRpcServices.get(RSRpcServices.java:2249)
 at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:35068)
 at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2373)
 at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:124)
 at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
 at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168
 {noformat}

Possible fix  for this would be to backport PHOENIX-4440 and PHOENIX-4318
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                GitHub user mnpoonia opened a pull request:

    https://github.com/apache/phoenix/pull/323

    PHOENIX-4839 Check for memstore scanners if it is null before adding …

    …it to scanner list

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/mnpoonia/phoenix 4.x-HBase-1.3-PHOENIX-4839

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/phoenix/pull/323.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #323
    
----
commit 3e3b352c711f909fe71e40baae4b0cd413c36857
Author: Aman Poonia &lt;aman.poonia.29@...&gt;
Date:   2018-08-08T14:24:12Z

    PHOENIX-4839 Check for memstore scanners if it is null before adding it to scanner list

----

              </div></li><li><div>
                Github user joshelser commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r208711828
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    +        if(memstoreScanners != null) {
    --- End diff --
    
    What is the case that this would ever be null?

              </div></li><li><div>
                Github user joshelser commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r208713485
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    --- End diff --
    
    In general, we don't ever want to be casting the interface (`Store`) to the implementation (`HStore`). Is phoenix fundamentally doing something here that requires it to be tied to some specific HStore functionality?

              </div></li><li><div>
                Github user mnpoonia commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r208812073
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    +        if(memstoreScanners != null) {
    --- End diff --
    
    This is the line where it might return null 
    https://github.com/apache/hbase/blob/branch-1.3/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DefaultMemStore.java#L637

              </div></li><li><div>
                Github user mnpoonia commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r208821626
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    --- End diff --
    
    Actually i didn't want to touch the other part of code to fix this specific issue.

              </div></li><li><div>
                Github user mnpoonia commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r209157109
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    --- End diff --
    
    @joshelser Looks like we need HStore to access memstore specifically. We can't access the memstore and get its scanners from the store object. 

              </div></li><li><div>
                Github user mnpoonia commented on a diff in the pull request:

    https://github.com/apache/phoenix/pull/323#discussion_r209235284
  
    --- Diff: phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java ---
    @@ -395,7 +395,10 @@ public KeyValueScanner preStoreScannerOpen(final ObserverContext&lt;RegionCoprocess
                             .getReader().getHFileReader().hasMVCCInfo(), readPt));
                 }
             }
    -        keyValueScanners.addAll(((HStore) store).memstore.getScanners(readPt));
    +        List&lt;KeyValueScanner&gt; memstoreScanners = ((HStore) store).memstore.getScanners(readPt);
    --- End diff --
    
    @joshelser - Thanks for pointing that out(my bad i didn't get that in first look at the code ). Updated PR, please have a look.

              </div></li><li><div>
                This appears to be a regression from HBASE-17885 , where now getScanners can return null.&nbsp; They added the same null check in HStore.&nbsp; +1 to the patch.
              </div></li><li><div>
                [~vincentpoon] - Can you assign this Jira to me. I don't have permission.
              </div></li><li><div><div><b>body:</b> Sorry for the confusion, I missed that the original code already did the cast from Store to HStore. If we didn't have the instanceof check previously, no need to add it now.

I'd like to see a follow-on Jira issue created which can be used to track the necessary change in HBase so that we have a stable API for what we need to implement this in phoenix :)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                [~elserj] - I think this check is safer to have than not having it at all. We can surely open a JIRA in HBase to expose memstore at Store leve rather than at HStore(what's your opinion about this?) and a respective tracking JIRA in Phoenix.
If this PR looks good, please help in getting this merged.
              </div></li><li><div><div><b>body:</b> I'm not sure HBase will want to expose the memstore internals into any kind of Public or LP interface. Will take some convincing I bet. We once made the public Region interface out of HRegion for Phoenix, so it could be done, but would be a refactor that could only go in on a major or minor (maybe) release. 

Can you redesign for your intent here without touching memstore internals? That might be a better path forward. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                bq. Can you redesign for your intent here without touching memstore internals?
It seems [~rajeshbabu] already get rid of this in PHOENIX-4318. [~mnpoonia], I just tried backporting it for HBase 1.x and it works fine. 
can you please check the attached patch and confirm if it resolves your problem.
              </div></li><li><div>
                [~ankit@apache.org] - This looks good. There were few minor issues hence updated the patch. Please review.
[~vincentpoon][~rajeshbabu]
              </div></li><li><div>
                {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12936266/PHOENIX-4839-HBase-1.3.patch
  against master branch at commit 05edcd137c1940399ce9d679af2822889a3914bc.
  ATTACHMENT ID: 12936266

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1994//console

This message is automatically generated.
              </div></li><li><div>
                Thanks [~mnpoonia] , committed to 4.x branches only(as master has already had these changes).
              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-4.x-HBase-1.3 #191 (See [https://builds.apache.org/job/Phoenix-4.x-HBase-1.3/191/])
PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws (ankitsinghal59: rev a575ac04ea4b4497209a194169d2121e210ec307)
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReader.java

              </div></li><li><div>
                [~mnpoonia]

The following two tests are failing with this patch, can you please take a look?

org.apache.phoenix.end2end.LocalIndexSplitMergeIT.testLocalIndexScanAfterRegionsMerge
org.apache.phoenix.end2end.LocalIndexSplitMergeIT.testLocalIndexScanWithMergeSpecialCase
              </div></li><li><div>
                [~tdsilva] - Looks like we also need to backport PHOENIX-4440. I have a patch ready. i am bit confused about whether i should create another JIRA or add an addendum because the new patch is different for HBase 1.3 and 1.4
              </div></li><li><div>
                Added a patch for HBase-1.3 branch. Working on HBase-1.4 patch.
              </div></li><li><div>
                Looks like last patch is not applied properly on HBase-1.4 branch
[~tdsilva] - Need your help here in reverting the wrong commit and adding the right one. 
The diff is at https://github.com/apache/phoenix/commit/3b9a108f3891601cdfdc88dbad8ff39534cfd8f1#diff-21153511c1442d133c590106860b8a96L192 . The method was supposed to be preCompact  which is the case in 1.3 patch
              </div></li><li><div>
                [~mnpoonia] can you attach a patch for 1.4 that reverts what is required? 
              </div></li><li><div>
                [~vincentpoon] [~ankit@apache.org] can you please review the addendum patch? The original patch is caused two test failures. Thanks!
              </div></li><li><div>
                {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12937723/PHOENIX-4839-4.x-HBase-1.4.addendum.patch
  against 4.x-HBase-1.4 branch at commit fa20ff297ed2de19b6e736b39c73521045160115.
  ATTACHMENT ID: 12937723

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 release audit{color}.  The applied patch generated 2 release audit warnings (more than the master's current 0 warnings).

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +                                                long scannerOrder, boolean canOptimizeForNonNullColumn) {
+        // scanners. This is possible during merge where one of the child region scan should not return any

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2012//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2012//artifact/patchprocess/patchReleaseAuditWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2012//console

This message is automatically generated.
              </div></li><li><div><div><b>body:</b> We can now remove {{private boolean checkForReferenceFiles() in Phoenix' RegionScannerFactory.getWrappedScanner -&gt; anonymous RegionScanner.}}, right?

In fact we must remove that method, otherwise after HBASE-20940 each query will open all HFiles on all involved regions.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/phoenix/pull/323

              </div></li><li><div><div><b>body:</b> {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12938004/PHOENIX-4839-4.x-HBase-1.3.addendum.patch
  against 4.x-HBase-1.3 branch at commit 8ae455fd46e59d94a3f6710c03549239aa5b59c3.
  ATTACHMENT ID: 12938004

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 release audit{color}.  The applied patch generated 2 release audit warnings (more than the master's current 0 warnings).

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
     ./phoenix-core/target/failsafe-reports/TEST-org.apache.phoenix.execute.UpsertSelectOverlappingBatchesIT

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2019//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2019//artifact/patchprocess/patchReleaseAuditWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2019//console

This message is automatically generated.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                UpsertSelectOverlappingBatchesIT is passing locally atleast not sure why its failing here. Also it doesn't look related.


              </div></li><li><div>
                [~lhofhansl] - I think the PHOENIX-4885 will help. Removing RegionScannerFactory.getWrappedScanner -&gt; anonymous RegionScanner might cause issues in case we merge regions with local indexes and it has not been compacted yet. What do you think?
              </div></li><li><div>
                I'm happy to commit PHOENIX-4885 as a temporary measure. But it is true that with this in place we do not need that method anymore, right?
              </div></li><li><div>
                [~lhofhansl] Updated the addendum. 
Please review.


              </div></li><li><div>
                {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12938452/PHOENIX-4839-4.x-HBase-1.4.addendum.01.patch
  against 4.x-HBase-1.4 branch at commit 8ae455fd46e59d94a3f6710c03549239aa5b59c3.
  ATTACHMENT ID: 12938452

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 release audit{color}.  The applied patch generated 2 release audit warnings (more than the master's current 0 warnings).

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +                                                long scannerOrder, boolean canOptimizeForNonNullColumn) {
+        // scanners. This is possible during merge where one of the child region scan should not return any

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2025//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2025//artifact/patchprocess/patchReleaseAuditWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2025//console

This message is automatically generated.
              </div></li><li><div><div><b>body:</b> {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12938450/PHOENIX-4839-4.x-HBase-1.3.addendum.01.patch
  against 4.x-HBase-1.3 branch at commit 8ae455fd46e59d94a3f6710c03549239aa5b59c3.
  ATTACHMENT ID: 12938450

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 release audit{color}.  The applied patch generated 2 release audit warnings (more than the master's current 0 warnings).

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2024//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2024//artifact/patchprocess/patchReleaseAuditWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/2024//console

This message is automatically generated.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I'm happy to commit PHOENIX-4885 as a temporary measure. But it is true that with this in place we do not need that method anymore, right?

I didn't read your whole comment [~mnpoonia]. :(&nbsp; Re: Your question, I am not sure to be honest. I guess best to commit PHOENIX-4885 for now. Lemme just do that.
              </div></li><li><div>
                [~lhofhansl] - I did a quick test.
If i remove private boolean checkForReferenceFiles() in Phoenix' RegionScannerFactory.getWrappedScanner -&gt; anonymous RegionScanner without my patch then LocalIndexSplitMergeIT.testLocalIndexScanAfterRegionsMerge and LocalIndexSplitMergeIT.testLocalIndexScanWithMergeSpecialCase will fail. Once i apply my patch after removing the concerned method tests start passing. So i think we can remove the method hence [PHOENIX-4839-4.x-HBase-1.3.addendum.01.patch|http://issues.apache.org/jira/secure/attachment/12938450/PHOENIX-4839-4.x-HBase-1.3.addendum.01.patch] and [PHOENIX-4839-4.x-HBase-1.4.addendum.01.patch|http://issues.apache.org/jira/secure/attachment/12938450/PHOENIX-4839-4.x-HBase-1.4.addendum.01.patch] should be good i believe.
              </div></li><li><div>
                [~rajeshbabu] seems to be MIA. If you're there Rajeshbabu, could you have a look?

I'll hold off on committing PHOENIX-4885.
              </div></li><li><div>
                Actually I don't quite understand this if-statement:
{code:java}
+        if (Bytes.compareTo(scan.getStartRow(), 0, prefixLength,
+                (startKey.length == 0 ? new byte[endKey.length] : startKey), 0,
+                (startKey.length == 0 ? endKey.length : startKey.length)) != 0) {
+            return false;
+        }{code}
&nbsp;
Why do we need to create an empty byte array of size endkey.length? Can you explain this briefly?
Looks good otherwise.
              </div></li><li><div>
                This is to be inline with https://github.com/apache/phoenix/blob/master/phoenix-core/src/main/java/org/apache/phoenix/index/IndexMaintainer.java#L568
 which we use at the time of index row key creation. 
FYI - This is part of backport of PHOENIX-4440
              </div></li><li><div>
                Fair enough. Looks good to me. +1
              </div></li><li><div>
                Also let's make a separate issue for removing checkForReferenceFiles, since that needs to be forward-ported to master, right?
              </div></li><li><div>
                Let's commit this _without_ removing checkForReferences, and then remove checkForReferences in PHOENIX-4885. Good?
              </div></li><li><div>
                So specifically I'll commit .addendum patches here (not the .addendum.01 patches)
              </div></li><li><div>
                [~ankit@apache.org], please have a look at the addendum patch. Thanks.
              </div></li><li><div>
                Marking as blocker because it's 1/2 committed now.
              </div></li><li><div>
                Folks... Feedback?

If I do not hear anything by tomorrow I'm going to revert the parts already committed on this jira so that I can remove the blocker status due to a partial commit.
We can't have partially committed jiras for weeks.

              </div></li><li><div>
                [~lhofhansl] - Sorry for the delayed communication

&gt;&nbsp;Also let's make a separate issue for removing checkForReferenceFiles, since that needs to be forward-ported to master, right?

Yes that's okay with me. +1

&gt; So specifically I'll commit .addendum patches here (not the .addendum.01 patches).

yes. +1

Once this is committed i can upload the patch for&nbsp;PHOENIX-4885
 &nbsp;
              </div></li><li><div>
                Thanks :)
(Sorry if the previous sounded annoyed... Wasn't meant that way. I'm just allergic to leaving 1/2 things committed for a long duration, since it makes the code essentially unreleasable).

Ok then. Unless I hear objections I will make this so, for all 4.x branches.

              </div></li><li><div>
                Looks like the original was only committed to branch-1, 1.4, 1.3, and 1.2. Is that intentional?
[~apurtell], FYI
              </div></li><li><div>
                What HBase JIRA was only committed to the branch-1s [~lhofhansl]? We are doing that whenever an issue is not applicable to branch-2 and up so quite possible it is intentional. 
              </div></li><li><div>
                Ok... Gonna close this one then.

Thanks [~mnpoonia]
              </div></li><li><div>
                Wait... the Phoenix 4.x-HBase-1.1 branch...?
[~mnpoonia], mind creating a patch for that (sorry, I don't have time right now look at that :( )
              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-4.x-HBase-1.3 #206 (See [https://builds.apache.org/job/Phoenix-4.x-HBase-1.3/206/])
PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws (larsh: rev 4d8c5d43c3a6d09e7338bc7eaf767af0dd012860)
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReader.java
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java

              </div></li><li><div>
                &gt; Wait... the Phoenix 4.x-HBase-1.1 branch...?

4.x-HBase-1.1 has been deprecated. Working on&nbsp;patch for 1.2 .
              </div></li><li><div>
                Looks like 1.2 is already patched. So nothing left i believe.
              </div></li><li><div>
                Thanks [~mnpoonia]. I have been going by the recent commits. Good to know it has been deprecated. All good then. Thanks for bearing with me :)

Let's get PHOENIX-4885 in.
              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-omid2 #89 (See [https://builds.apache.org/job/Phoenix-omid2/89/])
PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws (ankitsinghal59: rev a575ac04ea4b4497209a194169d2121e210ec307)
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReader.java
PHOENIX-4839 IndexHalfStoreFileReaderGenerator throws (larsh: rev 4d8c5d43c3a6d09e7338bc7eaf767af0dd012860)
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReaderGenerator.java
* (edit) phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/IndexHalfStoreFileReader.java

              </div></li></ol></div></div></html>