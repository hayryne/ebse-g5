<!DOCTYPE html><html><div class="item-title">
        Item 294
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>message:</b> [GOBBLIN-1303] Catch error when failing to clean staging data

Closes #3141 from jack-moseley/cleanup-failure

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li><li><div><div><b>title:</b> [GOBBLIN-1303] Catch error when failing to clean staging data
                </div><div><b>body:</b> Dear Gobblin maintainers,

Please accept this PR. I understand that it will not be reviewed until I have checked off all the steps below!


### JIRA
- [x] My PR addresses the following [Gobblin JIRA](https://issues.apache.org/jira/browse/GOBBLIN/) issues and references them in the PR title. For example, "[GOBBLIN-XXX] My Gobblin PR"
    - https://issues.apache.org/jira/browse/GOBBLIN-1303


### Description
- [x] Here are some details about my PR, including screenshots (if applicable):
Currently if there is a failure in cleanupStagingData, it is not caught, so the rest of launchJob (which includes sending GobblinTrackingEvents) will not be run

### Tests
- [x] My PR adds the following unit tests __OR__ does not need testing for this extremely good reason:
trivial

### Commits
- [x] My commits all reference JIRA issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from "[How to write a good git commit message](http://chris.beams.io/posts/git-commit/)":
    1. Subject is separated from body by a blank line
    2. Subject is limited to 50 characters
    3. Subject does not end with a period
    4. Subject uses the imperative mood ("add", not "adding")
    5. Body wraps at 72 characters
    6. Body explains "what" and "why", not "how"


                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                +1 LGTM
              </div></li><li><div>
                @sv2000 please merge
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                But this change will swallow the exception and any errors in `cleanupStagingData` will not fail the job and hence will go undetected (even if there is log message). 
Should we rather move the code we want to run (sending GTEs) to the finally block at line 600?
              </div></li><li><div>
                Sure that's a good point, will change that
              </div></li><li><div><div><b>body:</b> Actually not sure if that's the correct place for it either, because if there is an error when notifying listeners, then the cleanup code to close the metrics reporting wouldn't run. Maybe it should be in the finally block at line 542
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Actually isn't this kind of the normal behaviour for a failed job? Any exception in work unit creation is caught at line 530 and not rethrown, does the job not failed for those cases either?
              </div></li><li><div>
                Got it. Yes 542 is the right place.
              </div></li><li><div>
                Okay, so the current behavior is do not fail the job (just mark the gobblin job as FAILED) when workunit creation fails, or anything in the main try block fails. However, according to the current behavior any exception in `cleanupStagingData` and `notifyListeners` are thrown (i.e. making job fail).
So, if we want to preserve the same behavior, we should move the code form L565-L599 to finally block at 542, right?
Why the current behavior treats `cleanupStagingData` failures differently, and whether we should change this behavior is a different question that I am not fully sure about.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Catch error when failing to clean staging data
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Catch error when failing to clean staging data
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>