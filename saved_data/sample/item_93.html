<!DOCTYPE html><html><div class="item-title">
        Item 93
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Fix SPARK-4471: blockManagerIdFromJson function throws exception while B...
                </div><div><b>message:</b> Fix SPARK-4471: blockManagerIdFromJson function throws exception while B...

Fix [SPARK-4471](https://issues.apache.org/jira/browse/SPARK-4471): blockManagerIdFromJson function throws exception while BlockManagerId be null in MetadataFetchFailedException

Author: hushan[胡珊] &lt;hushan@xiaomi.com&gt;

Closes #3340 from suyanNone/fix-blockmanagerId-jnothing-2 and squashes the following commits:

159f9a3 [hushan[胡珊]] Refine test code for blockmanager is null
4380d73 [hushan[胡珊]] remove useless blank line
3ccf651 [hushan[胡珊]] Fix SPARK-4471: blockManagerIdFromJson function throws exception while metadata fetch failed

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Fix SPARK-4471: blockManagerIdFromJson function throws exception while B...
                </div><div><b>body:</b> Fix [SPARK-4471](https://issues.apache.org/jira/browse/SPARK-4471): blockManagerIdFromJson function throws exception while BlockManagerId be null in MetadataFetchFailedException

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Can one of the admins verify this patch?

              </div></li><li><div>
                ok to test

              </div></li><li><div>
                  [Test build #23625 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23625/consoleFull) for   PR 3340 at commit [`4030248`](https://github.com/apache/spark/commit/4030248740dfc5cb578d5d9417dfca3ad1b69458).
- This patch merges cleanly.

              </div></li><li><div>
                I see, the `blockManagerIdToJson` path handles this correctly, but not the `fromJson` path. LGTM once you fix the comments.

              </div></li><li><div>
                Hey @suyanNone can you rebase to master now? The tests here will fail because of a MiMa issue that is now fixed in master.

              </div></li><li><div>
                  [Test build #23625 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23625/consoleFull) for   PR 3340 at commit [`4030248`](https://github.com/apache/spark/commit/4030248740dfc5cb578d5d9417dfca3ad1b69458).
- This patch **fails MiMa tests**.
- This patch merges cleanly.
- This patch adds no public classes.

              </div></li><li><div>
                Test FAILed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23625/
Test FAILed.

              </div></li><li><div>
                retest this please

              </div></li><li><div>
                  [Test build #23646 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23646/consoleFull) for   PR 3340 at commit [`4030248`](https://github.com/apache/spark/commit/4030248740dfc5cb578d5d9417dfca3ad1b69458).
- This patch merges cleanly.

              </div></li><li><div>
                  [Test build #23646 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23646/consoleFull) for   PR 3340 at commit [`4030248`](https://github.com/apache/spark/commit/4030248740dfc5cb578d5d9417dfca3ad1b69458).
- This patch **passes all tests**.
- This patch merges cleanly.
- This patch adds no public classes.

              </div></li><li><div>
                Test PASSed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23646/
Test PASSed.

              </div></li><li><div>
                  [Test build #23657 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23657/consoleFull) for   PR 3340 at commit [`94b81e9`](https://github.com/apache/spark/commit/94b81e967879ab0e3b9a303aa1228750047a5a46).
- This patch merges cleanly.

              </div></li><li><div>
                  [Test build #23658 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23658/consoleFull) for   PR 3340 at commit [`e216ffa`](https://github.com/apache/spark/commit/e216ffaead983274428052caa992b20760b2c5e0).
- This patch **does not merge cleanly**.

              </div></li><li><div>
                  [Test build #23660 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23660/consoleFull) for   PR 3340 at commit [`4380d73`](https://github.com/apache/spark/commit/4380d73639a3c66d32a2d3f94b39157e1412193d).
- This patch merges cleanly.

              </div></li><li><div>
                Test FAILed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23659/
Test FAILed.

              </div></li><li><div>
                 = =! Sorry, made some mistakes, so recommit the changes.

              </div></li><li><div>
                  [Test build #23657 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23657/consoleFull) for   PR 3340 at commit [`94b81e9`](https://github.com/apache/spark/commit/94b81e967879ab0e3b9a303aa1228750047a5a46).
- This patch **passes all tests**.
- This patch merges cleanly.
- This patch adds no public classes.

              </div></li><li><div>
                Test PASSed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23657/
Test PASSed.

              </div></li><li><div>
                  [Test build #23658 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23658/consoleFull) for   PR 3340 at commit [`e216ffa`](https://github.com/apache/spark/commit/e216ffaead983274428052caa992b20760b2c5e0).
- This patch **passes all tests**.
- This patch **does not merge cleanly**.
- This patch adds no public classes.

              </div></li><li><div>
                Test PASSed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23658/
Test PASSed.

              </div></li><li><div>
                  [Test build #23660 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23660/consoleFull) for   PR 3340 at commit [`4380d73`](https://github.com/apache/spark/commit/4380d73639a3c66d32a2d3f94b39157e1412193d).
- This patch **passes all tests**.
- This patch merges cleanly.
- This patch adds no public classes.

              </div></li><li><div>
                Test PASSed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23660/
Test PASSed.

              </div></li><li><div>
                @andrewor14  Do I need to @ you to merge ? 

              </div></li><li><div>
                  [Test build #23775 has started](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23775/consoleFull) for   PR 3340 at commit [`159f9a3`](https://github.com/apache/spark/commit/159f9a3ad43caeb7af7c91a1f3c5c8faf561b087).
- This patch merges cleanly.

              </div></li><li><div>
                @andrewor14 , now OK?

              </div></li><li><div>
                  [Test build #23775 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/23775/consoleFull) for   PR 3340 at commit [`159f9a3`](https://github.com/apache/spark/commit/159f9a3ad43caeb7af7c91a1f3c5c8faf561b087).
- This patch **passes all tests**.
- This patch merges cleanly.
- This patch adds no public classes.

              </div></li><li><div>
                Test PASSed.
Refer to this link for build results (access rights to CI server needed): 
https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/23775/
Test PASSed.

              </div></li><li><div>
                Ok I'm merging this into 1.2 and master. Thanks.

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                let's even make a `MetadataFetchFailException` and call `toTaskEndReason` on it to simulate the real issue

              </div></li><li><div>
                Can you add a comment here

```
// On metadata fetch fail, block manager ID can be null (SPARK-4471)
```

              </div></li><li><div>
                hey actually why did you make this change?

              </div></li><li><div>
                should you just do something like

```
if (bm1 == null || bm2 == null) {
  assert(bm1 === null)
  assert(bm2 === null)
} else {
  assert(bm1.executorId === ...
  ...
}
```

              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>