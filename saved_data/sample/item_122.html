<!DOCTYPE html><html><div class="item-title">
        Item 122
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [SPARK-26003][SQL][2.4] Improve SQLAppStatusListener.aggregateMetrics performance
                </div><div><b>message:</b> [SPARK-26003][SQL][2.4] Improve SQLAppStatusListener.aggregateMetrics performance

This PR is to cherry-pick https://github.com/apache/spark/pull/23002 to Spark 2.4

---

## What changes were proposed in this pull request?

In `SQLAppStatusListener.aggregateMetrics`, we use the `metricIds` only to filter the relevant metrics. And this is a Seq which is also sorted. When there are many metrics involved, this can be pretty inefficient. The PR proposes to use a Set for it.

## How was this patch tested?

NA

Closes #23002 from mgaido91/SPARK-26003.

Closes #25860 from gatorsmile/cherrypickSPARK-26003.

Authored-by: Marco Gaido &lt;marcogaido91@gmail.com&gt;
Signed-off-by: Dongjoon Hyun &lt;dhyun@apple.com&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [SPARK-26003] Improve SQLAppStatusListener.aggregateMetrics performance
                </div><div><b>body:</b> ## What changes were proposed in this pull request?

In `SQLAppStatusListener.aggregateMetrics`, we use the `metricIds` only to filter the relevant metrics. And this is a Seq which is also sorted. When there are many metrics involved, this can be pretty inefficient. The PR proposes to use a Set for it.


## How was this patch tested?

NA

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                **[Test build #98683 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/98683/testReport)** for PR 23002 at commit [`7e79041`](https://github.com/apache/spark/commit/7e790412ed6409fdda96216dde7f4f408bb04a57).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                cc @cloud-fan @vanzin 
              </div></li><li><div>
                LGTM, also cc @gengliangwang 
              </div></li><li><div>
                **[Test build #98730 has finished](https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/98730/testReport)** for PR 23002 at commit [`031d512`](https://github.com/apache/spark/commit/031d512b84e0b84a1876c098e0842f13d37c38e8).
 * This patch passes all tests.
 * This patch merges cleanly.
 * This patch adds no public classes.
              </div></li><li><div>
                thanks, merging to master!
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Actually this one can be merged into `metricTypes`.
              </div></li><li><div>
                Consider also change the following `flatMap` / `filter`  / `groupBy` into `while` loop
              </div></li><li><div>
                not sure what you mean here. Why should we use a `while` loop?
              </div></li><li><div>
                If the metrics is large, then using a while loop can reduce the number of traversal loops. And it is not complicated to do it in the code here.
              </div></li><li><div>
                I am also fine with the current code here.
              </div></li><li><div>
                yes, we can save 1 traversal, but I am not sure it is worth honestly... This approach seems cleaner to me.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>