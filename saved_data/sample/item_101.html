<!DOCTYPE html><html><div class="item-title">
        Item 101
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Update Avro to 1.8.0 (#5015)
                </div><div><b>message:</b> Update Avro to 1.8.0 (#5015)

The druid parquet extensions uses Avro 1.8 and therefore it is
required to update the Avro version itself also to 1.8 to avoid
classpath conflicts
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li><li><div><div><b>title:</b> Update Avro to 1.8.0
                </div><div><b>body:</b> Hi guys,

Since we've updated in our Parquet contrib extension from Parquet 1.8.1 to 1.8.2, the dependancy on Avro updated from 1.7.6 to 1.8.0:
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.1
https://mvnrepository.com/artifact/org.apache.parquet/parquet-avro/1.8.2

Avro changelog: https://github.com/apache/avro/blob/master/CHANGES.txt#L274

Therefore I would like to update the Avro extension from 1.7.7 to 1.8.0 to get to the same version. We've deployed 0.10.1 on our acceptance servers and we ran into these classpath issues.

I had to rewrite the Generic writers to the specific ones because due to a bug in the Generic writer:
https://issues.apache.org/jira/browse/AVRO-1810
This should not impact Druid itself, since it only affects testcode.

Cheers, Fokko


                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Building locally and running (without hadoop), I'm able to read parquet data, generated using Spark:
`spark.read.json("quickstart/wikiticker-2015-09-12-sampled.json.gz").write.parquet("quickstart/wikiticker.parquet")`.

I had to add the java-snappy dependancy to read snappy compressed parquet. I'll try to get everything running on our acceptance environment.

```
Fokkos-MBP:druid-0.11.1-SNAPSHOT fokkodriesprong$ parquet-tools head quickstart/wikiticker.parquet/
added = 36
channel = #en.wikipedia
comment = added project
deleted = 0
delta = 36
isAnonymous = false
isMinor = false
isNew = false
isRobot = false
isUnpatrolled = false
namespace = Talk
page = Talk:Oswald Tilghman
time = 2015-09-12T00:46:58.771Z
user = GELongstreet

added = 17
channel = #ca.wikipedia
comment = Robot inserta {{Commonscat}} que enllaça amb [[commons:category:Rallicula]]
deleted = 0
delta = 17
isAnonymous = false
isMinor = true
isNew = false
isRobot = true
isUnpatrolled = false
namespace = Main
page = Rallicula
time = 2015-09-12T00:47:00.496Z
user = PereBot

added = 0
channel = #en.wikipedia
cityName = Auburn
comment = /* Status of peremptory norms under international law */ fixed spelling of 'Wimbledon'
countryIsoCode = AU
countryName = Australia
deleted = 0
delta = 0
isAnonymous = true
isMinor = false
isNew = false
isRobot = false
isUnpatrolled = false
namespace = Main
page = Peremptory norm
regionIsoCode = NSW
regionName = New South Wales
time = 2015-09-12T00:47:05.474Z
user = 60.225.66.142

added = 18
channel = #vi.wikipedia
comment = fix Lỗi CS1: ngày tháng
deleted = 0
delta = 18
isAnonymous = false
isMinor = true
isNew = false
isRobot = true
isUnpatrolled = false
namespace = Main
page = Apamea abruzzorum
time = 2015-09-12T00:47:08.770Z
user = Cheers!-bot

added = 18
channel = #vi.wikipedia
comment = clean up using [[Project:AWB|AWB]]
deleted = 0
delta = 18
isAnonymous = false
isMinor = false
isNew = false
isRobot = true
isUnpatrolled = false
namespace = Main
page = Atractus flammigerus
time = 2015-09-12T00:47:11.862Z
user = ThitxongkhoiAWB
```

Using job:
```
{
	"type": "index_hadoop",
	"spec": {
		"ioConfig": {
			"type": "hadoop",
			"inputSpec": {
				"type": "static",
				"inputFormat": "io.druid.data.input.parquet.DruidParquetInputFormat",
				"paths": "/tmp/druid/druid-0.11.1-SNAPSHOT/quickstart/wikiticker.parquet/*"
			}
		},
		"dataSchema": {
			"dataSource": "wikiticker",
			"granularitySpec": {
				"type": "uniform",
				"segmentGranularity": "day",
				"queryGranularity": "none",
				"intervals": ["2015-09-12/2015-09-13"]
			},
			"parser": {
				"type": "parquet",
				"parseSpec": {
                    "format": "timeAndDims",
					"dimensionsSpec": {
						"dimensions": [
							"channel",
							"cityName",
							"comment",
							"countryIsoCode",
							"countryName",
							"isAnonymous",
							"isMinor",
							"isNew",
							"isRobot",
							"isUnpatrolled",
							"metroCode",
							"namespace",
							"page",
							"regionIsoCode",
							"regionName",
							"user"
						]
					},
					"timestampSpec": {
						"format": "auto",
						"column": "time"
					}
				}
			},
			"metricsSpec": [{
					"name": "count",
					"type": "count"
				},
				{
					"name": "added",
					"type": "longSum",
					"fieldName": "added"
				},
				{
					"name": "deleted",
					"type": "longSum",
					"fieldName": "deleted"
				},
				{
					"name": "delta",
					"type": "longSum",
					"fieldName": "delta"
				},
				{
					"name": "user_unique",
					"type": "hyperUnique",
					"fieldName": "user"
				}
			]
		},
		"tuningConfig": {
			"type": "hadoop",
			"partitionsSpec": {
				"type": "hashed",
				"targetPartitionSize": 5000000
			},
			"jobProperties": {}
		}
	}
}
```
              </div></li><li><div>
                Test failure looks unrelated, re-running.
              </div></li><li><div>
                How stable is the build?
              </div></li><li><div>
                @Fokko there's one particular stubborn test: #2253. Looks like that one failed so I just retried it.
              </div></li><li><div><div><b>body:</b> @Fokko, re:

&gt; I had to add the java-snappy dependancy to read snappy compressed parquet. I'll try to get everything running on our acceptance environment.

Have you had a chance to test this on your acceptance environment? If so, the CI is passing now so it looks ready to me.
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                I need some time to test it, it will be either this or next week.
              </div></li><li><div>
                Okay, cool, please keep us posted.
              </div></li><li><div>
                I've rebased with master
              </div></li><li><div>
                Just ran an indexing job using `0.11.1-SNAPSHOT`. Works perfectly!
              </div></li><li><div>
                Thanks @Fokko!
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> GenericDatumWriter broken with Enum
                </div><div><b>description:</b> {panel:title=Description|titleBGColor=#3FA|bgColor=#DDD}
Using the GenericDatumWriter with either Generic OR SpecificRecord will break if an Enum is present.
{panel}

{panel:title=Steps To Reproduce|titleBGColor=#8DB|bgColor=#DDD}
I have been tracking Avro decoding oddities for a while.
The tests for this issue can be found [here|https://github.com/ryonday/avroDecodingHelp/blob/master/src/test/java/com/ryonday/test/Avro180EnumFail.java]
{panel}

{panel:title=Notes|titleBGColor=#3AF|bgColor=#DDD}
Due to the debacle that is the Avro "UTF8" object, we have been avoiding it by using the following scheme:

* Write incoming records to a byte array using the GenericDatumWriter
* Read back the byte array to our compiled Java domain objects using a SpecificDatumWriter

This worked great with Avro 1.7.7, and this is a binary-incompatable breaking change with 1.8.0.

This would appear to be caused by an addition in the {{GenericDatumWriter:163-164}}:

{code}
  if (!data.isEnum(datum))
      throw new AvroTypeException("Not an enum: "+datum);
{code}
{panel}

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                {quote}
Due to the debacle that is the Avro "UTF8" object, we have been avoiding it by using the following scheme:
{quote}

I am curious to hear what the debacle is, perhaps you could send a description to user@avro or dev@avro?

{quote}
This worked great with Avro 1.7.7, and this is a binary-incompatable breaking change with 1.8.0.
This would appear to be caused by an addition in the GenericDatumWriter:163-164:
{code}
  if (!data.isEnum(datum))
      throw new AvroTypeException("Not an enum: "+datum);
{code}
{quote}

This was the breaking change documented in AVRO-997.

The example in {{genericDatumWriter_andSpecificDatumWriter_failForGenericRecord_populatedWithTextualEnum}} is using Strings for enum types. Those should be GenericEnumSymbol, as documented in the [javadocs for type mapping|http://avro.apache.org/docs/1.8.0/api/java/org/apache/avro/generic/package-summary.html] and the release notes for AVRO-997.

The other two examples are based on what look like generated specific classes from [the schemas in your test project|https://github.com/ryonday/avroDecodingHelp/tree/master/src/main/avro], is that right?

If I build the test project at the top level is it straight forward to examine hte generated classes?
              </div></li><li><div>
                Thanks for the quick response!

Yes, doing a {{gradle build}} at the top level (assuming you use Gradle...) should result in the domain objects being built and output in the {{build/generated-main-avro-java}} directory. 

With respect to {{UTF8}} vs {{String}}, I regret my incendiary language there; it is just one of those things we have had to work around after a lot of {{ClassCastException}}s. 

We generate our domain objects using {{String}} and therefore interoperability with teams who don't do so is terrible (I am working on defining additional test cases that show that {{GenericData.deepCopy()}} and {{SpecificData.deepCopy()}} do not work in many cases, ending up something like this:

{code}
java.lang.ClassCastException: org.apache.avro.util.Utf8 cannot be cast to java.lang.String
	at our.package.domainObject.put(domainObject.java:151)
	at org.apache.avro.generic.GenericData.setField(GenericData.java:573)
	at org.apache.avro.generic.GenericData.setField(GenericData.java:590)
	at org.apache.avro.generic.GenericData.deepCopy(GenericData.java:972)
{code}
              </div></li><li><div><div><b>body:</b> This looks like an impedance mismatch between the Generic and Specific APIs. The Specific API generates bare java enums for avro enum types, while the Generic API now requires GenericEnumSymbol. (technically the switch to GenericEnumSymbol happened in 1.4.0, but enforcement has been inconsistent.)

Short term, the {{genericDatumWriter_failsForGenericRecord_populatedWithRawEnum}} test can be fixed similar to the string one by wrapping things in GenericData.EnumSymbol.

It looks like the root cause for your helper utility is that SpecificRecordBase claims to implement GenericRecord, but then returns the raw java enums for the two avro enum fields rather than the correct o.a.avro.generic type.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Sup Sean, getting burned by this:

{code}
org.apache.avro.AvroTypeException: Not an enum: UNIT
	at org.apache.avro.generic.GenericDatumWriter.writeEnum(GenericDatumWriter.java:164)
	at org.apache.avro.generic.GenericDatumWriter.writeWithoutConversion(GenericDatumWriter.java:106)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:73)
	at org.apache.avro.generic.GenericDatumWriter.writeField(GenericDatumWriter.java:153)
	at org.apache.avro.generic.GenericDatumWriter.writeRecord(GenericDatumWriter.java:143)
	at org.apache.avro.generic.GenericDatumWriter.writeWithoutConversion(GenericDatumWriter.java:105)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:73)
	at org.apache.avro.generic.GenericDatumWriter.writeField(GenericDatumWriter.java:153)
	at org.apache.avro.generic.GenericDatumWriter.writeRecord(GenericDatumWriter.java:143)
	at org.apache.avro.generic.GenericDatumWriter.writeWithoutConversion(GenericDatumWriter.java:105)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:73)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:60)
	at org.apache.avro.file.DataFileWriter.append(DataFileWriter.java:302)
{code}

Looks like enums have to subclass [GenericEnumSymbol|https://github.com/apache/avro/blob/master/lang/java/avro/src/main/java/org/apache/avro/generic/GenericData.java#L800]. Fair enough. But, it looks like the class auto-generation tools that we're using are not putting that into the schema. We're using:

{code}
                 &lt;plugin&gt;
  &lt;groupId&gt;org.apache.avro&lt;/groupId&gt;
  &lt;artifactId&gt;avro-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;${avro.version}&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;schema&lt;/goal&gt;
        &lt;goal&gt;protocol&lt;/goal&gt;
        &lt;goal&gt;idl-protocol&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;fieldVisibility&gt;PRIVATE&lt;/fieldVisibility&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
{code}

But it generates:

{code}
@org.apache.avro.specific.AvroGenerated
public enum EntityType { // LOOK MA, NO INTERFACE
  LISTING, UNIT  ;
  public static final org.apache.avro.Schema SCHEMA$ = new org.apache.avro.Schema.Parser().parse("{\"type\":\"enum\",\"name\":\"EntityType\",\"namespace\":\"com.homeaway.commons.logging.events.lm\",\"symbols\":[\"LISTING\",\"UNIT\"]}");
  public static org.apache.avro.Schema getClassSchema() { return SCHEMA$; }
}
{code}

For now, rolling back to {{1.7.7}}, but that does seem brokenish.

              </div></li><li><div>
                That does seem broken. Could you share a code snippet that results in the stacktrace?
              </div></li><li><div><div><b>body:</b> I hit this issue when serializing a SpecificRecord (generated from idl) with a GenericDatumWriter.

Everything works fine when serializing withe SpecificDatumWriter, but since all generated avro records implement GenericRecord I don't see why they should not be serializable with a GenericDatumWriter...

I see 2 ways to fix this:

1) make GenericDatumWriter handle java enums.
2) make the generated enums (like Reuben suggested) implement GenericEnumSymbol.

I used approach 1 to fix my fork.

I am not sure the separation between GenericRecord and SpecificRecords reader/writers is ideal...

For example I wrote some utilities to on the fly generate Generic Data like:

https://github.com/zolyfarkas/spf4j/blob/master/spf4j-avro/src/main/java/org/spf4j/avro/GenericRecordBuilder.java

how to use:

https://github.com/zolyfarkas/spf4j/blob/master/spf4j-avro/src/test/java/org/spf4j/avro/GenericRecordBuilderTest.java

This is still beta quality, but the results are slightly more efficient (10%) GenericRecord implementations. (see JMH benchmark: https://github.com/zolyfarkas/spf4j/blob/master/spf4j-benchmarks/src/test/java/org/spf4j/avro/GenericRecordBenchmark.java)


                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I'm seeing this as well.... basically SpecificRecords generated by maven plugin in 1.8.1 don't satisfy contract for GenericRecord wrt enums. Rolling back to 1.7.7 works.
              </div></li><li><div>
                Grabbed Spring Platform Athens SR1 which specifies 1.8.1 of Avro, and hibernate search threw this error, downgrading to 1.7.7 works.
              </div></li><li><div>
                This issue means that the Avro 1.8 release ist practically unusable in conjunction with Kafka Connect, which I think affects quite a lot of users. Any plans on fixing this? 

Any workarounds other than
* don't use enums in your schema or
* downgrade to Avro 1.7.7?
              </div></li><li><div>
                Personally I'd love to see this get fixed. I'm happy to review, but almost certainly don't have the time to post a patch up. If anyone wants to try to work through things please either ping here or ping me off-list and I'll help get you up and running.
              </div></li><li><div>
                The way I resolved this in my fork was to make the Generated enums implement org.apache.avro.generic.GenericEnumSymbol:

https://github.com/zolyfarkas/avro/blob/trunk/lang/java/compiler/src/main/velocity/org/apache/avro/compiler/specific/templates/java/classic/enum.vm#L29

Also changed GenericEnumSymbol from:

{code}
/** An enum symbol. */
public interface GenericEnumSymbol
    extends GenericContainer, Comparable&lt;GenericEnumSymbol&gt; {
  /** Return the symbol. */
  String toString();
}
{code}

to:

{code}
/** An enum symbol. */
public interface GenericEnumSymbol&lt;T extends GenericEnumSymbol&gt;
    extends GenericContainer, Comparable&lt;T&gt; {
  /** Return the symbol. */
  String toString();
}
{code}

I can prepare a PR if this approach is OK with everyone.

              </div></li><li><div><div><b>body:</b> [~zolyfarkas] Would it be bad to interoperate {{GenericData.EnumSymbol}} instances with generated classes in terms of {{equals}} and {{compareTo}}?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                [~howellbridger] 
java.lang.Enum equals, hashCode, compareTo are final and cannot be overloaded... 

So if one would need to compare generated enums with generic enums a custom comparator would be the way...

what is the use case you are thinking of?


              </div></li><li><div>
                No particular use case, I was just looking at the way that {{GenericData.EnumSymbol}} supports being compared with any other {{GenericEnumSymbol}} and wondering if there was a good reason for that.

Considering that {{equals}} is final for enums, it seems harder to keep that property (although {{compareTo}} should be fine because the type signatures for {{java.lang.Enum}}'s {{compareTo}} only matches the enum type, not {{GenericEnumSymbol}}?).

At least It would be nice to avoid weird cases where the following test fails:
{noformat}
/* assuming SpecificEnum is generated from enumSchema */
final SpecificEnum specificSymbol = SpecificEnum.FOO;
final GenericData.EnumSymbol genericSymbol = new GenericData.EnumSymbol(enumSchema, "FOO");

assertTrue(genericSymbol.equals(specificSymbol) == specificSymbol.equals(genericSymbol));
{noformat}
              </div></li><li><div>
                [~zolyfarkas] - How has the use of your branch been in the past months? I am interested in having this ticket revived as this is something that I will also be needing to do. Is there anything I could do to help?
              </div></li><li><div>
                Commit 4a3609cd854e9ef5bdda5b43e188a3309a93aef9 in avro's branch refs/heads/master from ivangreene
[ https://gitbox.apache.org/repos/asf?p=avro.git;h=4a3609c ]

AVRO-1810: Fix GenericDatumWriter w/ enums (#462)


              </div></li><li><div>
                FAILURE: Integrated in Jenkins build AvroJava #612 (See [https://builds.apache.org/job/AvroJava/612/])
AVRO-1810: Fix GenericDatumWriter w/ enums (#462) (fokko: [https://github.com/apache/avro/commit/4a3609cd854e9ef5bdda5b43e188a3309a93aef9])
* (edit) lang/java/tools/src/test/compiler/output-string/Position.java
* (edit) lang/java/tools/src/test/compiler/output/Position.java
* (add) lang/java/avro/src/test/java/org/apache/avro/generic/TestGenericConcreteEnum.java
* (edit) lang/java/compiler/src/main/velocity/org/apache/avro/compiler/specific/templates/java/classic/enum.vm
* (edit) lang/java/avro/src/main/java/org/apache/avro/generic/GenericEnumSymbol.java
* (edit) lang/java/avro/src/test/java/org/apache/avro/TypeEnum.java
* (edit) lang/java/avro/src/main/java/org/apache/avro/generic/GenericData.java
* (edit) lang/java/tools/src/test/compiler/output-string/avro/examples/baseball/Position.java

              </div></li><li><div>
                Would it be possible to have a backport release of this in 1.8x?&nbsp; I would rather not have to upgrade to 1.9x just for this since I may have to pull in jars compiled w/ 1.8 in the project.&nbsp;
              </div></li></ol></div></div></html>