<!DOCTYPE html><html><div class="item-title">
        Item 166
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 flip switch and check that the previous state is returned
              </div></li><li><div>
                 disable cleaner_chore and check that the previous state is returned
              </div></li><li><div>
                 check that cleaner_chore_enabled returns the current state
              </div></li><li><div>
                 disable snapshot cleanup and check that the previous state is returned
              </div></li><li><div>
                 disable normalizer and check that the previous state is returned
              </div></li><li><div>
                 enable balancer and check that the previous state is returned
              </div></li><li><div>
                -------------------------------------------------------------------------------
              </div></li><li><div>
                 enable normalizer and check that the previous state is returned
              </div></li><li><div>
                 disable balancer and check that the previous state is returned
              </div></li><li><div>
                 Author's note: All the other feature switches in hbase-shell only toggle one feature. This command operates on
 both the "SPLIT" and "MERGE", so you will note that both code paths need coverage.
              </div></li><li><div>
                 enable snapshot cleanup and check that the previous state is returned
              </div></li><li><div>
                 check that balancer_enabled returns the current state
              </div></li><li><div>
                 check that normalizer_enabled returns the current state
              </div></li><li><div>
                 enable cleaner_chore and check that the previous state is returned
              </div></li><li><div>
                 disable catalogjanitor and check that the previous state is returned
              </div></li><li><div>
                 check that splitormerge_enabled returns the current state
              </div></li><li><div>
                 check that snapshot_cleanup_enabled returns the current state
              </div></li><li><div>
                 enable catalogjanitor and check that the previous state is returned
              </div></li><li><div>
                 check that catalogjanitor_enabled returns the current state
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HBASE-24722 Update commands with unintentional return values (#2058)
                </div><div><b>message:</b> HBASE-24722 Update commands with unintentional return values (#2058)

- Prior to this commit, there were 13 commands that unintentionally return the
  number of lines they print (usually one). This commit ensures that they
  return the value documented by the help text, or nil if there is not a simple
  logical value to return.
- Fixes 6 hbase-shell commands that return String rather than TrueClass or
  FalseClass
- Use double-bang to cast truthy values to TrueClass and FalseClass so that
  ruby's to_s can reliably print true or false without using ternary operators
- Updates tests for is_disabled, is_enabled, disable_rpc_throttle,
  enable_rpc_throttle, disable_exceed_throttle_quota,
  enable_exceed_throttle_quota, clear_deadservers, snapshot_cleanup_switch,
  snapshot_cleanup_enabled, and balancer to check return values
- Adds new tests for balance_switch, balancer_enabled, normalizer_switch,
  normalizer_enabled, catalog_janitor_switch, catalogjanitor_enabled,
  cleaner_chore_switch, cleaner_chore_enabled, splitormerge_switch, and
  splitormerge_enabled

signed-off-by: stack &lt;stack@apache.org&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> HBASE-24722 Address hbase-shell commands with unintentional return values
                </div><div><b>body:</b> Resolves https://issues.apache.org/jira/browse/HBASE-24722

## Changelog

- Prior to this commit, there were 13 commands that unintentionally return the
  number of lines they print (usually one). This commit ensures that they
  return the value documented by the help text, or nil if there is not a simple
  logical value to return.
- Fixes 6 hbase-shell commands that return String rather than TrueClass or
  FalseClass
- Use double-bang to cast truthy values to TrueClass and FalseClass so that
  ruby's to_s can reliably print true or false without using ternary operators
- Updates tests for is_disabled, is_enabled, disable_rpc_throttle,
  enable_rpc_throttle, disable_exceed_throttle_quota,
  enable_exceed_throttle_quota, clear_deadservers, snapshot_cleanup_switch,
  snapshot_cleanup_enabled, and balancer to check return values
- Adds new tests for balance_switch, balancer_enabled, normalizer_switch,
  normalizer_enabled, catalog_janitor_switch, catalogjanitor_enabled,
  cleaner_chore_switch, cleaner_chore_enabled, splitormerge_switch, and
  splitormerge_enabled

_Note that the many assertions with explicit comparisons to booleans are intentional (ie. `assert(return_value == false)`). In ruby, this test makes sure that return value is actually an instance of TrueClass or FalseClass, which makes these tests much more potent. Since every ruby object can be cast to a boolean, we don't want to just `assert(return_value)`._

## Testing

- Of the 19 commands updated, 17 are covered by unit testing (a number of the unit tests are introduced by this PR).
- I manually tested my changes to the 2 commands not covered by unit tests: normalize and clear_block_cache. I'd love to get these commands covered as well, but I believe that is out of scope for this ticket since testing those commands should be a little more extensive.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                :confetti_ball: **+1 overall**






| Vote | Subsystem | Runtime | Comment |
|:----:|----------:|--------:|:--------|
| +0 :ok: |  reexec  |   0m 30s |  Docker mode activated.  |
||| _ Prechecks _ |
| +1 :green_heart: |  dupname  |   0m  0s |  No case conflicting files found.  |
| +1 :green_heart: |  @author  |   0m  0s |  The patch does not contain any @author tags.  |
||| _ master Compile Tests _ |
||| _ Patch Compile Tests _ |
| -0 :warning: |  rubocop  |   0m 57s |  The patch generated 25 new + 300 unchanged - 6 fixed = 325 total (was 306)  |
| +1 :green_heart: |  whitespace  |   0m  0s |  The patch has no whitespace issues.  |
||| _ Other Tests _ |
| +1 :green_heart: |  asflicense  |   0m 12s |  The patch does not generate ASF License warnings.  |
|  |   |   2m 58s |   |


| Subsystem | Report/Notes |
|----------:|:-------------|
| Docker | Client=19.03.12 Server=19.03.12 base: https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/artifact/yetus-general-check/output/Dockerfile |
| GITHUB PR | https://github.com/apache/hbase/pull/2058 |
| Optional Tests | dupname asflicense rubocop |
| uname | Linux 262dd5130c9e 4.15.0-58-generic #64-Ubuntu SMP Tue Aug 6 11:12:41 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | dev-support/hbase-personality.sh |
| git revision | master / 3bd54217a0 |
| rubocop | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/artifact/yetus-general-check/output/diff-patch-rubocop.txt |
| Max. process+thread count | 51 (vs. ulimit of 12500) |
| modules | C: hbase-shell U: hbase-shell |
| Console output | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/console |
| versions | git=2.17.1 maven=(cecedd343002696d0abb50b32b541b8a6ba2883f) rubocop=0.80.0 |
| Powered by | Apache Yetus 0.11.1 https://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                :confetti_ball: **+1 overall**






| Vote | Subsystem | Runtime | Comment |
|:----:|----------:|--------:|:--------|
| +0 :ok: |  reexec  |   0m 24s |  Docker mode activated.  |
| -0 :warning: |  yetus  |   0m  2s |  Unprocessed flag(s): --brief-report-file --spotbugs-strict-precheck --whitespace-eol-ignore-list --whitespace-tabs-ignore-list --quick-hadoopcheck  |
||| _ Prechecks _ |
||| _ master Compile Tests _ |
| +1 :green_heart: |  mvninstall  |   4m  1s |  master passed  |
| +1 :green_heart: |  javadoc  |   0m 14s |  master passed  |
||| _ Patch Compile Tests _ |
| +1 :green_heart: |  mvninstall  |   3m 43s |  the patch passed  |
| +1 :green_heart: |  javadoc  |   0m 12s |  the patch passed  |
||| _ Other Tests _ |
| +1 :green_heart: |  unit  |   6m 52s |  hbase-shell in the patch passed.  |
|  |   |  16m 29s |   |


| Subsystem | Report/Notes |
|----------:|:-------------|
| Docker | Client=19.03.12 Server=19.03.12 base: https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/artifact/yetus-jdk8-hadoop3-check/output/Dockerfile |
| GITHUB PR | https://github.com/apache/hbase/pull/2058 |
| Optional Tests | javac javadoc unit |
| uname | Linux 0bf0ae7cf57d 4.15.0-101-generic #102-Ubuntu SMP Mon May 11 10:07:26 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | dev-support/hbase-personality.sh |
| git revision | master / 3bd54217a0 |
| Default Java | 1.8.0_232 |
|  Test Results | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/testReport/ |
| Max. process+thread count | 1528 (vs. ulimit of 12500) |
| modules | C: hbase-shell U: hbase-shell |
| Console output | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/console |
| versions | git=2.17.1 maven=(cecedd343002696d0abb50b32b541b8a6ba2883f) |
| Powered by | Apache Yetus 0.11.1 https://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                :confetti_ball: **+1 overall**






| Vote | Subsystem | Runtime | Comment |
|:----:|----------:|--------:|:--------|
| +0 :ok: |  reexec  |   1m 43s |  Docker mode activated.  |
| -0 :warning: |  yetus  |   0m  3s |  Unprocessed flag(s): --brief-report-file --spotbugs-strict-precheck --whitespace-eol-ignore-list --whitespace-tabs-ignore-list --quick-hadoopcheck  |
||| _ Prechecks _ |
||| _ master Compile Tests _ |
| +1 :green_heart: |  mvninstall  |   6m  3s |  master passed  |
| +1 :green_heart: |  javadoc  |   0m 18s |  master passed  |
||| _ Patch Compile Tests _ |
| +1 :green_heart: |  mvninstall  |   5m 56s |  the patch passed  |
| +1 :green_heart: |  javadoc  |   0m 15s |  the patch passed  |
||| _ Other Tests _ |
| +1 :green_heart: |  unit  |   8m 27s |  hbase-shell in the patch passed.  |
|  |   |  24m  5s |   |


| Subsystem | Report/Notes |
|----------:|:-------------|
| Docker | Client=19.03.12 Server=19.03.12 base: https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/artifact/yetus-jdk11-hadoop3-check/output/Dockerfile |
| GITHUB PR | https://github.com/apache/hbase/pull/2058 |
| Optional Tests | javac javadoc unit |
| uname | Linux 0c0286776f12 4.15.0-101-generic #102-Ubuntu SMP Mon May 11 10:07:26 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | dev-support/hbase-personality.sh |
| git revision | master / 3bd54217a0 |
| Default Java | 2020-01-14 |
|  Test Results | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/testReport/ |
| Max. process+thread count | 1603 (vs. ulimit of 12500) |
| modules | C: hbase-shell U: hbase-shell |
| Console output | https://builds.apache.org/job/HBase-PreCommit-GitHub-PR/job/PR-2058/1/console |
| versions | git=2.17.1 maven=(cecedd343002696d0abb50b32b541b8a6ba2883f) |
| Powered by | Apache Yetus 0.11.1 https://yetus.apache.org |


This message was automatically generated.


              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Does it make sense to put this pattern in a method?
              </div></li><li><div>
                I think the simple implementation to encapsulate this pattern would be strange. I would rather leave this as is, and revisit the formatter more holistically as a separate ticket.
              </div></li><li><div>
                Makes sense, can you create the follow-on issue and leave a short description?
              </div></li><li><div>
                Will do! :smile:
              </div></li><li><div>
                Nice idiom convertion (java to ruby)
              </div></li><li><div>
                formatter.row returns void? Different to nil?
              </div></li><li><div>
                Bug fix?
              </div></li><li><div>
                Sweet
              </div></li><li><div>
                formatter.row returns the running total number of rows printed (`@row_count`) since the last call to formatter.header
              </div></li><li><div>
                This is just a change to collect all the server names as an array so that we can both print and return the list of servers that could not be cleared
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>