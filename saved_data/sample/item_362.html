<!DOCTYPE html><html><div class="item-title">
        Item 362
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 We would like to make sure that ORC reading overrides this config, so reading Iceberg tables could work in
 systems (like Hive 3.2 and higher) where this value is set to true explicitly.
              </div></li><li><div>
                 Create a copy of the HiveConf for the metastore
              </div></li><li><div>
                 We need to turn positional schema evolution off since we use column name based schema evolution for projection
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Hive: Fix ORC projection with orc.force.positional.evolution=true (#2111)
                </div><div><b>message:</b> Hive: Fix ORC projection with orc.force.positional.evolution=true (#2111)


                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li><li><div><div><b>title:</b> ORC, Hive: Fix column projection when reading ORC files and `orc.force.positional.evolution` is set to `true` on the default configuration
                </div><div><b>body:</b> After this change (_[HIVE-20129](https://issues.apache.org/jira/browse/HIVE-20129) Revert to position based schema evolution for orc tables_) in Hive the Iceberg ORC column projection is not working as expected.

The effect:
- If the table has 3 columns (customer_id, first_name, last_name)
- And the query requests the last 2 columns (first_name, last_name)
- We will read the first 2 (customer_id, first_name) instead of the requested ones

I think it would be good to turn off this config for our Iceberg ORC readers as we expect it to be false anyway and other systems using Iceberg might need it to be set differently.

The patch contains 3 groups of changes:
- Test infra changes so we can change HMS configuration (this is used for HiveCatalog FileIO creation)
- Actually setting the `orc.force.positional.evolution` to `true` in the tests - this causes `TestHiveIcebergStorageHandlerLocalScan.testColumnSelection()` to fail
- Setting `orc.force.positional.evolution` to `false` in `ORC.ReadBuilder` to override the configuration values to the expected one - tis fixes the test failures
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                If I understand correctly, the id-based projection requests fields by name and if the projection type is changed in the Hive conf, that causes the wrong projection. Right? If so, then I agree with the fix to set this in the conf that we use for readers.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> Can you add a comment for this that explains why it is set for the Hive tests? I think it could be confusing later that this is explicitly set to true, only to be overridden by ORC when creating a reader.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> Nit: if `initConf` returned the configuration, this could be one line still: `this.hiveConf = initConf(conf, port);`
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Is this change needed? `start()` is still defined and uses `HiveMetastoreTest.class`. The only difference is that this doesn't pass a `Configuration` and the parameterless `start` passes `new Configuration()`.
              </div></li><li><div>
                Good point!
Added the comment
              </div></li><li><div>
                Before the change the configuration was created in `newHiveConf()`. The new method changes values in the conf parameter. The change meant to emphasize that we are not creating a new conf, only changing values in the one got in the parameter list.

Shall we move back to create a new config and initialize that?
              </div></li><li><div>
                Yeah... that is something I forgot to revert.
Thanks for noticing!

Removed the change.
              </div></li><li><div>
                If conf is passed in, I think the change to `initConf` makes sense. I just think the patch could be slightly smaller. Not a blocker, though.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Revert to position based schema evolution for orc tables
                </div><div><b>description:</b> Hive has been doing positional based schema evolution.&nbsp;ORC-54 changed it to column name based schema evolution causing unexpected results. Queries returned results earlier are now returning no results. Change the default in hive to positional schema evolution.&nbsp;
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                +1
              </div></li><li><div>
                +1
              </div></li><li><div>
                Previous patch failed because of github outage.&nbsp;Rebased patch.&nbsp;
              </div></li><li><div>
                | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 52s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 16s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 15s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 30s{color} | {color:blue} common in master has 64 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 13s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 17s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 16s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 16s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 15s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 38s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 13s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 13s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 11m 23s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-12520/dev-support/hive-personality.sh |
| git revision | master / b574bcd |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| modules | C: common U: common |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-12520/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.


              </div></li><li><div>
                

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12931033/HIVE-20129.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:green}SUCCESS:{color} +1 due to 14642 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/12520/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/12520/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-12520/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12931033 - PreCommit-HIVE-Build
              </div></li><li><div>
                Committed to branch-3 and master. Thanks for the review!
              </div></li></ol></div></div></html>