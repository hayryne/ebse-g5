<!DOCTYPE html><html><div class="item-title">
        Item 124
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                * rename 
              </div></li><li><div>
                * concat 
              </div></li><li><div>
                * delete 
              </div></li><li><div>
                * renameSnapshot 
              </div></li><li><div>
                * createSnapshot operaiton 
              </div></li><li><div>
                * create file operation (without OverWrite) 
              </div></li><li><div>
                * append operation 
              </div></li><li><div>
                * createSymlink 
              </div></li><li><div>
                 append to the file and leave the last block under construction
              </div></li><li><div>
                * updatePipeline 
              </div></li><li><div>
                 make sure the client's call has actually been handled by the active NN
              </div></li><li><div>
                 check if the inode of the file is under construction
              </div></li><li><div>
                * rename2 
              </div></li><li><div>
                * deleteSnapshot 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HDFS-5045. Merge change r1516348 from trunk.
                </div><div><b>message:</b> HDFS-5045. Merge change r1516348 from trunk.

git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/branches/branch-2@1516349 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Add more unit tests for retry cache to cover all AtMostOnce methods
                </div><div><b>description:</b> 
                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                An initial patch covering all the AtMostOnce methods except saveNamespace and updatePipeline.
              </div></li><li><div>
                Update the patch:
1. Add timeout for each test
2. Add unit test for updatePipeline

For ClientProtocol#saveNamespace, because we do not record this operation in editlog, its retry cache will not work when NN failover happens (but works in a single NN for RPC response loss over the network). Thus we do not plan to add test for saveNamespace here.
              </div></li><li><div>
                {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12599021/HDFS-5045.002.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/4863//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/4863//console

This message is automatically generated.
              </div></li><li><div><div><b>body:</b> Hi, Jing.  The new tests look great.  I ran them multiple times on Windows, and everything worked as expected.

I have a minor comment about this:

{code}
  private final Map&lt;String, Object&gt; results = new HashMap&lt;String, Object&gt;();
{code}

It seems unnecessary for {{results}} to be a member variable storing the results of all ops from all tests.  Each particular op result only gets accessed within the scope of one invocation of {{testClientRetryWithFailover}}, so I think this could move to a local variable within {{testClientRetryWithFailover}}.  It could be {{final Map&lt;String, Object&gt;}}, or it could just be {{final Mutable&lt;Object&gt;}}, considering that the value is the only important part to remember and the key would be redundant with {{op.name}}.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Thanks for the review Chris! Update the patch to address your comments.
              </div></li><li><div>
                +1 pending successful test-patch run on the new patch.  Thanks, Jing!

Jenkins doesn't seem to be picking up new patches automatically.  I see failures in the admin job that drives pre-commit checks.  I submitted a manual run for this issue:

https://builds.apache.org/job/PreCommit-HDFS-Build/4868/

              </div></li><li><div>
                {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12599293/HDFS-5045.003.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/4868//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/4868//console

This message is automatically generated.
              </div></li><li><div>
                Thanks again for the review Chris! I've committed this to trunk, branch-2, branch-2.1-beta.
              </div></li><li><div>
                SUCCESS: Integrated in Hadoop-trunk-Commit #4307 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/4307/])
HDFS-5045. Add more unit tests for retry cache to cover all AtMostOnce methods. Contributed by Jing Zhao. (jing9: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1516348)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/ha/TestRetryCacheWithHA.java

              </div></li><li><div>
                SUCCESS: Integrated in Hadoop-Yarn-trunk #309 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/309/])
HDFS-5045. Add more unit tests for retry cache to cover all AtMostOnce methods. Contributed by Jing Zhao. (jing9: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1516348)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/ha/TestRetryCacheWithHA.java

              </div></li><li><div>
                SUCCESS: Integrated in Hadoop-Hdfs-trunk #1499 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1499/])
HDFS-5045. Add more unit tests for retry cache to cover all AtMostOnce methods. Contributed by Jing Zhao. (jing9: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1516348)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/ha/TestRetryCacheWithHA.java

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Mapreduce-trunk #1526 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1526/])
HDFS-5045. Add more unit tests for retry cache to cover all AtMostOnce methods. Contributed by Jing Zhao. (jing9: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1516348)
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSClient.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/ha/TestRetryCacheWithHA.java

              </div></li></ol></div></div></html>