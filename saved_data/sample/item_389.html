<!DOCTYPE html><html><div class="item-title">
        Item 389
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License.
              </div></li><li><div>
                
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License.

              </div></li><li><div>
                 flake8: noqa
 out of order import to avoid circular deps
              </div></li><li><div>
                 not None check here to ensure MagicMocks aren't treated as None
              </div></li><li><div>
                 Object hasn't been created yet, can't refresh.
              </div></li><li><div>
                 type: ignore
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Python: Support creating tables (#1216)
                </div><div><b>message:</b> Python: Support creating tables (#1216)


                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [Python] create table support
                </div><div><b>body:</b> First step in write support for python.

Adds support &amp; tests for create on:
* `HiveTables`
* `FilesystemTables`
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Should be  merged after #1214 
              </div></li><li><div>
                I merged #1214. Could you please rebase this one? Thanks!
              </div></li><li><div>
                &gt; I merged #1214. Could you please rebase this one? Thanks!

:+1: rebased and ready for review!
              </div></li><li><div>
                Hey @danielcweeks &amp; @rdblue anyone have some time to take a peek at this?
              </div></li><li><div>
                @rymurr, I should be able to review it this week and hopefully tomorrow.
              </div></li><li><div>
                @rymurr, overall this looks good to me. We might want to make it more pythonic in areas, like relying on `if reference` instead of `if reference is not None`, but those are minor.

Have you tested this in practice by actually connecting to a Hive Metastore? It looks like the tests only mock the behavior. We might want to repurpose some of the Java test code to run a metastore for the duration of python testing from a script.
              </div></li><li><div>
                thanks for the review @rdblue! I have addressed your comments and made the code more pythonic. For some odd reason I thought keeping python close to Java was a good idea when I first raised the PR :-)

As for the metastore tests: adding an integration test with HMS has proved slightly more annoying than I hoped so we can either leave this open while I work on it or I can add it as part of another PR later
              </div></li><li><div>
                @rymurr, thanks for the update. I think this is fine to commit without the integration tests, as long as someone has tested it by hand to make sure it actually works to create tables in Hive. It works, right?
              </div></li><li><div>
                &gt; It works, right?

This comment made my morning :)


              </div></li><li><div>
                &gt; &gt; It works, right?
&gt; 
&gt; This comment made my morning :)

Thanks @jacques-n  :rofl:  and yes @rdblue it is working :-)
              </div></li><li><div>
                Everything looks good to me. There are a couple of minor things, like still having the Hive types defined (I'm not sure if you intended to remove those). Tests are passing except what looks like a flaky test in Java.
              </div></li><li><div>
                fixed the build error, should be good to go now :-)
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                In `load`, the number of items returned is checked. Should that be done here as well?
              </div></li><li><div>
                I'm getting a warning about PEP 8 and limiting lines to 120 chars. Is that something we want to do in Python?

Seems to make sense to me to limit lines to 120.
              </div></li><li><div>
                Minor: if we add types, the docs are better. For example, changing this to `table_identifier: str` made it so that documentation for `str.rsplit` is found, at least in PyCharm. We should probably start adding types where it makes sense, like in the base class `Tables`.

Not something we need to do in this commit, but it really helps reviewing.
              </div></li><li><div>
                I agree with using table_identifier here. Should we also rename it in `load` since the location is the table identifier for FS tables?
              </div></li><li><div>
                Couldn't this just be `if self.current_metadata_location`? I think both `None` and `""` evaluate to `False` in python if statements.
              </div></li><li><div>
                I think you can probably embed this method in `unlock`. I think the `doUnlock` method in Java is only there because of the use of `Optional` for a lock id.
              </div></li><li><div>
                Nit: I think `timedOut` would be a better name?
              </div></li><li><div>
                Since this is identical to the fall through case, can this be `pass` instead?
              </div></li><li><div>
                agreed, fixed
              </div></li><li><div>
                I agree, I have added types in places where this PR has made changes. Hopefully we can build full type coverage over time rather than having someone slog through the code base and add them individually
              </div></li><li><div>
                yes, fixed
              </div></li><li><div>
                yeah, its strange it wasn't caught by flake8. Fixed now
              </div></li><li><div>
                correct, fixed
              </div></li><li><div>
                yup, fixed
              </div></li><li><div>
                agreed, fixed
              </div></li><li><div>
                agreed
              </div></li><li><div>
                I'm not sure I understand this comment. Will a mock object evaluate to `False` in an if?
              </div></li><li><div>
                I think this does need to be the metadata file location and not the table location.
              </div></li><li><div>
                just wasn't mocked correctly, fixed now and removed the `is not None` check
              </div></li><li><div>
                I don't really like the idea of exposing hive types through Iceberg types natively.  Seems like we should externalize this and have a separate hive&lt;-&gt;iceberg type mapping utility class/function.
              </div></li><li><div>
                `metadataFileLocation` is the Java name, `location` is the Python name. Same value though.
              </div></li><li><div>
                That seems confusing to me. How do you get the table's base location in Python?
              </div></li><li><div>
                agreed. thats a good point. Thats fixed.
              </div></li><li><div>
                ahh, i see now. It appears that the Java and Python impls are a bit out of sync. Python doesn't use `file` at all, which is where java takes its location from. Will look at figuring out what happened there and update the PR this eve or tomorrow
              </div></li><li><div>
                should be good to go now @rdblue, we had missed a property in `TableMetadata` in python 
              </div></li><li><div>
                I don't see this `hive_name` property used anywhere. Did you mean to remove these changes from types?
              </div></li><li><div>
                Should we check that `location is None` to ensure that a user doesn't pass both a table identifier (location) and a different location?
              </div></li><li><div>
                This doesn't agree with what is enforced. I like that `location` must always be `None` in the code so it would be good to state that here. It would also be easier to read since it avoids "should be not None".
              </div></li><li><div>
                yup, apologies. Changed my mind halfway through impl. Fixed now
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>