<!DOCTYPE html><html><div class="item-title">
        Item 284
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 TODO the first part of this check should be removed.
 because a restarted server will probably have the same
 membership port as it had in its last incarnation, causing
 delays in removing the old member ID from the view.
 be watched again
              </div></li><li><div>
                 Bundling is mostly only useful if we're doing no-ack work,
 which is fairly rare
              </div></li><li><div>
                 GemFire uses its own reply processors so there is no need
 to maintain message order
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> GEODE-77: minor bug fixes
                </div><div><b>message:</b> GEODE-77: minor bug fixes

Member weights were not being installed into member identifiers, nor serialized with them.  This wasn't an issue with GemFire because the weights were only important for JGroups IpAddresses but we now use Geode member IDs in membership views so the weights need to be included.

During startup if a member was told to become the membership coordinator it wasn't correctly setting its membership ID's view ID.  This caused some unnecessary confusion in other members.

During view preparation we don't wait for acks from members who are going to be removed in the next view but we weren't aborting the view when this happened.  This caused us to not detect a network partition.  The reply processor now adds these member IDs to the set of members that didn't respond to view preparation.

Multicast testing showed that JGroups was not dispatching a received message, probably due to problems with the message digest installed during startup.  We now send all messages out-of-band so NAKACK2 will not queue them for ordered delivery.  We also turn off bundling so that all messages are immediatly sent (no jitter for cache operations).

Other changes are in tests, which had timing issues or misspelled identifiers (this affected some constants in CliStrings, too).

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Replace JGroups 2.2.9
                </div><div><b>description:</b> The JGroups 2.2.9 sources that are currently included in Geode must be replaced in order for Geode to leave incubation.  A wiki document has been created to investigate alternatives.

https://cwiki.apache.org/confluence/display/GEODE/Replacing+JGroups+2.2.9
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                An initial functional specification for replacing JGroups can be found here:

https://cwiki.apache.org/confluence/display/GEODE/MembershipManager+Functional+Specification
              </div></li><li><div>
                Functional specification snapshot
              </div></li><li><div>
                Branch feature/GEODE-77 has been created for this work.  The initial push on this branch removed jgroups source and introduced a smaller jgroups stack using a downloaded jar.  It has initial implementations of Services, ServiceConfig, Manager, JoinLeave, Locator and Messenger.  You can start and stop locators and servers with gfsh but there is no HA or authentication.  Other things like network-partition-detection and multicast support also still need to be implemented.

I will be creating stories/tasks for the remaining work.
              </div></li><li><div>
                Commit 17a1f4dd79dca1ca99e495e0dab37495380b398f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=17a1f4d ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

              </div></li><li><div>
                A code walkthrough for the initial push is here:  https://www.youtube.com/watch?v=g96lyWQjErA
              </div></li><li><div>
                Commit 0a70d5140277b366be4d0b9607a5e68936837c2f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~qihong]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0a70d51 ]

GEODE-77: Implement Authenticator interface in class GMSAuthenticator with unit tests.

              </div></li><li><div>
                Commit ab68f4e683ac784b2602adb3d57323d0ace75db0 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ab68f4e ]

GEODE-77 fixing the inability to create multiple MembershipManagers ina single JVM

The static MemberAttributes.DEFAULT was being used to pull together all
of the bits of a new members identity (InternalDistributedMember) but
this prevented multiple MembershipManagers from being instantiated w/o
ones identity bleeding into anothers.  Now the MembershipManager is the
assembling a single InternalDistributedMember instance, putting info
into it as it becomes available.  A new unit test ensures that this is
functioning correctly.

              </div></li><li><div>
                Commit e0d1c4f908b30bdf239041403bf9c6369f2be22b in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e0d1c4f ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

              </div></li><li><div>
                Commit 26fea7a161f2336aa5577b0f4b2126d11c9ae37f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=26fea7a ]

GEODE-77 added Messenger statistics and removed old JGroups statistics

This also fixes a few bugs that I found during testing.  GMSMember wasn't
serializing correctly in some cases.
I also found that gfsh has a showDeadlock command and hooked in the new
findDeepestGraph DependencyGraph search.  If gfsh can't find a deadlock
it will now report on the deepest call chain it can find, which often
points to the source of a problem in the distributed system.

              </div></li><li><div>
                Commit d4a3f122555ee6daa15c6aea38adea30bc1a057d in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=d4a3f12 ]

GEODE-77 removed shutdown status check.

This check was recently added but it is keeping the manager from
properly shutting down because the status is set by
DirectChannel before the manager is told to shut down.

              </div></li><li><div>
                Commit c5c8565c654ad681c7171c7fad582e113cb8e720 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=c5c8565 ]

GEODE-77 fixing a hang caused by wrong DSFID in RemoveMemberMessage

also addressing an authentication issue found by Jason with the new
GMSJoinLeaveJUnitTest, and adding a test method for removeMember()

              </div></li><li><div>
                Commit 7fd67b8836b1c0ff95034a9a6f25901e805354f2 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~qihong]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=7fd67b8 ]

GEODE-77: improve restart locator error handling on corrupted state file

              </div></li><li><div>
                Commit b8f40f4c1205fe56ab823e50dad962ddd29089d3 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b8f40f4 ]

GEODE-77 adding new unit tests for GMSJoinLeave

This adds a bunch of new unit tests to GMSJoinLeaveJUnitTest and
fixes a number of problems exposed by the new tests.

Members were in the view multiple times.
Members were in the shutdownMembers collection multiple times.
Members could be in the crashedMembers collection multiple times.
View preparation was actually installing the view in the coordinator.
A rogue process could request removal of a member.

              </div></li><li><div>
                Commit f894238b5f9f54665728c69145a6c1c72dba3c21 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f894238 ]

GEODE-77 adding test coverage for JGroupsMessenger

A couple of unit tests to make sure that request routing is working as
expected and that message payload fragmentation is being performed.

              </div></li><li><div>
                Commit d511979efbbbd8146f1bd285a4642df87b0a29bb in incubator-geode's branch refs/heads/feature/GEODE-17 from tushark
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=d511979 ]

GEODE-77 : Integrated Security Code Merge
Review board url : https://reviews.apache.org/r/37209/

This is manual merge of code from int_security branch.

Testing done : JMX RMI-connector testing done from JConsole, Gfsh interactive testing with different roles. DUnits are not yet integrated into open.

Adding description about changes done

JMX - Key Changes

	ManagementAgent.java
		Hooks managementInterceptor when security plugins are configured

	ManagementInterceptor.java
		Central interceptor for JMX RMI connector.
		Each JMX call go through interceptor via MBeanServerWrapper in following fashion

		jmx(mxbean.op()) -&gt; mbeanServerWrapper -&gt; interceptor -&gt; security plugin -&gt; back to wrapper -&gt; mxbean.op()

	ResourceOperationContext
		OperationContext for all m&amp;m resource operations.
		This returns operation code as RESOURCE (except for data commands) and has additional code called resourceOperationCode which return exact operation requested

	ResourceOperation
		This annotation is used to mark mxbean interfaces and commands to corresponding m&amp;m action

	JMXOperationContext
		describes mbean operation(getAttr,SetAttr,Op) in terms of ResourceOperationContext.
		Parses all MXBean annotation and build map used for mapping jmx calls to resource codes
	CLIOperationContext
		describes gfsh command(name, params) in terms of ResourceOperationContext
		Parses all Command annotation and build map used for mapping gfsh command calls to resource codes

	*MXBean and *Commands Changes
		Added ResourceOperation annotation

REST ADMIN - Key Changes

	AuthManager
		gateway to authorize and authenticate REST ADMIN

	internal/web/controllers/AbstractCommandsController.java
		Changes for ADMIN REST to add authentication and authorization callbacks

Pulse - Key Changes from gemfire side

	AccessControlMXBean/AccessControlContext
		This is hidden mbean which opens up authorization end-point for Pulse
		Pulse will access this mbean to know its authorization levels after connecting with given credentials
		Any JMX Client can use this mbean to know its (currrent jmx connection) authorization levels

REST - Key changes

	gemfire-web-api - AbstractBaseController.java and other controller classes
		REST API changes for At &amp; Az

	DistributionConfig (its impl)
		New system properties token-service for REST

	TokenService
		New interface for REST endpoint which is supposed to give secured token when given Princial

	RestAPIsOperationContext
		OperationContext for REST API

              </div></li><li><div>
                Commit fb0e2b2814b86d1e41bb6909eab82a4de4de9637 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=fb0e2b2 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

              </div></li><li><div>
                Commit edc81a750d6e54040cc5210bcdbd9013602002ae in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=edc81a7 ]

GEODE-77 adding additional test coverage

Test coverage is now &gt; 71% for all membership services.
This also fixes a problem in GMSJoinLeave.join where a member that
was shut down &amp; restarted with a start-locator setting formed a
split-brain.  Now we send a collection of previously attempted
coordinators with FindCoordinator requests, and a member receiving
a join request will check to see if the new member ought to assume
the role of coordinator.  See LocatorDUnitTest.testCollocatedLocatorWithSecurity.

              </div></li><li><div>
                Commit 6bf1f20943554b26c51a2d820947bfda58e51f2f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~hitesh.khamesra]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=6bf1f20 ]

GEODE-77. Set group in InternalDistributedMember, it fixes RoleDunitTest

              </div></li><li><div>
                Commit 0178610645178cc995ca60992d00368a266f1378 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0178610 ]

GEODE-77 bug fixes for LocatorDUnitTest

All tests in LocatorDUnitTest now pass except the quorum check,
which needs a test hook.  GMSJoinLeaveJUnitTest, GMSHealthMonitoryJUnitTest
(except for testSuspectMembersCalledThroughSuspectThread) and
MembershipJUnitTest are all passing with these changes.

              </div></li><li><div>
                Commit c43d045788aa2a87f477b6f3c396ab76b8707ab6 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=c43d045 ]

GEODE-77 a log statement was using the wrong logger method, resulting in an odd log message containing {0}

              </div></li><li><div>
                Commit e21dc11e95b1d58c43cc7ad5463174ae4d730caa in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e21dc11 ]

GEODE-77 changed this test to use annotations per Jason's recommendation

              </div></li><li><div>
                Commit 7956d06524fcba1f5dd329dd4ae13faa7b024d2a in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=7956d06 ]

GEODE-77 added an additional catch/retry of NoAvailableLocatorsException

              </div></li><li><div>
                Commit d87cf44ab04b046e70f554e22f8110c94aa7000c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=d87cf44 ]

GEODE-77 fixed expected exception in a test

              </div></li><li><div>
                Commit 10035269cf6d3f9245b0b1d6edb93085c606b0c3 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=1003526 ]

GEODE-77 modified the test to use the dunit locator

              </div></li><li><div>
                Commit a0a9ce8d8050f4106e9db4195c37fe3dad400c69 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=a0a9ce8 ]

GEODE-77 added an expected client/server exception to this test

              </div></li><li><div>
                Commit 29ce461318f98ee040447c10b6f18ef719b0ba39 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=29ce461 ]

GEODE-77 install membership view even if quorum has been lost

If enable-network-partition-detection isn't enabled we need to go ahead
and install a new membership view when quorum has been lost.

              </div></li><li><div>
                Commit 4a5119c28f9ac75525777b96f5dfad14fa188f27 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=4a5119c ]

GEODE-77 corrected weight calculation for non-lead members

              </div></li><li><div>
                Commit 1002aa047b6904151bfd6e608bfe0a6467773451 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=1002aa0 ]

GEODE-77 improved handling of join requests having the same host:port as a previous member

This adds a check of the UUID bytes in an address's NetMember in
compareTo to keep a new address from matching an old one.  The
test TXDistributedDUnitTest was failing consistently when a member
crashed its distributed system and then tried to reconnect immediately.
This is due to how JGroups allocates its ports starting with the first
number in the port range and sequencing through until it finds one that's
available.  GemFire had used a random selection algorithm for this.

              </div></li><li><div>
                Commit ddae00976e4510bf41aca6b7f87dd6b1b3df5574 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ddae009 ]

GEODE-77 reduced some health monitor logging to trace level

During HA events I observed the health monitor create in excess of 1gb of
log entries per second.  That's way too much for debug-level logging.

              </div></li><li><div>
                Commit 9d01654256e87151000f34702ccb2cf1ab761d14 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=9d01654 ]

GEODE-77 added an expected ConnectException to a test

              </div></li><li><div>
                Commit 505b45df34f9b2d751c2a21d478f372225725622 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=505b45d ]

GEODE-77 fixing NPE encountered in ProductUseLogDUnitTest

              </div></li><li><div>
                Commit 0b103c1dbe4867c28904099668b7c85324a7e108 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0b103c1 ]

GEODE-77 changed a test to use locators instead of multicast discovery

              </div></li><li><div>
                Commit 4d5f6aa4f20e81bb56b3097ad526f9819a155ef4 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=4d5f6aa ]

GEODE-77 changed a test to use locators instead of multicast discovery

              </div></li><li><div>
                Commit fcc0f34fbef1ab00208964d7ae5d01d1285e3330 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=fcc0f34 ]

GEODE-77 Clean up services if join attempt fails

              </div></li><li><div>
                Commit ea9a739e2657214756f84f0a58dab2db73fa08f6 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ea9a739 ]

GEODE-77 changed a few tests to stop using multicast discovery

              </div></li><li><div>
                Commit ae43acaa40734cd8004bca9c7e98a5098de8d354 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ae43aca ]

GEODE-77 fixed a problem with creating member IDs for a test

              </div></li><li><div>
                Commit 299966d7af04838dfa0651adda22e63100b92281 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=299966d ]

GEODE-77 modified two tests to account for background thread timed-wait,
and modified a second to create temp files in /etc on non-Windows machines

              </div></li><li><div>
                Commit 36b81da23e8e6ceeedd6b5189f54a9c3af226695 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=36b81da ]

GEODE-77 reducing aggressiveness of the health monitor

The health monitor was timing out a peer after not seeing a message from
it in 100ms.  HA testing has shown that this is far too aggressive, with
most test runs dieing a quick and tragic death with all members trying
to kick each other out of the distributed system.

This commit reverts to our old way of waiting member-timeout ms before
giving up on a peer, and adds a final check of the member activity map
before allowing a suspect message to be sent to the coordinator.

              </div></li><li><div>
                Commit 1553ddcd0f45d8859c2c6f0329e3d1516a388796 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=1553ddc ]

GEODE-77 fixed a test failure

This test was converted to use a locator instead of mcast discovery but
that increased the number of resource manager profiles, causing test
verification to fail.

              </div></li><li><div>
                Commit 972b60564a042ebc5e6f074b165d1b23cdda1c61 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=972b605 ]

GEODE-77: GMSJoinLeave now collects removal requests to see if it should become the membership coordinator

              </div></li><li><div>
                Commit e7a6a28b22727a59a8b24dbc9a88ceae5e7673b7 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e7a6a28 ]

Merge branch 'master' into feature/GEODE-77

              </div></li><li><div>
                Commit 43a368831d350f58bb3b7ba40d9292b0157eaa7e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=43a3688 ]

GEODE-77 fixing test issues and an error in GMSMember.compareTo

              </div></li><li><div>
                Commit fc28817106ae8e534e56913426f7955efdc6d58f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=fc28817 ]

GEODE-77 fixing statistics recording in StatRecorderJUnitTest

              </div></li><li><div>
                Commit 9cd82c7b935da9f040b2215b6678a080eb9d5c2d in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=9cd82c7 ]

GEODE-77 fixing unit test config problems and a failure in colocated membership manager testing

              </div></li><li><div>
                Commit 7bc011293f311a77b44beac13c6d5c91a01abe3d in incubator-geode's branch refs/heads/develop from [~upthewaterspout]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=7bc0112 ]

GEODE-171: Disabling ClientServerTimeSyncDUnitTest

After discussion with Bruce, we may not even have this time sync
protocol after GEODE-77 merges. There's no point in continuing to see
failures from this broken test on develop in the mean time.

              </div></li><li><div>
                Commit 377a495b8ea6ac7b41998ce2d46fbd84a13afb5f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=377a495 ]

GEODE-77 fixing LocatorDUnitTest issues

Members trying to rejoin with the same inetaddr:port were causing
issues.
This also moves us to JGroups 3.6.6.Final

              </div></li><li><div>
                Commit 99e50c12ae710264f61b6db4f149f8cae07db521 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=99e50c1 ]

GEODE-77(Sub-Task GEODE-205) After a network outage is fixed a former member can rejoin

              </div></li><li><div>
                Commit eab327f6a2b9bc2ca715464f61b4388ce304df2f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=eab327f ]

GEODE-77 fixes for failing unit and integration tests

  if the coordinator returned by locators doesn't work we now
  ask other members in the view returned by the locator

  leave &amp; crash events now ack the view currently being installed
  so that it won't wait for the associated members

  views are always installed using the two-phase protocol.
  GemFire did this and some algorithms, such as rebalancing,
  are thrown off if departed members are in the view when
  a rebalance starts.

  views are always transmitted by the View Creator thread.
  GMSJoinLeave.becomeCoordinator() installs an initial view
  into the View Creator before starting it if there is a view
  to prepare and install.

  Rebalance operations targetting a new member were failing to
  achieve balance if an old ID for that member was still in the
  membership view.  We now detect those old IDs and remove them
  when the new member joins.

  ClientProxyMembershipID was not being deserialized properly
  after being transmitted from one member to another.

  HealthMonitor classes with Ping in their names are renamed to
  Check.  I've found that Ping confuses people - they
  sometimes think that gemfire is using network ping protocol

  HealthMonitor beSick/playDead were tightened up

  HealthMonitor was not recording activity from other members unless
  it was currently watching that member.  This caused a lot of
  unnecessary suspicion when switching from one member to another.

  HealthMonitor wasn't clear about who was raising suspicion and
  who was the target of the suspicion.

  FindCoordinatorRequest was using java serialization for rejected
  coordinator IDs.

  GMSMembershipManager's latestViewLock use wasn't quite the same
  as in the membership manager in GemFire 8.2 and caused a deadlock.

  fixing GEODE-360: PRTombstoneMessage should ignore
  ForceReattemptException

  LogFileParser wasn't recognizing timestamps for thread dumps, causing
  them to be mis-sorted when merging log files.

              </div></li><li><div>
                Commit ad7fc9ce881cfbe01124e0b3460252f79778398c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ad7fc9c ]

GEODE-77 adding interface missing from previous commit

              </div></li><li><div>
                Commit 01907e688070ba47c59d75b94f5e5dd6a1ed1ff2 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=01907e6 ]

GEODE-77: minor bug fixes.

              </div></li><li><div>
                Commit e3e794d7bd47f3573cb966ba08f16f0a5a385d99 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e3e794d ]

GEODE-77 fixes for network failure handling &amp; miscellaneous unit test failures

Network failure handling was not properly shutting down TCPConduit, leaving threads hanging trying to send messages.  The shutdown code was calling Services.emergencyClose too soon, and the recursion back into GMSMembershipManager shutdown code caused some problems, too.

GMSHealthMonitor was continually switching between two members to watch even though it had already sent suspect messages about them and had received no response.  I added a collection of IDs that are in this state and modified setNextNeighbor to avoid reusing them.

GMSHealthMonitor was sending removeMember messages to the locators and a random member, but for some reason this wasn't resolving a network partition fast enough.  I've disabled that behavior for now, sending the messages to all members.  This needs to be revisited because sending the message to all members is not scalable.

GMSHealthMonitor had some issues with initiating removals when it was in the process of shutting down.  I added some isStopping checks to fix this.

MembershipJUnitTest and StatRecorderJUnitTest were failing in gradle runs but not under Eclipse because my Eclipse launch configuration wasn't set to enable assertions.  After fixing that I found a number of problems with these tests and fixed them.

Multicast tests are now implemented in GMSMembershipManager and JGroupsMessenger.  This leverages the ping/pong messaging added for the quorum checker.

GMSJoinLeave was too slow in sending out new views when there were process failures.  I added code to inform the reply processor if there are queued leave/remove requests so it wouldn't wait for these, and also added similar checks in the removeHealthyMembers method (which performs checks on members using the HealthMonitor).

When there is a network partition GMSJoinLeave will now send a NetworkPartitionMessage to other members to prod them along in figuring out that they should shut down.

During a forced-disconnect there can be a lot of warning/fatail log messages.  If there are alert listeners in the system this can create a lot of network traffic and extra work figuring out whether the receiver is even there or not.  GMSMembershipManager now throws away outbound alerts when a forced-disconnect is in process.

Some of the forced-disconnect shutdown processing has been moved out of the membershp manager's DisconnectThread that was introduced with the quorum checker in order to set the shutdown cause, etc, as quickly as possible.

I noticed a lot of TXState log messages at debug level with a Throwable stack trace.  There was no comment saying why this was being done so I commented it out.

JGroups logging level is now set to FATAL by default.  The default log level was a problem during network partitions because each message send was causing a dire warning to be logged.

I observed a number of threads being left behind when a locator failed to start during auto-reconnect testing.  I added a unit test to LocatorJUnitTest for this and fixed the leaks.

              </div></li><li><div>
                Commit d624ea73d0b12b7e21ddbd5e72ed3ca07bc0c71c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=d624ea7 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

              </div></li><li><div>
                Commit 592584d61bc495df31461826dcb9999b70efc032 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=592584d ]

GEODE-77 fixing a dangling reference to the old JGroups IPAddress class that's causing compilation failures

              </div></li><li><div>
                Commit 92a67db37045f96e30baf950ca2242e7f2756752 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=92a67db ]

GEODE-77 disabling use of SynchronousQueueNoSpin

This class has been implicated in the loss of messages during startup.
Its use has been discontinued in GemFire maintenance releases and as
we have seen this problem during testing on feature/GEODE-77 I'm removing
its use from our branch as well.

              </div></li><li><div>
                Commit 92a67db37045f96e30baf950ca2242e7f2756752 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=92a67db ]

GEODE-77 disabling use of SynchronousQueueNoSpin

This class has been implicated in the loss of messages during startup.
Its use has been discontinued in GemFire maintenance releases and as
we have seen this problem during testing on feature/GEODE-77 I'm removing
its use from our branch as well.

              </div></li><li><div>
                Commit a40121106df0208e137472d9702adeb69e5c7d0c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=a401211 ]

GEODE-77 IDs for old clients were serializing with V9.0

When a client cache ID was serialized by a 9.0 server to send to another
9.0 server the ID being transmitted was 9.0 instead of the clientVersion
instance variable.  This caused EOFExceptions when deserializing a
message containing the ID.

              </div></li><li><div>
                Commit b08159fbb952252f6c4087d59e94133291544d94 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b08159f ]

GEODE-77 bugfixes from code review

ClientProxyMembershipID's clientVersion may be null.  toData was
assuming that it was never null and caused NPEs.

InternalDistributedSystem needs to tell the locator whether there was
a forced-disconnect but was using the wrong value.  It needs to use
its forcedDisconnect boolean instead of the preparingForReconnect
parameter.

              </div></li><li><div>
                Commit ba566c0c433ff23650f89a0cc9a214a3f2a271ef in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ba566c0 ]

GEODE-77 fixes for failing unit tests and multicast

              </div></li><li><div>
                Commit b6d01474d5752746599dad3ba6bc59c93ed27bc4 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b6d0147 ]

GEODE-77 updated records with new classes

              </div></li><li><div>
                Commit 8de790397e2abd0dac9c0c0d347812f540ab625e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=8de7903 ]

GEODE-77 improved suspect processing, multicast fix for Windows

GMSHealthMonitor was allowing the service to watch itself if it ran out of other members to watch.  This change set modifies that behavior to set the "next neighbor" to null, causing suspect processing to halt until a member transitions out of "suspect" state or a new membership view is installed.

I also found that GMSHealthMonitor wasn't notifying the Manager when a member goes into final-check state, so that membership listeners weren't being notified of suspect events.  This was causing a unit test failure.

JGroupsMessenger now fools the JGroups stack into thinking an IPv4 stack is being used even if IPv6 is available, so that JGroups will use an IPv4 address.  JGroups was selecting an IPv6 address, making communications with IPv4 members impossible and causing a schizm between the GemFire member address and the JGroups address.

The JGroups log level is now set to WARN in the default log4j2.xml settings file.

              </div></li><li><div>
                Commit 9f556046e6389244915835f0173c8c436905de01 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=9f55604 ]

GEODE-77: minor bug fixes

Member weights were not being installed into member identifiers, nor serialized with them.  This wasn't an issue with GemFire because the weights were only important for JGroups IpAddresses but we now use Geode member IDs in membership views so the weights need to be included.

During startup if a member was told to become the membership coordinator it wasn't correctly setting its membership ID's view ID.  This caused some unnecessary confusion in other members.

During view preparation we don't wait for acks from members who are going to be removed in the next view but we weren't aborting the view when this happened.  This caused us to not detect a network partition.  The reply processor now adds these member IDs to the set of members that didn't respond to view preparation.

Multicast testing showed that JGroups was not dispatching a received message, probably due to problems with the message digest installed during startup.  We now send all messages out-of-band so NAKACK2 will not queue them for ordered delivery.  We also turn off bundling so that all messages are immediatly sent (no jitter for cache operations).

Other changes are in tests, which had timing issues or misspelled identifiers (this affected some constants in CliStrings, too).

              </div></li><li><div>
                Commit 4f1a943f521efcf2c23ef40396608782240437c8 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=4f1a943 ]

Merge branch 'develop' into feature/GEODE-77

              </div></li><li><div>
                Commit 3e1a9f69b0d07e311cc261656d6ba553b7120072 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=3e1a9f6 ]

GEODE-77 fixed ability to shut down a rogue member

              </div></li><li><div>
                Commit c4b14b7244fc021c08ed4a5753887c0a493f527f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=c4b14b7 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/src/main/java/com/gemstone/gemfire/distributed/internal/PooledExecutorWithDMStats.java
	gemfire-core/src/main/java/com/gemstone/gemfire/distributed/internal/membership/jgroup/JGroupMembershipManager.java
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/tier/sockets/CacheClientNotifier.java
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/i18n/LocalizedStrings.java
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/i18n/ParentLocalizedStrings.java
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/logging/LogService.java
	gemfire-core/src/test/java/com/gemstone/gemfire/cache/client/internal/AutoConnectionSourceWithUDPDUnitTest.java
	gemfire-core/src/test/java/com/gemstone/gemfire/internal/FDDUnitTest.java
	gemfire-core/src/test/resources/com/gemstone/gemfire/codeAnalysis/sanctionedSerializables.txt

              </div></li><li><div>
                Commit 5ca7c37ccf02e9291620f2472df87922e4183643 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=5ca7c37 ]

GEODE-77 fixing merge problems

It looks like one of my ammended commits got lost somehow

              </div></li><li><div>
                Commit e267c88b134155eea6dab935a7a549c041e3e77e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e267c88 ]

[GEODE-77] TCP check for health monitor

              </div></li><li><div>
                Commit 5db80554379f7d68292941de75473516069c812a in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=5db8055 ]

Revert "[GEODE-77] TCP check for health monitor"

This reverts commit e267c88b134155eea6dab935a7a549c041e3e77e.

The revert is due to some test failures.

              </div></li><li><div>
                Commit 0f7daf2563145a1084f66a6195d3e354ebf063df in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0f7daf2 ]

GEODE-77: exiting from main() doesn't cause Shutdown Hook to run

This introduces a subclass of the JGroups UDP protocol in order to
force it to create daemon threads.  It also inhibits setting time-to-live
on the UDP socket unless multicast is enabled.  This was causing
InvocationTargetExceptions to be logged at ERROR level on Windows 7 machines.

              </div></li><li><div>
                Commit f3b1f1b17f69dc9d21a846971fbe26d813e9df0a in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f3b1f1b ]

GEODE-77: deadlock in GMSJoinLeave

This removes the stateLock read-write lock in favor of using a
sync on viewInstallationLock, eliminating the possibility of
inversion between the two.

              </div></li><li><div>
                Commit 8ff8ede79705d9333f6165e9015de3f3a269c576 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=8ff8ede ]

GEODE-77: proper deserialization of old member IDs

Member IDs from old GemFire clients (which we'd like to be compatible
with Geode) were not being properly deserialized, so that they did not
know what version their member was using.  This caused deserialization
errors when the IDs were transmitted from one Geode server to another.
The fix is to look for the member's version in the DataInput parameter
in fromData()

              </div></li><li><div>
                Commit 481574db871086c30d08a942bcc147b1e059412f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=481574d ]

GEODE-77: moving jgroups configuration files to the messenger package

I've also added a comment to the health monitor playDead code that
was puzzling to a reviewer

              </div></li><li><div>
                Commit 0c1008e659700b2515994cfc91cae72ba1857f06 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0c1008e ]

GEODE-77: installing initial view

The membership manager was not installing the initial view into the
DistributionManager.  This was causing its waitForViewInstallation method
to hang if the view in question was the member's initial view

              </div></li><li><div>
                Commit 9d110301f31d6176b276b69603fc998cd7db588c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=9d11030 ]

GEODE-77: fixing a ClassCastException observed in integration testing.

Sometimes the 'object' returned by the GC function is a String description
of an exception encountered while executing the function in another
member.  In that case we want to return the exception description to
gfsh as the result.

              </div></li><li><div>
                Commit b4d083e4cc6616199a2f6751f49a0686c9d28570 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b4d083e ]

GEODE-77 handling messages from old GemFire clients

Message objects were not passing on their version information to Part objects, causing deserialization errors when servers were being used by old GemFire clients.

              </div></li><li><div>
                Commit a68ed7d032c0db1c26a72ccc777a749cabd71718 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=a68ed7d ]

GEODE-77 added a test for DistributionMessage.isPreciousThread()

This method wasn't correctly determining that a JGroups thread should
not be used for dispatching a cache operation message.  I corrected the
check and added a unit test.

              </div></li><li><div>
                Commit ad8ee8cb832837427598012cf3c41d8d357da6d1 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=ad8ee8c ]

GEODE-77 adding expected thread states to PluckStacks tool

              </div></li><li><div>
                Commit 932a99eec9d9c93c63ae22417e2f7f0874add64e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=932a99e ]

GEODE-77: adjusting expected results of AnalyzeSerializablesJUnitTest

              </div></li><li><div>
                Commit cfba7ae5d3c76b571166cdfb169d3cdfdfb657de in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=cfba7ae ]

Merge branch 'feature/GEODE-77' of https://git-wip-us.apache.org/repos/asf/incubator-geode into feature/GEODE-77

              </div></li><li><div>
                Commit cfba7ae5d3c76b571166cdfb169d3cdfdfb657de in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=cfba7ae ]

Merge branch 'feature/GEODE-77' of https://git-wip-us.apache.org/repos/asf/incubator-geode into feature/GEODE-77

              </div></li><li><div>
                Commit 5feab8241deb507c11152236b152b91d983eeace in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=5feab82 ]

GEODE-77: avoids creating a split-brain if joining times out and network partition detection is not enabled

              </div></li><li><div>
                Commit 63802dab6090eef2721620afe518e1ad0b65df5d in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=63802da ]

[GEODE-77] TCP check for final check in health monitor

              </div></li><li><div>
                Commit 2847235c5d1574031f431bae0c4eff8ed636f31e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=2847235 ]

GEODE-77: send Remove messages to members that are kicked out during view installation

This also changes view preparation to only attempt to prepare the view once.
If the initial preparation fails we create the new view kicking out
unresponsive members and just send it out, along with the Remove messages.

              </div></li><li><div>
                Commit 14445c082a7642d5a771c4557c64858835fab283 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=14445c0 ]

GEODE-77: improvements in handling loss of coordinator

1) Locator join-timeout has been bumped from 17 sec to 24.  This allows it to join in spite of the loss of the current coordinator and several backup coordinators.

2) Join responses are now sent after "prepare for view" messages so that other members have some knowledge of the new members before they are allowed into the system.  If the coordinator dies before completing preparation the new coordinator will find this prepared view and now adds its new members to its own membership view.

3) We no longer clear the collection of already-tried potential-coordinators when a new view is processed during startup.  Since join-requests have already been sent to these addresses there is no point in trying them again.

4) The coordinator now periodically sends out the current view to members and to crashed members of the last view using unreliable messaging.  This helps get rid of rogue processes &amp; is similar to what we did with the view-sync JGroups protocol in GemFire.  I new method for unreliable message transmission to Messenger for this purpose.  This keeps JGroups UNICAST3 protocol from recreating a retransmission table entry for the old, crashed, members who would reject the old sequence numbers generated by the new table entry and never dispatch the messages.

5) Removal requests are now processed in the ViewCreator after all other requests have been processed.  This prevents a member from being kicked out when we've already received a shutdown message from that member.

6) Several new unit tests

              </div></li><li><div>
                Commit 74d4ed3721a92aa101590930839171b37adf9076 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~huynhja]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=74d4ed3 ]

[GEODE-77] When coordinator shutsdown, next coordinator may be missed
No longer ignores leave messages from other members, even if not coordinator
Instead we track them and if we become coordinator, we end up "processing" them
by removing the members that left from the view (if there are any in the list)

Additional change to correctly keep removed and left members in the list on installview

              </div></li><li><div>
                Commit c152e20b01518aa2dd19d46060e34de1ab2fa91a in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=c152e20 ]

GEODE-77: moving failure detection sockets into the membership view

              </div></li><li><div>
                Commit f3034be681dca37aca59710df3d44794d22d0f4e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f3034be ]

GEODE-77: bug fixes

GMSHealthMonitorJUnitTest was incorrectly using Mockito's any() when it should
have used isA().  Fixing this exposed a lot of problems in the health monitor
that this checkin addresses.  I've also renamed a number of entities so that we
now have more uniform use of the term "heartbeat" instead of "check".

GMSHealthMonitor now has a positive heartbeat sender thread that determines
who might be watching it and sends unsolicited heartbeats to those members.

GMSHealthMonitor now sends the viewID of its membership ID in TCP/IP
health checks.  This enables the receiver to differentiate between the
received UUID/viewID and its own information when it is a reconnected
member (using auto-reconnect).  The response threads are now also moved
to a cached thread-pool to decrease the cost of these checks.  Responses
now have soLinger set on them (experimental) because I was seeing a lot
of checks fail with EOF even though the member wrote an OK status.

The health monitor now uses suspectMembersInView to avoid suspecting the
same member over and over again.  This means that it can't be used to
avoid duplicate final-checks.  I've also disabled the collection thread for
suspect events because it was adding unnecessary delay in initiating
final-checks on crashed members and I have yet to see it collect more than
one event.

SuspectMembersMessage processing now checks to see if the receiver is the
target of the suspicion and, if so, send a heartbeat to the sender.  This
seems to happen a lot when the membership coordinator is a locator because
the locator doesn't push operations out to other members very often.  The
positive heartbeat sender will also help with this.

This change-set also turns off the JGroups thread pools because they were found
to be causing our performance problem.  This exposed a bug in JGroups that they
are fixing, but for now there is a workaround in StatRecorder.  Along with the
removal of thread pools we now need to pass messages through
handleOrDeferMessage() in GMSMembershipManager since processMessage() can be
blocked during initialization, causing a new process to time out trying to join
the distributed system.

GMSJoinLeave was not setting the failure detection ports on a new view if it
abandoned a view that it could not prepare.

The Connection class had some incorrect checks for shutdown conditions when
the shared/ordered connection to another member is shut down.  This should
improve our detection time for crashed members.

              </div></li><li><div>
                Commit 2561cf157f93fa66eb4a3dd63cd30f9f73fa8620 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=2561cf1 ]

GEODE-77: view received with no failure detection info

JoinLeave was sending a view with no failure detection ports set if
it created a new view due to additional failed members being detected
during preparation or due to a conflicting prepared-view being received

              </div></li><li><div>
                Commit e41f260e9ceb0f3e3dd743813120f623ee4c6727 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e41f260 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

GEODE-77 will need to have copyright notices added to new files added on
that branch.

This moves GEODE-77 to Java 8

              </div></li><li><div>
                Commit e41f260e9ceb0f3e3dd743813120f623ee4c6727 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e41f260 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

GEODE-77 will need to have copyright notices added to new files added on
that branch.

This moves GEODE-77 to Java 8

              </div></li><li><div>
                Commit e41f260e9ceb0f3e3dd743813120f623ee4c6727 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=e41f260 ]

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

GEODE-77 will need to have copyright notices added to new files added on
that branch.

This moves GEODE-77 to Java 8

              </div></li><li><div>
                Commit 8156c6ceb4a434d1a4a24b6dca0497fd1bb1b56d in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=8156c6c ]

GEODE-77: fixing some compilation problems from the merge from develop

              </div></li><li><div>
                Commit 6b7ea8bb7822762a40bbb5bfe1dc3c31494ad4b1 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=6b7ea8b ]

GEODE-77 fixing a recursion error

My last commit had a bug that sometimes caused infinite recursion during
startup.  This corrects the problem

              </div></li><li><div>
                Commit 0ab85392f95811c83436ebd4ac4d19a48ae2424e in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0ab8539 ]

GEODE-77 fixing uncaught exception in view creator

check for inclusion in the new view before trying to set failure detection
port

              </div></li><li><div>
                Commit 1ff1ba672248ff3b1a87bb87c017645486e6cebb in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=1ff1ba6 ]

GEODE-77 fixing uncaught exception in view creator

check for inclusion in the new view before trying to set failure detection
port

              </div></li><li><div>
                Commit 8a4af0fff5f96b3cf2fffc46db81d10950c20bf4 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=8a4af0f ]

[GEODE-77] Fixed some backward compatibility issues

              </div></li><li><div>
                Commit 6f661a7e338bfd413f433028f26ea0131b4dc88c in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=6f661a7 ]

GEODE-77 updating sanctioned serializable data for java 8

              </div></li><li><div>
                Commit 14417892b0c60e809ceafb816391e5050f3373f9 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=1441789 ]

GEODE-77: clarifying the meaning of max-wait-time-reconnect

              </div></li><li><div>
                Commit 4eb09ad43f47a4a0cef83c4d71acdb87554ab0ec in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=4eb09ad ]

GEODE-77: changing names of expected idle threads

              </div></li><li><div>
                Commit f0c5ec2644e78e1522b7cb3ba0bae824e796ea27 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f0c5ec2 ]

GEODE-77: fixing the bind-address in this test to be the same as the locator's address

              </div></li><li><div>
                Commit 026d149d415eadf39ff6c421fdd0452291ac5d75 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=026d149 ]

GEODE-77: removing references to GMSJoinLeave from the health monitor unit tests

              </div></li><li><div>
                Commit 28d273cb0f19ff2d6b2b506b1d82b91b5ce2ce36 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=28d273c ]

GEODE-77: members unfairly forced out of the distributed system

n integration testing members were, under heavy load, being forced out
of the distributed system in spite of the new tcp/ip final-checks.

This change set adds a recent-activity check to the doTCPCheckMember method
of GMSHealthMonitor.  It also corrects this method to use SocketCreator with
a background timeout task in case the tcp/ip socket timeout fails to work
(as it sometimes does).

During testing I also saw that GMSJoinLeave was not initiating a forced-
disconnect if it received a membership view showing that it was no longer
in the distributed system and modified it to do so.

              </div></li><li><div>
                Commit 0ee416f99c4730a928c159ae4aeae43e097ec7dd in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=0ee416f ]

GEODE-77: reduce jgroups log level to FATAL

JGroups spits out many ERROR level log messages when there is a network
failure

JGRP000029: 10.138.44.124&lt;v3&gt;:1026: failed sending message to 10.138.44.171&lt;v3&gt;:1026 (284 bytes): java.io.IOException: Operation not permitted, ...

              </div></li><li><div>
                Commit 21274f9c943a7f8cd99833a3b1f7f91ad12cbf48 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=21274f9 ]

GEODE-77: faster network-partition detection, bugfixes for auto-reconnect

network-partition-detection was taking too long to initiate.  This adds checks for IOExceptions to the Transport class to initiate member checks, shrinking the time to detect partitions.

There were still problems with auto-reconnect not being able to join while the old member ID was still in the view.  It would also sometimes install a view and think it had joined when it had not, causing other members to reject messages from the new "member" and resulting in a hung test.  GMSJoinLeave now rejects view messages that don't contain an appropriate member ID during the join process, and installView is smarter about what views it will accept as well.

The view creator was being stubborn about exiting during shutdown.  I've added additional checks to it so that it won't accidentally create another view when GMSJoinLeave is in the process of stopping.

              </div></li><li><div>
                Commit 4addcea057a22e1f1c5f131f8bc1f2f42a04fe4b in incubator-geode's branch refs/heads/feature/GEODE-77 from [~jchen21]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=4addcea ]

GEODE-77: Fix unable to allocate a failure detection port in the membership-port range

              </div></li><li><div>
                Commit f57eb8b15e042e87576b117e093180bba256f90f in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f57eb8b ]

GEODE-77: faster initiation of suspect processing on crashed member
TCPConduit's Connection.java was not initiating suspect processing when a member crashed.  This was due to not having the check in the normal (amt &lt; 0) check for a socket error.

In testing this fix with ReconnectDUnitTest I found that the change exposed some problems in GMSJoinLeave that were keeping reconnect from happening as fast as it should:

1. The reconnecting member was processing a RemoveMember message intended for its old incarnation.  This caused it to invoke forceDisconnect() but the concurrent join() attempt did not notice this and continued to try to connect until it timed out.

2. ViewCreator was removing the new member from the view if its old ID was being declared crashed in the same view because of the way InternalDistributedMember.compareTo() works with viewless identifiers.

This change-set also gets rid of a bunch of references to JGroups scattered around in the code and removes references to JGroups classes from GMSMembershipManager, moving the code requiring these refs to the quorum checker.

              </div></li><li><div>
                Commit fd98f62f8a1d2eaa41c001f04cc95751f1bea636 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=fd98f62 ]

GEODE-77: initiation of member verification on loss of shared/ordered connection

The initiation of member verification wasn't working correctly.  It wasn't
being triggered most of the time and when it was the check passed because
it was done so soon after the other member crashed that the timestamp
checks in GMSJoinLeave didn't think enough time had passed to declare the
member dead.  This changes the check to request a heartbeat first.

              </div></li><li><div>
                Commit 766dfd05b378abc981b83a5372551c6df01bcda4 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=766dfd0 ]

merge of develop to feature/GEODE-77

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/build.gradle
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/LocalRegion.java
	gemfire-jgroups/build.gradle

              </div></li><li><div>
                Commit 766dfd05b378abc981b83a5372551c6df01bcda4 in incubator-geode's branch refs/heads/feature/GEODE-77 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=766dfd0 ]

merge of develop to feature/GEODE-77

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/build.gradle
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/LocalRegion.java
	gemfire-jgroups/build.gradle

              </div></li><li><div>
                Commit fd98f62f8a1d2eaa41c001f04cc95751f1bea636 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=fd98f62 ]

GEODE-77: initiation of member verification on loss of shared/ordered connection

The initiation of member verification wasn't working correctly.  It wasn't
being triggered most of the time and when it was the check passed because
it was done so soon after the other member crashed that the timestamp
checks in GMSJoinLeave didn't think enough time had passed to declare the
member dead.  This changes the check to request a heartbeat first.

              </div></li><li><div>
                Commit 766dfd05b378abc981b83a5372551c6df01bcda4 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=766dfd0 ]

merge of develop to feature/GEODE-77

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/build.gradle
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/LocalRegion.java
	gemfire-jgroups/build.gradle

              </div></li><li><div>
                Commit 766dfd05b378abc981b83a5372551c6df01bcda4 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=766dfd0 ]

merge of develop to feature/GEODE-77

Merge remote-tracking branch 'origin/develop' into feature/GEODE-77

Conflicts:
	gemfire-core/build.gradle
	gemfire-core/src/main/java/com/gemstone/gemfire/internal/cache/LocalRegion.java
	gemfire-jgroups/build.gradle

              </div></li><li><div>
                Commit d63113c6ac02efbbd7e20a7d3c93bb2e1084e012 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=d63113c ]

Merge branch 'feature/GEODE-77' into develop

Conflicts:
	gemfire-core/src/test/java/com/gemstone/gemfire/cache/management/MemoryThresholdsOffHeapDUnitTest.java

              </div></li><li><div>
                Branch feature/GEODE-77 has been merged to develop.  We now use JGroups 3.x off-the-shelf for UDP communications and new membership, failure-detection and location services built from scratch.  See the distributed.internal.membership.gms packages for the implementations of these services.
              </div></li><li><div>
                Commit 253549d555abc5cb8bb12595a9c4ac09052ad94d in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=253549d ]

corrections for GMSHealthMonitor from an impromptu code review

Engineers working on the GEODE-77 effort reviewed some of the final-check
code in GMSHealthMonitor and came up with these corrections.

This commit also includes some test clean-up that I hope will help with
GEODE-589.

              </div></li><li><div>
                Commit b826b4b0077dc159cbcee68775cc197b025d5586 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b826b4b ]

implementation of AvailablePort.isPortAvailable for multicast

The AvailablePort utility has not had support for finding a free multicast
port since feature/GEODE-77 was merged to the develop branch.  This change-
set enables the old multicast code in AvailablePort and implements the
check &amp; response for its datagrams in JGroupsMessenger.  The JGroups
transport method for receiving packets is overridden to look for these
datagrams and respond to them.

I also renamed AvailablePort.JGroups to AvailablePort.MULTICAST, which
describes the kind of port that's being tested a little better.

              </div></li><li><div>
                Commit b826b4b0077dc159cbcee68775cc197b025d5586 in incubator-geode's branch refs/heads/feature/GEODE-14 from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=b826b4b ]

implementation of AvailablePort.isPortAvailable for multicast

The AvailablePort utility has not had support for finding a free multicast
port since feature/GEODE-77 was merged to the develop branch.  This change-
set enables the old multicast code in AvailablePort and implements the
check &amp; response for its datagrams in JGroupsMessenger.  The JGroups
transport method for receiving packets is overridden to look for these
datagrams and respond to them.

I also renamed AvailablePort.JGroups to AvailablePort.MULTICAST, which
describes the kind of port that's being tested a little better.

              </div></li><li><div>
                Commit aa624cc037c697bbc7c711aa5b93edc251127644 in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=aa624cc ]

reenabling a few tests that were commented out on the GEODE-77 branch due
to requiring multicast discovery.

              </div></li><li><div>
                Commit f5114c02a2e592c58c612b48624a779767608d0d in incubator-geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=incubator-geode.git;h=f5114c0 ]

moving to jgroups 3.6.7

jgroups 3.6.7 fixes a few bugs that we reported during
feature/GEODE-77 development.

              </div></li><li><div>
                Commit 65220a3f412311b7522727888985e51cc63e45e0 in geode's branch refs/heads/develop from [~bschuchardt]
[ https://git-wip-us.apache.org/repos/asf?p=geode.git;h=65220a3 ]

GEODE-77: Replace JGroups 2.2.9

This adds a test ensuring that a large membership ID is properly transmitted
via JGroups.  An older version of GemFire recently ran into this problem so
I wanted to make sure it works okay in Geode with its new membership services.

              </div></li></ol></div></div></html>