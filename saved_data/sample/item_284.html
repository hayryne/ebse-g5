<!DOCTYPE html><html><div class="item-title">
        Item 284
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> TS-826 TSHttpTxnErrorBodySet() can leak memory
                </div><div><b>message:</b> TS-826 TSHttpTxnErrorBodySet() can leak memory

Author: William Bardwell
Review: leif

git-svn-id: https://svn.apache.org/repos/asf/trafficserver/traffic/trunk@1137775 13f79535-47bb-0310-9956-ffa450edef68

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> TSHttpTxnErrorBodySet() can leak memory
                </div><div><b>description:</b> TSHttpTxnErrorBodySet() sets HttpSM::t_state.internal_msg_buffer without freeing any old contents in there.
There can be an error message in that if you have a request with a bad hostname and you let the transaction get past DNS
lookup.  Instead it should free the contents, or there should be another field that it sets and nothing else does.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Patch based on what TSHttpTxnServerRequestBodySet does.
              </div></li><li><div>
                Resolved on both 3.0.x and trunk.
              </div></li><li><div><div><b>body:</b> Correct me if I'm wrong but with this patch it's still leaking mimetype. See HttpSM::setup_internal_transfer line 5416 which frees internal_msg_buffer_type...it's expected that mimetype was malloced since clearly it's being freed. So that means there is still a memory leak in TSHttpTxnErrorBodySet().
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Opened bug https://issues.apache.org/jira/browse/TS-1038
              </div></li></ol></div></div></html>