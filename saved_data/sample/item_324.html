<!DOCTYPE html><html><div class="item-title">
        Item 324
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Add cmd flag of retain key ordering (#8886)
                </div><div><b>message:</b> Add cmd flag of retain key ordering (#8886)

Signed-off-by: xiaolong.ran &lt;rxl@apache.org&gt;

Fixes #6527 

### Motivation

We already support `key_shared` mode on Pulsar Functions in #7647, However, this option is not exposed in the command line parameters, so users currently cannot use this function.

### Modifications

In this pull request, we expose this cmd flag of `--retain-key-ordering` and add the docs for this.

### Verifying this change

The original test can cover this option, so, in this change, no relevant code is added

                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li><li><div><div><b>title:</b> Having a Key_Shared mode for functions
                </div><div><b>body:</b> **Is your feature request related to a problem? Please describe.**
As functions can manipulate states, race conditions may occur if multiple instance of the same function are processed in parallel and update state for the same key. 

**Describe the solution you'd like**
having a Key_Shared mode for a function's instances - similar to Key_Shared subscription mode for consumers  - would provide the guarantee that only one function instance would run at any time for a given key

**Describe alternatives you've considered**
Another solution could be to have transactions enabled for states, but i'm not sure it's even possible with BookKeeper.

**Additional context**

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                @sijie Hi, is adding key shared mode on the roadmap soon?
              </div></li><li><div>
                @Lanayx I think @wolfstudy is picking that up already.
              </div></li><li><div>
                Yes, we already support key_shared mode on pulsar functions in #7647. 
              </div></li><li><div>
                That's great news!
              </div></li><li><div><div><b>body:</b> Does it mean this issue should be closed with 2.7? Is there somewhere in the documentation explaining how to use it this feature?
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                &gt; Does it mean this issue should be closed with 2.7? 

Yes, in 2.7.0, we can use this feature. 

&gt;  Is there somewhere in the documentation explaining how to use it this feature?

@sijie It seems that we need to expose the corresponding parameters to users. Currently, when creating pulsar function, `--retain-key-ordering` is not exposed. 


              </div></li><li><div>
                &gt; @sijie It seems that we need to expose the corresponding parameters to users. Currently, when creating pulsar function, `--retain-key-ordering` is not exposed.

Is there a turnaround to be able to use it? Is that enough to set `functionConfig.retainKeyOrdering = true` if using PulsarAdmin java?

              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Add cmd flag of retain key ordering
                </div><div><b>body:</b> Signed-off-by: xiaolong.ran &lt;rxl@apache.org&gt;

Fixes #6527 

### Motivation

We already support `key_shared` mode on Pulsar Functions in #7647, However, this option is not exposed in the command line parameters, so users currently cannot use this function.

### Modifications

In this pull request, we expose this cmd flag of `--retain-key-ordering` and add the docs for this.

### Verifying this change

The original test can cover this option, so, in this change, no relevant code is added


### Documentation

  - Does this pull request introduce a new feature? (yes)
  - If yes, how is the feature documented? (docs)
  - If a feature is not applicable for documentation, explain why?
  - If a feature is not documented yet in this PR, please create a followup issue for adding the documentation

                </div><div><b>label:</b> documentation
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>