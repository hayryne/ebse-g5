<!DOCTYPE html><html><div class="item-title">
        Item 15
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Fix elixir tests on Jenkins (#1931)
                </div><div><b>message:</b> Fix elixir tests on Jenkins (#1931)

fix flaky  elixir tests on jenkins

* Add retry_until to some flaky tests. 
* Add skip_on_jenkins tag for tests that won't pass with retry_until but pass on Travis.
* set jenkins timeout to 90 minutes


                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Jenkins fix elixir take 3
                </div><div><b>body:</b> ## Overview

Improve the reliability of Elixir tests on Jenkins.
Add retry_until to some flaky tests. Also add `:skip_on_jenkins` tag
for tests that won't pass with retry_until but pass on Travis.

## Testing recommendations
All builds should pass on Jenkins. See
https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/jenkins-fix-elixir-take-3/3/pipeline/

## Related Issues or Pull Requests

&lt;!-- If your changes affects multiple components in different
     repositories please put links to those issues or pull requests here.  --&gt;

## Checklist

- [x] Code is written and works correctly;
- [ ] Changes are covered by tests;
- [ ] Documentation reflects the changes;

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Closer, but still not there.

After merged to master, 3 builds failed, 2 because of Elixir tests. (1 was a bunch of timeouts in eunit tests.)

https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/501/pipeline :

```
ReduceTest

...
  * test Reduce pagination
  * test Reduce pagination (5015.9ms)

  1) test Reduce pagination (ReduceTest)
     test/reduce_test.exs:205
     ** (KeyError) key :status_code not found in: %HTTPotion.ErrorResponse{message: "req_timedout"}
     stacktrace:
       (foo) lib/couch/db_test.ex:165: Couch.DBTest.create_db/2
       (foo) lib/couch/db_test.ex:38: Couch.DBTest.set_db_context/1
       (elixir) lib/enum.ex:1899: Enum."-reduce/3-lists^foldl/2-0-"/3
       (foo) test/support/couch_test_case.ex:23: CouchTestCase.__ex_unit_setup_0/1
       (foo) test/support/couch_test_case.ex:1: CouchTestCase.__ex_unit__/2
       test/reduce_test.exs:1: ReduceTest.__ex_unit__/2

  * test More complex array key view row testing
  * test More complex array key view row testing (5000.5ms)

  2) test More complex array key view row testing (ReduceTest)
     test/reduce_test.exs:70
     ** (KeyError) key :status_code not found in: %HTTPotion.ErrorResponse{message: "req_timedout"}
     stacktrace:
       (foo) lib/couch/db_test.ex:165: Couch.DBTest.create_db/2
       (foo) lib/couch/db_test.ex:38: Couch.DBTest.set_db_context/1
       (elixir) lib/enum.ex:1899: Enum."-reduce/3-lists^foldl/2-0-"/3
       (foo) test/support/couch_test_case.ex:23: CouchTestCase.__ex_unit_setup_0/1
       (foo) test/support/couch_test_case.ex:1: CouchTestCase.__ex_unit__/2
       test/reduce_test.exs:1: ReduceTest.__ex_unit__/2
```

and at https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/501/pipeline/47 :

```
PartitionCrudTest

...

  * test _bulk_docs errors with bad partition key
  * test _bulk_docs errors with bad partition key (5008.7ms)

  1) test _bulk_docs errors with bad partition key (PartitionCrudTest)
     test/partition_crud_test.exs:208
     ** (KeyError) key :status_code not found in: %HTTPotion.ErrorResponse{message: "req_timedout"}
     stacktrace:
       (foo) lib/couch/db_test.ex:165: Couch.DBTest.create_db/2
       (foo) lib/couch/db_test.ex:38: Couch.DBTest.set_db_context/1
       (elixir) lib/enum.ex:1899: Enum."-reduce/3-lists^foldl/2-0-"/3
       (foo) test/support/couch_test_case.ex:23: CouchTestCase.__ex_unit_setup_0/1
       (foo) test/support/couch_test_case.ex:1: CouchTestCase.__ex_unit__/2
       test/partition_crud_test.exs:1: PartitionCrudTest.__ex_unit__/2
```
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>