<!DOCTYPE html><html><div class="item-title">
        Item 366
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
 * garrow_uint8_array_sum:
 * @array: A #GArrowUInt8Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_double_array_sum:
 * @array: A #GArrowDoubleArray.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_int16_array_sum:
 * @array: A #GArrowInt16Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_int8_array_sum:
 * @array: A #GArrowInt8Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_float_array_sum:
 * @array: A #GArrowFloatArray.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_uint16_array_sum:
 * @array: A #GArrowUInt16Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_uint32_array_sum:
 * @array: A #GArrowUInt32Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_uint64_array_sum:
 * @array: A #GArrowUInt64Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_int64_array_sum:
 * @array: A #GArrowInt64Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                *
 * garrow_int32_array_sum:
 * @array: A #GArrowInt32Array.
 * @error: (nullable): Return location for a #GError or %NULL.
 *
 * Returns: The value of the computed sum on success,
 *   If an error is occurred, the returned value is untrustful value.
 *
 * Since: 0.13.0
 
              </div></li><li><div>
                 IWYU pragma: export
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ARROW-4882: [GLib] Add sum functions
                </div><div><b>message:</b> ARROW-4882: [GLib] Add sum functions

Author: Yosuke Shiro &lt;yosuke.shiro615@gmail.com&gt;
Author: Kouhei Sutou &lt;kou@clear-code.com&gt;

Closes #3933 from shiro615/glib-sum and squashes the following commits:

1fe8805c &lt;Kouhei Sutou&gt; Add test for empty case
4393487b &lt;Kouhei Sutou&gt; Add NULL check
adbebca5 &lt;Yosuke Shiro&gt; Fix typos
6ebe5a02 &lt;Yosuke Shiro&gt; Align
c1361034 &lt;Yosuke Shiro&gt; Fix documents
3a079dfc &lt;Yosuke Shiro&gt; Implement a template function that can be used by all sum functions
316d3cae &lt;Yosuke Shiro&gt;  Add sum functions

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> ARROW-4882: [GLib] Add sum functions
                </div><div><b>body:</b> 
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                # [Codecov](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=h1) Report
&gt; Merging [#3933](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/c707822d01ccba02c823d14426188943ce7a4cdb?src=pr&amp;el=desc) will **increase** coverage by `0.82%`.
&gt; The diff coverage is `n/a`.

[![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/3933/graphs/tree.svg?width=650&amp;token=LpTCFbqVT1&amp;height=150&amp;src=pr)](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=tree)

```diff
@@            Coverage Diff             @@
##           master    #3933      +/-   ##
==========================================
+ Coverage   87.74%   88.56%   +0.82%     
==========================================
  Files         727      593     -134     
  Lines       89499    79916    -9583     
  Branches     1252        0    -1252     
==========================================
- Hits        78532    70780    -7752     
+ Misses      10849     9136    -1713     
+ Partials      118        0     -118
```


| [Impacted Files](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=tree) | Coverage Δ | |
|---|---|---|
| [cpp/src/plasma/thirdparty/ae/ae.c](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-Y3BwL3NyYy9wbGFzbWEvdGhpcmRwYXJ0eS9hZS9hZS5j) | `70.75% &lt;0%&gt; (-0.95%)` | :arrow_down: |
| [python/pyarrow/tests/test\_convert\_pandas.py](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9jb252ZXJ0X3BhbmRhcy5weQ==) | `94.82% &lt;0%&gt; (ø)` | :arrow_up: |
| [cpp/src/arrow/util/cpu-info.cc](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL2NwdS1pbmZvLmNj) | `75% &lt;0%&gt; (ø)` | :arrow_up: |
| [python/pyarrow/pandas\_compat.py](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-cHl0aG9uL3B5YXJyb3cvcGFuZGFzX2NvbXBhdC5weQ==) | `93.68% &lt;0%&gt; (ø)` | :arrow_up: |
| [go/arrow/math/uint64\_amd64.go](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-Z28vYXJyb3cvbWF0aC91aW50NjRfYW1kNjQuZ28=) | | |
| [go/arrow/memory/memory\_avx2\_amd64.go](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-Z28vYXJyb3cvbWVtb3J5L21lbW9yeV9hdngyX2FtZDY0Lmdv) | | |
| [js/src/enum.ts](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-anMvc3JjL2VudW0udHM=) | | |
| [go/arrow/array/builder.go](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-Z28vYXJyb3cvYXJyYXkvYnVpbGRlci5nbw==) | | |
| [js/src/Arrow.node.ts](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-anMvc3JjL0Fycm93Lm5vZGUudHM=) | | |
| [js/src/schema.ts](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree#diff-anMvc3JjL3NjaGVtYS50cw==) | | |
| ... and [128 more](https://codecov.io/gh/apache/arrow/pull/3933/diff?src=pr&amp;el=tree-more) | |

------

[Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=continue).
&gt; **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)
&gt; `Δ = absolute &lt;relative&gt; (impact)`, `ø = not affected`, `? = missing data`
&gt; Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=footer). Last update [c707822...1fe8805](https://codecov.io/gh/apache/arrow/pull/3933?src=pr&amp;el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).

              </div></li><li><div>
                Thanks!
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Can we create a template function that can be used by all `sum` functions?

```diff
diff --git a/c_glib/arrow-glib/basic-array.cpp b/c_glib/arrow-glib/basic-array.cpp
index deedc0fe..4db6a564 100644
--- a/c_glib/arrow-glib/basic-array.cpp
+++ b/c_glib/arrow-glib/basic-array.cpp
@@ -92,6 +92,28 @@ garrow_numeric_array_get_sum_value_raw(std::shared_ptr&lt;arrow::Scalar&gt; scalar)
   return arrow_numeric_scalar-&gt;value;
 };
 
+template &lt;typename ArrowType, typename GArrowArrayType&gt;
+typename ArrowType::c_type
+garrow_numeric_array_sum(GArrowArrayType array,
+                         GError **error,
+                         const gchar *tag,
+                         typename ArrowType::c_type default_value)
+{
+  auto arrow_array = garrow_array_get_raw(GARROW_ARRAY(array));
+  auto memory_pool = arrow::default_memory_pool();
+  arrow::compute::FunctionContext context(memory_pool);
+  arrow::compute::Datum sum_datum;
+  auto status = arrow::compute::Sum(&amp;context, arrow_array, &amp;sum_datum);
+  if (garrow_error_check(error, status, tag)) {
+    using ScalarType = typename arrow::TypeTraits&lt;ArrowType&gt;::ScalarType;
+    auto arrow_numeric_scalar =
+      std::dynamic_pointer_cast&lt;ScalarType&gt;(sum_datum.scalar());
+    return arrow_numeric_scalar-&gt;value;
+  } else {
+    return default_value;
+  }
+}
+
 G_BEGIN_DECLS
 
 /**
@@ -1062,16 +1084,10 @@ gint8
 garrow_int8_array_sum(GArrowInt8Array *array,
                       GError **error)
 {
-  auto arrow_array = garrow_array_get_raw(GARROW_ARRAY(array));
-  auto memory_pool = arrow::default_memory_pool();
-  arrow::compute::FunctionContext context(memory_pool);
-  arrow::compute::Datum sum_datum;
-  auto status = arrow::compute::Sum(&amp;context, arrow_array, &amp;sum_datum);
-  if (garrow_error_check(error, status, "[int8-array][sum]")) {
-    return garrow_numeric_array_get_sum_value_raw&lt;arrow::Int64Type&gt;(sum_datum.scalar());
-  } else {
-    return 0;
-  }
+  return garrow_numeric_array_sum&lt;arrow::Int64Type&gt;(array,
+                                                    error,
+                                                    "[int8-array][sum]",
+                                                    0);
 }
```
              </div></li><li><div>
                Should we use `gint64` instead of `gint8`?
              </div></li><li><div>
                "0 on error" is misleading. 0 is one of a valid value. Users should not use 0 as an error indicator.
              </div></li><li><div>
                Thanks! I've updated a template function.
              </div></li><li><div>
                Yes. I've fixed it.
              </div></li><li><div>
                I've fixed documents.
              </div></li><li><div>
                Note that it may also return NULL, and this should not be an error, so the "true" return type is `option&lt;T&gt;`.
              </div></li><li><div>
                Thanks.
We need to add a NULL check, then.
              </div></li><li><div>
                I've added.
We use zero for the case because we can't implement `option&lt;T&gt;` in C for primitive types.
              </div></li><li><div>
                Oh, sorry. I missed it.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> [GLib] Add "Sum" functions
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Issue resolved by pull request 3933
[https://github.com/apache/arrow/pull/3933]
              </div></li></ol></div></div></html>