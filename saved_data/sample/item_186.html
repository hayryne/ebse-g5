<!DOCTYPE html><html><div class="item-title">
        Item 186
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 The _record_key() returns zero if there is no host. The qdr_http_request_info_t (record) should not even be created
 if the passed in host parameter is zero. There is no point in having a record without a key.

              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> DISPATCH-1973: Do not record the http request without a record key. Sometimes a host might not be available to create a record key
                </div><div><b>message:</b> DISPATCH-1973: Do not record the http request without a record key. Sometimes a host might not be available to create a record key

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> ASan failure in system_tests_http2 in _update_qdr_http_request_info
                </div><div><b>description:</b> https://travis-ci.com/github/apache/qpid-dispatch/jobs/484883505#L6017

{noformat}
68: test_put_request (system_tests_http2.Http2TestOneInteriorRouter) ... ok
68: test_zzz_http_connector_delete (system_tests_http2.Http2TestOneInteriorRouter) ... ERROR
68: 
68: Router QDR output file:
68: &gt;&gt;&gt;&gt;
68: /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:29: runtime error: null pointer passed as argument 2, which is declared to never be null
68: /usr/include/string.h:138:33: note: nonnull attribute specified here
68: SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:29 in 
68: AddressSanitizer:DEADLYSIGNAL
68: =================================================================
68: ==18183==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x00000042f665 bp 0x7fba8afa91e0 sp 0x7fba8afa8980 T1)
68: ==18183==The signal is caused by a READ memory access.
68: ==18183==Hint: address points to the zero page.
68:     #0 0x42f665 in strcmp (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x42f665)
68:     #1 0x7fba90ba1c2c in _update_qdr_http_request_info /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:9
68:     #2 0x7fba90ba1c2c in _add_http_request_info_CT /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:618:13
68:     #3 0x7fba90d9f611 in router_core_thread /home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:239:13
68:     #4 0x7fba9088f608 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x9608)
68:     #5 0x7fba900ba292 in clone (/lib/x86_64-linux-gnu/libc.so.6+0x122292)
68: 
68: AddressSanitizer can not provide additional info.
68: SUMMARY: AddressSanitizer: SEGV (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x42f665) in strcmp
68: Thread T1 created by T0 here:
68:     #0 0x480f0a in pthread_create (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x480f0a)
68:     #1 0x7fba90ccc5bd in sys_thread /home/travis/build/apache/qpid-dispatch/src/posix/threading.c:181:5
68:     #2 0x7fba90d80750 in qdr_core /home/travis/build/apache/qpid-dispatch/src/router_core/router_core.c:121:20
68:     #3 0x7fba90e0d838 in qd_router_setup_late /home/travis/build/apache/qpid-dispatch/src/router_node.c:2071:31
68:     #4 0x7fba8d00cff4  (/lib/x86_64-linux-gnu/libffi.so.7+0x6ff4)
68: LLVMSymbolizer: error reading file: No such file or directory
68:     #5 0x7ffcdfd9e62f  ([stack]+0x1e62f)
68: 
68: ==18183==ABORTING
68: 
68: &lt;&lt;&lt;&lt;
68: 
68: Router QDR command file:
68: &gt;&gt;&gt;&gt;
68: qdrouterd -c http2-test-router.conf -I /home/travis/build/apache/qpid-dispatch/python
68: pid=18183
68: 
68: &lt;&lt;&lt;&lt;
68: 
68: Router QDR log file tail:
68: &gt;&gt;&gt;&gt;
68: 2021-02-21 15:00:35.166602 +0000 AGENT (debug) Agent response:
68:   Message(address='amqp:/_topo/0/QDR/temp.nyzZ1TDOXPfXXyF', properties={'statusCode': 204, 'statusDescription': 'No Content'}, body={}, reply_to=None, correlation_id='1', content_type=None)
68:   Responding to: 
68:   Message(address=None, properties={'operation': 'DELETE', 'type': 'org.apache.qpid.dispatch.httpConnector', 'name': 'connectorToBeDeleted'}, body={}, reply_to='amqp:/_topo/0/QDR/temp.nyzZ1TDOXPfXXyF', correlation_id='1', content_type=None) (/home/travis/build/apache/qpid-dispatch/python/qpid_dispatch_internal/management/agent.py:955)
68: 2021-02-21 15:00:35.166813 +0000 ROUTER_CORE (trace) Core action 'send_to' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.166851 +0000 HTTP_ADAPTOR (trace) [C1] PN_RAW_CONNECTION_WAKE Wake-up (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2292)
68: 2021-02-21 15:00:35.166878 +0000 HTTP_ADAPTOR (trace) [C1] PN_RAW_CONNECTION_CLOSED_READ (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2256)
68: 2021-02-21 15:00:35.166902 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery created qdr_forward_new_delivery_CT (/home/travis/build/apache/qpid-dispatch/src/router_core/forwarder.c:158)
68: 2021-02-21 15:00:35.166921 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery incref:    rc:1  qdr_forward_deliver_CT - add to undelivered list (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:113)
68: 2021-02-21 15:00:35.166954 +0000 HTTP_ADAPTOR (trace) [C1] PN_RAW_CONNECTION_CLOSED_WRITE (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2260)
68: 2021-02-21 15:00:35.166988 +0000 HTTP_ADAPTOR (trace) [C1] PN_RAW_CONNECTION_READ Read 0 bytes (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2298)
68: 2021-02-21 15:00:35.167000 +0000 HTTP_ADAPTOR (trace) [C1] Egress PN_RAW_CONNECTION_DISCONNECTED (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2268)
68: 2021-02-21 15:00:35.167009 +0000 HTTP_ADAPTOR (trace) [C1] Setting conn-&gt;pn_raw_conn=0 (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2072)
68: 2021-02-21 15:00:35.167017 +0000 HTTP_ADAPTOR (trace) [C1] Detaching stream dispatcher link on egress connection, freed associated stream data (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2082)
68: 2021-02-21 15:00:35.167053 +0000 PROTOCOL (trace) [C1] Freeing stream_data (stream_dispatcher, handle_disconnected) (61500000b9d0) (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:2087)
68: 2021-02-21 15:00:35.167099 +0000 ROUTER_CORE (trace) Core action 'link_detach' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167128 +0000 ROUTER_MA (debug) No Longer Local Dest: M0examples (/home/travis/build/apache/qpid-dispatch/src/router_core/modules/mobile_sync/mobile.c:763)
68: 2021-02-21 15:00:35.167166 +0000 ROUTER_CORE (debug) [C16][L50][D49] Delivery decref:    rc:1  removed reference from pn_delivery (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167193 +0000 ROUTER_CORE (debug) [C16][L50][D49] Delivery decref:    rc:0  qdr_connection_process - remove from updated list (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167238 +0000 PROTOCOL (trace) [C16]:FRAME: 0 -&gt; @flow(19) [next-incoming-id=1, incoming-window=2147483647, next-outgoing-id=0, outgoing-window=2147483647, handle=0, delivery-count=1, link-credit=250, drain=false] (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.167265 +0000 PROTOCOL (trace) [C16]:FRAME: 0 -&gt; @disposition(21) [role=true, first=0, settled=true, state=@accepted(36) []] (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.167353 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery incref:    rc:2  qdr_link_process_deliveries - holding the undelivered delivery locally (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:113)
68: 2021-02-21 15:00:35.167387 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery incref:    rc:3  referenced by a pn_delivery (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:113)
68: 2021-02-21 15:00:35.167410 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery decref:    rc:2  removed reference from pn_delivery (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167430 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery decref:    rc:1  qdr_link_process_deliveries - remove from undelivered list (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167445 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery decref:    rc:0  qdr_link_process_deliveries - release local reference - done processing (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167500 +0000 PROTOCOL (trace) [C16]:FRAME: 0 -&gt; @transfer(20) [handle=1, delivery-id=0, delivery-tag=b"\x18\x00\x00\x00\x00\x00\x00\x00", message-format=0, settled=true] (144) "\x00Sp\xd0\x00\x00\x00\x05\x00\x00\x00\x01B\x00Ss\xd0\x00\x00\x003\x00\x00\x00\x06@@\xa1&amp;amqp:/_topo/0/QDR/temp.nyzZ1TDOXPfXXyF@@\xa1\x011\x00St\xd1\x00\x00\x004\x00\x00\x00\x04\xa1\x0astatusCodeq\x00\x00\x00\xcc\xa1\x11statusDescription\xa1\x0aNo Content\x00Sw\xd1\x00\x00\x00\x04\x00\x00\x00\x00" (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.167559 +0000 ROUTER_CORE (trace) Core action 'connection_closed' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167585 +0000 ROUTER_CORE (info) [C1][L1] Link closed due to connection loss: del=11 presett=0 psdrop=0 acc=0 rej=0 rel=0 mod=0 delay1=0 delay10=0 blocked=no (/home/travis/build/apache/qpid-dispatch/src/router_core/connections.c:1054)
68: 2021-02-21 15:00:35.167604 +0000 ROUTER_CORE (info) [C1][L44] Link closed due to connection loss: del=1 presett=0 psdrop=0 acc=0 rej=0 rel=0 mod=0 delay1=0 delay10=0 blocked=no (/home/travis/build/apache/qpid-dispatch/src/router_core/connections.c:1054)
68: 2021-02-21 15:00:35.167619 +0000 ROUTER_CORE (info) [C1][L45] Link closed due to connection loss: del=1 presett=0 psdrop=0 acc=0 rej=0 rel=1 mod=0 delay1=0 delay10=0 blocked=no (/home/travis/build/apache/qpid-dispatch/src/router_core/connections.c:1054)
68: 2021-02-21 15:00:35.167647 +0000 ROUTER_CORE (info) [C1] Connection Closed (/home/travis/build/apache/qpid-dispatch/src/router_core/connections.c:1531)
68: 2021-02-21 15:00:35.167674 +0000 ROUTER_CORE (trace) Core action 'delete_http2_connection' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167687 +0000 HTTP_ADAPTOR (trace) [C1][S21] Freeing stream in free_qdr_http2_connection (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:350)
68: 2021-02-21 15:00:35.167711 +0000 HTTP_ADAPTOR (debug) Adding http request info (null) (/home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:688)
68: 2021-02-21 15:00:35.167733 +0000 HTTP_ADAPTOR (trace) [C1][S21] Freeing stream_data in free_http2_stream_data (61500000b4d0) (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:313)
68: 2021-02-21 15:00:35.167748 +0000 ROUTER_CORE (debug) [C1][L44][D42] Delivery decref:    rc:0  HTTP2 adaptor out_dlv - free_http2_stream_data (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:147)
68: 2021-02-21 15:00:35.167812 +0000 HTTP_ADAPTOR (trace) [C1] Freeing http2 connection in free_qdr_http2_connection (/home/travis/build/apache/qpid-dispatch/src/adaptors/http2/http2_adaptor.c:385)
68: 2021-02-21 15:00:35.167829 +0000 ROUTER_CORE (trace) Core action 'qdr_connection_process - remove from updated list' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167860 +0000 ROUTER_CORE (debug) [C16][L50][D49] Delivery outcome : is accepted (0x24) (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:395)
68: 2021-02-21 15:00:35.167874 +0000 ROUTER_CORE (trace) Core action 'qdr_link_process_deliveries - release local reference - done processing' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167890 +0000 ROUTER_CORE (debug) [C16][L51][D50] Delivery outcome pre-settled: is unknown (0x0) (/home/travis/build/apache/qpid-dispatch/src/router_core/delivery.c:395)
68: 2021-02-21 15:00:35.167916 +0000 ROUTER_CORE (trace) Core action 'link_flow' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.167928 +0000 ROUTER_CORE (trace) Core action 'add_http_request_info' (/home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:238)
68: 2021-02-21 15:00:35.189944 +0000 PROTOCOL (trace) [C16]:FRAME: 0 -&gt; @close(24) [error=@error(29) [condition=:"amqp:connection:framing-error", description="connection aborted"]] (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.190017 +0000 PROTOCOL (trace) [C16]:FRAME:   &lt;- EOS (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.190046 +0000 SERVER (info) [C16] Connection from 127.0.0.1:36658 (to 0.0.0.0:22053) failed: amqp:connection:framing-error connection aborted (/home/travis/build/apache/qpid-dispatch/src/server.c:1075)
68: 2021-02-21 15:00:35.190121 +0000 PROTOCOL (trace) [C16]:FRAME:   -&gt; EOS (/home/travis/build/apache/qpid-dispatch/src/server.c:113)
68: 2021-02-21 15:00:35.190146 +0000 CONTAINER (debug) Aborting link 'f740a2bb-41f8-4e0d-a1e4-d78818124bca-$management' due to parent connection end (/home/travis/build/apache/qpid-dispatch/src/container.c:331)
68: 2021-02-21 15:00:35.190222 +0000 CONTAINER (debug) Aborting link 'f740a2bb-41f8-4e0d-a1e4-d78818124bca-5d895ca1-2019-4183-b35a-3bc9f6714106' due to parent connection end (/home/travis/build/apache/qpid-dispatch/src/container.c:331)
68: 
68: &lt;&lt;&lt;&lt;
68: ERROR
68: test_000_stats (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_404 (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_500 (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_delete_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_get_image_jpg (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: /usr/lib/python3.8/unittest/suite.py:107: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name=5 encoding='UTF-8'&gt;
68:   for index, test in enumerate(self):
68: ResourceWarning: Enable tracemalloc to get the object allocation traceback
68: test_get_image_png (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: /usr/lib/python3.8/unittest/suite.py:107: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name=5 encoding='UTF-8'&gt;
68:   for index, test in enumerate(self):
68: ResourceWarning: Enable tracemalloc to get the object allocation traceback
68: test_get_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_head_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_patch_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_post_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_put_request (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_zzz_http_connector_delete (system_tests_http2.Http2TestOneStandaloneRouter) ... ok
68: test_000_stats (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_404 (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_500 (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_delete_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_get_image_jpg (system_tests_http2.Http2TestTwoRouter) ... ok
68: /usr/lib/python3.8/unittest/suite.py:107: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name=10 encoding='UTF-8'&gt;
68:   for index, test in enumerate(self):
68: ResourceWarning: Enable tracemalloc to get the object allocation traceback
68: test_get_image_png (system_tests_http2.Http2TestTwoRouter) ... ok
68: /usr/lib/python3.8/unittest/suite.py:107: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name=10 encoding='UTF-8'&gt;
68:   for index, test in enumerate(self):
68: ResourceWarning: Enable tracemalloc to get the object allocation traceback
68: test_get_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_head_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_patch_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_post_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_put_request (system_tests_http2.Http2TestTwoRouter) ... ok
68: test_zzz_http_connector_delete (system_tests_http2.Http2TestTwoRouter) ... ok
68: 
68: Router QDR.B debug dump file:
68: &gt;&gt;&gt;&gt;
68: alloc.c: Items of type 'qd_timer_t' remain allocated at shutdown: 1 (SUPPRESSED)
68: alloc.c: Items of type 'qd_connector_t' remain allocated at shutdown: 1 (SUPPRESSED)
68: 
68: &lt;&lt;&lt;&lt;
68: 
68: ======================================================================
68: ERROR: test_zzz_http_connector_delete (system_tests_http2.Http2TestOneInteriorRouter)
68: ----------------------------------------------------------------------
68: Traceback (most recent call last):
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 1176, in __call__
68:     p.teardown()
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 313, in teardown
68:     error("exit code %s, expected %s" % (status, self.expect))
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 301, in error
68:     raise RuntimeError("Process %s error: %s\n%s\n%s\n&gt;&gt;&gt;&gt;\n%s&lt;&lt;&lt;&lt;" % (
68: RuntimeError: Process 18208 error: exit code 1, expected 0
68: qdmanage QUERY --type=org.apache.qpid.dispatch.httpConnector --bus amqp://0.0.0.0:22053 --indent=-1 --timeout 60.0
68: /home/travis/build/apache/qpid-dispatch/build/tests/system_test.dir/system_tests_http2/Http2TestOneInteriorRouter/test_zzz_http_connector_delete/qdmanage-121.cmd
68: &gt;&gt;&gt;&gt;
68: &lt;&lt;&lt;&lt;
68: 
68: During handling of the above exception, another exception occurred:
68: 
68: Traceback (most recent call last):
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 929, in wrap
68:     return f(*args, **kwargs)
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_tests_http2.py", line 431, in test_zzz_http_connector_delete
68:     self.check_connector_delete(client_addr=self.router_qdra.http_addresses[0],
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_tests_http2.py", line 228, in check_connector_delete
68:     http_connectors  = qd_manager.query('org.apache.qpid.dispatch.httpConnector')
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 1208, in query
68:     return json.loads(self('QUERY --type=%s' % long_type))
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 1178, in __call__
68:     raise Exception("%s\n%s" % (e, out))
68: Exception: Process 18208 error: exit code 1, expected 0
68: qdmanage QUERY --type=org.apache.qpid.dispatch.httpConnector --bus amqp://0.0.0.0:22053 --indent=-1 --timeout 60.0
68: /home/travis/build/apache/qpid-dispatch/build/tests/system_test.dir/system_tests_http2/Http2TestOneInteriorRouter/test_zzz_http_connector_delete/qdmanage-121.cmd
68: &gt;&gt;&gt;&gt;
68: &lt;&lt;&lt;&lt;
68: ConnectionException: Connection amqp://0.0.0.0:22053 disconnected: Condition('proton.pythonio', 'Connection refused to all addresses')
68: 
68: 
68: ======================================================================
68: ERROR: tearDownClass (system_tests_http2.Http2TestOneInteriorRouter)
68: ----------------------------------------------------------------------
68: Traceback (most recent call last):
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 863, in tearDownClass
68:     cls.tester.teardown()
68:   File "/home/travis/build/apache/qpid-dispatch/tests/system_test.py", line 806, in teardown
68:     raise RuntimeError("Errors during teardown: \n\n%s" % "\n\n".join([str(e) for e in errors]))
68: RuntimeError: Errors during teardown: 
68: 
68: Process 18183 error: exit code 1, expected -1
68: qdrouterd -c http2-test-router.conf -I /home/travis/build/apache/qpid-dispatch/python
68: /home/travis/build/apache/qpid-dispatch/build/tests/system_test.dir/system_tests_http2/Http2TestOneInteriorRouter/setUpClass/http2-test-router-45.cmd
68: &gt;&gt;&gt;&gt;
{noformat}

{noformat}
68: /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:29: runtime error: null pointer passed as argument 2, which is declared to never be null
68: /usr/include/string.h:138:33: note: nonnull attribute specified here
68: SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:29 in 
68: AddressSanitizer:DEADLYSIGNAL
68: =================================================================
68: ==18183==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x00000042f665 bp 0x7fba8afa91e0 sp 0x7fba8afa8980 T1)
68: ==18183==The signal is caused by a READ memory access.
68: ==18183==Hint: address points to the zero page.
68:     #0 0x42f665 in strcmp (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x42f665)
68:     #1 0x7fba90ba1c2c in _update_qdr_http_request_info /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:596:9
68:     #2 0x7fba90ba1c2c in _add_http_request_info_CT /home/travis/build/apache/qpid-dispatch/src/adaptors/http_common.c:618:13
68:     #3 0x7fba90d9f611 in router_core_thread /home/travis/build/apache/qpid-dispatch/src/router_core/router_core_thread.c:239:13
68:     #4 0x7fba9088f608 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x9608)
68:     #5 0x7fba900ba292 in clone (/lib/x86_64-linux-gnu/libc.so.6+0x122292)
68: 
68: AddressSanitizer can not provide additional info.
68: SUMMARY: AddressSanitizer: SEGV (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x42f665) in strcmp
68: Thread T1 created by T0 here:
68:     #0 0x480f0a in pthread_create (/home/travis/build/apache/qpid-dispatch/build/router/qdrouterd+0x480f0a)
68:     #1 0x7fba90ccc5bd in sys_thread /home/travis/build/apache/qpid-dispatch/src/posix/threading.c:181:5
68:     #2 0x7fba90d80750 in qdr_core /home/travis/build/apache/qpid-dispatch/src/router_core/router_core.c:121:20
68:     #3 0x7fba90e0d838 in qd_router_setup_late /home/travis/build/apache/qpid-dispatch/src/router_node.c:2071:31
68:     #4 0x7fba8d00cff4  (/lib/x86_64-linux-gnu/libffi.so.7+0x6ff4)
68: LLVMSymbolizer: error reading file: No such file or directory
68:     #5 0x7ffcdfd9e62f  ([stack]+0x1e62f)
68: 
68: ==18183==ABORTING
68: &lt;&lt;&lt;&lt;
68: 
68: ----------------------------------------------------------------------
68: Ran 77 tests in 78.454s
68: 
68: FAILED (errors=2)
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68: 'utf-8' codec can't decode byte 0xff in position 237: invalid start byte
68/73 Test #68: system_tests_http2 ................................***Failed   82.82 sec
{noformat}
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> This seems to happen very rarely.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Commit a0451227c7480e89b0892ffa962e77d157ffc370 in qpid-dispatch's branch refs/heads/master from Ganesh Murthy
[ https://gitbox.apache.org/repos/asf?p=qpid-dispatch.git;h=a045122 ]

DISPATCH-1973: Do not record the http request without a record key. Sometimes a host might not be available to create a record key

              </div></li></ol></div></div></html>