<!DOCTYPE html><html><div class="item-title">
        Item 247
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Use EJSON compare NIF only if OTP version &gt; R14B03
                </div><div><b>message:</b> Use EJSON compare NIF only if OTP version &gt; R14B03

COUCHDB-1267


git-svn-id: https://svn.apache.org/repos/asf/couchdb/trunk@1167626 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li><li><div><div><b>summary:</b> Bignums in views aren't sorted correctly.
                </div><div><b>description:</b> Easily tested by creating a doc and hitting this as a temp view:

function(doc) {
  emit(["bylatest",-1303085266000], null);
  emit(["bylatest",-1298817134000], null);
  emit(["bylatest",-1294536544000], null);
  emit(["bylatest",-1294505612000], null);
  emit(["bylatest",-1178704800000], null);
}


                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Should've also mentioned this was reported by mattopenstack on IRC.
              </div></li><li><div>
                Simplified test case showing this is in enif_compare/2 is at [1]. I submitted upstream to erlang-bugs at [2].

Now we need to decide what to do about ejson_compare. For now we should probably disable it until further notice. Unordered views are nobody's friend.


[1] https://github.com/davisp/enif_cmp_bug
[2] http://erlang.org/pipermail/erlang-bugs/2011-August/002565.html
              </div></li><li><div><div><b>body:</b> +1 on disabling/removing this until there's a fix or a workaround. Trunk can be a little broken, from time to time, but this is pretty big.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                The corresponding OTP patch landed into OTP's dev branch, which means the fix will be in R14B04 (to be released by early October afaik):

https://github.com/erlang/otp/commit/262a9af33d3ceb4cb032c434b100cea7d4b0d60e

I just updated configure.ac to enable the NIF only if the OTP version is &gt; R14B03.
Leaving this ticket open for a while however.
              </div></li><li><div>
                This has been fixed in Erlang R14B04.
              </div></li></ol></div></div></html>