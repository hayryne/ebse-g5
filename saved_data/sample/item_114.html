<!DOCTYPE html><html><div class="item-title">
        Item 114
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Merge pull request #569 from pwendell/merge-fixes.
                </div><div><b>message:</b> Merge pull request #569 from pwendell/merge-fixes.

Fixes bug where merges won't close associated pull request.

Previously we added "Closes #XX" in the title. Github will sometimes
linbreak the title in a way that causes this to not work. This patch
instead adds the line in the body.

This also makes the commit format more concise for merge commits.
We might consider just dropping those in the future.

Author: Patrick Wendell &lt;pwendell@gmail.com&gt;

Closes #569 and squashes the following commits:

732eba1 [Patrick Wendell] Fixes bug where merges won't close associated pull request.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Fix SPARK-1629: Spark should inline use of commons-lang `SystemUtils.IS_...
                </div><div><b>body:</b> ...OS_WINDOWS`

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Can one of the admins verify this patch?

              </div></li><li><div>
                Jenkins, test this please.

Looks good to me, pending tests.

              </div></li><li><div>
                Jenkins, test this please.

              </div></li><li><div>
                 Merged build triggered. 

              </div></li><li><div>
                Merged build started. 

              </div></li><li><div>
                Merged build finished. All automated tests passed.

              </div></li><li><div>
                All automated tests passed.
Refer to this link for build results: https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/14526/

              </div></li><li><div>
                I am still catching up on PR's and bugs.
Why was this changed ?
Hacky solutions based on string parsing of properties lead to fragility in case of changes in future.
Since we are already depending on apache commons, makes sense to delegate to that.

              </div></li><li><div>
                The problem was that the project was not depending on commons lang already.
The code is the same as is contained in commons lang. The property being
referenced is a standard JVM property.
On May 3, 2014 9:34 PM, "Mridul Muralidharan" notifications@github.com
wrote:

&gt; I am still catching up on PR's and bugs.
&gt; Why was this changed ?
&gt; Hacky solutions based on string parsing of properties lead to fragility in
&gt; case of changes in future.
&gt; Since we are already depending on apache commons, makes sense to delegate
&gt; to that.
&gt; 
&gt; —
&gt; Reply to this email directly or view it on GitHubhttps://github.com/apache/spark/pull/569#issuecomment-42115677
&gt; .

              </div></li><li><div>
                Maven dependency still shows org.apache.commons:commons-lang3:jar - am I missing something here ?

Btw, we do depend on it for repl tests too ...

              </div></li><li><div>
                Yes, but those are transitive dependencies. `core` happens to bring in both lang and lang3, and this was using the old lang dependency even. It would be correct-er to either depend directly on it, or not use it. To me it seems better to inline what amounts to one-liner access of a standard system property. 

I think it's also true that Guava is the go-to utility package and would be better to use Guava where possible rather than encourage use of lang too.

The use of lang3 in ReplSuite should also either be 'inlined', or else supplemented with a direct test-scope dependency. It's just a test, so not as big of an issue. I think the one use can even be replaced with a simple escape, which I presume is there to handle backslash on Windows.

              </div></li><li><div>
                If we are depending on something and bundling it, we might as well use it
instead of duplicating code and having to maintain the changes : assuming
it is intutive to use.
Since apache commons is used by whole bunch of projects, bugs would be
better reported and fixed there than hacked up code within spark.

The long term maintenance cost adds up for these 'small' changes.
Things like os.name.tolowercase startswith windows or file.separator ==\
are hacks we should avoid and let others handle if being maintained.

Regards
Mridul
On May 4, 2014 12:55 PM, "Sean Owen" notifications@github.com wrote:

&gt; Yes, but those are transitive dependencies. core happens to bring in both
&gt; lang and lang3, and this was using the old lang dependency even. It would
&gt; be correct-er to either depend directly on it, or not use it. To me it
&gt; seems better to inline what amounts to one-liner access of a standard
&gt; system property.
&gt; 
&gt; I think it's also true that Guava is the go-to utility package and would
&gt; be better to use Guava where possible rather than encourage use of lang too.
&gt; 
&gt; The use of lang3 in ReplSuite should also either be 'inlined', or else
&gt; supplemented with a direct test-scope dependency. It's just a test, so not
&gt; as big of an issue. I think the one use can even be replaced with a simple
&gt; escape, which I presume is there to handle backslash on Windows.
&gt; 
&gt; —
&gt; Reply to this email directly or view it on GitHubhttps://github.com/apache/spark/pull/569#issuecomment-42126473
&gt; .

              </div></li><li><div>
                That makes sense. Since Tachyon now brings in `lang3`, it is no extra burden to use it. It would rationalize the use in `ReplSuite`. Anyone second a PR a to bring _back_ use of Commons Lang, but the latest `lang3` version? 

              </div></li><li><div>
                Yes, lang3 - not lang : some of the methods (for example, the escape method
used in repl) is actually broken in lang, but works in lang3.

On Sun, May 4, 2014 at 10:09 PM, Sean Owen notifications@github.com wrote:

&gt; That makes sense. Since Tachyon now brings in lang3, it is no extra
&gt; burden to use it. It would rationalize the use in ReplSuite. Anyone
&gt; second a PR a to bring _back_ use of Commons Lang, but the latest lang3version?
&gt; 
&gt; —
&gt; Reply to this email directly or view it on GitHubhttps://github.com/apache/spark/pull/569#issuecomment-42137398
&gt; .

              </div></li><li><div>
                I'm ambivalent between inlining this and fixing up the dependency. In general we should probably rely on other utilities where possible, but if the JVM ever changes the way windows machines identify themselves in a non-backwards-compatible fashion, I will eat my shoe.

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                @srowen

``` scala
def isWindows(): Boolean = {
  try {
    val osName = System.getProperty("os.name")
    osName != null &amp;&amp; osName.startsWith("Windows")
  } catch {
    case e: SecurityException =&gt; (log a warning and return false)
  }
}
```

You think here will be thrown a SecurityException .Why?

              </div></li><li><div>
                Regarding `SecurityException`, `System.getProperty` will often be disallowed in an environment where the security manager has been enabled. I strongly suspect that the rest of Spark fails already in such an environment for other reasons, and you could argue that the only reasonable response here is to fail rather than "guess" that the environment is not Windows. But I put it in mostly to mimic `SystemUtils`. It could go either way.

              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>