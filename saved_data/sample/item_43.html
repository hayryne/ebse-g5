<!DOCTYPE html><html><div class="item-title">
        Item 43
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> MINOR: Prohibit setting StreamsConfig commit.interval.ms to a negative value (#5809)
                </div><div><b>message:</b> MINOR: Prohibit setting StreamsConfig commit.interval.ms to a negative value (#5809)

Reviewers: Guozhang Wang &lt;guozhang@confluent.io&gt;, Matthias J. Sax &lt;matthias@confluent.io&gt;, Bill Bejeck &lt;bill@confluent.io&gt;
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> MINOR: Prohibit setting StreamsConfig commit.interval.ms to a negative value
                </div><div><b>body:</b> Prohibit setting StreamsConfig `commit.interval.ms` to a negative value to avoid possible ambiguity of what it indicates.

So far, setting the property to a negative value can be used to turn off periodic offset-commit by `StreamThread`. With this change, that will no longer work.
Instead of using a negative value, `LONG.MAX_VALUE` can be used to achieve the almost same thing.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                We might be able to remove the check `interval &gt;= 0`, but I'm not sure whether we can assume their value always come from `StreamsConfig`. So, I did not update the code.

https://github.com/apache/kafka/blob/9951f8fee145ce10b5dccde665e160a5f4ff6d03/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java#L1023

https://github.com/apache/kafka/blob/9951f8fee145ce10b5dccde665e160a5f4ff6d03/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStreamThread.java#L244
              </div></li><li><div>
                @guozhangwang Could you review this?
              </div></li><li><div>
                It's a judgement call. I am fine with the change. We recently updated `KafkaStreams#close()` similarly.

@occho I think it's save the remove the check `&gt;= 0` in both classes. Can you update the code accordingly?
              </div></li><li><div>
                &gt; @occho I think it's save the remove the check &gt;= 0 in both classes. Can you update the code accordingly?

Sure. Thank you for your advice.
Updated.
              </div></li><li><div>
                Added a test.
              </div></li><li><div>
                Ah, wait, I need more fix.
              </div></li><li><div>
                Updated and rebased onto the latest trunk.
              </div></li><li><div>
                retest this please
              </div></li><li><div>
                Thank you for reviewing. :)
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                nit: maybe keep this test but pass in `0` instead? 
              </div></li><li><div>
                From my understanding, the test name is wrong and should be like `shouldNotFlushWhenFlushIntervalIsNegative`.
The code that `shouldNotFlushWhenFlushIntervalIsZero` tests is about this line:

https://github.com/apache/kafka/blob/74f686d3c24d06c977341cee7294f36e02cbc366/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStreamThread.java#L244

With the code on trunk, when `flushInterval` is set to negative, `stateMaintainer.flushState()` is not called.
But, since this spec is removed, I think it is okay to remove the test.

WDYT?
              </div></li><li><div>
                Ack, thanks for the explanation.  Sounds good to me.
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>