<!DOCTYPE html><html><div class="item-title">
        Item 305
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                !/bin/bash
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                 unmarshal the string to a JSON object
              </div></li><li><div>
                 last line of stdout is the result JSON object as a string
              </div></li><li><div>
                program receives one argument: the JSON object as a string
              </div></li><li><div>
                 can optionally log to stdout (or stderr)
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                 +build integration
              </div></li><li><div>
                wskaction.Annotations = listOfOutputs
              </div></li><li><div>
                 Create action data object from client library
              </div></li><li><div>
                 when an action has Docker image specified,
 set exec.Kind to "blackbox" and
 set exec.Image to specified image e.g. dockerhub/image
 when an action Native is set to true,
 set exec.Image to openwhisk/skeleton
              </div></li><li><div>
                 Web Export
              </div></li><li><div>
                 update the action (of type Action) to set its name
 here key name is the action name
              </div></li><li><div>
                 Action.Inputs
              </div></li><li><div><div><b>comment:</b>  TODO() use LIMITS_UNSUPPORTED in yamlparser to enumerate through instead of hardcoding
 emit warning errors if these limits are not nil
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>comment:</b>  Action.Outputs
 TODO{} add outputs as annotations (work to discuss officially supporting for compositions)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 Check if action.Function is specified with action.Code
 with action.Code, action.Function is not allowed
 with action.Code, action.Runtime should be specified
              </div></li><li><div>
                 Action.Limits
              </div></li><li><div>
                
	*  Action.Runtime
	*  Perform few checks if action runtime is specified in manifest YAML file
	*  (1) Check if specified runtime is one of the supported runtimes by OpenWhisk server
	*  (2) Check if specified runtime is consistent with action source file extensions
	*  Set the action runtime to match with the source file extension, if wskdeploy is not invoked in strict mode
	 
              </div></li><li><div>
                 determine extension of the given action source file
              </div></li><li><div>
                 Action.Annotations
              </div></li><li><div>
                 validate manifest_parser.ComposeActions() method
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Adding Docker and Native support (#801)
                </div><div><b>message:</b> Adding Docker and Native support (#801)

* refactoring composeActions - phase 1

* refactor compose action - phase 2

* refactor composeAction - phase 3

* refactor composeaction - phase 4

* refactor composeAction - phase 5

* adding docker and native support

* adding license header

* refactor manifest parser to utilize common inputs and annotations function

* fixing compile error

* using PATH SEPARATOR as rune

* capitalizing Packages in dependency - fixing unit test

* updating docker unit test - error messages

* moving action file name to a var

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> Support "blackbox" Docker images
                </div><div><b>body:</b> This has been a discussion since last Sept. and asked Daisy to look into supporting at that time.  Need to track this work via this issue.

```
Sept 2016:
Daisy: Blackbox (Docker) Actions: Need to think about how to set the field "runtime" if it is a docker action. We should document it.
```
                </div></div></li><li><div><div><b>title:</b> Support "blackbox" Docker images
                </div><div><b>body:</b> This has been a discussion since last Sept. and asked Daisy to look into supporting at that time.  Need to track this work via this issue.

```
Sept 2016:
Daisy: Blackbox (Docker) Actions: Need to think about how to set the field "runtime" if it is a docker action. We should document it.
```
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Support "blackbox" Docker images
                </div><div><b>body:</b> This has been a discussion since last Sept. and asked Daisy to look into supporting at that time.  Need to track this work via this issue.

```
Sept 2016:
Daisy: Blackbox (Docker) Actions: Need to think about how to set the field "runtime" if it is a docker action. We should document it.
```
                </div></div></li><li><div><div><b>title:</b> Support "blackbox" Docker images
                </div><div><b>body:</b> This has been a discussion since last Sept. and asked Daisy to look into supporting at that time.  Need to track this work via this issue.

```
Sept 2016:
Daisy: Blackbox (Docker) Actions: Need to think about how to set the field "runtime" if it is a docker action. We should document it.
```
                </div></div></li><li><div><div><b>title:</b> Support "blackbox" Docker images
                </div><div><b>body:</b> This has been a discussion since last Sept. and asked Daisy to look into supporting at that time.  Need to track this work via this issue.

```
Sept 2016:
Daisy: Blackbox (Docker) Actions: Need to think about how to set the field "runtime" if it is a docker action. We should document it.
```
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                See: https://github.com/apache/incubator-openwhisk-wskdeploy/issues/279
              </div></li><li><div><div><b>body:</b> TODO: look at CLI conventions for what they call this?  I believe its "docker" so we would then use:
runtime: docker

then we would have to be able to validate the image reference exists/is valid (DockerHub) and if we need to add it to an existing key or new key in the YAML manifest.  Need a recommendation here on what is clear/friendly to the user.

Then we have to consider "private" Docker repos (hubs) and credentials.

Please.... also make sure this would work in the future for Rocket images.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Private docker repos are not yet supported by openwhisk, see https://github.com/apache/incubator-openwhisk/issues/1362

              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li><li><div><div><b>title:</b> Adding Docker and Native support
                </div><div><b>body:</b> Closes #623
Closes #279 

List of changes in this PR:

1. Major Refactoring of `manifest_parser.go`:
* Replace `str != ""` kind of check with `len(str) != 0`
* Replace "/" with constant `PATH_SEPARATOR`
* Created a common function to parse inputs and outputs, updated all `Compose*` routines to utilize this common function. Same with annotations.
* Split `ComposeAction` function into smaller routines with validating code, validating function, reading code, reading function, creating action exec depending on action function and code, etc.
2. Added support for docker and native actions with unit test and integration test.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @ddragosd @pritidesai In order to support private (with credentials), we would need to add support for thee credential and repository schema (envisionsed in spec.).  Priti, do you agree with this assessment?  If so, can we open an epic/issues for this and prioritize?
              </div></li><li><div>
                This is not supported in core, the invoker doesn’t deal with credentials to pull the image it just executes docker pull 

Cc @rabbah 
              </div></li><li><div>
                @mrutkows I think its beyond the scope of `wskdeploy`. We have repository and credentials defined [here](https://github.com/apache/incubator-openwhisk-wskdeploy/blob/master/specification/openwhisk_v0.9.2.pdf) on line 558 and line 571. But with docker actions the way they are designed, images are not pulled during action creation. So even if we have access to credentials of private repo and we could pass that to OpenWhisk server but its not supported by server side. 

We can address this by what Rodric has commented here https://github.com/apache/incubator-openwhisk/issues/1362 saying "_One way to support this is by pulling images from the private registry to a whisk managed registry at action create time. This would avoid some the challenges around key management for docker login. In general I think this is a good approach for docker actions as it will make it easier for vetting images; but not without its demerits._" We can definitely add support for this in `wskdeploy`, is that what we are looking for?

@mrutkows @ddragosd @csantanapr @rabbah suggestions please?
              </div></li><li><div>
                Yep this is something that wskdeploy can’t solve at the moment 
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Nice unit test we have needed for some time...
              </div></li><li><div><div><b>body:</b> Would have preferred this declared at top of function so we can quickly identify test data files used within the test method and they do not scroll off the right edge.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> we will get you yet typo! ...

                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Do we need the source code for the "exec" binary?  Is this example.c?  
              </div></li><li><div>
                great 👍 

should we assume that custom/private docker registries are supported as well, provided the machine has the credentials needed to connect to that registry ?
              </div></li><li><div>
                This is a sample in Go from https://console.bluemix.net/docs/openwhisk/openwhisk_actions.html#creating-go-actions. I have three examples included, (1) a dir with exec in bash (`function: &lt;dir&gt;`) (2) a dir with exec in go (compiled) (`function: &lt;dir&gt;`) (3) exec.zip. Its pretty much same workflow for example.c  
              </div></li><li><div>
                @ddragosd yes and no, custom docker registries are supported but not private. OpenWhisk does not support private registries yet (see https://github.com/apache/incubator-openwhisk/issues/1362) since the docker image is pulled when you invoke that action for the first time so even if the machine from where the action was created has credentials, its not useful.
              </div></li><li><div>
                👍 done
              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>