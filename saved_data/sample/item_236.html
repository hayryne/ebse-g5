<!DOCTYPE html><html><div class="item-title">
        Item 236
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> IGNITE-10509 reordered setting of timeout flag and transaction state - Fixes #5555.
                </div><div><b>message:</b> IGNITE-10509 reordered setting of timeout flag and transaction state - Fixes #5555.

Signed-off-by: Dmitriy Govorukhin &lt;dmitriy.govorukhin@gmail.com&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> IGNITE-10509 reordered setting of timeout flag and transaction state
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> IGNITE-10509 reordered setting of timeout flag and transaction state
                </div><div><b>body:</b> 
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Rollback exception instead of timeout exception
                </div><div><b>description:</b> Looks like we have race on changing transaction state between timedOut and state set
Reproducer - TxRollbackOnTimeoutNearCacheTest.testEnlistManyWrite
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                GitHub user akalash opened a pull request:

    https://github.com/apache/ignite/pull/5555

    IGNITE-10509 reordered setting of timeout flag and transaction state

    

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/gridgain/apache-ignite ignite-10509

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/ignite/pull/5555.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #5555
    
----
commit ada8fc9cb664e70f975312007f9d5003ca6a82b0
Author: Anton Kalashnikov &lt;kaa.dev@...&gt;
Date:   2018-12-03T13:49:24Z

    IGNITE-10509 reordered setting of timeout flag and transaction state

----

              </div></li><li><div>
                {panel:title=--&amp;gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&amp;gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2452853&amp;amp;buildTypeId=IgniteTests24Java8_RunAll]
              </div></li><li><div>
                [~akalashnikov] I did review your changes, and I have a question. Why this reordering solve a problem? I can get timeout status (true), but transaction state wasn't changed. Why is it ok? I mean, we still have a race between changes timeout status and change transaction change. Should we change timeout first in all cases?
              </div></li><li><div><div><b>body:</b> [~DmitriyGovorukhin], you actually right, but I don't ready to add synchronization on state and timeout now because it looks like too redundantly. But my changes looks correct because timeout is reason of state changing but state changing is not reason of timeout.
If you have any other idea, please share it.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                [~akalashnikov] Thanks for the comments,&nbsp; I agree.
              </div></li><li><div>
                [~akalashnikov] Changes look good to me, thanks for the&nbsp;contribution! Merged to master.
              </div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/ignite/pull/5555

              </div></li></ol></div></div></html>