<!DOCTYPE html><html><div class="item-title">
        Item 66
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 Same for seekExact
              </div></li><li><div><div><b>comment:</b>  Make sure that calls to next() does not modify the term of the other enum
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 Same for seekCeil
              </div></li><li><div>
                 Same for seek by ord
              </div></li><li><div>
                 Same for seekCeil on an exact value
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.
                </div><div><b>message:</b> LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.


git-svn-id: https://svn.apache.org/repos/asf/lucene/dev/trunk@1655693 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Multiple filtered subsets of the same underlying index passed to IW.addIndexes() can produce an index with bad SortedDocValues
                </div><div><b>description:</b> Were hit by this in a custom index splitter implementation that showed no problems with Lucene 4.8. After upgrading to 4.10 documents started having wrong SortedDocValues after splitting.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Test showing the issue
              </div></li><li><div><div><b>body:</b> Thanks for taking the time to write the test.

Attached is your same test, just ported to trunk (using a slow-splitting way that forces it to still fail, as the bug still exists).

This is a byte[] reuse bug caused from LUCENE-5703. If you run the test with the revision before that commit it will pass, it fails after that commit.
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                The bug is that doc values terms enums assume that nothing else is going to use the underlying dv instance at the same time. Here is a patch that makes the attached test case pass. I also added tests to the base dv format test case and to the Lucene50 one to test the compressed terms dict.
              </div></li><li><div>
                Same patch, I just added an entry in the changes.txt and fixed the test to remove an abusive "assumeTrue". For now the entry is under 5.1 but I'm wondering if we should try to put in in 5.0?
              </div></li><li><div>
                +1! 
              </div></li><li><div>
                +1 for patch and +1 to fix this for 5.0.0
              </div></li><li><div>
                Commit 1655693 from [~jpountz] in branch 'dev/trunk'
[ https://svn.apache.org/r1655693 ]

LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.
              </div></li><li><div>
                Commit 1655705 from [~jpountz] in branch 'dev/branches/branch_5x'
[ https://svn.apache.org/r1655705 ]

LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.
              </div></li><li><div>
                Commit 1655710 from [~jpountz] in branch 'dev/branches/lucene_solr_5_0'
[ https://svn.apache.org/r1655710 ]

LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.
              </div></li><li><div>
                Commit 1655718 from [~jpountz] in branch 'dev/branches/lucene_solr_4_10'
[ https://svn.apache.org/r1655718 ]

LUCENE-6207: Fixed consumption of several terms enums on the same sorted (set) doc values instance.
              </div></li><li><div>
                Thanks Tom for the patch, it was really helpful to dig this issue!
              </div></li><li><div>
                Bulk close after 5.0 release.
              </div></li></ol></div></div></html>