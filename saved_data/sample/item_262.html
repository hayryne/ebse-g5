<!DOCTYPE html><html><div class="item-title">
        Item 262
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [CXF-5421] Making the servlet api dependency optional in OAuth poms
                </div><div><b>message:</b> [CXF-5421] Making the servlet api dependency optional in OAuth poms

git-svn-id: https://svn.apache.org/repos/asf/cxf/trunk@1545640 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Servlet dependency in OAuth2 pom.xml should be with scope "provided"
                </div><div><b>description:</b> From cxf-rt-rs-security-oauth2's pom.xml:

       &lt;dependency&gt;
            &lt;groupId&gt;${cxf.servlet-api.group}&lt;/groupId&gt;
            &lt;artifactId&gt;${cxf.servlet-api.artifact}&lt;/artifactId&gt;
            &lt;version&gt;${cxf.servlet-api.version}&lt;/version&gt;
        &lt;/dependency&gt;

This should have a &lt;scope&gt;provided&lt;/scope&gt; otherwise the servlet JAR will be pulled in as a transitive dependency. It may conflict with the container's own servlet and throw exceptions like:

Caused by: java.lang.ClassCastException: org.springframework.web.SpringServletContainerInitializer cannot be cast to javax.servlet.ServletContainerInitializer
	at org.apache.catalina.startup.ContextConfig.getServletContainerInitializer(ContextConfig.java:1670)
	at org.apache.catalina.startup.ContextConfig.getServletContainerInitializers(ContextConfig.java:1652)
	at org.apache.catalina.startup.ContextConfig.processServletContainerInitializers(ContextConfig.java:1562)
	at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1270)
	at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:878)
	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:376)
	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
	at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5322)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)
	... 6 more

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Workaround is to manually exclude the dependency:

		&lt;dependency&gt;
			&lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
			&lt;artifactId&gt;cxf-rt-rs-security-oauth2&lt;/artifactId&gt;
			&lt;version&gt;${org.apache.cxf-version}&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;artifactId&gt;geronimo-servlet_3.0_spec&lt;/artifactId&gt;
					&lt;groupId&gt;org.apache.geronimo.specs&lt;/groupId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Saw the change in http://svn.apache.org/repos/asf/cxf/trunk/rt/rs/security/oauth-parent/oauth2/pom.xml.

Thanks!
              </div></li></ol></div></div></html>