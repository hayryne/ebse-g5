<!DOCTYPE html><html><div class="item-title">
        Item 192
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [scala] Change ScalaAggregateOperator to use TypeSerializer
                </div><div><b>message:</b> [scala] Change ScalaAggregateOperator to use TypeSerializer

This closes #263

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [scala] Change ScalaAggregateOperator to use TypeSerializer
                </div><div><b>body:</b> Before it was using TypeSerializerFactory. This led to problems with the
user code class loader and is not necessary.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                I moved the cast and added a Validate.\* check.

              </div></li><li><div>
                +1

LGTM

              </div></li><li><div>
                Looks good, will merge...

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Could we do explicit conversion from TypeSerializer to TupleSerializerBase instead of hard casting?

              </div></li><li><div>
                What do you mean by explicit conversion?

              </div></li><li><div>
                Ah sorry, I meant getIntputType call returns TypeSerializer and the AggregatingUdf constructor is taking TupleSerializerBase so could the constructor parameter takes TypeSerializer instead?

              </div></li><li><div>
                We could maybe. If we enhanced TypeSerializer to have a method createInstance(...) that can create an instance with the given field values. This is only possible for a small subset of the types that we support: The Java Tuple Types, since we control their constructors. And Scala Case Classes, since we assume that the fields are exactly the constructor arguments, as is customary for Case Classes.

We would then need to add createInstance(...) methods to all other TypeSerializers that throw an Exception telling the user that instance creation with field values is not supported.

              </div></li><li><div>
                At least for now, could we change the signature of the constructor to TypeSerializer and add validate for the argument if it could be cast to TupleSerializerBase?

So add check:
Validate.isTrue(serializer instanceof TupleSerializerBase);

Casting without proper check makes me nervous.

              </div></li><li><div>
                Ok, will do. 

              </div></li></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>