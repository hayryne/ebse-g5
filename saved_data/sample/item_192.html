<!DOCTYPE html><html><div class="item-title">
        Item 192
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
	 * This method returns the bytes of a serialized {@link KryoSerializerSnapshot}, that contains a Kryo registration
	 * of a class that does not exists in the current classpath.
	 
              </div></li><li><div>
                 it is compatible as is, since Kryo does not expose compatibility API with KryoSerializers
 so we can not know if DogKryoSerializer is compatible with DogV2KryoSerializer
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 * Tests for {@link KryoSerializerSnapshot}.
 
              </div></li><li><div>
                 -------------------------------------------------------------------------------------------------------
 Helpers
 -------------------------------------------------------------------------------------------------------
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [FLINK-11773] [tests] Add unit tests for KryoSerializerSnapshot
                </div><div><b>message:</b> [FLINK-11773] [tests] Add unit tests for KryoSerializerSnapshot

This closes #7852.

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [FLINK-11773][core] Harden KryoSerializerSnapshot
                </div><div><b>body:</b> This PR builds on top of #7845 .

## What is the purpose of the change

`KryoSerializerSnapshot` would fail in `readSnapshot` if a previously registered `Kryo` type is not accessible by the restored job anymore (either removed from the classpath, or failed to load for some other reason)

The source of this behaviour is an early return at [1], which would skip the consumption at [2] 
 
 [1] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310

[2] https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

## Brief change log
* The first two commits are from  #7845 and they are used by 3224e60 (KryoSnapshotTest)
* 2b95d56 adds an `LinkedOptionalMapSerializer` to robustly read/write `LinkedOptionalMaps`
* b4b47ef uses `LinkedOptionalMapSerializer` by `KryoSnapshotData` and `PojoSnapshotData`

## Verifying this change

* A new unit test for `KryoSerializerSnapshot` was introduced.

This change added tests and can be verified as follows:

## Does this pull request potentially affect one of the following parts:

  - Dependencies (does it add or upgrade a dependency): (yes / **no**)
  - The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / **no**)
  - The serializers: (**yes** / no / don't know)
  - The runtime per-record code paths (performance sensitive): (yes / **no** / don't know)
  - Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / **no** / don't know)
  - The S3 file system connector: (yes / **no** / don't know)

## Documentation

  - Does this pull request introduce a new feature? (yes / **no**)
  - If yes, how is the feature documented? (**not applicable** / docs / JavaDocs / not documented)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Thanks a lot for your contribution to the Apache Flink project. I'm the @flinkbot. I help the community
to review your pull request. We will use this comment to track the progress of the review.


## Review Progress

* ✅ 1. The [description] looks good.
    - Approved by @tzulitai [PMC]
* ✅ 2. There is [consensus] that the contribution should go into to Flink.
    - Approved by @tzulitai [PMC]
* ❗ 3. Needs [attention] from.
    - Needs attention by @tzulitai [PMC]
* ✅ 4. The change fits into the overall [architecture].
    - Approved by @tzulitai [PMC]
* ✅ 5. Overall code [quality] is good.
    - Approved by @tzulitai [PMC]

Please see the [Pull Request Review Guide](https://flink.apache.org/reviewing-prs.html) for a full explanation of the review process.&lt;details&gt;
  &lt;summary&gt;Bot commands&lt;/summary&gt;
  The @flinkbot bot supports the following commands:

 - `@flinkbot approve description` to approve the 1st aspect (similarly, it also supports the `consensus`, `architecture` and `quality` keywords)
 - `@flinkbot approve all` to approve all aspects
 - `@flinkbot approve-until architecture` to approve everything until `architecture`
 - `@flinkbot attention @username1 [@username2 ..]` to require somebody's attention
 - `@flinkbot disapprove architecture` to remove an approval
&lt;/details&gt;
              </div></li><li><div>
                @flinkbot attention @tzulitai 
              </div></li><li><div>
                @flinkbot approve description
@flinkbot approve architecture
@flinkbot approve consensus
              </div></li><li><div>
                @flinkbot approve quality
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> nit: would add a comment about what the HEADER is for. I guess it is for sanity checks?
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> nit: typo, `writter` -&gt; `writer`
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                I think you can actually use `DataOutputSerializer` here.
              </div></li><li><div><div><b>body:</b> You would want to call `readFully` here to be completely resilient.
`read` only reads "up to" `#bufferSize` bytes, so there could be cases where we have some dangling bytes unread, leaving a corrupted stream.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I don't think we need to set `startPos` / `endPos` here.
Just `new DataInputDeserializer(buf)` will do.
              </div></li><li><div>
                avoid having raw types -&gt; `new ClassResolverByName&lt;?&gt;(cl)`
              </div></li><li><div><div><b>body:</b> all occurrences of "kryo" should have capital K
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> KryoSerializerSnapshot would fail to deserialize if a type is missing
                </div><div><b>description:</b> KryoSerializerSnapshot would fail to read successfully if a previously registered&nbsp;Kryo type is not accessible&nbsp;by&nbsp;the restored job (either removed from the classpath, or failed to load for some other reason)

The source of the bug is an early return at [1]&nbsp;,which would skip the consumption at [2]&nbsp;
&nbsp;
&nbsp;[1]&nbsp;[https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L310]

[2]&nbsp;https://github.com/apache/flink/blob/cf7b86de436c8714414f563e8637ceb36ea7aabe/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerSnapshotData.java#L314

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Merged.

1.8.0: 151cd8cf864e8fce73724c2bd3e7d188ff91c71a
1.9.0: 2a60cd7f865c5ef22452d34c673deba543200676
              </div></li></ol></div></div></html>