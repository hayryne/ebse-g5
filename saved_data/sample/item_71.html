<!DOCTYPE html><html><div class="item-title">
        Item 71
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * Create a new {@link TypeTokenFilter} that filters tokens out
   * (useWhiteList=false).
   * @see #TypeTokenFilter(Version, TokenStream, Set, boolean)
   
              </div></li><li><div>
                *
   * Create a new {@link TypeTokenFilter}.
   * @param version      the Lucene match version
   * @param input        the {@link TokenStream} to consume
   * @param stopTypes    the types to filter
   * @param useWhiteList if true, then tokens whose type is in stopTypes will
   *                     be kept, otherwise they will be filtered out
   
              </div></li><li><div>
                * @deprecated enablePositionIncrements=false is not supported anymore as of Lucene 4.4. 
              </div></li><li><div>
                *
   * Create a new {@link KeepWordFilter}.
   * &lt;p&gt;&lt;b&gt;NOTE&lt;/b&gt;: The words set passed to this constructor will be directly
   * used by this filter and should not be modified.
   * @param version the Lucene match version
   * @param in      the {@link TokenStream} to consume
   * @param words   the words to keep
   
              </div></li><li><div>
                * @deprecated enablePositionIncrements=false is not supported anymore as of Lucene 4.4. 
              </div></li><li><div>
                * @deprecated enablePositionIncrements=false is not supported anymore as of Lucene 4.4. 
              </div></li><li><div>
                * Create a new {@link TrimFilter} on top of &lt;code&gt;in&lt;/code&gt;. 
              </div></li><li><div>
                *
   * Create a new {@link TrimFilter}.
   * @param version       the Lucene match version
   * @param in            the stream to consume
   * @param updateOffsets whether to update offsets
   * @deprecated Offset updates are not supported anymore as of Lucene 4.4.
   
              </div></li><li><div>
                *
   * Create a new {@link FilteringTokenFilter}.
   * @param version the Lucene match version
   * @param in      the {@link TokenStream} to consume
   
              </div></li><li><div>
                *
   * Create a new {@link FilteringTokenFilter}.
   * @param version                  the Lucene match &lt;a href="#version"&gt;version&lt;/a&gt;
   * @param enablePositionIncrements whether to increment position increments when filtering out terms
   * @param input                    the input to consume
   * @deprecated enablePositionIncrements=false is not supported anymore as of Lucene 4.4
   
              </div></li><li><div>
                *
   * Create a new {@link JapanesePartOfSpeechStopFilter}.
   * @param version  the Lucene match version
   * @param input    the {@link TokenStream} to consume
   * @param stopTags the part-of-speech tags that should be removed
   
              </div></li><li><div>
                * @deprecated enablePositionIncrements=false is not supported anymore as of Lucene 4.4. 
              </div></li><li><div>
                * Whether to generate holes in the automaton for missing positions, &lt;code&gt;true&lt;/code&gt; by default. 
              </div></li><li><div>
                *
   * Create a new FilteringTokenFilter.
   * @param in      the TokenStream to consume
   
              </div></li><li><div>
                * Override this method and return if the current input token should be returned by incrementToken. 
              </div></li><li><div>
                * Whether to take position holes (position increment &gt; 1) into account when
   *  building the automaton, &lt;code&gt;true&lt;/code&gt; by default. 
              </div></li><li><div>
                * Whether position holes should appear in the automaton. 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> LUCENE-4963: Deprecate broken TokenFilter options (merged from r1479148).
                </div><div><b>message:</b> LUCENE-4963: Deprecate broken TokenFilter options (merged from r1479148).


git-svn-id: https://svn.apache.org/repos/asf/lucene/dev/branches/branch_4x@1479151 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li><li><div><div><b>summary:</b> Deprecate broken TokenFilter constructors
                </div><div><b>description:</b> We have some TokenFilters which are only broken with specific options. This includes:

 * TrimFilter when updateOffsets=true
 * StopFilter, JapanesePartOfSpeechStopFilter, KeepWordFilter, LengthFilter, TypeTokenFilter when enablePositionIncrements=false

I think we should deprecate these behaviors in 4.4 and remove them in trunk.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Hi,
+1 to deprecate the constuctors taking those arguments and make sure the alternatives already implement the correct behaviour.
Unfortunately we may not be able to completely remove that code in 5.x (we can remove the ctors, yes), because matchVersion sometimes implies the wrong behaviour. We nuked almost all of them, we should just check this.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Thanks Uwe for the advice. Here is a first patch:

 * Deprecate constructors that expose broken options and make them throw an IllegalArgumentException when the lucene match version is &gt;= 4.4

 * Remove the same constructors from TestRandomChains' exclusion list.

 * Since enablePositionIncrements=true was used by the Analyzing and Fuzzy suggesters to ignore position holes, I had to make it an option in the suggesters themselves instead of the token streams.

 * More documentation in the oal.analysis package: PositionLengthAttribute and guidelines on writing non-corrupt token streams.
              </div></li><li><div>
                Hi Adrien,
thanks for doing the work! I think on the first look its fine! I will now verify the changes for each TokenFilter... The patch is for 4.x? In trunk you will remove the deprecations in a second step to enable merging without extra work?
              </div></li><li><div>
                Hi Uwe, thanks for doing the review! The patch applies to trunk and I plan to remove deprecations in a second step. Is it OK with you?
              </div></li><li><div>
                Yeah, I would do it the same way. First deprecate and commit to both branches. Then remove stuff in trunk only.
              </div></li><li><div>
                I'll commit this soon unless someone objects.
              </div></li><li><div>
                [trunk commit] jpountz
http://svn.apache.org/viewvc?view=revision&amp;revision=1479148

LUCENE-4963: Deprecate broken TokenFilter options.
              </div></li><li><div>
                [branch_4x commit] jpountz
http://svn.apache.org/viewvc?view=revision&amp;revision=1479151

LUCENE-4963: Deprecate broken TokenFilter options (merged from r1479148).
              </div></li><li><div>
                [trunk commit] jpountz
http://svn.apache.org/viewvc?view=revision&amp;revision=1479171

LUCENE-4963: Completely remove deprecated options in 5.0.
              </div></li><li><div>
                Thank you Uwe!
              </div></li><li><div>
                Bulk close resolved 4.4 issues
              </div></li><li><div>
                There should be an option in AnalyzingLookupFactory and FuzzyLookupFactory to setPreservePositionIncrements then.
              </div></li><li><div>
                There should be an option in AnalyzingLookupFactory and FuzzyLookupFactory to setPreservePositionIncrements then.
              </div></li><li><div>
                Hi, how we're now supposed to fix this?
http://stackoverflow.com/questions/18668376/solr-4-4-stopfilterfactory-and-enablepositionincrements
              </div></li><li><div>
                I do index
twitter.com/testuser
then search for
http://www.twitter.com/testuser

These are in stopwords filter:
http
https
www

No results.
              </div></li><li><div>
                The way to generate a query based on the token stream of the query string is the responsibility of the query parser. For example, QueryParserBase has the {{setEnablePositionIncrements}} method http://lucene.apache.org/core/4_4_0/queryparser/org/apache/lucene/queryparser/classic/QueryParserBase.html#setEnablePositionIncrements(boolean) which can be used to ignore holes in the token stream (which seems to be what you are looking for). 
              </div></li></ol></div></div></html>