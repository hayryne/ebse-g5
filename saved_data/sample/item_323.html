<!DOCTYPE html><html><div class="item-title">
        Item 323
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 client in worker will use this config to authenticate with broker
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Issue 4469: add function worker client auth config in standalone (#4473)
                </div><div><b>message:</b> Issue 4469: add function worker client auth config in standalone (#4473)

* add worker client auth config in standalone

* add more other conf passingly

* add configs

                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> standalone failed to start for token auth in function worker client
                </div><div><b>body:</b> **Describe the bug**
when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

it happens like this:
standalone will start function `WorkerService`, then `WorkerService` will create a pulsar client to create topics. But this pulsar client is not properly configured, and caused failure when it connects to server

![image](https://user-images.githubusercontent.com/6348208/58889006-d2614400-871a-11e9-8b32-3c2ce5d2a53d.png)

                </div></div></li><li><div><div><b>title:</b> standalone failed to start for token auth in function worker client
                </div><div><b>body:</b> **Describe the bug**
when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

it happens like this:
standalone will start function `WorkerService`, then `WorkerService` will create a pulsar client to create topics. But this pulsar client is not properly configured, and caused failure when it connects to server

![image](https://user-images.githubusercontent.com/6348208/58889006-d2614400-871a-11e9-8b32-3c2ce5d2a53d.png)

                </div></div></li><li><div><div><b>title:</b> standalone failed to start for token auth in function worker client
                </div><div><b>body:</b> **Describe the bug**
when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

it happens like this:
standalone will start function `WorkerService`, then `WorkerService` will create a pulsar client to create topics. But this pulsar client is not properly configured, and caused failure when it connects to server

![image](https://user-images.githubusercontent.com/6348208/58889006-d2614400-871a-11e9-8b32-3c2ce5d2a53d.png)

                </div></div></li><li><div><div><b>title:</b> standalone failed to start for token auth in function worker client
                </div><div><b>body:</b> **Describe the bug**
when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

it happens like this:
standalone will start function `WorkerService`, then `WorkerService` will create a pulsar client to create topics. But this pulsar client is not properly configured, and caused failure when it connects to server

![image](https://user-images.githubusercontent.com/6348208/58889006-d2614400-871a-11e9-8b32-3c2ce5d2a53d.png)

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                @jerrypeng  Would you please help take a look of this? 
              </div></li><li><div>
                will work on a fix
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li><li><div><div><b>title:</b> Issue 4469: add function worker client auth config in standalone
                </div><div><b>body:</b> Fixes #4469 

### Motivation

when it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.

It happens like this:
standalone will start function WorkerService, then WorkerService will create a pulsar client to create topics. But this pulsar client in worker could not get properly configuration, and caused failure when it connects to server, which has authn enabled.

### Modifications

add authn related configs, so user could config the Client in worker, and make it work.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                run integration tests
              </div></li><li><div>
                @jiazhai perhaps we should also let the function worker inherit the following Auth configs as well from the broker:

 workerConfig.setUseTls();
 workerConfig.setTlsAllowInsecureConnection();
 workerConfig.setTlsTrustCertsFilePath();
 workerConfig.setTlsHostnameVerificationEnable()

              </div></li><li><div>
                @jerrypeng  ,  
 added passingly other 2 configs:
```
workerConfig.setTlsAllowInsecureConnection();
workerConfig.setTlsTrustCertsFilePath();
```

`setUseTls(`) is deprecated, not add it.
`TlsHostnameVerificationEnable` is a client config, and here we are using passed in serverconfig, so not add it.

              </div></li><li><div><div><b>body:</b> @jiazhai we should set TlsHostnameVerificationEnable to false since that is the behavior when brokers talk with each other.  I think we should also setUseTls accordingly even if its deprecated because:

1. to be consistent otherwise its confusing why set other auth configs but not this one
2. In case a user uses this config in the standalone.conf and then gets auth errors from the function worker
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @jerrypeng  updated. 
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>