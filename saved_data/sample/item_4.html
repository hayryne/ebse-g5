<!DOCTYPE html><html><div class="item-title">
        Item 4
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 Field.get() can throw NPE if the value of the field is null
              </div></li><li><div>
                 ignore the constants
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>message:</b> Only log yaml config once, at startup

patch by jasobrown, reviewed by Paulo Motta for CASSANDRA-11217

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li><li><div><div><b>summary:</b> Only log yaml config once, at startup
                </div><div><b>description:</b> CASSANDRA-6456 introduced a feature where the yaml is dumped in the log. At startup this is a nice feature, but I see that it’s actually triggered every time it handshakes with a node and fails to connect and the node happens to be a seed ([see here|https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L435]). Calling {{DD.getseeds()}} calls the {{SeedProvider}}, and if you happen to use {{SimpleSeedProvider}} it will reload the yaml config, and once again dump it out to the log.

It's debatable if {{DD.getseeds()}} should trigger a reload (which I added in CASSANDRA-5459) or whether reloading the seeds should be a different method (it probably should), but we shouldn't keep logging the yaml config on every connection failure to a seed.

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                ||2.2||3.0||trunk||
|[branch|https://github.com/apache/cassandra/compare/trunk...jasobrown:config_logging_2.2]|[branch|https://github.com/apache/cassandra/compare/trunk...jasobrown:config_logging_3.0]|[branch|https://github.com/apache/cassandra/compare/trunk...jasobrown:config_logging_3.x]
|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_2.2-testall/]|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.0-testall/]|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.x-testall/]
|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_2.2-dtest/]|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.0-dtest/]|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.x-dtest/]
              </div></li><li><div><div><b>body:</b> Overall LGTM, but how about moving the actual logging to {{DatabaseDescriptor}} so we don't need to change the {{ConfigurationLoader}} interface and we'll also log configuration of custom loaders? We could also maybe save the latest loaded configuration and print only in case the configuration changed, since that could still be useful to operators (though this will probably only happen when refreshing seeds currently), WDYT?

The log {{INFO  \[main\] 2016-02-29 21:59:21,025 YamlConfigurationLoader.java:92 - Loading settings from file:~/.ccm/test/node1/conf/cassandra.yaml}} is still being print repeatedly, should we maybe decrease the log level to {{DEBUG}}?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                bq. how about moving the actual logging to {{DatabaseDescriptor}} so we don't need to change the {{ConfigurationLoader}}

Good call. I've moved the logging into {{Config#log}}, and is still invoked from DD the way it was in the first patch.

bq. maybe decrease the log level to {{DEBUG}}

Done.

Tests running now.

|| 2.2 | 3.0 | trunk ||
|[branch|https://github.com/jasobrown/cassandra/tree/config_logging_2.2]|[branch|https://github.com/jasobrown/cassandra/tree/config_logging_3.0]|[branch|https://github.com/jasobrown/cassandra/tree/config_logging_3.x]
|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_2.2-testall/]|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.0-testall/]|[testall|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.x-testall/]
|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_2.2-dtest/]|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.0-dtest/]|[dtest|http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-config_logging_3.x-dtest/]


              </div></li><li><div>
                LGTM, marking as ready to commit. Thanks!
              </div></li><li><div>
                Committed to 2.2, 3.0, 3.5, and trunk

Commit sha is 093454205498bad7094cb8fb362d60e95296b092

Thanks [~pauloricardomg]
              </div></li></ol></div></div></html>