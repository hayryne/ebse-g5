<!DOCTYPE html><html><div class="item-title">
        Item 291
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> NUTCH-987 Constants for HTTP auth for Solr
                </div><div><b>message:</b> NUTCH-987 Constants for HTTP auth for Solr

git-svn-id: https://svn.apache.org/repos/asf/nutch/branches/branch-1.4@1146043 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Support HTTP auth for Solr communication
                </div><div><b>description:</b> At the moment we cannot send data directly to a public HTTP auth protected Solr instance. I've a WIP that passes a configured HTTPClient object to CommonsHttpSolrServer, it works. This issue should add this ability to indexing, dedup and clean and be configured from some configuration file.

Enable Solr HTTP auth communication by setting the following parameters in your nutch-site config:
* solr.auth=true
* solr.auth.username=USERNAME
* solr.auth.password=PASSWORD
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Attached nasty hack for the sake of not losing it.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Patch for 1.4. Also moved UTF-8 strip method to Solr utils. It's implemented using simple job properties, no fancy AuthScope stuff. Please comment.
              </div></li><li><div><div><b>body:</b> Some instances in SolrDedup were missing. Also cleaned up some mess.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Are there objections? Pointers? Comments?
              </div></li><li><div>
                Based upon the current patch you provided, I think this is a good suggestion for inclusion. I am not currently using an auth protected Solr core in production, but will get authentication set up in development and get this tested Markus. It would make sense for inclusion just now as it will inevitably become a requested feature in the future.

Further to this, to address you initial question, I agree with the comments regarding the location to configure the auth credentials for Solr communication as quite simply I cannot think of any other solution which would do anything other than clutter.
              </div></li><li><div>
                If no objections i'll send this one in together with NUTCH-1036. This patch includes the changes made for NUTCH-1036, adding reporter increments here and there.
              </div></li><li><div>
                don't forget to add the parameters you introduced to nutch-default.xml (with authentication off by default)
+1 otherwise

Thanks!
              </div></li><li><div>
                The previous patch has the config change for nutch-default, i missed it in the last patch.  Thanks Lewis and Julien!
              </div></li><li><div>
                Committed for 1.4 in rev. 1146035.
              </div></li><li><div>
                Hi Markus, will this be committed to trunk as well?
              </div></li><li><div><div><b>body:</b> Yes, at least partially. Solrclean isn't finished yet and dedup is broken. 
                </div><div><b>label:</b> requirement
                </div></div></li><li><div>
                Partial patch for 2.0 includes support for HTTP auth for solrindex and solrdedup and includes NUTCH-1026 and NUTCH-1036.

Anyone who can test this would make me happy.
              </div></li><li><div><div><b>body:</b> Hi Markus, the patch for 2.0 does not apply cleanly for me I get the following output
{code}
lewis@lewis-01:~/ASF/trunk$ patch -p0 -i NUTCH-987-2.0-1.patch
patching file src/java/org/apache/nutch/indexer/solr/SolrUtils.java
patching file src/java/org/apache/nutch/indexer/solr/SolrDeleteDuplicates.java
patching file src/java/org/apache/nutch/indexer/solr/SolrIndexerJob.java
patching file src/java/org/apache/nutch/indexer/solr/SolrConstants.java
patching file src/java/org/apache/nutch/indexer/solr/SolrWriter.java
patching file src/java/org/apache/nutch/indexer/IndexerReducer.java
patching file conf/nutch-default.xml
Hunk #1 FAILED at 728.
Hunk #2 succeeded at 1060 (offset 13 lines).
1 out of 2 hunks FAILED -- saving rejects to file conf/nutch-default.xml.rej
{code}

I therefore I attach an updated patch which applies cleanly, however it breaks runtime builds and (already broken) tests with the following output
{code}
[javac] Compiling 5 source files to /home/lewis/ASF/trunk/build/classes
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrDeleteDuplicates.java:231: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrDeleteDuplicates.SolrInputFormat
    [javac]       SolrServer solr = SolrUtils.getCommonsHttpSolrServer(conf);
    [javac]                         ^
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrDeleteDuplicates.java:261: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrDeleteDuplicates.SolrInputFormat
    [javac]       SolrServer solr = SolrUtils.getCommonsHttpSolrServer(conf);
    [javac]                         ^
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrDeleteDuplicates.java:306: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrDeleteDuplicates
    [javac]        solr = SolrUtils.getCommonsHttpSolrServer(conf);
    [javac]               ^
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrIndexerJob.java:70: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrIndexerJob
    [javac]       SolrServer solr = SolrUtils.getCommonsHttpSolrServer(getConf());
    [javac]                         ^
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrWriter.java:51: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrWriter
    [javac]     solr = SolrUtils.getCommonsHttpSolrServer(conf);
    [javac]            ^
    [javac] /home/lewis/ASF/trunk/src/java/org/apache/nutch/indexer/solr/SolrWriter.java:64: cannot find symbol
    [javac] symbol  : variable SolrUtils
    [javac] location: class org.apache.nutch.indexer.solr.SolrWriter
    [javac]           val2 = SolrUtils.stripNonCharCodepoints((String)val);
    [javac]                  ^
    [javac] 6 errors

BUILD FAILED
/home/lewis/ASF/trunk/build.xml:96: Compile failed; see the compiler error output for details.
{code}
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Ah the config. You can easily add the config params yourself but they're not strictly required as the code already uses the same defaults.

I'm off!! Cheers!
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Resolved for 1.4, see NUTCH-1104 for 2.0
              </div></li></ol></div></div></html>