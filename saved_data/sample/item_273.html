<!DOCTYPE html><html><div class="item-title">
        Item 273
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> PHOENIX-3925 Disallow usage of ON DUPLICATE KEY clause on tables with global secondary indexes
                </div><div><b>message:</b> PHOENIX-3925 Disallow usage of ON DUPLICATE KEY clause on tables with global secondary indexes

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Disallow usage of ON DUPLICATE KEY clause on tables with global secondary indexes
                </div><div><b>description:</b> For the reasons of service protection, rather than just documenting that you shouldn't use the ON DUPLICATE KEY clause on tables with global secondary indexes, we should instead throw an exception if this is attempted. See reasons listed here for the reason: https://phoenix.apache.org/atomic_upsert.html#Limitations
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> We should probably also make the language on the website stronger. Right now it says it's "supported" but "not recommended", as opposed to the other limitations which say the stronger "may not". For 4.11 and up Phoenix will enforce, but it would be good for users of older versions using the docs to get more clarity too. 
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> Agreed. We'll update the docs when 4.11 is released.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Please review, [~gjacoby].
              </div></li><li><div>
                +1, thanks [~jamestaylor]. 
              </div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-master #1651 (See [https://builds.apache.org/job/Phoenix-master/1651/])
PHOENIX-3925 Disallow usage of ON DUPLICATE KEY clause on tables with (jamestaylor: rev 9b402043896fdeb78a236542bddf88e4a7f300e7)
* (edit) phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java
* (edit) phoenix-core/src/it/java/org/apache/phoenix/end2end/OnDuplicateKeyIT.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/compile/QueryCompilerTest.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/compile/UpsertCompiler.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/util/SchemaUtil.java

              </div></li><li><div>
                Updated website documentation to this:
"Global indexes on columns being atomically updated are not supported, as potentially a separate RPC across the wire would be made while the row is under lock to maintain the secondary index."
              </div></li></ol></div></div></html>