<!DOCTYPE html><html><div class="item-title">
        Item 246
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div><div><b>comment:</b>  if error happens from write, mock a BAD_REQUEST response so that invoker can return immediately without
 waiting until timeout. FIXME: not sure if this is the right approach, but exceptionCaught doesn't work
 as expected.
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Merge pull request #2049, upgrade netty4 to the latest release and make it the default option for transporter.
                </div><div><b>message:</b> Merge pull request #2049, upgrade netty4 to the latest release and make it the default option for transporter.


                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> upgrade netty4 to the latest release and make it the default option for transporter
                </div><div><b>body:</b> we should upgrade netty4 to the latest release and make it the default option for transporter
                </div></div></li><li><div><div><b>title:</b> upgrade netty4 to the latest release and make it the default option for transporter
                </div><div><b>body:</b> we should upgrade netty4 to the latest release and make it the default option for transporter
                </div></div></li><li><div><div><b>title:</b> upgrade netty4 to the latest release and make it the default option for transporter
                </div><div><b>body:</b> we should upgrade netty4 to the latest release and make it the default option for transporter
                </div></div></li><li><div><div><b>title:</b> upgrade netty4 to the latest release and make it the default option for transporter
                </div><div><b>body:</b> we should upgrade netty4 to the latest release and make it the default option for transporter
                </div></div></li><li><div><div><b>title:</b> upgrade netty4 to the latest release and make it the default option for transporter
                </div><div><b>body:</b> we should upgrade netty4 to the latest release and make it the default option for transporter
                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div>
                It look goods to me :-)
              </div></li><li><div>
                looks good!
I'd like to add flow control into netty4 transport
              </div></li><li><div>
                Fixed in the master branch with #2049, need to sync to 2.6.x.
              </div></li></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [dubbo-2029]: upgrade netty4 to the latest release and make it the default option for transporter 
                </div><div><b>body:</b> …lt option for transporter

## What is the purpose of the change

issue#2029: upgrade netty4 to the latest release and make it the default option for transporter 

## Brief changelog

dependencies-bom/pom.xml
dubbo-common/src/main/java/org/apache/dubbo/common/Constants.java
dubbo-config/dubbo-config-api/pom.xml
dubbo-config/dubbo-config-spring/pom.xml
dubbo-demo/dubbo-demo-consumer/pom.xml
dubbo-demo/dubbo-demo-provider/pom.xml
dubbo-monitor/dubbo-monitor-default/pom.xml
dubbo-registry/dubbo-registry-default/pom.xml
dubbo-remoting/dubbo-remoting-api/src/main/java/org/apache/dubbo/remoting/Transporter.java
dubbo-remoting/dubbo-remoting-netty/src/test/java/org/apache/dubbo/remoting/exchange/support/header/HeartbeatHandlerTest.java
dubbo-remoting/dubbo-remoting-netty/src/test/java/org/apache/dubbo/remoting/transport/netty/ClientReconnectTest.java
dubbo-remoting/dubbo-remoting-netty/src/test/java/org/apache/dubbo/remoting/transport/netty/NettyClientTest.java
dubbo-remoting/dubbo-remoting-netty4/src/main/java/org/apache/dubbo/remoting/transport/netty4/NettyClientHandler.java
dubbo-remoting/dubbo-remoting-p2p/pom.xml
dubbo-rpc/dubbo-rpc-dubbo/pom.xml
dubbo-rpc/dubbo-rpc-thrift/pom.xml


## Verifying this change

XXXXX

Follow this checklist to help us incorporate your contribution quickly and easily:

- [x] Make sure there is a [GITHUB_issue](https://github.com/apache/incubator-dubbo/issues) filed for the change (usually before you start working on it). Trivial changes like typos do not require a GITHUB issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.
- [ ] Format the pull request title like `[Dubbo-XXX] Fix UnknownException when host config not exist #XXX`. Each commit in the pull request should have a meaningful subject line and body.
- [ ] Write a pull request description that is detailed enough to understand what the pull request does, how, and why.
- [ ] Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in [test module](https://github.com/apache/incubator-dubbo/tree/master/dubbo-test).
- [ ] Run `mvn clean install -DskipTests` &amp; `mvn clean test-compile failsafe:integration-test` to make sure unit-test and integration-test pass.
- [ ] If this contribution is large, please follow the [Software Donation Guide](https://github.com/apache/incubator-dubbo/wiki/Software-donation-guide).
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                # [Codecov](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=h1) Report
&gt; Merging [#2049](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=desc) into [master](https://codecov.io/gh/apache/incubator-dubbo/commit/b36a6eea627f9854c909b3a9368ddb06fc6610e4?src=pr&amp;el=desc) will **increase** coverage by `0.83%`.
&gt; The diff coverage is `12.5%`.

[![Impacted file tree graph](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/graphs/tree.svg?width=650&amp;height=150&amp;src=pr&amp;token=VnEIkiFQT0)](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=tree)

```diff
@@             Coverage Diff              @@
##             master    #2049      +/-   ##
============================================
+ Coverage     52.19%   53.02%   +0.83%     
- Complexity     4963     4986      +23     
============================================
  Files           568      568              
  Lines         25453    25460       +7     
  Branches       4486     4487       +1     
============================================
+ Hits          13285    13501     +216     
+ Misses        10144     9913     -231     
- Partials       2024     2046      +22
```


| [Impacted Files](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=tree) | Coverage Δ | Complexity Δ | |
|---|---|---|---|
| [...bbo/remoting/transport/netty/NettyTransporter.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctbmV0dHkvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2R1YmJvL3JlbW90aW5nL3RyYW5zcG9ydC9uZXR0eS9OZXR0eVRyYW5zcG9ydGVyLmphdmE=) | `100% &lt;ø&gt; (ø)` | `3 &lt;0&gt; (ø)` | :arrow_down: |
| [...bo/remoting/transport/netty4/NettyTransporter.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctbmV0dHk0L3NyYy9tYWluL2phdmEvb3JnL2FwYWNoZS9kdWJiby9yZW1vdGluZy90cmFuc3BvcnQvbmV0dHk0L05ldHR5VHJhbnNwb3J0ZXIuamF2YQ==) | `100% &lt;ø&gt; (ø)` | `3 &lt;0&gt; (ø)` | :arrow_down: |
| [.../remoting/transport/netty4/NettyClientHandler.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctbmV0dHk0L3NyYy9tYWluL2phdmEvb3JnL2FwYWNoZS9kdWJiby9yZW1vdGluZy90cmFuc3BvcnQvbmV0dHk0L05ldHR5Q2xpZW50SGFuZGxlci5qYXZh) | `58.33% &lt;12.5%&gt; (-14.09%)` | `5 &lt;0&gt; (ø)` | |
| [...ache/dubbo/remoting/p2p/support/AbstractGroup.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctcDJwL3NyYy9tYWluL2phdmEvb3JnL2FwYWNoZS9kdWJiby9yZW1vdGluZy9wMnAvc3VwcG9ydC9BYnN0cmFjdEdyb3VwLmphdmE=) | `45.45% &lt;0%&gt; (-11.37%)` | `7% &lt;0%&gt; (-1%)` | |
| [...he/dubbo/remoting/transport/netty/NettyClient.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctbmV0dHkvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2R1YmJvL3JlbW90aW5nL3RyYW5zcG9ydC9uZXR0eS9OZXR0eUNsaWVudC5qYXZh) | `72.88% &lt;0%&gt; (-8.48%)` | `12% &lt;0%&gt; (-1%)` | |
| [...rpc/protocol/dubbo/telnet/InvokeTelnetHandler.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcnBjL2R1YmJvLXJwYy1kdWJiby9zcmMvbWFpbi9qYXZhL29yZy9hcGFjaGUvZHViYm8vcnBjL3Byb3RvY29sL2R1YmJvL3RlbG5ldC9JbnZva2VUZWxuZXRIYW5kbGVyLmphdmE=) | `51.89% &lt;0%&gt; (-3.8%)` | `11% &lt;0%&gt; (-2%)` | |
| [...dubbo/rpc/protocol/dubbo/CallbackServiceCodec.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcnBjL2R1YmJvLXJwYy1kdWJiby9zcmMvbWFpbi9qYXZhL29yZy9hcGFjaGUvZHViYm8vcnBjL3Byb3RvY29sL2R1YmJvL0NhbGxiYWNrU2VydmljZUNvZGVjLmphdmE=) | `77.2% &lt;0%&gt; (-1.48%)` | `29% &lt;0%&gt; (ø)` | |
| [.../dubbo/remoting/transport/netty4/NettyChannel.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcmVtb3RpbmcvZHViYm8tcmVtb3RpbmctbmV0dHk0L3NyYy9tYWluL2phdmEvb3JnL2FwYWNoZS9kdWJiby9yZW1vdGluZy90cmFuc3BvcnQvbmV0dHk0L05ldHR5Q2hhbm5lbC5qYXZh) | `65% &lt;0%&gt; (-1.25%)` | `22% &lt;0%&gt; (-1%)` | |
| [.../apache/dubbo/rpc/protocol/injvm/InjvmInvoker.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcnBjL2R1YmJvLXJwYy1pbmp2bS9zcmMvbWFpbi9qYXZhL29yZy9hcGFjaGUvZHViYm8vcnBjL3Byb3RvY29sL2luanZtL0luanZtSW52b2tlci5qYXZh) | `69.23% &lt;0%&gt; (+15.38%)` | `3% &lt;0%&gt; (+1%)` | :arrow_up: |
| [.../apache/dubbo/rpc/protocol/thrift/ThriftUtils.java](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree#diff-ZHViYm8tcnBjL2R1YmJvLXJwYy10aHJpZnQvc3JjL21haW4vamF2YS9vcmcvYXBhY2hlL2R1YmJvL3JwYy9wcm90b2NvbC90aHJpZnQvVGhyaWZ0VXRpbHMuamF2YQ==) | `91.8% &lt;0%&gt; (+16.39%)` | `8% &lt;0%&gt; (+2%)` | :arrow_up: |
| ... and [3 more](https://codecov.io/gh/apache/incubator-dubbo/pull/2049/diff?src=pr&amp;el=tree-more) | |

------

[Continue to review full report at Codecov](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=continue).
&gt; **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)
&gt; `Δ = absolute &lt;relative&gt; (impact)`, `ø = not affected`, `? = missing data`
&gt; Powered by [Codecov](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=footer). Last update [b36a6ee...7f89783](https://codecov.io/gh/apache/incubator-dubbo/pull/2049?src=pr&amp;el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).

              </div></li><li><div>
                Agree to change the default transporter to netty4. 

Only one thing to note: this change is not transparent to the user, they should guarantee `[netty 4](https://github.com/netty/netty)` in the classpath, which is not always satisfied since their projects may rely on netty3 by default. But I think it's ok, a release note for incompatible upgrade is enough.
              </div></li><li><div>
                To continue use `netty`, how about this way:

based on your PR, add the following items,
For [netty4/Transporter](https://github.com/apache/incubator-dubbo/blob/master/dubbo-remoting/dubbo-remoting-netty4/src/main/resources/META-INF/dubbo/internal/org.apache.dubbo.remoting.Transporter)
```properties
netty=org.apache.dubbo.remoting.transport.netty4.NettyTransporter
netty4=org.apache.dubbo.remoting.transport.netty4.NettyTransporter
```

And 

For [netty3/Transporter](https://github.com/apache/incubator-dubbo/blob/master/dubbo-remoting/dubbo-remoting-netty/src/main/resources/META-INF/dubbo/internal/org.apache.dubbo.remoting.Transporter)
```properties
netty3=org.apache.dubbo.remoting.transport.netty.NettyTransporter
```
              </div></li><li><div>
                Keep `netty` no changed
```java
@SPI("netty")
 public interface Transporter {
```
              </div></li><li><div><div><b>body:</b> Perhaps the `server` should be removed and passed to the client.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @zonghaishang Agree to remove `server` from the client, and this can be achieved within this issue #2030
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol></ol></div><div><b>jira_issues_comments:</b> <ol></ol></div></div></html>