<!DOCTYPE html><html><div class="item-title">
        Item 165
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * Check if Client is interrupted after handling
   * InterruptedException during cleanup
   
              </div></li><li><div>
                 Clear Thread interrupt
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla.
                </div><div><b>message:</b> HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla.

(cherry picked from commit 0ebc658105336cfe3e1a248b411de60f1d380928)

Conflicts:
	hadoop-common-project/hadoop-common/CHANGES.txt

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Interrupted exception can occur when Client#stop is called
                </div><div><b>description:</b> Its more of a nuisance then a bug, but nevertheless 
{code}
16:16:48,709 ERROR pool-1-thread-1 ipc.Client:195 - Interrupted while waiting for clientExecutorto stop
java.lang.InterruptedException
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2072)
	at java.util.concurrent.ThreadPoolExecutor.awaitTermination(ThreadPoolExecutor.java:1468)
	at org.apache.hadoop.ipc.Client$ClientExecutorServiceFactory.unrefAndCleanup(Client.java:191)
	at org.apache.hadoop.ipc.Client.stop(Client.java:1235)
	at org.apache.hadoop.ipc.ClientCache.stopClient(ClientCache.java:100)
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.close(ProtobufRpcEngine.java:251)
	at org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)
	at org.apache.hadoop.yarn.api.impl.pb.client.ApplicationClientProtocolPBClientImpl.close(ApplicationClientProtocolPBClientImpl.java:112)
	at org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:621)
	at org.apache.hadoop.io.retry.DefaultFailoverProxyProvider.close(DefaultFailoverProxyProvider.java:57)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.close(RetryInvocationHandler.java:206)
	at org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)
	at org.apache.hadoop.yarn.client.api.impl.YarnClientImpl.serviceStop(YarnClientImpl.java:124)
	at org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)
. . .
{code}
It happens sporadically when stopping YarnClient. 
Looking at the code in Client's 'unrefAndCleanup' its not immediately obvious why and who throws the interrupt but in any event it should not be logged as ERROR. Probably a WARN with no stack trace.
Also, for consistency and correctness you may want to Interrupt current thread as well.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> Fix to log Interrupted Exception in IPC Client as a warning. The current thread is interrupted once the Exception is caught. Also, some cleanup code in TestIPC is added so that the client executor count is decremented after each test.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 22s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 37s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 39s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  6s | There were no new checkstyle issues. |
| {color:red}-1{color} | whitespace |   0m  0s | The patch has 1  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 33s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 53s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  22m  9s | Tests passed in hadoop-common. |
| | |  61m 18s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12741693/YARN-1965.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 4c659dd |
| whitespace | https://builds.apache.org/job/PreCommit-YARN-Build/8335/artifact/patchprocess/whitespace.txt |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8335/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8335/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf909.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8335/console |


This message was automatically generated.
              </div></li><li><div>
                Uploading corrected patch shortly
              </div></li><li><div><div><b>body:</b> Patch with correction for whitespace. 
Fix to log Interrupted Exception in IPC Client as a warning. The current thread is interrupted once the Exception is caught. Also, some cleanup code in TestIPC is added so that the client executor count is decremented after each test.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Revised patch upload
              </div></li><li><div>
                \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  17m  4s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 50s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m  0s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 24s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  8s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 36s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 51s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  22m 21s | Tests passed in hadoop-common. |
| | |  62m 51s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12741865/YARN-1965-v2.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / b381f88 |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8345/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8345/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8345/console |


This message was automatically generated.
              </div></li><li><div>
                Thanks for the patch [~kshukla]. I will review it shortly.
              </div></li><li><div>
                Should this be a hadoop common issue? Looks like all the changes are in hadoop common project.
              </div></li><li><div><div><b>body:</b> Overall patch Looks good. Few minor nits.
* There should be a space between () and { here
{{public static final ExecutorService getClientExecutor(){}}
* In testStandAloneClient(), we need spaces near the brackets. Change {{}finally{}} to {{} finally {}}
* In testConnectionIdleTimeouts(), we need space near the brackets. Change {{}finally{}} to {{} finally {}}
* testInterrupted needs to be indented.
* In doErrorTest, testRTEDuringConnectionSetup stopping the client before the server makes more sense. Swap the stop calls in finally block
* In testSocketFactoryException,testIpcConnectTimeout {{client.stop()}} should be within finally block
* Is there a need to move {{Client client = new Client(LongWritable.class, conf, spyFactory);}} in testRTEDuringConnectionSetup?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Moving out all non-critical / non-blocker issues that didn't make it out of 2.7.1 into 2.7.2.
              </div></li><li><div><div><b>body:</b> Changes to TestIPC and Client with correct indentation and formatting.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 16s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 32s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 36s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  6s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 33s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 53s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  22m  0s | Tests passed in hadoop-common. |
| | |  60m 54s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12742522/YARN-1965-v3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / fde20ff |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8376/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8376/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8376/console |


This message was automatically generated.
              </div></li><li><div>
                latest patch looks good.
+1 (non-binding)
              </div></li><li><div>
                Moving to Hadoop Common since all the changes involve in hadoop-common.
              </div></li><li><div>
                \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 26s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 39s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 34s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  8s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 19s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 52s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  22m 13s | Tests passed in hadoop-common. |
| | |  61m  8s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12742522/YARN-1965-v3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 5214876 |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7225/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7225/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7225/console |


This message was automatically generated.
              </div></li><li><div>
                +1, committing this shortly.
              </div></li><li><div>
                Committed this to trunk, branch-2, and branch-2.7. Thanks [~kshukla] for your contribution, thanks [~mitdesai], [~devaraj.k], [~zxu] for your reviews and comments, and thanks [~ozhurakousky] for your reporting.
              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #347 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/347/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java
* hadoop-common-project/hadoop-common/CHANGES.txt

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-trunk-Commit #8397 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8397/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java
* hadoop-common-project/hadoop-common/CHANGES.txt

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Mapreduce-trunk #2289 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2289/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Yarn-trunk #1078 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1078/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #341 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/341/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Hdfs-trunk #2268 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2268/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java

              </div></li><li><div>
                FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #330 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/330/])
HADOOP-12213. Interrupted exception can occur when Client#stop is called. Contributed by Kuhu Shukla. (ozawa: rev 0ebc658105336cfe3e1a248b411de60f1d380928)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestIPC.java
* hadoop-common-project/hadoop-common/CHANGES.txt

              </div></li></ol></div></div></html>