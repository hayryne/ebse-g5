<!DOCTYPE html><html><div class="item-title">
        Item 227
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
     * Get a friendly description of the error (if one is available).
     * @return the error message
     
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>message:</b> KAFKA-3318: clean up consumer logging and error messages

Author: Jason Gustafson &lt;jason@confluent.io&gt;

Reviewers: Ismael Juma

Closes #1036 from hachikuji/KAFKA-3318

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-3318: clean up consumer logging and error messages
                </div><div><b>body:</b> 
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div><div><b>body:</b> Minor comment, otherwise LGTM!

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Thanks for this @hachikuji, very important. :) I left a few comments, looks good otherwise.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> @ijuma Made some more improvements. In particular, I wanted to ensure that the groupId was always provided since otherwise it's difficult to follow logs which contain multiple consumer instances. I also tried to address the review comments.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @hachikuji I did another pass. That last commit changed more than the previous ones! I think it's looking pretty good now. I had a small number of comments/questions.

              </div></li><li><div>
                LGTM

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> Typo "poll() by with max.poll.records"?

                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Ack.

              </div></li><li><div><div><b>body:</b> Do we really need two log statements so near to each other? I guess the second one also includes the co-ordinator id. Would it be too confusing to include it in the previous log statement?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Where do the retries happen and what message do we log when all the retries fail?

              </div></li><li><div><div><b>body:</b> I guess we also need this debug log because of the `syncResponse`? Does the message still make sense given the new log statement above it?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Would this read better as "Not authorized to..."?

              </div></li><li><div><div><b>body:</b> Should this be `error.message()` like a few lines above? Same question for other cases where we are still using `error`.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Do we want to say "most likely means" or simply "may mean"? There could be other reasons too, right? Do we want to briefly mention them?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                What is the reasoning for this being a warning?

              </div></li><li><div><div><b>body:</b> Should the second sentence be "Will find new coordinator and retry"? That seems to be what we use everywhere else.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> The coordinator id ends up being a really big negative integer, but if we used host:port in the log message then maybe it wouldn't be too bad? We'd probably want to make the same change in the other messages as well.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> It happens elsewhere. We could probably just leave that part off if we're reducing the level to debug. Seems like it was originally intended to give users some comfort that the error is being handled internally.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Sure. 

              </div></li><li><div>
                I was debating on it. Maybe there's some useful information to pull out of the sync response, but probably not if it was successful anyway. Perhaps we just remove it?

              </div></li><li><div>
                Ack.

              </div></li><li><div>
                Interesting. Which is more useful host:port or id? If the latter, let's just leave as is. Otherwise, then changing it here and other places sounds good.

              </div></li><li><div>
                Ack.

              </div></li><li><div>
                I changed it to warn because we ignore it internally. 

              </div></li><li><div>
                How about this?

&gt; This means that the time between subsequent calls to poll() was longer than the configured session.timeout.ms, which typically means that the poll loop is spending too much time message processing.

              </div></li><li><div>
                Usually the host:port is more helpful when debugging, and it's kind of a pain to do the reverse mapping from id to host in my head. The only time the id is helpful is when looking at NetworkClient issues.

              </div></li><li><div>
                Sounds good.

              </div></li><li><div><div><b>body:</b> Should we change the `toString` of `Node` to be more logging friendly?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Yeah, it seems to me like we should remove it.

              </div></li><li><div><div><b>body:</b> Is it better to say `Unexpected error` since we are not actually outputting the errorCode in the message?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I think we tend to just say `partition` even though we mean `topic partition`. Is there a reason to say topic-partition here?

              </div></li><li><div>
                But we want users to be aware of it?

              </div></li><li><div>
                Only because it's an unexpected error code. I could go either way.

              </div></li><li><div><div><b>body:</b> Good point. We probably _should_ include the error code or it will be tough to debug the issue.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Ack.

              </div></li><li><div>
                OK, let's leave it as warn.

              </div></li><li><div>
                It currently looks like "Node(id, host, port)," which doesn't seem too bad to me. What do you think?

              </div></li><li><div><div><b>body:</b> When I suggested it, I thought we could do a bit better, maybe something like `(id: 5, www.example.com:9123)`, but maybe that's actually worse.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> I was mostly trying to get rid of the word `Node` because it's a bit redundant when you look at the log messages.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Initially I didn't use Node's toString() at all. I just filled in "{}:{}" with the host and port, but that got a little annoying after a couple times. But maybe it's actually better?

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Improve consumer rebalance error messaging
                </div><div><b>description:</b> A common problem with the new consumer is to have message processing take longer than the session timeout, causing an unexpected rebalance. Unfortunately, when this happens, the error messages are often cryptic (e.g. something about illegal generation) and contain no clear advice on what to do (e.g. increase session timeout). We should do a pass on error messages to ensure that users receive clear guidance on the problem and possible solutions.
                </div></div></li><li><div><div><b>summary:</b> Improve consumer rebalance error messaging
                </div><div><b>description:</b> A common problem with the new consumer is to have message processing take longer than the session timeout, causing an unexpected rebalance. Unfortunately, when this happens, the error messages are often cryptic (e.g. something about illegal generation) and contain no clear advice on what to do (e.g. increase session timeout). We should do a pass on error messages to ensure that users receive clear guidance on the problem and possible solutions.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Improve consumer rebalance error messaging
                </div><div><b>description:</b> A common problem with the new consumer is to have message processing take longer than the session timeout, causing an unexpected rebalance. Unfortunately, when this happens, the error messages are often cryptic (e.g. something about illegal generation) and contain no clear advice on what to do (e.g. increase session timeout). We should do a pass on error messages to ensure that users receive clear guidance on the problem and possible solutions.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                GitHub user hachikuji opened a pull request:

    https://github.com/apache/kafka/pull/1036

    KAFKA-3318: clean up consumer logging and error messages

    

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/hachikuji/kafka KAFKA-3318

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/kafka/pull/1036.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #1036
    
----
commit 274378395e48bca11350c1df3a38137810ba0732
Author: Jason Gustafson &lt;jason@confluent.io&gt;
Date:   2016-03-09T01:42:11Z

    KAFKA-3318: clean up consumer logging and error messages

----

              </div></li><li><div>
                Issue resolved by pull request 1036
[https://github.com/apache/kafka/pull/1036]
              </div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/kafka/pull/1036

              </div></li></ol></div></div></html>