<!DOCTYPE html><html><div class="item-title">
        Item 317
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * This method will be called when there is an unexpected clientside
   * exception. This does not include application-defined exceptions that
   * appear in the IDL, but rather things like IOExceptions.
   * @param throwable
   
              </div></li><li><div>
                *
   * This method will be called when the remote side has completed invoking
   * your method call and the result is fully read. For oneway method calls,
   * this method will be called as soon as we have completed writing out the
   * request.
   * @param response
   
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 Ensure we're not in an error state
              </div></li><li><div>
                *
   * Called by delegate method when finished
   
              </div></li><li><div>
                *
   * Get the client's error - returns null if no error
   * @return
   
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                *
   * Is the client in an error state?
   * @return
   
              </div></li><li><div>
                 Ensure we are not currently executing a method
              </div></li><li><div>
                *
   * Called by delegate method on error
   
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 We don't want to hold up the JVM when shutting down
              </div></li><li><div>
                 Start any new calls
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 Handle any ready channels calls
              </div></li><li><div>
                 this should only have happened if the method call experienced an
 error and the key was cancelled. just skip it.
              </div></li><li><div>
                *
 * Contains selector thread which transitions method call objects
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 Transition function
              </div></li><li><div>
                 this ensures that the TAsyncMethod instance doesn't hang around
              </div></li><li><div>
                 Prepare to read incoming frame size
              </div></li><li><div>
                *
   * Transition to next state, doing whatever work is required. Since this
   * method is only called by the selector thread, we can make changes to our
   * select interests without worrying about concurrency.
   * @param key
   
              </div></li><li><div>
                *
 * Encapsulates an async method call
 * Need to generate:
 *   - private void write_args(TProtocol protocol)
 *   - public T getResult() throws &lt;Exception_1&gt;, &lt;Exception_2&gt;, ...
 * @param &lt;T&gt;
 
              </div></li><li><div>
                 Ensure key is valid
              </div></li><li><div>
                 put up a server
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 make a oneway method call
              </div></li><li><div>
                 make a standard method call
              </div></li><li><div>
                 connect an async client
              </div></li><li><div>
                 set up async client manager
              </div></li><li><div>
                 make another standard method call
              </div></li><li><div>
                 make a void method call
              </div></li><li><div>
                 Generate client method implementations
              </div></li><li><div>
                 Member variables
              </div></li><li><div>
                *
  * Renders a function signature of the form 'void name(args, resultHandler)'
  *
  * @params tfunction Function definition
  * @return String of rendered function definition
  
              </div></li><li><div>
                 Return method  
              </div></li><li><div>
                 TAsyncMethod object for this function call
              </div></li><li><div>
                 extends_client = " extends " + extends + ".AsyncClient";
              </div></li><li><div>
                 Close function
              </div></li><li><div>
                 Close AsyncClient
              </div></li><li><div><div><b>comment:</b>  NOTE since we use a new Client instance to deserialize, let's keep seqid to 0 for now
 indent(f_service_) &lt;&lt; "private int seqid;" &lt;&lt; endl &lt;&lt; endl;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 Assign member variables
              </div></li><li><div>
                 Close class
              </div></li><li><div>
                 Constructor
              </div></li><li><div>
                 Factory method
              </div></li><li><div>
                 Main method body   
              </div></li><li><div>
                 Serialize request
 NOTE we are leaving seqid as 0, for now (see above)
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> THRIFT-768. java: Async client for Java
                </div><div><b>message:</b> THRIFT-768. java: Async client for Java

This patch adds an implementation of a fully-asynchronous client that makes use of NIO. Stubs for the async method calls are generated along with the existing synchronous ones.

git-svn-id: https://svn.apache.org/repos/asf/incubator/thrift/trunk@948492 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Async client for Java
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Is that something you want to include in the generated code or could it be a contrib?

I already have a few classes which I use to invoke Thrift services asynchronously via an executor, I'll contribute them with pleasure, even if they just cover specific use cases (methods that return a single struct).

              </div></li><li><div><div><b>body:</b> I'm thinking of doing something makes use of minor compiler changes to offer really smooth access, so I'm planning for it to go into trunk. Not only will it be asynchronous from the client perspective, it's going to support NIO. (We really want to head towards single-io-threadedness for one of our high performance applications.)

I'd love to see what you've done though - feel free to attach a patch.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Here's the first draft of this functionality. I made some incremental changes on top of what Ning Liang contributed, particularly support for void and oneway method calls, as well as a simple test suite. I think there's probably a bit more cleanup and refactoring to do, but what's attached is fully functional.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Here's a more polished version. This renames a few things, does some refactoring, and just generally cleans things up.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> OK, this version does away with the awkward and unnecessary separate callbacks for errors and results. 

Unless anyone has any further objections, I'll commit this later today.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                I just committed this. Thanks again to Ning Liang for all his hard work!
              </div></li></ol></div></div></html>