<!DOCTYPE html><html><div class="item-title">
        Item 73
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> SOLR-3465: Replication causes two searcher warmups. 
                </div><div><b>message:</b> SOLR-3465: Replication causes two searcher warmups. 

git-svn-id: https://svn.apache.org/repos/asf/lucene/dev/trunk@1385145 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Replication Causes Two Searcher Warmups 
                </div><div><b>description:</b> I'm doing some testing with the current trunk, and am seeing that when a slave retrieves index updates from the master the warmup &amp; searcher registration is performed twice.  Here is a snippet of the log that demonstrates this:

May 16, 2012 6:02:02 PM org.apache.solr.handler.SnapPuller fetchLatestIndex
INFO: Total time taken for download : 92 secs
May 16, 2012 6:02:02 PM org.apache.solr.core.SolrDeletionPolicy onInit
INFO: SolrDeletionPolicy.onInit: commits:num=2
        commit{dir=/Users/mgarski/Code/indexes/solr2/geo/index,segFN=segments_1,generation=1,filenames=[segments_1]
        commit{dir=/Users/mgarski/Code/indexes/solr2/geo/index,segFN=segments_10,generation=36,filenames=[_45_0.tim, _45.fdt, segments_10, _45_0.tip, _45.fdx, _45.fnm, _45_0.frq, _45.per, _45_0.prx]
May 16, 2012 6:02:02 PM org.apache.solr.core.SolrDeletionPolicy updateCommits
INFO: newest commit = 36
May 16, 2012 6:02:02 PM org.apache.solr.search.SolrIndexSearcher &lt;init&gt;
INFO: Opening Searcher@559fe5e6 main
May 16, 2012 6:02:02 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener sending requests to Searcher@559fe5e6 main{StandardDirectoryReader(segments_10:335:nrt _45(4.0):C1096375)}
May 16, 2012 6:02:02 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener done.
May 16, 2012 6:02:02 PM org.apache.solr.core.SolrCore registerSearcher
INFO: [geo] Registered new searcher Searcher@559fe5e6 main{StandardDirectoryReader(segments_10:335:nrt _45(4.0):C1096375)}
May 16, 2012 6:02:02 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: start commit{flags=0,version=0,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false}
May 16, 2012 6:02:02 PM org.apache.solr.search.SolrIndexSearcher &lt;init&gt;
INFO: Opening Searcher@42101da9 main
May 16, 2012 6:02:02 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: end_commit_flush
May 16, 2012 6:02:02 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener sending requests to Searcher@42101da9 main{StandardDirectoryReader(segments_10:335:nrt _45(4.0):C1096375)}
May 16, 2012 6:02:02 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener done.
May 16, 2012 6:02:02 PM org.apache.solr.core.SolrCore registerSearcher
INFO: [geo] Registered new searcher Searcher@42101da9 main{StandardDirectoryReader(segments_10:335:nrt _45(4.0):C1096375)}

I am trying to determine the cause, does anyone have any idea where to start?
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> I found the issue but am not sure what the appropriate fix would be.

The SnapPuller.doCommit method does a solrCore.getSearcher and a solrCore.getUpdateHandler().commit... one of those may be redundant but I do not know which.  I reverted the body of that method to an older version (1237497) and only one searcher is opened, warmed, and registered.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                The commit should not need to open a new searcher - I'll change this.
              </div></li><li><div>
                Fix committed.
              </div></li><li><div>
                [branch_4x commit] Mark Robert Miller
http://svn.apache.org/viewvc?view=revision&amp;revision=1385146

SOLR-3465: Replication causes two searcher warmups. 


              </div></li><li><div>
                [branch_4x commit] Mark Robert Miller
http://svn.apache.org/viewvc?view=revision&amp;revision=1385146

SOLR-3465: Replication causes two searcher warmups. 

              </div></li><li><div>
                Closed after release.
              </div></li></ol></div></div></html>