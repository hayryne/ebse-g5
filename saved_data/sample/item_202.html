<!DOCTYPE html><html><div class="item-title">
        Item 202
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 [[arrow::export]]
              </div></li><li><div>
                 some known special cases
              </div></li><li><div>
                 Reserve enough space before appending
              </div></li><li><div>
                 Recurse.
              </div></li><li><div>
                 append
              </div></li><li><div>
                 convert to an R object to store as the list' ptype
              </div></li><li><div>
                 Build an empty array to match value_type
              </div></li><li><div>
                 nothing to do, list contain NULL by default
              </div></li><li><div>
                 datatype.cpp
              </div></li><li><div>
                 array.cpp
              </div></li><li><div>
                 [[arrow::export]]
              </div></li><li><div>
                 persistently protect `x` and return it
              </div></li><li><div>
                 returns the namespace environment for package `name`
              </div></li><li><div>
                 return R string vector, e.g.
 strings({"foo", "bar"}) returns a size 2 STRSXP
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>message:</b> ARROW-9291 [R]: Support fixed size binary/list types

some progress here:

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt;
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2]
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)),
  ptype = raw(),
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt;
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2]
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;

Closes #7660 from romainfrancois/ARROW-9291/FixedSize

Lead-authored-by: Romain Francois &lt;romain@rstudio.com&gt;
Co-authored-by: Neal Richardson &lt;neal.p.richardson@gmail.com&gt;
Signed-off-by: Neal Richardson &lt;neal.p.richardson@gmail.com&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li><li><div><div><b>title:</b> ARROW-9291 [R]: Support fixed size binary/list types
                </div><div><b>body:</b> some progress here: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(vctrs::list_of(as.raw(1:4), as.raw(1:4)), type = fixed_size_binary(4L))
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04

# we can skip the type= we have an R object that inherits from vctrs_list_of,
# with class arrow_fixed_size_binary and a byte_width attribute
raws &lt;- vctrs::new_list_of(
  list(as.raw(1:4), as.raw(1:4)), 
  ptype = raw(), 
  byte_width = 4L,
  class = "arrow_fixed_size_binary"
)
a &lt;- Array$create(raws)
a
#&gt; Array
#&gt; &lt;fixed_size_binary[4]&gt;
#&gt; [
#&gt;   01020304,
#&gt;   01020304
#&gt; ]
v &lt;- a$as_vector()
v
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
str(v)
#&gt; fixed_size_binary&lt;4&gt; [1:2] 
#&gt; $ : raw [1:4] 01 02 03 04
#&gt; $ : raw [1:4] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                I think we need a function for the `raws &lt;- vctrs::new_list_of(...)` part, and probably an equivalent function for the other binary types, but `binary()`, `large_binary()` and `fixed_size_binary()` which would be the obvious choice is already taken. 

I think that in this function: 

```
template &lt;&gt;
std::shared_ptr&lt;arrow::DataType&gt; InferArrowTypeFromVector&lt;VECSXP&gt;(SEXP x) {
  if (Rf_inherits(x, "data.frame") || Rf_inherits(x, "POSIXlt")) {
    return InferArrowTypeFromDataFrame(x);
  } else {
    if (Rf_inherits(x, "arrow_fixed_size_binary")) {
      SEXP byte_width = Rf_getAttrib(x, symbols::byte_width);
      if (Rf_isNull(byte_width) || TYPEOF(byte_width) != INTSXP ||
          XLENGTH(byte_width) != 1) {
        Rcpp::stop("malformed arrow_fixed_size_binary object");
      }
      return arrow::fixed_size_binary(INTEGER(byte_width)[0]);
    }

    SEXP ptype = Rf_getAttrib(x, symbols::ptype);
    if (Rf_isNull(ptype)) {
      if (XLENGTH(x) == 0) {
        Rcpp::stop(
            "Requires at least one element to infer the values' type of a list vector");
      }

      ptype = VECTOR_ELT(x, 0);
    }

    // special case list(raw()) -&gt; BinaryArray
    if (TYPEOF(ptype) == RAWSXP) {
      return arrow::binary();
    }

    return arrow::list(InferArrowType(ptype));
  }
}
```

we should rather dispatch based on an r type for binary and large binary, as it's done here for fixed size binary, and forget the magic conversion of a `vctrs_list_of&lt;raw&gt;` to a `BinaryArray`, as we might actually want to create an Array of type `List&lt;uint8&gt;`: 

``` r
arrow::list_of(arrow::uint8())
#&gt; ListType
#&gt; list&lt;item: uint8&gt;
```

&lt;sup&gt;Created on 2020-07-07 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;

but type deduction currently short circuits it.  

              </div></li><li><div>
                https://issues.apache.org/jira/browse/ARROW-9291
              </div></li><li><div>
                Let me see if I understand the issues you're concerned with. We have some inconsistency in how types are converted: `raw` -&gt; `uint8`, but `uint8` -&gt; `integer`, for example. Here, `binary` -&gt; `list_of(raw)`, and we've special-cased `list_of(raw)` -&gt; `binary`, but you might think that it should be `list_of(uint8)` given how the non-list type is converted. 

I'm fine with getting rid of the special-casing of `list_of(raw)` to `binary` and having the binary conversion set an R class (subclass of vctrs list of or whatever), which we use to determine that the list of raw should be converted back to BinaryArray. I'm not particularly worried that someone would have a list of raw vectors in R and be frustrated that that wasn't converted to a list of uint8--seems unlikely, and if you really care, you can always specify a type/schema. But it seems reasonable to be explicit and set a class attribute.
              </div></li><li><div>
                Some more progress today. 

``` r
library(arrow, warn.conflicts = FALSE)

# with explicit type=
#   no deduction, but testing
raws &lt;- vctrs::list_of(as.raw(1:4), as.raw(1:4))
a1 &lt;- Array$create(raws, type = binary())
a2 &lt;- Array$create(raws, type = large_binary())
a3 &lt;- Array$create(raws, type = fixed_size_binary(4L))
a1$as_vector()
#&gt; &lt;binary[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
a2$as_vector()
#&gt; &lt;large_binary[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
a3$as_vector()
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04

# with type deduced from class, we should have functions for this. 

a1 &lt;- Array$create(
  vctrs::new_list_of(list(as.raw(1:4), as.raw(1:4)), class = "arrow_binary")
)
a2 &lt;- Array$create(
  vctrs::new_list_of(list(as.raw(1:4), as.raw(1:4)), class = "arrow_large_binary")
)
a3 &lt;- Array$create(
  vctrs::new_list_of(list(as.raw(1:4), as.raw(1:4)), class = "arrow_fixed_size_binary", byte_width = 4L)
)
a1$as_vector()
#&gt; &lt;binary[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
a2$as_vector()
#&gt; &lt;large_binary[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
a3$as_vector()
#&gt; &lt;fixed_size_binary&lt;4&gt;[2]&gt;
#&gt; [[1]]
#&gt; [1] 01 02 03 04
#&gt; 
#&gt; [[2]]
#&gt; [1] 01 02 03 04
```

&lt;sup&gt;Created on 2020-07-08 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;

Will tackle FixedSizeList on the same model. 

Now that we have the R classes `arrow_binary`, `arrow_large_binary`, and `arrow_fixed_size_binary`, perhaps we don't really need to inherit from `vctrs_list_of`, I actually had to backpedal it with some methods to make it look sort of ok: 

```r
# vctrs support -----------------------------------------------------------

#' @importFrom vctrs vec_ptype_full vec_ptype_abbr obj_str_footer
#' @method vec_ptype_full arrow_fixed_size_binary
#' @export
vec_ptype_full.arrow_fixed_size_binary &lt;- function(x, ...) {
  paste0("fixed_size_binary&lt;", attr(x, "byte_width"), "&gt;")
}

#' @method vec_ptype_full arrow_binary
#' @export
vec_ptype_full.arrow_binary &lt;- function(x, ...) {
  "binary"
}

#' @method vec_ptype_full arrow_large_binary
#' @export
vec_ptype_full.arrow_large_binary &lt;- function(x, ...) {
  "large_binary"
}


#' @method vec_ptype_abbr arrow_fixed_size_binary
#' @export
vec_ptype_abbr.arrow_fixed_size_binary &lt;- vec_ptype_full.arrow_fixed_size_binary

#' @method vec_ptype_abbr arrow_binary
#' @export
vec_ptype_abbr.arrow_binary &lt;- vec_ptype_full.arrow_binary

#' @method vec_ptype_abbr arrow_large_binary
#' @export
vec_ptype_abbr.arrow_large_binary &lt;- vec_ptype_full.arrow_large_binary



#' @method obj_str_footer arrow_fixed_size_binary
#' @export
obj_str_footer.arrow_fixed_size_binary &lt;- function(x, ..., indent.str = "", nest.lev = 0) {
  invisible(NULL)
}

#' @method obj_str_footer arrow_binary
#' @export
obj_str_footer.arrow_binary &lt;- obj_str_footer.arrow_fixed_size_binary

#' @method obj_str_footer arrow_large_binary
#' @export
obj_str_footer.arrow_large_binary &lt;- obj_str_footer.arrow_fixed_size_binary
```
              </div></li><li><div>
                So now either : 
 - we have a compatible list, i.e. a list of raw vectors and we request `type = binary/large_binary/fixed_size_binary`. 
 - we have R objects (that still have to be list of raw vectors) with these dedicated classes

In any case the conversion from arrow to R makes these classes regardless. 
              </div></li><li><div>
                Further progress re FixedSizeList: 

``` r
library(arrow, warn.conflicts = FALSE)

a &lt;- Array$create(list(1:4), type = fixed_size_list_of(int32(), 4L))
a
#&gt; Array
#&gt; &lt;fixed_size_list&lt;item: int32&gt;[4]&gt;
#&gt; [
#&gt;   [
#&gt;     1,
#&gt;     2,
#&gt;     3,
#&gt;     4
#&gt;   ]
#&gt; ]

# back to R
a$as_vector()
#&gt; &lt;fixed_size_list&lt;integer, 4&gt;[1]&gt;
#&gt; [[1]]
#&gt; [1] 1 2 3 4
str(a$as_vector())
#&gt; fixed_size_list&lt;integer, 4&gt; [1:1] 
#&gt; $ : int [1:4] 1 2 3 4
#&gt; @ list_size: int 4
#&gt; @ ptype    : int(0)
```

&lt;sup&gt;Created on 2020-07-09 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)&lt;/sup&gt;
              </div></li><li><div>
                Looks like this conflicts with the Dictionary PR I just merged
              </div></li><li><div><div><b>body:</b> Should be better now ü§ûüèæ
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Should remove the byte_width arg since it's no longer used
              </div></li><li><div><div><b>body:</b> Would you mind adding a comment/docstring to these new functions? It's not obvious what they do just from their names.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Should footnote and explain what these `arrow_` types are (at least that they're subclasses of list/vctrs::list_of)
              </div></li><li><div>
                That's no longer the case for the `*binary` ones, they inherit from `vctrs_vctr` mostly for printing purposes. I'll add some footnotes. 
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> [R] Support fixed size binary/list types
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> [R] Support fixed size binary/list types
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> [R] Support fixed size binary/list types
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Issue resolved by pull request 7660
[https://github.com/apache/arrow/pull/7660]
              </div></li></ol></div></div></html>