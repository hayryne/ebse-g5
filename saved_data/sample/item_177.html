<!DOCTYPE html><html><div class="item-title">
        Item 177
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Disable publishing of .sha256 and .sha512 files to repository.apache.org
                </div><div><b>message:</b> Disable publishing of .sha256 and .sha512 files to repository.apache.org

See https://github.com/gradle/gradle/pull/11358
See https://issues.apache.org/jira/browse/INFRA-14923

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Add new SHA-* rules to Nexus staging
                </div><div><b>description:</b> Currently .sha256/.sha512 [1] aren't recognized as checksums when uploading to Nexus, therefore the staging rules need to be updated. 

[1] http://www.apache.org/dev/release-distribution#sigs-and-sums


Error when uploading to nexus:

Error while trying to close staging repository with ID "orgapachepoi-1144".

Nexus Staging Rules Failure Report
==================================

Repository "orgapachepoi-1144" failures
  Rule "checksum-staging" failures
    * Missing SHA1: '/org/apache/poi/poi/3.17/poi-3.17.pom.sha512.sha1'
    * Missing MD5: '/org/apache/poi/poi/3.17/poi-3.17.pom.sha512.md5'
    * Missing SHA1: '/org/apache/poi/poi/3.17/poi-3.17-javadoc.jar.sha512.sha1'
    * Missing MD5: '/org/apache/poi/poi/3.17/poi-3.17-javadoc.jar.sha512.md5'
    * Missing SHA1: '/org/apache/poi/poi/3.17/poi-3.17-sources.jar.sha512.sha1'
    * Missing MD5: '/org/apache/poi/poi/3.17/poi-3.17-sources.jar.sha512.md5'
    * Missing SHA1: '/org/apache/poi/poi/3.17/poi-3.17.jar.sha512.sha1'
    * Missing MD5: '/org/apache/poi/poi/3.17/poi-3.17.jar.sha512.md5'
  Rule "signature-staging" failures
    * Missing Signature: '/org/apache/poi/poi/3.17/poi-3.17.pom.sha512.asc' does not exist for 'poi-3.17.pom.sha512'.
    * Missing Signature: '/org/apache/poi/poi/3.17/poi-3.17-javadoc.jar.sha512.asc' does not exist for 'poi-3.17-javadoc.jar.sha512'.
    * Missing Signature: '/org/apache/poi/poi/3.17/poi-3.17-sources.jar.sha512.asc' does not exist for 'poi-3.17-sources.jar.sha512'.
    * Missing Signature: '/org/apache/poi/poi/3.17/poi-3.17.jar.sha512.asc' does not exist for 'poi-3.17.jar.sha512'.


Dropping failed staging repository with ID "orgapachepoi-1144".

Waiting for operation to complete...
.
.


                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Will require changes to the code.
              </div></li><li><div>
                [~brianf] is there a timeline for this?
              </div></li><li><div>
                Note also that as per recent changes to http://www.apache.org/dev/release-distribution we'd like to stop using md5 digests, IIUC this might also require Nexus code changes.

/cc [~penning@uu.nl]
              </div></li><li><div><div><b>body:</b> Any updates on this?
Our next releases are due and Shane wrote basically last Friday the same to all PMCs:
"
-----------------------------------------------------------------------
*2 Release Dist Policy Changes  (Q? users@infra.apache.org)
-----------------------------------------------------------------------

The Release Distribution Policy[1] changed regarding checksum files.
See under "Cryptographic Signatures and Checksums Requirements" [2].

Note that "MUST", "SHOULD", "SHOULD NOT" are technical terms ;
not just emphasized words ; for an explanation see RFC-2119 [3].

Old policy :

  -- SHOULD supply a SHA checksum file
  -- SHOULD NOT supply a MD5 checksum file

New policy :

  -- SHOULD supply a SHA-256 and/or SHA-512 checksum file
  -- SHOULD NOT supply MD5 or SHA-1 checksum files

Why this change ?

  -- Like MD5, SHA-1 is too broken ; we should move away from it.

Impact for PMCs :

  -- for new releases :
     -- you MUST supply a SHA-256 and/or SHA-512 file
     -- you SHOULD NOT supply MD5 or SHA-1 files

  -- for past releases :
     -- you are not required to change anything ;
     -- it would be nice if you fixed your dist area ;
        start with : cleanup ; rename .sha's ; remove .md5's

  -- Questions, remarks, etc ? Mail users@infra.apache.org.

  ...

[1] https://www.apache.org/dev/release-distribution
[2] https://www.apache.org/dev/release-distribution#sigs-and-sums
[3] https://www.ietf.org/rfc/rfc2119.txt
[4] https://www.apache.org/legal/release-policy.html#when-to-archive
"
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                We've started working on adjustments to the staging rules for this. I have the new plugin and need to find the time to test and update our system.
              </div></li><li><div>
                We've just fixed our builds to generate sha512 checksums, and are hitting this issue, so can't do releases at the moment.  Any estimate of when this will be fixed?
              </div></li><li><div>
                I did  workaround, where I had the maven gpg plugin sign the sha512 files.  This worked, however I see what I expect in my .m2 repository:
for attached artifact X I see 
  X, 
  X.asc, 
  X.sha512, 
  X.sha512.asc

But in the Nexus staging repo, I see these *plus* 
  X.md5 
  X.sha1, 
  X.sha512.md5, 
  X.sha512.sha1

So something in the process of deploying to repository.apache.org is adding md5 and sha1 checksums, which is against policy.
              </div></li><li><div>
                [~brianf] ping, any progress.
              </div></li><li><div>
                [~brianf] I neither see an issue for the support of SHA512 except for https://issues.sonatype.org/browse/NEXUS-5881 over at the JIRA from Nexus nor do I see the according code changes in https://github.com/sonatype/nexus-public/tree/master/plugins/nexus-repository-maven yet. AFAIK this is not about the staging rules but also about for which files checksum are automatically generated. Can you share an update and also which changes you are planning to do?
              </div></li><li><div>
                [~brianf] any news please?
              </div></li><li><div>
                Team is updating and working on merging the changes into the 2.x trunk.


              </div></li><li><div>
                Thanks [~brianf] let me know please if you need anything our end.
              </div></li><li><div>
                Almost a month* here, [~brianf]. Anything to be done or said?

* whoops! it's still 2019
              </div></li><li><div>
                [~brianf] we have been waiting over 2 years for code changes in order to close this ticket, what can we do this end to help?
              </div></li><li><div>
                Gradle 6.0 added SHA256 and SHA512: https://docs.gradle.org/6.0/release-notes.html#signing-plugin-now-uses-sha512-instead-of-sha1

{quote} Gradle will now automatically upload SHA256 and SHA512 signatures, in addition to the traditional but unsecure MD5 and SHA1 signatures.{quote}

In other words, current Gradle can't really upload release artifacts to repository.apache.org.
Sample: https://repository.apache.org/content/repositories/orgapachejmeter-1061/
Note: the staging repository is not closed, so the artifacts can't be viewed by the URL above.

Close produces 2 errors:
{noformat}
Event: 2 rules failed: Apache Rules
Wednesday, November 13, 2019 01:00:57 GMT (GMT+0300)
id	ced3de4fc7f29
failureCount	2
{noformat}

1)
{noformat}
Event: Failed: Signature Validation
Wednesday, November 13, 2019 01:00:57 GMT (GMT+0300)
typeId	signature-staging
failureMessage	Missing Signature: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha512.asc' does not exist for 'jorphan-5.2.1.pom.sha512'.
failureMessage	Missing Signature: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha256.asc' does not exist for 'jorphan-5.2.1.pom.sha256'.
failureMessage	Missing Signature: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.module.sha256.asc' does not exist for 'jorphan-5.2.1.module.sha256'.
failureMessage	Missing Signature: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.jar.asc.sha512.asc' does not exist for 'jorphan-5.2.1.jar.asc.sha512'.
...
{noformat}

2) 
{noformat}Event: Failed: Checksum Validation
Wednesday, November 13, 2019 01:00:57 GMT (GMT+0300)
typeId	checksum-staging
failureMessage	Missing SHA1: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha512.sha1'
failureMessage	Missing MD5: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha512.md5'
failureMessage	Missing SHA1: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha256.sha1'
failureMessage	Missing MD5: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.pom.sha256.md5'
failureMessage	Missing SHA1: '/org/apache/jmeter/jorphan/5.2.1/jorphan-5.2.1.module.sha256.sha1'
...
{noformat}

Can the above validation rules be adjusted so repository.apache.org does not require signing and checksumming sha256 and sha512 files?

Is it something that requires code change for Nexus 2.0?
Can repository.apache.org be upgraded? (e.g. in case Nexus 3.x supports sha512)


              </div></li><li><div>
                Unfortunately, it looks like there's an extra issue with maven-metadata.xml.sha256 / maven-metadata.xml.sha512 handing at Nexus side ( see https://issues.sonatype.org/browse/MVNCENTRAL-5276 )
              </div></li><li><div>
                ping [~brianf] [~jorlina]

              </div></li><li><div>
                I'm not sure if this issue is public:

https://issues.sonatype.org/browse/NEXUS-21802

but we opened up specifically to change the handling of sha256/sha512 associated with maven-metadata files.  I don't have an ETA on when it's going to get worked on.
              </div></li><li><div>
                Can you make the issue public? Currently it is not visible even if logging in...
              </div></li><li><div>
                We've updated the visibility on that NEXUS issue.
              </div></li><li><div>
                Any update here?

              </div></li><li><div>
                FWIW, The JSPWiki project has a setup that allows them to publish SHA-512 digests, see 

https://lists.apache.org/thread.html/r8cf8cb87f43569fa5578497f8fba64da0298677aad1cfd279ffc0c37%40%3Cgeneral.incubator.apache.org%3E
              </div></li><li><div>
                [~brianf] [~jorlina] any update here?

              </div></li><li><div>
                [~brianf] and [~jorlina] ping please - you guys just did a release and it doesnt look like this was addressed, when can we expect an update??
              </div></li><li><div>
                Thanks for the nudge. I suddenly find myself with more time given no
travel and no place to go locally so I'll get this done.


              </div></li><li><div>
                Are there any updates here?

              </div></li><li><div>
                Is there any update on this one?
Releasing a project with ~300 artifacts is simply not feasible with sha512 verified and added manually.
              </div></li><li><div>
                This week we should be able to install the new release. The system is
also being cutover to a new vm at the same time.


              </div></li><li><div>
                2.18.1 upgrade contains sha2 support.
              </div></li><li><div>
                Still there are no SHA256 and SHA512 hashes being generated automatically for new staging repos. E.g. https://repository.apache.org/content/repositories/orgapachesling-2277/org/apache/sling/org.apache.sling.models.validation-impl/1.0.0/ does only have SHA1 and MD5. Is there anything else to be configured?
              </div></li><li><div>
                The hashed aren't generated by Nexus. They are generated by the tooling you use to do the upload. For example, the Maven Resolver and Maven Resilver Ant tasks are in the process of being updated to create the new hashes.
              </div></li><li><div>
                [~markt] Maven Resolver is just a consumer (i.e. will never generate those files). It is just inconsistent right now, as now MD5 and SHA1 are generated by Nexus, while SHA2 (256/512) are not. Also there is some discussion in https://issues.apache.org/jira/browse/MINSTALL-138 which tool/plugin is responsible for doing that in the future and what is a good default.
              </div></li></ol></div></div></html>