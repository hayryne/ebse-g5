<!DOCTYPE html><html><div class="item-title">
        Item 358
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                












              </div></li><li><div>
                 Retrieving Scheduler Job by ID
              </div></li><li><div>
                 Waiting for Job to complete
              </div></li><li><div>
                








              </div></li><li><div>
                 Executing Scheduler Job
              </div></li><li><div>
                 Verifying the Status of the Recently executed Scheduler Job
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Merge pull request #842 from Vishwa1311/MIFOSX-1047
                </div><div><b>message:</b> Merge pull request #842 from Vishwa1311/MIFOSX-1047

[MIFOSX-1047] Updated JUnit Test Cases for Scheduler Jobs
                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> fix generic warnings in StaffTest (re. FINERACT-949)
                </div><div><b>body:</b> FINERACT-949
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> fix generic warnings in StaffTest (re. FINERACT-949)
                </div><div><b>body:</b> FINERACT-949
                </div></div></li><li><div><div><b>title:</b> fix generic warnings in StaffTest (re. FINERACT-949)
                </div><div><b>body:</b> FINERACT-949
                </div></div></li><li><div><div><b>title:</b> fix generic warnings in StaffTest (re. FINERACT-949)
                </div><div><b>body:</b> FINERACT-949
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div><div><b>body:</b> @ptuomola @awasum @xurror OK for you?

But more importantly, please chime in to the more general question raised in FINERACT-949 ...
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                LGTM.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Improve Java API style used for writing integration tests in Fineract
                </div><div><b>description:</b> The current (Java) "style" that integration tests are written in in Fineract is... really ugly!

They are from a bygone era when Java had no generic. All those weird {{java.util.HashSet}}, with a lot of {{java.lang.Object}} etc. in tests are... so not 21st century style.

I don't really have the answer here, yet - but perhaps others have ideas - how does one write Java (test) code in 2020 which deals with JSON in a nicer way?

Does REST Assured (http://rest-assured.io) meanwhile offer a better way to do this kind of thing?

Could https://github.com/skyscreamer/JSONassert be of use and interest for this purpose?

BTW if using REST Assured better than we are is part of the answer here, then let's first do FINERACT-884.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> One particularly annoying issue seems to be that RestAssured, before FINERACT-884, returns {{List&lt;Map&lt;String, Object&gt;&gt;}} if the JSON contains a list, but just {{(LinkedHash)Map}} in case of API replies such as errors? This makes it particularly painful to "nicely" write e.g. the {{StaffTest}}, which expects a list in reply to {{/api/v1/staff}}, but for {{testStaffListFetchWrongState()}} needs to assert the return of an error. That's presumably why {{getStaffListWithState()}} was written to return an {{java.lang.Object}} ...

... in https://github.com/apache/fineract/pull/842/files?w=1 I've made it return a List, and fort he exceptional case of {{testStaffListFetchWrongState()}} used {{@Test(expected = ClassCastException.class)}}, but that seems more like a wrong hack... :D

There must be a better style? What I'm missing here is some sort of {{Any}} with an {{asList()}} and an {{isError()}} and what not.

BTW while that {{Map&lt;String, Object&gt;}} I'm using is slightly better than what we have, the Maps' {{Object}} value is still "ugly".

PS: In this context, I also explored using REST Assured's {{getObject()}} with a {{TypeRef&lt;&gt;}} instead of {{get()}}, e.g. with this in {{Utils}}, but it turns out this actually isn't required, and doesn't really help with the problem described above.

{code:java}
    public static &lt;T&gt; T performServerGetObject(final RequestSpecification requestSpec, final ResponseSpecification responseSpec,
            final String getURL, final String jsonAttributeToGetBack, final TypeRef&lt;T&gt; typeRef) {
        final String json = given().spec(requestSpec).expect().spec(responseSpec).log().ifError().when().get(getURL).andReturn().asString();
        if (jsonAttributeToGetBack == null) { return (T) json; }
        return from(json).getObject(jsonAttributeToGetBack, typeRef);
    {code}
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Or the approach of "mapping" to a {{List}} or {{Map}} may be the wrong start all together.. https://www.baeldung.com/rest-assured-response is worth reading here. Also https://github.com/rest-assured/rest-assured/wiki/Usage#full-bodycontent-matching documents REST-Assured's {{body()}} method, as used also e.g. on https://stackoverflow.com/questions/51015677/use-jsonassert-on-part-of-json-with-restassured. For bigger responses, comining that with JSONassert (https://github.com/skyscreamer/JSONassert)  seems interesting.
              </div></li><li><div><div><b>body:</b> I'm not going to be much use on this, but just reading the&nbsp; ([https://github.com/skyscreamer/JSONassert]&nbsp;suggests it has a good approach and makes tests less brittle, which seams to be a main issue for fineract. &nbsp;Down the paths you outlined, I also found [https://springframework.guru/processing-json-jackson/]&nbsp; &nbsp;(and the debate of Jackson vs GSON). &nbsp;It seems that the criteria for this effort is: &nbsp; less brittle, more readable, easy to write. &nbsp;I hope someone with some experience in this can chime in. &nbsp;

&nbsp;
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                FINERACT-996 has a somewhat related idea which could play a role in future ITs.
              </div></li></ol></div></div></html>