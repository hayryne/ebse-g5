<!DOCTYPE html><html><div class="item-title">
        Item 352
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * Context of the schema, the context can be generated from a source schema or descriptors. The
   * ability of converting back from Row to proto depends on the type of context.
   
              </div></li><li><div>
                *
   * Context the contains the full {@link ProtoDomain} and a reference to the message name. The full
   * domain is needed for creating Rows back to the original proto messages.
   
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
   * Create a new ProtoDynamicMessageSchema from a {@link ProtoDomain} and for a descriptor. The
   * descriptor is only used for it's name, that name will be used for a search in the domain.
   
              </div></li><li><div>
                * List of field converters for each field in the row. 
              </div></li><li><div>
                *
   * Proto has a well defined way of storing maps, by having a Message with two fields, named "key"
   * and "value" in a repeatable field. This overlay translates between Row.map and the Protobuf
   * map.
   
              </div></li><li><div>
                 handled by logical type case
              </div></li><li><div>
                 Protobuf messages BYTES doesn't like empty bytes?!
              </div></li><li><div>
                * Enum overlay handles the conversion between a string and a ProtoBuf Enum. 
              </div></li><li><div>
                *
   * This overlay handles nullable fields. If a primitive field needs to be nullable this overlay is
   * wrapped around the original overlay.
   
              </div></li><li><div>
                * The toRow function to convert the Message to a Row. 
              </div></li><li><div>
                * Convert a row value and set it on a proto message. 
              </div></li><li><div>
                *
   * Base converter class for converting from proto values to row values. The converter mainly works
   * on fields in proto messages but also has methods to convert individual elements (example, for
   * elements in Lists or Maps).
   
              </div></li><li><div>
                *
   * Specific converter for Proto Wrapper values as they are translated into nullable row values.
   
              </div></li><li><div>
                * Get a proto field and convert it into a row value. 
              </div></li><li><div>
                * Converter for primitive proto values. 
              </div></li><li><div>
                *
     * Base class for the protobuf message. Normally this is DynamicMessage, but as this schema
     * class is also used to decode protobuf options this can be normal Message instances.
     
              </div></li><li><div>
                * Initialize the transient fields after deserialization or construction. 
              </div></li><li><div>
                * The fromRow function to convert the Row to a Message. 
              </div></li><li><div>
                * Convert Proto oneOf fields into the {@link OneOfType} logical type. 
              </div></li><li><div>
                * Convert a row value into a proto value. 
              </div></li><li><div>
                 return object;
              </div></li><li><div>
                * Convert a proto value into a row value. 
              </div></li><li><div>
                *
   * Converter for Bytes. Protobuf Bytes are natively represented as ByteStrings that requires
   * special handling for byte[] of size 0.
   
              </div></li><li><div>
                *
   * Create a new ProtoDynamicMessageSchema from a {@link ProtoDomain} and for a message. The
   * message need to be in the domain and needs to be the fully qualified name.
   
              </div></li><li><div>
                *
   * Context that only has enough information to convert a proto message to a Row. This can be used
   * for arbitrary conventions, like decoding messages in proto options.
   
              </div></li><li><div>
                 equality doesn't work between dynamic messages and other,
 so we compare string representation
              </div></li><li><div>
                 Test map type
              </div></li><li><div>
                * Collection of tests for values on Protobuf Messages and Rows. 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                * Create a {@link Value} specifying which field to set and the value to set. 
              </div></li><li><div>
                * Attach the name of the message to a map key. 
              </div></li><li><div>
                * Return the message name for a map key. 
              </div></li><li><div>
                * Attach the name of the message to a type. 
              </div></li><li><div>
                * Return the message name for a type. 
              </div></li><li><div>
                * Return the message name for a map value. 
              </div></li><li><div>
                * Attach the name of the message to a map value. 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Merge pull request #10502: [BEAM-7274] Add DynamicMessage Schema support
                </div><div><b>message:</b> Merge pull request #10502: [BEAM-7274] Add DynamicMessage Schema support


                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [BEAM-7274] Add DynamicMessage Schema support
                </div><div><b>body:</b> Add DynamicMessage schema support. This is different from
generated classes as it uses the proto descriptors. It uses
the ProtoDomain as an index for searching embedded messages.

R: @reuvenlax 

------------------------------------------------------------------------------------------------

Lang | SDK | Apex | Dataflow | Flink | Gearpump | Samza | Spark
--- | --- | --- | --- | --- | --- | --- | ---
Go | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Go/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Go/lastCompletedBuild/) | --- | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Go_VR_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Go_VR_Flink/lastCompletedBuild/) | --- | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Go_VR_Spark/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Go_VR_Spark/lastCompletedBuild/)
Java | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Apex/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Apex/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Dataflow/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Dataflow/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Flink/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink_Batch/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink_Batch/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink_Streaming/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Flink_Streaming/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Gearpump/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Gearpump/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Samza/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Samza/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Spark_Batch/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_PVR_Spark_Batch/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_SparkStructuredStreaming/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_SparkStructuredStreaming/lastCompletedBuild/)
Python | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Python2/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python2/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Python35/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python35/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Python36/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python36/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Python37/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python37/lastCompletedBuild/) | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Py_VR_Dataflow/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Py_VR_Dataflow/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Py_ValCont/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Py_ValCont/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Python2_PVR_Flink_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Python2_PVR_Flink_Cron/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PostCommit_Python35_VR_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python35_VR_Flink/lastCompletedBuild/) | --- | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_Python_VR_Spark/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_Python_VR_Spark/lastCompletedBuild/)
XLang | --- | --- | --- | [![Build Status](https://builds.apache.org/job/beam_PostCommit_XVR_Flink/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PostCommit_XVR_Flink/lastCompletedBuild/) | --- | --- | ---

Pre-Commit Tests Status (on master branch)
------------------------------------------------------------------------------------------------

--- |Java | Python | Go | Website
--- | --- | --- | --- | ---
Non-portable | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Java_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Java_Cron/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Python_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Python_Cron/lastCompletedBuild/)&lt;br&gt;[![Build Status](https://builds.apache.org/job/beam_PreCommit_PythonLint_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_PythonLint_Cron/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Go_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Go_Cron/lastCompletedBuild/) | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Website_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Website_Cron/lastCompletedBuild/) 
Portable | --- | [![Build Status](https://builds.apache.org/job/beam_PreCommit_Portable_Python_Cron/lastCompletedBuild/badge/icon)](https://builds.apache.org/job/beam_PreCommit_Portable_Python_Cron/lastCompletedBuild/) | --- | ---

See [.test-infra/jenkins/README](https://github.com/apache/beam/blob/master/.test-infra/jenkins/README.md) for trigger phrase, status and link of all Jenkins jobs.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                Run Java PreCommit
              </div></li><li><div>
                R: @reuvenlax this is an implementation for DynamicMessages. It takes into account the new Logical Types and also use RowWithStorage instead of going with the getters.
              </div></li><li><div>
                @reuvenlax this is ready for review. It has feature parity with the static compiled proto, including all logical types.
              </div></li><li><div>
                Run Java PreCommit
              </div></li><li><div>
                This branch has been updated to take the new Logical Types into account.
              </div></li><li><div>
                Run Java PreCommit
              </div></li><li><div>
                @reuvenlax @iemejia @TheNeuralBit I've tested this PR extensively on Dataflow. This is way more stable than the original DynamicMessage schema implementation.

Can I get a LGTM, that I can focus on the options. Thanks.

(master is failing, it was green till rebase)
              </div></li><li><div>
                Run Java PreCommit
              </div></li><li><div>
                Run Java PreCommit
              </div></li><li><div>
                A few comments.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                I think you can replace the lambda with this::indexDescriptor
              </div></li><li><div>
                you can do the same here - forEach(this::indexDescriptor)
              </div></li><li><div>
                I don't think we should be storing SchemaCoder objects around here. I think preferable to store schema and to/from row functions separately.
              </div></li><li><div>
                fixed
              </div></li><li><div>
                fixed
              </div></li><li><div>
                I've changed the accesses here, but iI still think that it's ok to use SchemaCoder as a transient container for the trio: Schema, ToRow and FromRow.

If it's a blocker, I can spit it up in 3 different transient fields.
              </div></li><li><div>
                I would prefer 3 fields. SchemaCoder is not a container object - it just happens to contain those fields. In fact I would prefer to make SchemaCoder private (so that users of Schemas don't have to ever deal with coders at all), however that would require more major changes to Beam. 
              </div></li><li><div>
                Removed coder as container.
              </div></li><li><div>
                I don't see this function being used anywhere. Remove?
              </div></li><li><div>
                I used it in a production pipeline, but as it's not available in the other providers I removed it, (squashed and rebased).
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Protobuf Beam Schema support
                </div><div><b>description:</b> Add support for the new Beam Schema to the Protobuf extension.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [~alexvanboxel] any update on this? I'm looking to get started on BEAM-4455 which depends on this. Thanks in advance!
              </div></li><li><div>
                Well. picking it up again as I'm back from holidays. Hopefully we then get the pull request out in a reasonable time.
              </div></li><li><div>
                PR ready for review
              </div></li><li><div>
                Moved to 2.17.0
              </div></li><li><div>
                Is this resolved? Associated PR is not merged yet.
              </div></li><li><div>
                Reopening as new comments on PR still needs to be resolved
              </div></li><li><div>
                [~alexvanboxel]

Seems to me this is an improvement. I am going to cut release branch for 2.20.0 tomorrow. Do you agree that we can push this Jira to 2.21.0 release?
              </div></li><li><div>
                Moved to 2.21
              </div></li><li><div>
                Moving back to 2.20 as it's merged into master
              </div></li></ol></div></div></html>