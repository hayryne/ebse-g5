<!DOCTYPE html><html><div class="item-title">
        Item 178
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * The evaluator has only contacted the driver after the expiration period.
   
              </div></li><li><div>
                *
   * The evaluator has had its context/running task processed.
   
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                *
   * @return true if the transition of {@link EvaluatorRestartState} is legal.
   
              </div></li><li><div>
                *
   * @return true if the evaluator has heartbeated back to the driver.
   
              </div></li><li><div>
                *
   * The evaluator has had its recovery heartbeat processed.
   
              </div></li><li><div>
                *
 * The state that the evaluator is in in the driver restart process.
 
              </div></li><li><div>
                *
   * The evaluator is not a restarted instance. Not expecting.
   
              </div></li><li><div>
                *
   * Received the evaluator heartbeat, but have not yet processed it.
   
              </div></li><li><div>
                *
   * Have not yet heard back from an evaluator, but we are expecting it to report back.
   
              </div></li><li><div><div><b>comment:</b>  set the state machine in motion.
 TODO[REEF-560]: Call onDriverRestartCompleted() (to do in REEF-617) on a Timer.
                </div><div><b>label:</b> requirement
                </div></div></li><li><div>
                *
   * Signals to the {@link DriverRestartManager} that an evaluator is to be expected to report back after restart.
   
              </div></li><li><div>
                *
   * Signals to the {@link DriverRestartManager} that an evaluator has reported back after restart.
   
              </div></li><li><div>
                *
   * Signals to the {@link DriverRestartManager} that an evaluator has had its recovery heartbeat processed.
   
              </div></li><li><div>
                *
   * Signals to the {@link DriverRestartManager} that an evaluator has had its running task processed.
   
              </div></li><li><div>
                *
   * Signals to the {@link DriverRestartManager} that an expected evaluator has been expired.
   
              </div></li><li><div>
                *
   * the negation of {@link #hasRestarted()}.
   
              </div></li><li><div><div><b>comment:</b>  TODO[REEF-617]: Create EvaluatorManager for recovered evaluator and call onEvaluatorHeartbeatMessage().
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>comment:</b>  TODO[REEF-617]: Create EvaluatorManager for expired evaluator and close it.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                *
   * Process an evaluator heartbeat message.
   
              </div></li><li><div>
                
       * First message from a running evaluator. The evaluator can be a new evaluator or be a previous evaluator
       * from a separate application attempt. In the case of a previous evaluator, if the restart period has not
       * yet expired, we should register it and trigger context active and task events. If the restart period has
       * expired, we should return immediately after setting its remote ID in order to close it.
       
              </div></li><li><div><div><b>comment:</b>  TODO[REEF-617]: Move restart completion logic to DriverRestartManager.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>comment:</b>  TODO[REEF-617]: Move evaluator recovery to EvaluatorHeartbeatHandler and reregister evaluator here.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 Don't do anything if evaluator has expired. Close it immediately upon exit of this method.
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>message:</b> [REEF-616] Keep state of previous evaluators with a state machine

This switches to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

Pull Request:
  This closes #396

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li><li><div><div><b>title:</b> [REEF-616] Keep state of previous evaluators with a state machine
                </div><div><b>body:</b> This addressed the issue by
- Switching to a state machine model for evaluator statuses for driver restart.

JIRA:
  [REEF-616](https://issues.apache.org/jira/browse/REEF-616)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                [Reef-pull-request-ubuntu #367](https://builds.apache.org/job/Reef-pull-request-ubuntu/367/) SUCCESS
This pull request looks good

              </div></li><li><div>
                [REEF-pull-request-windows3 #274](https://builds.apache.org/job/REEF-pull-request-windows3/274/) SUCCESS
This pull request looks good

              </div></li><li><div>
                I'll do a pass.

              </div></li><li><div>
                @afchung I've done a pass.

              </div></li><li><div>
                @markusweimer Addressed comments. Please have another look. Thanks!

              </div></li><li><div>
                [REEF-pull-request-windows3 #278](https://builds.apache.org/job/REEF-pull-request-windows3/278/) SUCCESS
This pull request looks good

              </div></li><li><div><div><b>body:</b> Looks good, I will test &amp; merge.

                </div><div><b>label:</b> test
                </div></div></li><li><div>
                [Reef-pull-request-ubuntu #371](https://builds.apache.org/job/Reef-pull-request-ubuntu/371/) FAILURE
Looks like there's a problem with this pull request

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                This, as well as the assignment to `state`, could move to the attribute declaration.

              </div></li><li><div>
                It might make sense to code the negation into a method, e.g. `state.hasNotRestarted()`

              </div></li><li><div>
                This can be `private`, as it is only called within this class.

              </div></li><li><div>
                This could be a `private` method of its own. e.g. `haveAllExpectedEvaluatorsReported()`.

              </div></li><li><div><div><b>body:</b> There are some methods in this class which are not used (any more?):
- `setEvaluatorExpired`
- `setEvaluatorReregistered`
- `isRestartCompleted`
- `hasRestarted`

Will they be used in future commits?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Maybe add a static method `boolean isLegalTransition(EvaluatorRestartState old, EvaluatorRestartState new)` to check transitions between states.

              </div></li><li><div>
                Other than `isRestartCompleted`, the rest of the methods will be used in future commits.

              </div></li><li><div><div><b>body:</b> I preferred keeping it public, since some of the other `setEvaluator` calls are needed to be called from the outside, and left this here to keep it consistent. What do you think?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                OK, keep it `public`

              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Keep state of previous evaluators with a state machine
                </div><div><b>description:</b> Right now it's using two separate sets. This will be much more complicated when the concept of evaluator expiration is factored in. The more concise pattern here to use is the state machine.
                </div></div></li><li><div><div><b>summary:</b> Keep state of previous evaluators with a state machine
                </div><div><b>description:</b> Right now it's using two separate sets. This will be much more complicated when the concept of evaluator expiration is factored in. The more concise pattern here to use is the state machine.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Keep state of previous evaluators with a state machine
                </div><div><b>description:</b> Right now it's using two separate sets. This will be much more complicated when the concept of evaluator expiration is factored in. The more concise pattern here to use is the state machine.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Implemented via [#396|https://github.com/apache/incubator-reef/pull/396]
              </div></li></ol></div></div></html>