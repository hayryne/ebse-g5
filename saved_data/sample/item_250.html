<!DOCTYPE html><html><div class="item-title">
        Item 250
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Simplify regression test for COUCHDB-1283
                </div><div><b>message:</b> Simplify regression test for COUCHDB-1283

The previous version of this test relied on trying to bump into the
all_dbs_active error from the couch_server LRU. This proves to be rather
difficult to reliably provide assertions on behavior. In hindsight all
we really care about is that the compactor holds a monitor against the
database and then we can trust couch_server will not evict anything that
is actively monitored.

Fixes #680

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>github_issues:</b> <ol><li><div><div><b>title:</b> EUnit: couchdb_1283: View group shutdown fails
                </div><div><b>body:</b> Hey @davisp we still have issues in couchdb_1283.

* https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/94/pipeline
  * https://couchdb-vm2.apache.org/ci_errorlogs/jenkins-couchdb-94-2017-07-14T16:50:13.852436/couchlog.tar.gz
Makefile output:

```
View group shutdown
    couchdb_views_tests:315: couchdb_1283...*failed*
in function couchdb_views_tests:wait_for_process_shutdown/3 (test/couchdb_views_tests.erl, line 420)
in call from couchdb_views_tests:'-couchdb_1283/0-fun-21-'/0 (test/couchdb_views_tests.erl, line 365)
**error:{assertion_failed,[{module,couchdb_views_tests},
                   {line,422},
                   {reason,"Failure waiting for db shutdown"}]}
  output:&lt;&lt;""&gt;&gt;
```

couch.log:
```
[info] 2017-07-14T16:50:03.368819Z nonode@nohost &lt;0.20932.1&gt; -------- Apache CouchDB has started on http://127.0.0.1:46375/
[notice] 2017-07-14T16:50:03.369155Z nonode@nohost &lt;0.20784.1&gt; -------- config: [compactions] _default deleted for reason nil
[info] 2017-07-14T16:50:03.369202Z nonode@nohost &lt;0.7.0&gt; -------- Application couch started on node nonode@nohost
[notice] 2017-07-14T16:50:03.369958Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] max_dbs_open set to 3 for reason nil
[notice] 2017-07-14T16:50:03.371239Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] delayed_commits set to false for reason nil
[info] 2017-07-14T16:50:03.643758Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {set,{system_memory_high_watermark,[]}}
[info] 2017-07-14T16:50:03.853451Z nonode@nohost &lt;0.21012.1&gt; -------- Opening index for db: eunit-test-db-150051003375857 idx: _design/foo sig: "0963a19eb3ef007218f1e11f0aefa2d9"
[info] 2017-07-14T16:50:03.853818Z nonode@nohost &lt;0.21015.1&gt; -------- Starting index update for db: eunit-test-db-150051003375857 idx: _design/foo
[info] 2017-07-14T16:50:03.928889Z nonode@nohost &lt;0.21015.1&gt; -------- Index update finished for db: eunit-test-db-150051003375857 idx: _design/foo
[notice] 2017-07-14T16:50:03.929427Z nonode@nohost &lt;0.20952.1&gt; -------- 127.0.0.1 - - GET /eunit-test-db-150051003375857/_design/foo/_view/foo 200
[error] 2017-07-14T16:50:05.045951Z nonode@nohost &lt;0.21016.1&gt; -------- gen_server &lt;0.21016.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.046769Z nonode@nohost &lt;0.21016.1&gt; -------- CRASH REPORT Process  (&lt;0.21016.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 376, stack_size: 27, reductions: 119
[error] 2017-07-14T16:50:05.047722Z nonode@nohost &lt;0.21015.1&gt; -------- gen_server &lt;0.21015.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.048419Z nonode@nohost &lt;0.21015.1&gt; -------- CRASH REPORT Process  (&lt;0.21015.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 27, reductions: 1690
[info] 2017-07-14T16:50:05.049159Z nonode@nohost &lt;0.7.0&gt; -------- Application couch exited with reason: stopped
[info] 2017-07-14T16:50:05.049365Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {clear,system_memory_high_watermark}
[info] 2017-07-14T16:50:05.051419Z nonode@nohost &lt;0.7.0&gt; -------- Application os_mon exited with reason: stopped
```

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> EUnit: couchdb_1283: View group shutdown fails
                </div><div><b>body:</b> Hey @davisp we still have issues in couchdb_1283.

* https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/94/pipeline
  * https://couchdb-vm2.apache.org/ci_errorlogs/jenkins-couchdb-94-2017-07-14T16:50:13.852436/couchlog.tar.gz
Makefile output:

```
View group shutdown
    couchdb_views_tests:315: couchdb_1283...*failed*
in function couchdb_views_tests:wait_for_process_shutdown/3 (test/couchdb_views_tests.erl, line 420)
in call from couchdb_views_tests:'-couchdb_1283/0-fun-21-'/0 (test/couchdb_views_tests.erl, line 365)
**error:{assertion_failed,[{module,couchdb_views_tests},
                   {line,422},
                   {reason,"Failure waiting for db shutdown"}]}
  output:&lt;&lt;""&gt;&gt;
```

couch.log:
```
[info] 2017-07-14T16:50:03.368819Z nonode@nohost &lt;0.20932.1&gt; -------- Apache CouchDB has started on http://127.0.0.1:46375/
[notice] 2017-07-14T16:50:03.369155Z nonode@nohost &lt;0.20784.1&gt; -------- config: [compactions] _default deleted for reason nil
[info] 2017-07-14T16:50:03.369202Z nonode@nohost &lt;0.7.0&gt; -------- Application couch started on node nonode@nohost
[notice] 2017-07-14T16:50:03.369958Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] max_dbs_open set to 3 for reason nil
[notice] 2017-07-14T16:50:03.371239Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] delayed_commits set to false for reason nil
[info] 2017-07-14T16:50:03.643758Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {set,{system_memory_high_watermark,[]}}
[info] 2017-07-14T16:50:03.853451Z nonode@nohost &lt;0.21012.1&gt; -------- Opening index for db: eunit-test-db-150051003375857 idx: _design/foo sig: "0963a19eb3ef007218f1e11f0aefa2d9"
[info] 2017-07-14T16:50:03.853818Z nonode@nohost &lt;0.21015.1&gt; -------- Starting index update for db: eunit-test-db-150051003375857 idx: _design/foo
[info] 2017-07-14T16:50:03.928889Z nonode@nohost &lt;0.21015.1&gt; -------- Index update finished for db: eunit-test-db-150051003375857 idx: _design/foo
[notice] 2017-07-14T16:50:03.929427Z nonode@nohost &lt;0.20952.1&gt; -------- 127.0.0.1 - - GET /eunit-test-db-150051003375857/_design/foo/_view/foo 200
[error] 2017-07-14T16:50:05.045951Z nonode@nohost &lt;0.21016.1&gt; -------- gen_server &lt;0.21016.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.046769Z nonode@nohost &lt;0.21016.1&gt; -------- CRASH REPORT Process  (&lt;0.21016.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 376, stack_size: 27, reductions: 119
[error] 2017-07-14T16:50:05.047722Z nonode@nohost &lt;0.21015.1&gt; -------- gen_server &lt;0.21015.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.048419Z nonode@nohost &lt;0.21015.1&gt; -------- CRASH REPORT Process  (&lt;0.21015.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 27, reductions: 1690
[info] 2017-07-14T16:50:05.049159Z nonode@nohost &lt;0.7.0&gt; -------- Application couch exited with reason: stopped
[info] 2017-07-14T16:50:05.049365Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {clear,system_memory_high_watermark}
[info] 2017-07-14T16:50:05.051419Z nonode@nohost &lt;0.7.0&gt; -------- Application os_mon exited with reason: stopped
```

                </div></div></li><li><div><div><b>title:</b> EUnit: couchdb_1283: View group shutdown fails
                </div><div><b>body:</b> Hey @davisp we still have issues in couchdb_1283.

* https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/94/pipeline
  * https://couchdb-vm2.apache.org/ci_errorlogs/jenkins-couchdb-94-2017-07-14T16:50:13.852436/couchlog.tar.gz
Makefile output:

```
View group shutdown
    couchdb_views_tests:315: couchdb_1283...*failed*
in function couchdb_views_tests:wait_for_process_shutdown/3 (test/couchdb_views_tests.erl, line 420)
in call from couchdb_views_tests:'-couchdb_1283/0-fun-21-'/0 (test/couchdb_views_tests.erl, line 365)
**error:{assertion_failed,[{module,couchdb_views_tests},
                   {line,422},
                   {reason,"Failure waiting for db shutdown"}]}
  output:&lt;&lt;""&gt;&gt;
```

couch.log:
```
[info] 2017-07-14T16:50:03.368819Z nonode@nohost &lt;0.20932.1&gt; -------- Apache CouchDB has started on http://127.0.0.1:46375/
[notice] 2017-07-14T16:50:03.369155Z nonode@nohost &lt;0.20784.1&gt; -------- config: [compactions] _default deleted for reason nil
[info] 2017-07-14T16:50:03.369202Z nonode@nohost &lt;0.7.0&gt; -------- Application couch started on node nonode@nohost
[notice] 2017-07-14T16:50:03.369958Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] max_dbs_open set to 3 for reason nil
[notice] 2017-07-14T16:50:03.371239Z nonode@nohost &lt;0.20784.1&gt; -------- config: [couchdb] delayed_commits set to false for reason nil
[info] 2017-07-14T16:50:03.643758Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {set,{system_memory_high_watermark,[]}}
[info] 2017-07-14T16:50:03.853451Z nonode@nohost &lt;0.21012.1&gt; -------- Opening index for db: eunit-test-db-150051003375857 idx: _design/foo sig: "0963a19eb3ef007218f1e11f0aefa2d9"
[info] 2017-07-14T16:50:03.853818Z nonode@nohost &lt;0.21015.1&gt; -------- Starting index update for db: eunit-test-db-150051003375857 idx: _design/foo
[info] 2017-07-14T16:50:03.928889Z nonode@nohost &lt;0.21015.1&gt; -------- Index update finished for db: eunit-test-db-150051003375857 idx: _design/foo
[notice] 2017-07-14T16:50:03.929427Z nonode@nohost &lt;0.20952.1&gt; -------- 127.0.0.1 - - GET /eunit-test-db-150051003375857/_design/foo/_view/foo 200
[error] 2017-07-14T16:50:05.045951Z nonode@nohost &lt;0.21016.1&gt; -------- gen_server &lt;0.21016.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.046769Z nonode@nohost &lt;0.21016.1&gt; -------- CRASH REPORT Process  (&lt;0.21016.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 376, stack_size: 27, reductions: 119
[error] 2017-07-14T16:50:05.047722Z nonode@nohost &lt;0.21015.1&gt; -------- gen_server &lt;0.21015.1&gt; terminated with reason: killed
  last msg: {'EXIT',&lt;0.21012.1&gt;,killed}
     state: {st,&lt;0.21012.1&gt;,couch_mrview_index,undefined}
[error] 2017-07-14T16:50:05.048419Z nonode@nohost &lt;0.21015.1&gt; -------- CRASH REPORT Process  (&lt;0.21015.1&gt;) with 0 neighbors exited with reason: killed at gen_server:terminate/7(line:826) &lt;= proc_lib:init_p_do_apply/3(line:240); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [&lt;0.21012.1&gt;,&lt;0.21011.1&gt;], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 27, reductions: 1690
[info] 2017-07-14T16:50:05.049159Z nonode@nohost &lt;0.7.0&gt; -------- Application couch exited with reason: stopped
[info] 2017-07-14T16:50:05.049365Z nonode@nohost &lt;0.20916.1&gt; -------- alarm_handler: {clear,system_memory_high_watermark}
[info] 2017-07-14T16:50:05.051419Z nonode@nohost &lt;0.7.0&gt; -------- Application os_mon exited with reason: stopped
```

                </div></div></li></ol></div><div><b>github_issues_comments:</b> <ol><li><div><div><b>body:</b> Blargh. I'm pretty sure the flaky here is from trying to get a database to close by filling the LRU. Rather than do that I'm just gonna add a wait for the index update to finish and then kill the database forcefully. PR incoming.
                </div><div><b>label:</b> test
                </div></div></li></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li><li><div><div><b>summary:</b> Impossible to compact view groups when number of active databases &gt; max_dbs_open
                </div><div><b>description:</b> Mike Leddy recently reported this issue in the users mailing list:

http://mail-archives.apache.org/mod_mbox/couchdb-user/201109.mbox/%3C1315949945.22123.22.camel@mike.loop.com.br%3E

The attached patch is the simplest solution I can think of - keeping the database open until the view compaction finishes.
The patch includes a test case.

It will need to be updated after Paul's view index refactoring (COUCHDB-1270).
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Paul,

I made the necessary adaptions to the test case to use the new view modules. I also update couch_mrview_compactor, but this is not even close to what was done for 1.2.x (and 1.1.x) - namely we need to keep the database open for the eventual case of recompaction and when recompaction happens, reopen the database atomically via couch_db:reopen/1.

Running this test, I get some error for couch_mrview_compactor when recompact happens.
Hope you can give a hand here, as I'm not yet very familiar with the new view modules.

Thanks
              </div></li><li><div>
                I forgot to paste it yesterday, here's the error I get when a view recompact happens with trunk:

$ ./test/etap/run -v test/etap/201-view-group-shutdown.t 
test/etap/201-view-group-shutdown.t .. 
# Current time local 2011-09-16 00:10:22
# Using etap version "0.3.4"
1..17
Apache CouchDB 0.0.0 (LogLevel=info) is starting.
Apache CouchDB has started. Time to relax.
[info] [&lt;0.2.0&gt;] Apache CouchDB has started on http://127.0.0.1:58243/
# View group updated
ok 1  - Spawned writer 1
ok 2  - Spawned writer 2
ok 3  - Writer 1 opened his database
ok 4  - Writer 2 opened his database
# View group updated
ok 5  - Spawned writer 3
ok 6  - Writer 3 got {error, all_dbs_active} when opening his database
ok 7  - Writer 1 still alive
ok 8  - Writer 2 still alive
ok 9  - Writer 3 still alive
[info] [&lt;0.179.0&gt;] Recompacting index couch_test_view_group_shutdown _design/foo at 20001
[error] [emulator] Error in process &lt;0.190.0&gt; with exit value: {undef,[{couch_index_updater,update,[couch_mrview_index,{mrst,&lt;&lt;16 bytes&gt;&gt;,&lt;0.181.0&gt;,&lt;&lt;30 bytes&gt;&gt;,&lt;&lt;11 bytes&gt;&gt;,&lt;&lt;10 bytes&gt;&gt;,[],{[]},[{mrview,0,0,0,[&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;3 bytes&gt;&gt;],[],&lt;&lt;37 bytes&gt;&gt;,{btree,&lt;0.181.0&gt;,{29679751,{20000,[]},29237352},#Fun&lt;couch_btree.3.126133433&gt;,#Fun&lt;couch_btree.4.37628535&gt;,#Fun&lt;couch_ejson_compare.less_json_ids.2&gt;,#Fun&lt;couch_mrview_util.8.13864802&gt;,snappy},[]}],{btree,&lt;0.181.0&gt;,{384486,20000,384638},#Fun&lt;couch_btree.3.126133433&gt;,#Fun&lt;couch_btree.4.37628535&gt;,#Fun&lt;couch_btree.5.9554535&gt;,#Fun&lt;couch_mrview_util.6.41372338&gt;,snappy},20001,0,undefined,undefined,undefined,undefined,undefined,nil}]}]}

=ERROR REPORT==== 16-Sep-2011::00:10:38 ===
Error in process &lt;0.190.0&gt; with exit value: {undef,[{couch_index_updater,update,[couch_mrview_index,{mrst,&lt;&lt;16 bytes&gt;&gt;,&lt;0.181.0&gt;,&lt;&lt;30 bytes&gt;&gt;,&lt;&lt;11 bytes&gt;&gt;,&lt;&lt;10 bytes&gt;&gt;,[],{[]},[{mrview,0,0,0,[&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;4 bytes&gt;&gt;,&lt;&lt;3 bytes&gt;&gt;],[],&lt;&lt;37 bytes&gt;&gt;,{btree,&lt;0.181.0&gt;,{29679751,{20000,[]},29237352},#Fun&lt;couch_btree.3.126133433&gt;,#Fun&lt;couch_btree.4.37628535&gt;,#Fun&lt;couch_ejson_compare.less_json_ids.2&gt;,#Fun&lt;couch_mrview_util.8.13864802&gt;,snappy},[]}],{btree,&lt;0.181.0&gt;,{384486,20000,384638},#Fun&lt;couch_btree.3.126133433&gt;,#Fun&lt;couch_btree.4.37628535&gt;,#Fun&lt;couch_btree.5.9554535&gt;,#Fun&lt;couch_mrview_util.6.41372338&gt;,snappy},20001,0,undefined,undefined,undefined,undefined,undefined,nil}]}]}


couch_index_updater:update/2 doesn't exist, but there's a 3-arity version of it, however I'm not sure where to get the 3rd argument for it.
              </div></li><li><div>
                Should be fixed by 1173435
              </div></li><li><div>
                Commit c8f340e11c8fb34c960e98309bd514df0bd7b222 in couchdb's branch refs/heads/680-fix-couchdb-1283-test from [~paul.joseph.davis]
[ https://gitbox.apache.org/repos/asf?p=couchdb.git;h=c8f340e ]

Simplify regression test for COUCHDB-1283

The previous version of this test relied on trying to bump into the
all_dbs_active error from the couch_server LRU. This proves to be rather
difficult to reliably provide assertions on behavior. In hindsight all
we really care about is that the compactor holds a monitor against the
database and then we can trust couch_server will not evict anything that
is actively monitored.

Fixes #680

              </div></li><li><div>
                Commit 0f46cdeceb4d8c12a7e95ef110b381fdc6c3b2da in couchdb's branch refs/heads/master from [~paul.joseph.davis]
[ https://gitbox.apache.org/repos/asf?p=couchdb.git;h=0f46cde ]

Simplify regression test for COUCHDB-1283

The previous version of this test relied on trying to bump into the
all_dbs_active error from the couch_server LRU. This proves to be rather
difficult to reliably provide assertions on behavior. In hindsight all
we really care about is that the compactor holds a monitor against the
database and then we can trust couch_server will not evict anything that
is actively monitored.

Fixes #680

              </div></li><li><div>
                Commit 439e642363cbb7bbc299b844df211e849aa667a8 in couchdb's branch refs/heads/master from [~paul.joseph.davis]
[ https://gitbox.apache.org/repos/asf?p=couchdb.git;h=439e642 ]

Fix regression test for COUCHDB-1283

This makes sure that we correctly synchronize with the process running
compaction before we perform our desired assertions.

Fixes #701

              </div></li></ol></div></div></html>