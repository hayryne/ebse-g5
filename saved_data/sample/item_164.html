<!DOCTYPE html><html><div class="item-title">
        Item 164
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 trg, srcs.., timestamp
              </div></li><li><div>
                 mtime
 atime, unused at this
              </div></li><li><div><div><b>comment:</b>  unused this.atime = 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 trg and timestamp
              </div></li><li><div>
                * read short value 
              </div></li><li><div>
                * write the long value 
              </div></li><li><div>
                * write short value 
              </div></li><li><div>
                * read the long value 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G
                </div><div><b>message:</b> HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G


git-svn-id: https://svn.apache.org/repos/asf/hadoop/common/trunk@1171945 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li><li><div><div><b>summary:</b> FSEditLog should not writes long and short as UTF8 and should not use ArrayWritable for writing non-array items
                </div><div><b>description:</b> In FSEditLog, 

- long and short are first converted to String and are further converted to UTF8

- For some non-array items, it first create an ArrayWritable object to hold all the items and then writes the ArrayWritable object.

These result creating many intermediate objects which affects Namenode CPU performance and Namenode restart.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div><div><b>body:</b> {code}
  static UTF8 toLogLong(long timestamp) {
    return new UTF8(Long.toString(timestamp));
  }

void logRename(String src, String dst, long timestamp) {
    UTF8 info[] = new UTF8[] { 
      new UTF8(src),
      new UTF8(dst),
      FSEditLog.toLogLong(timestamp)};
    logEdit(OP_RENAME, new ArrayWritable(UTF8.class, info));
  }
{code}
For example, logRename converts timestamp from long to UTF8.  Then, it creates an ArrayWritable to hold everything.  A better way would be using LongWritable and writing everything directly without creating an ArrayWritable.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Introduced ShortWritable class (HADOOP-7493).
So, first HADOOP-7493 should be committed, to apply this patch.

              </div></li><li><div>
                HDFS-362.patch: 1st patch for review!
              </div></li><li><div>
                Updated patch against trunk!
              </div></li><li><div>
                -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12489975/HDFS-362.1.patch
  against trunk revision 1155998.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    -1 javac.  The patch appears to cause tar ant target to fail.

    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these core unit tests:


    -1 contrib tests.  The patch failed contrib unit tests.

    -1 system test framework.  The patch failed system test framework compile.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1069//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1069//console

This message is automatically generated.
              </div></li><li><div>
                -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12489975/HDFS-362.1.patch
  against trunk revision 1155998.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    -1 javac.  The patch appears to cause tar ant target to fail.

    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these core unit tests:


    -1 contrib tests.  The patch failed contrib unit tests.

    -1 system test framework.  The patch failed system test framework compile.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1074//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1074//console

This message is automatically generated.
              </div></li><li><div><div><b>body:</b> Cleaned some of the existing unused imports and variables.
Updated the patch for review!
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                This change removes fields, removes version checks (eg MkdirOp#readFields), etc. It's an incompatible change that would cause an upgrade to fail.
 
              </div></li><li><div>
                Hi Eli,
Thanks alot for taking a look!.

The main problem here is, ArrayLengths has been checked here. If i change that to direct LongWritable.write(..) or ShortWritable.write(..), that array length will be changed, this will lead to ncompatible change.

Do you have any alternative suggestion for this?

--Thanks
              </div></li><li><div>
                Hi Uma, we have to update LAYOUT_VERSION and support reading on files with older versions.  See HDFS-1630 as an example.
              </div></li><li><div>
                Hi Uma,

I would keep the read* wrappers and have them do the right thing depending on the version. See the existing code (eg what Nicholas referred to) for examples of this. 

Thanks,
Eli
              </div></li><li><div>
                Thanks to Eli and Nicholas for the suggestions,
my bad.....Yes, i missed the version thing.
I will update the patch accordingly.

              </div></li><li><div>
                Hi Eli,
I have updated the patch, can you please take a look.

Also, i have changed the layoutversion to -39.
With this change i have verified the following scenarios manually.

 *Scenario 1:*
   After the version change, verified the fsimgae loading. 
   Successfully able to writing the fields and loading back. This i checked with eclipse debug points.

 *Scenario 2:*
   a)Created the namespace with -38 version with mutiple FS operations.
   b)Applied the patch which contains the version updation to -39.
   c)started the NN with upgrade option.
   Observation: Successfully able to load and start.

 And also finalized and rollbacked.

Since old version of fsImage is required for upgrade verification, i have done the tests manually. And existing tests used for regression.

--thanks




              </div></li><li><div>
                -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12490959/HDFS-362.2.patch
  against trunk revision 1159004.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these core unit tests:
                  org.apache.hadoop.hdfs.server.blockmanagement.TestReplicationPolicy
                  org.apache.hadoop.hdfs.server.namenode.TestCheckpoint
                  org.apache.hadoop.hdfs.server.namenode.TestHDFSConcat
                  org.apache.hadoop.hdfs.server.namenode.TestNNThroughputBenchmark
                  org.apache.hadoop.hdfs.server.namenode.TestValidateConfigurationSettings
                  org.apache.hadoop.hdfs.TestHDFSServerPorts
                  org.apache.hadoop.hdfs.tools.offlineEditsViewer.TestOfflineEditsViewer

    -1 contrib tests.  The patch failed contrib unit tests.

    -1 system test framework.  The patch failed system test framework compile.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1126//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1126//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1126//console

This message is automatically generated.
              </div></li><li><div><div><b>body:</b> Rather than comparing the logVersion variable against the numeric -39 version, check out LayoutVersion.supports(...) -- makes the code easier to read, etc. Aside from that, I think it looks good, but will give one more pass before commit.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Hi Todd,

Thanks a lot for taking a look on this patch!
{quote}
Rather than comparing the logVersion variable against the numeric -39 version, check out LayoutVersion.supports(...) – makes the code easier to read
{quote}
 Nice suggestion. Addressed in this patch.

Thanks
Uma

              </div></li><li><div>
                Looks folder structure has been changed.
Re-based the patch based on trunk!

Hi Eli/Todd ,
 Can you just take look on this?

Thanks
Uma
              </div></li><li><div>
                Updated the same patch again to trigger Hudson. HDFS-362.2d.patch
              </div></li><li><div>
                -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12491819/HDFS-362.2d.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests:

                  org.apache.hadoop.hdfs.server.datanode.TestReplicasMap
                  org.apache.hadoop.hdfs.server.blockmanagement.TestHost2NodesMap
                  org.apache.hadoop.hdfs.TestDfsOverAvroRpc
                  org.apache.hadoop.hdfs.tools.offlineEditsViewer.TestOfflineEditsViewer

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1163//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1163//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1163//console

This message is automatically generated.
              </div></li><li><div>
                Test failures are not relevant, with out patch also they are failing.
              </div></li><li><div>
                Hi Todd,
I have updated the patch with your comments.Do you have any comments with this new patch?

Thanks,
Uma
              </div></li><li><div>
                Hi Todd/Eli, 
 Do you have any comments on this patch?
              </div></li><li><div>
                Todd, any issue with this patch to go?

Thanks
Uma
              </div></li><li><div>
                -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12493962/HDFS-362.2e.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 6 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed these unit tests:
                  org.apache.hadoop.hdfs.TestDfsOverAvroRpc
                  org.apache.hadoop.hdfs.server.blockmanagement.TestHost2NodesMap
                  org.apache.hadoop.hdfs.server.datanode.TestReplicasMap

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/1228//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/1228//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/1228//console

This message is automatically generated.
              </div></li><li><div>
                Test failures are not relavent to this patch change.

              </div></li><li><div>
                +1 patch looks good.

I will wait for a day before committing this, to see if there is any comment from the others.
              </div></li><li><div>
                I have committed this.  Thanks, Uma!
              </div></li><li><div>
                Integrated in Hadoop-Hdfs-trunk-Commit #983 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/983/])
    HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1171945
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestHDFSConcat.java

              </div></li><li><div>
                Integrated in Hadoop-Common-trunk-Commit #906 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/906/])
    HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1171945
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestHDFSConcat.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-trunk-Commit #921 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/921/])
    HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1171945
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestHDFSConcat.java

              </div></li><li><div>
                Integrated in Hadoop-Hdfs-trunk #803 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/803/])
    HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1171945
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestHDFSConcat.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-trunk #833 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/833/])
    HDFS-362.  FSEditLog should not writes long and short as UTF8, and should not use ArrayWritable for writing non-array items.  Contributed by Uma Maheswara Rao G

szetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1171945
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestHDFSConcat.java

              </div></li><li><div>
                Spoke w Arun about targeting this for 23.1, good to have, and if so in an earlier 23.x release. Before merging I'm going to test:
#1 Upgrade from 1.1 (branch-1) to a branch-23 build
#2 Upgrade from 23.0 to a branch-23 build
              </div></li><li><div>
                Did the above testing (when populating the initial file system I saved the namespace, and populated it again so there's both a non-empty base image and non-empty edit log), merged to branch-23, and fixed up the changelog.    
              </div></li><li><div>
                Integrated in Hadoop-Hdfs-0.23-Commit #374 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Commit/374/])
    HDFS-362. svn merge -c 1171945 from trunk

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232203
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java

              </div></li><li><div>
                Integrated in Hadoop-Hdfs-trunk-Commit #1623 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1623/])
    Update changelog for HDFS-362 to reflect the merge.

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232205
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt

              </div></li><li><div>
                Integrated in Hadoop-Common-trunk-Commit #1550 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1550/])
    Update changelog for HDFS-362 to reflect the merge.

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232205
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt

              </div></li><li><div>
                Integrated in Hadoop-Common-0.23-Commit #384 (See [https://builds.apache.org/job/Hadoop-Common-0.23-Commit/384/])
    HDFS-362. svn merge -c 1171945 from trunk

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232203
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-0.23-Commit #397 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Commit/397/])
    HDFS-362. svn merge -c 1171945 from trunk

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232203
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-trunk-Commit #1568 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1568/])
    Update changelog for HDFS-362 to reflect the merge.

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232205
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt

              </div></li><li><div>
                Integrated in Hadoop-Hdfs-trunk #928 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/928/])
    Update changelog for HDFS-362 to reflect the merge.

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232205
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt

              </div></li><li><div>
                Integrated in Hadoop-Hdfs-0.23-Build #141 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/141/])
    HDFS-362. svn merge -c 1171945 from trunk

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232203
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-0.23-Build #163 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/163/])
    HDFS-362. svn merge -c 1171945 from trunk

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232203
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/protocol/LayoutVersion.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSEditLogOp.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSImageSerialization.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineEditsViewer/EditsLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/tools/offlineImageViewer/ImageLoaderCurrent.java
* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFSEditLogLoader.java

              </div></li><li><div>
                Integrated in Hadoop-Mapreduce-trunk #961 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/961/])
    Update changelog for HDFS-362 to reflect the merge.

eli : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1232205
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt

              </div></li></ol></div></div></html>