<!DOCTYPE html><html><div class="item-title">
        Item 253
      </div> <div class="item-details"><div><b>git_comments:</b> <ol></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> HIVE-8654 : CBO: parquet_ctas test returns incorrect results (Sergey Shelukhin, reviewed by Ashutosh Chauhan)
                </div><div><b>message:</b> HIVE-8654 : CBO: parquet_ctas test returns incorrect results (Sergey Shelukhin, reviewed by Ashutosh Chauhan)

git-svn-id: https://svn.apache.org/repos/asf/hive/branches/branch-0.14@1635604 13f79535-47bb-0310-9956-ffa450edef68

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> CBO: parquet_ctas test returns incorrect results
                </div><div><b>description:</b> I am investigating right now. 
The issue is specific to Parquet:

{noformat}
set hive.cbo.enable=true;
drop table staging;
drop table parquet_ctas;

create table staging (key int, value string) stored as textfile;
insert into table staging select * from src order by key limit 10;
select * from staging;

create table parquet_ctas stored as parquet as select * from staging;
select * from parquet_ctas;
create table orc_ctas stored as orc as select * from staging;
select * from orc_ctas;
create table txt_ctas stored as textfile as select * from staging;
select * from txt_ctas;
{noformat}

The parquet query returns all NULLs with CBO on.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                [~brocknoland] do you guys have any feedback? We will probably look more at this, but I wonder why query would break on Parquet specifically. Does writing to Parquet table depend on something in addition to what other output formats do? CBO can change query plan, column names, etc.
              </div></li><li><div>
                The only thing I could thing of is if the column names written to the file are getting messed up. Parquet does column resolution by name. You can view the contents of a parquet file with the parquet dump command.
              </div></li><li><div><div><b>body:</b> Looks like changing the output schema, as we do now, is not enough for parquet. Patching AST column names in addition fixes parquet, but that is problematic because it breaks other things (e.g. references from order by to select expressions), and patching those also is too hacky. I'll look for some other fix
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                If the parquet code needs to be updated to get the column names from some other location. That is fine with ne.
              </div></li><li><div>
                tiny fix to populate fixed colName not just in fieldschemas, but also in tabledesc cols. Just in case, only do it when running CBO.

[~ashutoshc] [~jpullokkaran] [~hagleitn] ok for trunk/14?

if someone feels like committing things, please don't yet :)
              </div></li><li><div>
                

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12678112/HIVE-8654.patch

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 6590 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchCommit_Json
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1557/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1557/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1557/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12678112 - PreCommit-HIVE-TRUNK-Build
              </div></li><li><div>
                test failures are unrelated
              </div></li><li><div>
                +1
              </div></li><li><div>
                committed to both
              </div></li><li><div>
                This has been fixed in 0.14 release. Please open new jira if you see any issues.

              </div></li></ol></div></div></html>