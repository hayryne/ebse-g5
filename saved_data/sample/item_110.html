<!DOCTYPE html><html><div class="item-title">
        Item 110
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                *
   * Closes this snapshot releasing any associated resources. Once a
   * snapshot is closed, no new iterators can be created for it.
   
              </div></li><li><div>
                *
 * An immutable view of the {@link KeyValueStore} at a point-in-time.
 * The snapshot MUST be closed after use.
 *
 * @param &lt;K&gt; key type
 * @param &lt;V&gt; value type
 
              </div></li><li><div>
                *
   * Creates a new iterator for this snapshot. The iterator MUST be
   * closed after its execution by invoking {@link KeyValueIterator#close}.
   * @return an iterator
   
              </div></li><li><div>
                *
   * Closes this snapshot releasing any associated resources. Once a
   * snapshot is closed, no new iterators can be created for it.
   
              </div></li><li><div>
                *
 * An immutable view of the {@link KeyValueStore} at a point-in-time.
 * The snapshot MUST be closed after use.
 *
 * @param &lt;K&gt; key type
 * @param &lt;V&gt; value type
 
              </div></li><li><div>
                *
   * Creates a new iterator for this snapshot. The iterator MUST be
   * closed after its execution by invoking {@link KeyValueIterator#close}.
   * @return an iterator
   
              </div></li><li><div>
                 Please comment out range query part in order to do an accurate perf test for snapshot
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>message:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb

We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.

Author: xinyuiscool &lt;xiliu@linkedin.com&gt;

Reviewers: Jagadish V &lt;vjagadish@apache.org&gt;

Closes #510 from xinyuiscool/SAMZA-1705

(cherry picked from commit 89beb1fccb01c781a4de905d57a4bd99df25577a)
Signed-off-by: xiliu &lt;xiliu@linkedin.com&gt;

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li><li><div><div><b>title:</b> SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>body:</b> We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.
                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                Maybe add a new DBOperation here for SNAPSHOT.
              </div></li><li><div>
                Thanks for the catch. Let me update it.
              </div></li><li><div>
                How do u like this re-word? 
"Returns a snapshot of this store for a sorted range of entries specified by `from` to `to`. The snapshot is immutable - ie., any mutations to the store are not reflected in the snapshot after it is created"
              </div></li><li><div><div><b>body:</b> sounds good. Let me update the javadoc with this.
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                Consider throwing an IllegalStateException when calling `iterator()` on a snapshot that is already closed.  Also do this for the "InMemory" store case so that the behavior is consistent?
              </div></li><li><div><div><b>body:</b> Nit: Add javadocs for the `KeyValueSnapshot`. 
"An immutable view of the {@link KeyValueStore} at a point-in-time"
                </div><div><b>label:</b> documentation
                </div></div></li><li><div><div><b>body:</b> nit: I re-worded the docs a little bit. consider this? 
"Closes this snapshot releasing any associated resources. Once a snapshot is closed, no new iterators can be created for it"
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Nit: Add javadocs here. 
"Creates a new iterator for this snapshot. The iterator MUST be closed after its execution by invoking {@link KeyValueIterator#close}."
              </div></li><li><div>
                done.
              </div></li><li><div>
                fixed.
              </div></li><li><div>
                done.
              </div></li><li><div>
                Can we add a similar comment to the iterator method that this snapshot MUST be closed after use.
              </div></li><li><div>
                done.
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>description:</b> 
                </div></div></li><li><div><div><b>summary:</b> Switch to use snapshot in iterable impl of RocksDb
                </div><div><b>description:</b> 
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                GitHub user xinyuiscool opened a pull request:

    https://github.com/apache/samza/pull/510

    SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb

    We should use rocksDb.snapshot() method to keep the snapshot and creates a new iterator with it all the time. The perf shows a little bit more expensive but mostly on par with range iterator query.

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/xinyuiscool/samza SAMZA-1705

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/samza/pull/510.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #510
    
----
commit 78841d03aa280af17b301bf2d15e877074db0aac
Author: xinyuiscool &lt;xiliu@...&gt;
Date:   2018-05-08T20:11:14Z

    SAMZA-1705: Switch to use snapshot in iterable impl of RocksDb

----

              </div></li><li><div>
                Github user asfgit closed the pull request at:

    https://github.com/apache/samza/pull/510

              </div></li></ol></div></div></html>