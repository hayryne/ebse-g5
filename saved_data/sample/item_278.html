<!DOCTYPE html><html><div class="item-title">
        Item 278
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 ensure that we can 'see past' delete markers when doing scans
              </div></li><li><div>
                *
   * @param admin to create the table
   * @param index descriptor to update before creating table
   
              </div></li><li><div>
                *
   * Create the specified index table with the necessary columns
   * @param admin {@link HBaseAdmin} to use when creating the table
   * @param indexTable name of the index table.
   * @throws IOException
   
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> PHOENIX-4099 Do not write table data again when replaying mutations for partial index rebuild (addendum)
                </div><div><b>message:</b> PHOENIX-4099 Do not write table data again when replaying mutations for partial index rebuild (addendum)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div></div></li><li><div><div><b>summary:</b> Do not write table data again when replaying mutations for partial index rebuild
                </div><div><b>description:</b> There's no need to re-write the data table mutations when we're replaying them to partially rebuild the index.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Simple optimization. Would you mind reviewing, [~tdsilva]?
              </div></li><li><div>
                +1
              </div></li><li><div>
                When the REPLAY_AT connection property is used, we still need to write the data table mutations, so v2 of the patch writes a 1 for this case (which was what was written before) or a 2 (when replaying data writes for partial index rebuild). Backward compat is fine because we're using the same value as before.
              </div></li><li><div><div><b>body:</b> {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12882508/PHOENIX-4099_v2.patch
  against master branch at commit ab67f30278bbf98338b2b347524e0bd17923257f.
  ATTACHMENT ID: 12882508

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 10 new or modified tests.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 javadoc{color}.  The javadoc tool appears to have generated 56 warning messages.

    {color:red}-1 release audit{color}.  The applied patch generated 3 release audit warnings (more than the master's current 0 warnings).

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +            throw new IllegalArgumentException("Unknown ReplayWrite code of " + Bytes.toStringBinary(replayWriteBytes));
+                    mutation.setAttribute(BaseScannerRegionObserver.REPLAY_WRITES, BaseScannerRegionObserver.REPLAY_TABLE_AND_INDEX_WRITES);
+      boolean resetTimeStamp = replayWrite == null &amp;&amp; !isProbablyClientControlledTimeStamp(firstMutation);
+            Pair&lt;ValueGetter, IndexUpdate&gt; statePair = state.getIndexUpdateState(maintainer.getAllColumns(), metaData.getReplayWrite() != null, false, context);
+            Pair&lt;ValueGetter, IndexUpdate&gt; statePair = state.getIndexUpdateState(cols, metaData.getReplayWrite() != null, true, context);
+                        put.setAttribute(BaseScannerRegionObserver.REPLAY_WRITES, BaseScannerRegionObserver.REPLAY_ONLY_INDEX_WRITES);
+                        del.setAttribute(BaseScannerRegionObserver.REPLAY_WRITES, BaseScannerRegionObserver.REPLAY_ONLY_INDEX_WRITES);

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.phoenix.hbase.index.covered.NonTxIndexBuilderTest
                  org.apache.phoenix.hbase.index.covered.update.TestIndexUpdateManager

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1276//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1276//artifact/patchprocess/patchReleaseAuditWarnings.txt
Javadoc warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1276//artifact/patchprocess/patchJavadocWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1276//console

This message is automatically generated.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12882479/PHOENIX-4099.patch
  against master branch at commit 649b737a81243adc43b508a90addc9a2962c6bc1.
  ATTACHMENT ID: 12882479

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:red}-1 javadoc{color}.  The javadoc tool appears to have generated 56 warning messages.

    {color:red}-1 release audit{color}.  The applied patch generated 2 release audit warnings (more than the master's current 0 warnings).

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
     

     {color:red}-1 core zombie tests{color}.  There are 5 zombie test(s): 	at org.apache.phoenix.end2end.HashJoinIT.testJoinWithDifferentDateJoinKeyTypes(HashJoinIT.java:2411)
	at org.apache.phoenix.end2end.HashJoinLocalIndexIT.testJoinWithLocalIndex(HashJoinLocalIndexIT.java:94)
	at org.apache.phoenix.end2end.EncodeFunctionIT.testNullEncodingType(EncodeFunctionIT.java:120)
	at org.apache.phoenix.end2end.AlterTableIT.testAddVarCols(AlterTableIT.java:657)

Test results: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1275//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1275//artifact/patchprocess/patchReleaseAuditWarnings.txt
Javadoc warnings: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1275//artifact/patchprocess/patchJavadocWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-PHOENIX-Build/1275//console

This message is automatically generated.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                FAILURE: Integrated in Jenkins build Phoenix-master #1738 (See [https://builds.apache.org/job/Phoenix-master/1738/])
PHOENIX-4099 Do not write table data again when replaying mutations for (jamestaylor: rev b3473022cae55d2f73f961372ee1826de31e1382)
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/TestCoveredIndexSpecifierBuilder.java
* (delete) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/example/CoveredColumnIndexCodec.java
* (delete) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/example/TestCoveredColumnIndexCodec.java
* (delete) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/example/ColumnGroup.java
* (delete) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/example/CoveredColumnIndexSpecifierBuilder.java
* (edit) phoenix-core/src/it/java/org/apache/hadoop/hbase/regionserver/wal/WALReplayWithIndexWritesAndCompressedWALIT.java
* (delete) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/example/CoveredColumnIndexer.java
* (edit) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/FailForUnsupportedHBaseVersionsIT.java
* (delete) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/example/TestColumnTracker.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/TestColumnTracker.java
* (delete) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/covered/example/EndtoEndIndexingWithCompressionIT.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/util/TestIndexManagementUtil.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/write/TestWALRecoveryCaching.java
* (delete) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/covered/example/EndToEndCoveredIndexingIT.java
* (add) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/covered/FailWithoutRetriesIT.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/CoveredColumnIndexSpecifierBuilder.java
* (delete) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/example/TestCoveredIndexSpecifierBuilder.java
* (delete) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/covered/example/FailWithoutRetriesIT.java
* (delete) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/example/CoveredColumn.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/ColumnGroup.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/CoveredColumn.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/CoveredColumnIndexCodec.java
* (add) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/TestCoveredColumnIndexCodec.java
PHOENIX-4099 Do not write table data again when replaying mutations for (jamestaylor: rev 203a57f48c3145011fc4fcd6ab214ed204ac0101)
* (edit) phoenix-core/src/main/java/org/apache/phoenix/mapreduce/index/PhoenixIndexPartialBuildMapper.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/update/IndexUpdateManager.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/LocalTableStateTest.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/update/TestIndexUpdateManager.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/coprocessor/UngroupedAggregateRegionObserver.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/coprocessor/BaseScannerRegionObserver.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/builder/IndexBuildManager.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/index/PhoenixIndexBuilder.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/execute/MutationState.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/Indexer.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/builder/BaseIndexBuilder.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/builder/IndexBuilder.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/index/PhoenixIndexMetaData.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/index/PhoenixIndexCodec.java
* (edit) phoenix-core/src/test/java/org/apache/phoenix/hbase/index/covered/NonTxIndexBuilderTest.java
* (edit) phoenix-core/src/it/java/org/apache/phoenix/hbase/index/covered/EndToEndCoveredColumnsIndexBuilderIT.java
* (edit) phoenix-core/src/main/java/org/apache/phoenix/hbase/index/covered/IndexMetaData.java

              </div></li></ol></div></div></html>