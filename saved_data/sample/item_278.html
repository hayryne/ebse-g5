<!DOCTYPE html><html><div class="item-title">
        Item 278
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 * 
 * Function used to represent NOW()
 * The function returns a {@link org.apache.phoenix.schema.types.PTimestamp}
 *
 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> PHOENIX-1781 Add Now() (Alicia Ying Shu)
                </div><div><b>message:</b> PHOENIX-1781 Add Now() (Alicia Ying Shu)

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Add Now()
                </div><div><b>description:</b> Phoenix currently supports current_date() that returns a timestamp. 

From Oracle doc:
NOW()                     A timestamp value representing the current date and time

Many customers use Now() for current timestamp and curDate() for current Date. Will implement Now() similar to Phoenix current_date() so that customers do not need to change their queries. 

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                We're not trying to build an Oracle clone.
              </div></li><li><div>
                [~jamestaylor] Is there a way we can create synonyms for Now() in Phoenix? Thanks.
              </div></li><li><div><div><b>body:</b> [~jamestaylor] Our interest in now() was motivated by the JDBC 3.0 spec (see Appendix C.3 of http://java.cnam.fr/iagl/biblio/spec/jdbc-3_0-fr-spec.pdf) and some analysis of a corpus of ~1500 SQL samples downloaded from pastebin.

An except of that analysis over the Section C.3 functions is:
|Function|Area|ScriptHits|
|NOW|Date|71|
|YEAR|Date|69|
|MONTH|Date|53|
|SECOND|Date|25|
|CURDATE|Date|23|
|WEEK|Date|17|
|HOUR|Date|14|

I can elaborate more on the method if anyone cares. In any event many of these functions have been flowing into Phoenix lately.

100% agree there is no value in an Oracle clone, the real motivation is that now is very commonly used and it would make adopting Phoenix easier. FWIW Postgres and MySQL both offer now() as well.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                That's good information, [~cartershanklin], especially the part about other databases having now().

[~ayingshu] - take a look at TruncFunction.java. This is what you'd need to do for a NOW function. You just provide the @BuiltInFunction annotation that uses CurrentDateParseNode.class as the nodeClass attribute.
              </div></li><li><div>
                [~jamestaylor] Uploaded the patch. Thanks.
              </div></li><li><div>
                Since NOW is compiled to CurrentDateFunction, the NowFunction will never be pushed to the server side. Thus it does not need to appear in the ExpressionTypes here:
{code}
diff --git a/phoenix-core/src/main/java/org/apache/phoenix/expression/ExpressionType.java b/phoenix-core/src/main/java/org/apache/phoenix/expression/ExpressionType.java
index 92dd1d4..07286f0 100644
--- a/phoenix-core/src/main/java/org/apache/phoenix/expression/ExpressionType.java
+++ b/phoenix-core/src/main/java/org/apache/phoenix/expression/ExpressionType.java
@@ -51,6 +51,7 @@ import org.apache.phoenix.expression.function.MD5Function;
 import org.apache.phoenix.expression.function.MaxAggregateFunction;
 import org.apache.phoenix.expression.function.MinAggregateFunction;
 import org.apache.phoenix.expression.function.MonthFunction;
+import org.apache.phoenix.expression.function.NowFunction;
 import org.apache.phoenix.expression.function.NthValueFunction;
 import org.apache.phoenix.expression.function.PercentRankAggregateFunction;
 import org.apache.phoenix.expression.function.PercentileContAggregateFunction;
@@ -199,7 +200,8 @@ public enum ExpressionType {
     SignFunction(SignFunction.class),
     YearFunction(YearFunction.class),
     MonthFunction(MonthFunction.class),
-    SecondFunction(SecondFunction.class)
+    SecondFunction(SecondFunction.class),
+    NowFunction(NowFunction.class)
     ;
 
     ExpressionType(Class&lt;? extends Expression&gt; clazz) {
{code}
- Please create a unit test that uses NOW in the WHERE clause compared against a column value. Also, assert more than the value being not null in your test.
              </div></li><li><div>
                Have to add NowFunction to ExpressionType.java, otherwise got a syntax error. Just like TruncFunction is also in ExpressionType.java.
              </div></li><li><div><div><b>body:</b> You're right, [~ayingshu] - I forgot that we use that to find all built-in functions - would you mind adding a comment to the javadoc for the ExpressionType class to remind us? If you could still improve on the test a little bit as described above, that'd be good. Thanks for the contributions. 
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                [~jamestaylor] Modified the test and added a comment. Uploaded the patch. 
              </div></li><li><div>
                +1. Thanks for the contribution, [~ayingshu]. Would you mind committing to 4.x and master branch, [~rajeshbabu]?
              </div></li><li><div>
                Pushed to master and 4.x branch. Thanks for the patch [~ayingshu].
              </div></li><li><div>
                FAILURE: Integrated in Phoenix-master #650 (See [https://builds.apache.org/job/Phoenix-master/650/])
PHOENIX-1781 Add Now() (Alicia Ying Shu) (rajeshbabu: rev 13d6296f7cab70e45a5fa9e579f81b2fa0dc03fd)
* phoenix-core/src/it/java/org/apache/phoenix/end2end/YearMonthSecondFunctionIT.java
* phoenix-core/src/main/java/org/apache/phoenix/expression/ExpressionType.java
* phoenix-core/src/main/java/org/apache/phoenix/expression/function/NowFunction.java

              </div></li><li><div>
                Bulk close of all issues that has been resolved in a released version. 
              </div></li></ol></div></div></html>