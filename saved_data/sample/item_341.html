<!DOCTYPE html><html><div class="item-title">
        Item 341
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li><li><div>
                *
 * Wrapper around ServerSocketChannel.
 * 
 * This class is copied from org.apache.thrift.transport.TNonblockingServerSocket version 0.9.
 * The only change (apart from the logging statements) is the addition of the {@link #getPort()} method to retrieve the port used by the ServerSocket.
 
              </div></li><li><div><div><b>comment:</b>  The thread-safeness of this is dubious, but Java documentation suggests
 that it is safe to do this from a different thread context
                </div><div><b>label:</b> documentation
                </div></div></li><li><div>
                 Bind to listening port
              </div></li><li><div>
                *
   * Creates just a port listening server socket
   
              </div></li><li><div>
                *
   * Underlying ServerSocket object
   
              </div></li><li><div>
                 Prevent 2MSL delay problem on server restarts
              </div></li><li><div>
                *
   * Timeout for client sockets from accept
   
              </div></li><li><div>
                *
   * This channel is where all the nonblocking magic happens.
   
              </div></li><li><div>
                 Make sure not to block on accept
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                 Make server socket
              </div></li><li><div><div><b>comment:</b>  this shouldn't happen, ideally...
 TODO: decide what to do with this.
                </div><div><b>label:</b> requirement
                </div></div></li><li><div>
                 Register the server socket channel, indicating an interest in
 accepting new connections
              </div></li><li><div>
                *
   * Sets a given key with a random port for the value on the site config if it doesn't already exist.
   
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> ACCUMULO-1999 Backport changes from 1664 which advertise the Master's random port
                </div><div><b>message:</b> ACCUMULO-1999 Backport changes from 1664 which advertise the Master's random port

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Random port for Master doesn't make sense
                </div><div><b>description:</b> I was looking at ACCUMULO-1664. In 1.5.0, it appears that you can configure a port of 0 for the master. The master will bind itself to a random port, but none of the other procs know what that port was, so you just shot yourself in the foot.

I'd like to bring those changes back to 1.5.1 so a port of 0 actually works with the master and doesn't leave you with a broken system.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                Backport of ACCUMULO-1664 if anyone wants to review. I tested the following:

# Random monitor, log4j, master, tserver procs and updates to other procs when those are restarted
# Log4j forwarding works after restart
# ZooKeeper lock advertisement for master is updated after new master is start
# `accumulo info` is updated after new master is started.
              </div></li><li><div><div><b>body:</b> Attaching a 2nd verison of the patch with some suggestions from [~billie.rinaldi]:

# Cleaned up unnecessary Opts in SimpleGarbageCollector
# Used mergePropWithRandomPort in MiniAccumuloCluster
# Replace logging of portHint from configuration in MasterClient
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Screwed up patch2. Patch 3 with the changes that 2 claimed to have.
              </div></li><li><div>
                Commit 622fc7d20744ae8a7e75ba0dc945777f94254b48 in branch refs/heads/1.5.1-SNAPSHOT from [~elserj]
[ https://git-wip-us.apache.org/repos/asf?p=accumulo.git;h=622fc7d ]

ACCUMULO-1999 Backport changes from 1664 which advertise the Master's random port

              </div></li><li><div>
                Commit 622fc7d20744ae8a7e75ba0dc945777f94254b48 in branch refs/heads/1.6.0-SNAPSHOT from [~elserj]
[ https://git-wip-us.apache.org/repos/asf?p=accumulo.git;h=622fc7d ]

ACCUMULO-1999 Backport changes from 1664 which advertise the Master's random port

              </div></li></ol></div></div></html>