<!DOCTYPE html><html><div class="item-title">
        Item 229
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method (#6384)
                </div><div><b>message:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method (#6384)

Fixed the ConnectClusterStateImpl.connectors() method and throw an exception on timeout. Added unit test.

Author: Chris Egerton &lt;chrise@confluent.io&gt;

Reviewers: Magesh Nandakumar &lt;magesh.n.kumar@gmail.com&gt;, Robert Yokota &lt;rayokota@gmail.com&gt;, Arjun Satish &lt;wicknicks@users.noreply.github.com&gt;, Konstantine Karantasis &lt;konstantine@confluent.io&gt;, Randall Hauch &lt;rhauch@gmail.com&gt;, Ewen Cheslack-Postava &lt;ewen@confluent.io&gt;

Closes #6384 from C0urante:kafka-8058

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> test
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li><li><div><div><b>title:</b> KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
                </div><div><b>body:</b> This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.

More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).

~Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.~
A unit test has also been added for the `ConnectClusterStateImpl` class.

### Committer Checklist (excluded from commit message)
- [ ] Verify design and implementation 
- [ ] Verify test coverage and CI build status
- [ ] Verify documentation (including upgrade notes)

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                @mageshn @wicknicks @rayokota could you guys take a look when you have a chance? 😃 
              </div></li><li><div>
                @rhauch @ewencp Hi guys! Got a minor bug fix for you; been reviewed and approved by three contributors and seems ready to be looked at by a committer or two. Would appreciate your review when you get the chance.
              </div></li><li><div><div><b>body:</b> Forgot to mention that a unit test would be nice (for the whole class even?), since this seems it never worked because it returned immediately. 
                </div><div><b>label:</b> test
                </div></div></li><li><div>
                @kkonstantine I think I've addressed your two inline comments, and I've added a unit test for the `ConnectClusterStateImpl.connectors()` method. The other method (`connectorHealth(...)`) is synchronous and doesn't really look like it warrants an additional test.

As far as the ten-second timeout goes, I'm open to suggestions but it doesn't appear that rebalances or forwarding to master should be a factor.
              </div></li><li><div>
                @kkonstantine thanks for the review! I've taken your comments into account and pushed the next iteration, which consists of changes to how the `ConnectClusterStateImpl` is tested. Hope this looks good and addresses your review remarks, but will be happy to keep iterating if not or if there's anything else that needs work.
              </div></li><li><div>
                @rhauch yep, this bug has been present since REST extensions were added to Connect. I've added your suggested change to the PR, let me know if there are any other alterations you'd like.
              </div></li><li><div>
                @ewencp can you shed some light on why we'd want to take rebalances into account for the timeout? I could be wrong, but I don't think a rebalance would affect the latency of a call to `Herder.connectors(...)`.
              </div></li><li><div>
                Calling `connectors()` for `DistributedHerder` adds a request to the request queue, which are processed serially in the thread that manages cluster membership so they get a consistent view of the state of the Herder. Pretty much all the requests follow that pattern, though it is true some could potentially be optimized to not require it if some other locking were put in place for certain parts of the state.

The thread that processes the requests is also the one managing the `member` and calling `poll()` on it, which can block on ensuring membership in the group, which means request processing latency can be affected by rebalances.
              </div></li><li><div>
                @ewencp thanks for the clarification; I did not realize that membership and request handling were taken care of with the same thread. I've taken your suggestion literally and just made the timeout the minimum of the timeout for the `/connectors` resource and the rebalance timeout (if running in distributed mode). LMK how this looks!
              </div></li><li><div>
                BTW, I think we want to backport this to 2.0, which according to [the KIP](https://cwiki.apache.org/confluence/display/KAFKA/KIP-285%3A+Connect+Rest+Extension+Plugin) is when Connect REST extensions were introduced and AFAICT the code for the `ConnectClusterStateImpl` class hasn't been modified since.
              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div><div><b>body:</b> nit: should we log an error if this method returns false?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Hmm... good point. I think it may make more sense raise a `ConnectException` in order to avoid incorrect/unexpected behavior from the code that's invoking this method. WDYT? Would be interested in @mageshn's thoughts as well
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Yes, it would probably be good to throw an exception here if the method returns false.

              </div></li><li><div><div><b>body:</b> @C0urante would using a `FutureCallback` be more appropriate here? 
Also do you happen to know what happens if this request is not forwarded to the leader of the group? How much do we care here (not easy to say because this class is missing javadoc)?

You might want to check `completeOrForwardRequest` to see what we do on another call to `herder.connectors` method elsewhere. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Have you compared this value with `ConnectorsResource.REQUEST_TIMEOUT_MS`? I know the other one is taking into account rebalances. But how much do we care here? The diff between 90sec and 10sec seems significant. 
              </div></li><li><div><div><b>body:</b> @kkonstantine thanks for pointing out the `FutureCallback` class, that's much better than the `CountDownLatch`-based approach.

The `ConnectClusterStateImpl` class doesn't have javadocs, but the `ConnectClusterState` interface does. There's no mention of expected behavior if the `ConnectClusterState.connectors()` method is invoked on or off the master node, but FWICT both the standalone and distributed herders rely on their local `ClusterConfigState` snapshots to provide the list of connectors for their own `connectors()` methods, so it doesn't appear forwarding to the leader will be necessary. Let me know if I'm missing anything here; I've tried to go over the code base as best as I can but it's always good to hear from someone more familiar with it.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                It looks like the `DistributedHerderRequest` that gets created to fulfill a call to `DistributedHerder.connectors(...)` should complete quickly and won't be blocked even during rebalance. I'm unclear if other requests that are queued up before it could cause a call to `DistributedHerder.connectors(...)` to still take longer than ten seconds but I'm leaning toward no...
              </div></li><li><div><div><b>body:</b> nit: my impression is that we don't name the mocks as `mockSomething`. We just declare them/initialize them. Also, I think the annotation style is preferable with easymock/powermock, but I don't feel strong about it. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Thanks for simplifying the tests @C0urante! Definitely on the right track. 
As you can see in https://github.com/apache/kafka/blob/trunk/connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaConfigBackingStoreTest.java 
you can use the already existing `TestFuture` and be a bit more specific on what to capture and what you expect. 

For example this could be written as: 
```java
    @Test
    public void connectors() {
        Capture&lt;Callback&lt;Collection&lt;String&gt;&gt;&gt; callback = EasyMock.newCapture();
        mockHerder.connectors(EasyMock.capture(callback));
        EasyMock.expectLastCall().andAnswer(new IAnswer&lt;Future&lt;Collection&lt;String&gt;&gt;&gt;() {
            @Override
            public Future&lt;Collection&lt;String&gt;&gt; answer() throws Throwable {
                TestFuture&lt;Collection&lt;String&gt;&gt; future = new TestFuture&lt;&gt;();
                callback.getValue().onCompletion(null, expectedConnectors);
                future.resolveOnGet(expectedConnectors);
                return future;
            }
        });
        EasyMock.replay(mockHerder);
        assertEquals(expectedConnectors, connectClusterState.connectors());
    }
```
this way you also manage to avoid unchecked casts. 
              </div></li><li><div>
                Timeout to read the log and get a snapshot is 3sec. I agree. I think we are good. 
              </div></li><li><div>
                @kkonstantine definitely prefer the `Capture`-based approach that you've outlined, but I don't think the `TestFuture`/`IAnswer` combination in your example is applicable since the future/callback we're dealing with is being passed to `Herder.connectors(...)`, instead of being returned by it.
              </div></li><li><div><div><b>body:</b> That's correct. It's called in the method you test. I was carried away in the effort to remove the unchecked casts. 
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Nit: What about `TimeUnit.SECONDS.toMillis(10)`?
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                We're moving away from using this since we can use the new `assertThrows` that junit 4.13 supports, which is better since it isolates to the specific call that should fail and allows you to capture and make further assertions. At least for any new tests, we should prefer `assertThrows`, though that does affect ability to backport (since https://github.com/apache/kafka/pull/6248 was only merged to `master`, I think after `2.2` was cut).
              </div></li><li><div><div><b>body:</b> nit: i don't love `instanceof` solutions. might be better to generalize thee rebalance timeout so support a small/zero value for `StandaloneConfig`.

I wouldn't block merging on this, but this is an anti-pattern, so if there is a cleaner solution, it might be worth exploring.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                @C0urante, what do you think about doing something like the following instead of the `instanceof` block?

```
        Integer rebalanceTimeoutMs = config.getInt(DistributedConfig.REBALANCE_TIMEOUT_MS_CONFIG);
        if (rebalanceTimeoutMs != null) {
            herderRequestTimeoutMs = Math.min(herderRequestTimeoutMs, rebalanceTimeoutMs.longValue());
        }
```
This still uses the `DistributedConfig.REBALANCE_TIMEOUT_MS_CONFIG`, but otherwise is simply checking for the existence of that property to determine if `herderRequestTimeoutMs` should be set to a new value.
              </div></li><li><div>
                @rhauch sgtm! I've added your code snippet verbatim to the PR
              </div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> ConnectRestExtensionContext does not return list of connectors from its ConnectClusterState
                </div><div><b>description:</b> Title is not entirely accurate, but describes the most common way this bug presents itself.

The [ConnectClusterStateImpl|https://github.com/apache/kafka/blob/ab00c51b6362b41071ae32611ebf698ba9c221ee/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/health/ConnectClusterStateImpl.java]&nbsp;used by Kafka Connect to provide cluster information to REST extensions makes an asynchronous call to [Herder.connectors(...)|https://github.com/apache/kafka/blob/ab00c51b6362b41071ae32611ebf698ba9c221ee/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Herder.java#L70]&nbsp;in its&nbsp; [connectors()|https://github.com/apache/kafka/blob/ab00c51b6362b41071ae32611ebf698ba9c221ee/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/health/ConnectClusterStateImpl.java#L46]&nbsp;method that populates a list of connector names, then immediately returns that list of connector names. If the list is read soon after it is returned, it's possible it will be empty or at least not completely populated.

Since the method is implicitly synchronous (no callback logic is involved in its parameters or return values, and there is no documentation indicating asynchronous behavior for the [ConnectClusterState.connectors()|https://github.com/apache/kafka/blob/ab00c51b6362b41071ae32611ebf698ba9c221ee/connect/api/src/main/java/org/apache/kafka/connect/health/ConnectClusterState.java#L28-L34]&nbsp;method), this should be remedied by adding a wait for the Herder.connectors(...) method to complete in the ConnectClusterStateImpl.connectors() method.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                C0urante commented on pull request #6384: KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
URL: https://github.com/apache/kafka/pull/6384
 
 
   This makes the `ConnectClusterStateImpl.connectors()` method synchronous, whereas before it was implicitly asynchronous with no way to tell whether it had completed or not.
   
   More detail can be found in the [Jira](https://issues.apache.org/jira/browse/KAFKA-8058).
   
   Tested manually. Seems like a light enough change that even unit tests would be overkill, but if reviewers feel differently tests can be added.
   
   ### Committer Checklist (excluded from commit message)
   - [ ] Verify design and implementation 
   - [ ] Verify test coverage and CI build status
   - [ ] Verify documentation (including upgrade notes)
   
 
----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.
 
For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li><li><div>
                rhauch commented on pull request #6384: KAFKA-8058: Fix ConnectClusterStateImpl.connectors() method
URL: https://github.com/apache/kafka/pull/6384
 
 
   
 
----------------------------------------------------------------
This is an automated message from the Apache Git Service.
To respond to the message, please log on to GitHub and use the
URL above to go to the specific comment.
 
For queries about this service, please contact Infrastructure at:
users@infra.apache.org

              </div></li></ol></div></div></html>