<!DOCTYPE html><html><div class="item-title">
        Item 5
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                * Returns true if field min_index_interval is set (has been assigned a value) and false otherwise 
              </div></li><li><div>
                *
     * @deprecated
     
              </div></li><li><div>
                 MAX_INDEX_INTERVAL
              </div></li><li><div>
                * Returns true if field max_index_interval is set (has been assigned a value) and false otherwise 
              </div></li><li><div>
                 MIN_INDEX_INTERVAL
              </div></li><li><div>
                 optional
 optional
              </div></li><li><div>
                *
   * @deprecated
   
              </div></li><li><div>
                 migrate old index_interval values to min_index_interval, if present
              </div></li><li><div>
                 attribute setters that return the modified CFMetaData instance
              </div></li><li><div>
                 ensure the max is at least as large as the min
              </div></li><li><div>
                 if index_interval was set, use that for the min_index_interval default
              </div></li><li><div>
                 shouldn't happen
              </div></li><li><div><div><b>comment:</b>  TODO: In 3.0, remove this and the index_interval column from system.schema_columnfamilies
                </div><div><b>label:</b> requirement
                </div></div></li><li><div>
                * Migrates index_interval values to min_index_interval and sets index_interval to null 
              </div></li><li><div>
                *
     * Returns an estimate of the total number of keys in the SSTable.
     
              </div></li><li><div>
                *
     * A lower bound for the average number of partitions in between each index summary entry. A lower value means
     * that more partitions will have an entry in the index summary when at the full sampling level.
     
              </div></li><li><div>
                 effective index interval == (BASE_SAMPLING_LEVEL / samplingLevel) * minIndexInterval
 so we can just solve for minSamplingLevel here:
 maxIndexInterval == (BASE_SAMPLING_LEVEL / minSamplingLevel) * minIndexInterval
              </div></li><li><div>
                 for initializing data structures, adjust our estimates based on the sampling level
              </div></li><li><div>
                 that's a _lot_ of keys, and a very low min index interval
              </div></li><li><div>
                 The max_index_interval was lowered; force an upsample to the effective minimum sampling level
              </div></li><li><div>
                 The min_index_interval was changed; re-sample to match it.
              </div></li><li><div>
                 if the min_index_interval changed, calculate what our current sampling level would be under the new min
              </div></li><li><div>
                 We have to rebuild the summary from the on-disk primary index in three cases:
 1. The sampling level went up, so we need to read more entries off disk
 2. The min_index_interval changed (in either direction); this changes what entries would be in the summary
    at full sampling (and consequently at any other sampling level)
 3. The max_index_interval was lowered, forcing us to raise the sampling level
              </div></li><li><div>
                 we can use the existing index summary to make a smaller one
              </div></li><li><div>
                 adjust for the current sampling level: (BSL / SL) * index_interval_at_full_sampling
              </div></li><li><div>
                 return min_index_interval to it's original value (double it), but only give the summary enough space
 to have an effective index interval of twice the new min
              </div></li><li><div>
                 coldest sstables will get downsampled to 4/128 of their size, leaving us with 1 and 92/128th index
              </div></li><li><div>
                 at the min sampling level
 at the min sampling level
              </div></li><li><div>
                 halve the min_index_interval, but constrain the available space to exactly what we have now; as a result,
 the summary shouldn't change
              </div></li><li><div>
                 double the min_index_interval
              </div></li><li><div>
                 return min_index_interval to its original value
              </div></li><li><div><div><b>comment:</b>  raise the min_index_interval above our current effective interval, but set the max_index_interval lower
 than what we actually have space for (meaning the index summary would ideally be smaller, but this would
 result in an effective interval above the new max)
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                 return max_index_interval to its original value
              </div></li><li><div>
                 at the min sampling level
              </div></li><li><div>
                 halve the max_index_interval
              </div></li><li><div>
                 keep the min_index_interval the same, but now give the summary enough space to grow by 50%
              </div></li><li><div>
                 the entry at index 127 is the first to go
              </div></li><li><div>
                 with one round of downsampling, only the last summary entry has been removed, so only the last index will have
 at samplingLevel=2, the retained summary points are [0, 64] (assumes BASE_SAMPLING_LEVEL is 128)
              </div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> Replace index_interval with min/max_index_interval
                </div><div><b>message:</b> Replace index_interval with min/max_index_interval

patch by Tyler Hobbs; reviewed by Aleksey Yeschenko for CASSANDRA-6379

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol></ol></div><div><b>github_pulls_comments:</b> <ol></ol></div><div><b>github_pulls_reviews:</b> <ol></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> Replace index_interval with min/max_index_interval
                </div><div><b>description:</b> As a continuation of the work in CASSANDRA-5519, we want to replace the {{index_interval}} attribute of tables with {{min_index_interval}} and {{max_index_interval}}.
                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                6379.txt (and [branch|https://github.com/thobbs/cassandra/tree/CASSANDRA-6379]) replaces {{index_interval}} with {{min_index_interval}} and {{max_index_interval}}.  When migrating, the existing {{index_interval}} value is used for {{min_index_interval}}.  I chose 2048 for the default {{max_index_interval}}; in practice, this limit should only be hit for infrequently-read SSTables when the index summary memory pool is very full.

If you want to test it out, I suggest setting logging to TRACE for o.a.c.io.sstable.IndexSummaryManager, setting {{index_summary_capacity_in_mb}} to 1, and {{index_summary_resize_interval_in_minutes}} to 1.  After inserting a few million rows with stress, the index summary pool will hit capacity and some resizing will happen.  The JMX functions on IndexSummaryManager are also handy.

              </div></li><li><div>
                Thorough. LGTM, +1.
              </div></li><li><div><div><b>body:</b> Well, almost. Should add max/min index intervals to CFMetaData equals/toString/hashCode. Plus a nit - CFMetaData import in IndexSummary is in the wrong spot.
                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> bq. Should add max/min index intervals to CFMetaData equals/toString/hashCode. 

These all have min/max_index_interval, unless I'm missing something.

bq. CFMetaData import in IndexSummary is in the wrong spot.

Looks like it's unused.  6379-v2.txt removes the import.

Thanks!
                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                bq. These all have min/max_index_interval, unless I'm missing something.

Huh, indeed. Sorry. Committed w/ a simple NEWS.txt entry.
              </div></li></ol></div></div></html>