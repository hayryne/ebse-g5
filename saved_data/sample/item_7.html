<!DOCTYPE html><html><div class="item-title">
        Item 7
      </div> <div class="item-details"><div><b>git_comments:</b> <ol><li><div>
                 assert original attributes restored and the server can be updated.
              </div></li><li><div>
                 One host with one A, two CNAME and one PTR record
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                *
 * Implements methods in {@link brooklyn.entity.basic.AbstractSoftwareProcessSshDriver}.
 * {@link #isRunning()} returns true.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 
              </div></li><li><div>
                *
     * Uploads configuration files and restarts the service.
     
              </div></li><li><div>
                *
     * @return A serial number guaranteed to be valid for use in a modified domain.zone or reverse.zone file.
     
              </div></li><li><div>
                 Update Bind configuration files and restart the service
              </div></li><li><div><div><b>comment:</b>  Harder to make assertions on PTR because the entity servers might not be in the right CIDR
                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>git_commits:</b> <ol><li><div><div><b>summary:</b> This closes #263
                </div><div><b>message:</b> This closes #263

* github/pr/263:
  BindDnsServer improvements
  Mark Cidr class Serializable
  BROOKLYN-81: Refuse to reload security provider if none set

                </div></div></li></ol></div><div><b>github_issues:</b> <ol></ol></div><div><b>github_issues_comments:</b> <ol></ol></div><div><b>github_pulls:</b> <ol><li><div><div><b>title:</b> DNS entity improvements
                </div><div><b>body:</b> BindDnsServer rebinds, supports CNAME records and is better tested. 

@grkvlt Would be great if you could review this thoroughly.

                </div></div></li></ol></div><div><b>github_pulls_comments:</b> <ol><li><div>
                [incubator-brooklyn-pull-requests #153](https://builds.apache.org/job/incubator-brooklyn-pull-requests/153/) SUCCESS
This pull request looks good

              </div></li><li><div>
                nice work.  have not looked in detail however, @grkvlt over to you.

              </div></li><li><div>
                Good stuff @sjcorbett this looks really useful. I'd like to test it out before merging it, and would also suggest adding an example YAML blueprint for an application using it, somewhere.

              </div></li><li><div>
                Thanks for the comments. In the interim `BindDnsServerIntegrationTest.testRebindDns` has started failing. It's not rebinding any of the entities. I observe:

```
2014-10-27 21:34:50,256 INFO  Rebind complete: 1 app, 8 entities, 5 locations, 1 policy, 31 enrichers, 0 feeds, 0 catalog items
2014-10-27 21:34:50,256 INFO  A:
2014-10-27 21:34:50,257 INFO  CNAME:
2014-10-27 21:34:50,257 INFO  PTR:
```

The problem is that `getAttribute(ENTITIES).getMembers()` is returning an empty collection where before it returned the expected collection of members. Has anything in core changed with respect to rebind? 

              </div></li><li><div>
                [incubator-brooklyn-pull-requests #187](https://builds.apache.org/job/incubator-brooklyn-pull-requests/187/) SUCCESS
This pull request looks good

              </div></li><li><div>
                [incubator-brooklyn-pull-requests #188](https://builds.apache.org/job/incubator-brooklyn-pull-requests/188/) SUCCESS
This pull request looks good

              </div></li><li><div>
                Test failure fixed by overriding `postRebind` instead of `rebind`. Any more comments? I think this is mergeable now.

              </div></li><li><div>
                [incubator-brooklyn-pull-requests #191](https://builds.apache.org/job/incubator-brooklyn-pull-requests/191/) SUCCESS
This pull request looks good

              </div></li><li><div>
                Incorporated suggestion from @aledsage.

              </div></li><li><div>
                [incubator-brooklyn-pull-requests #203](https://builds.apache.org/job/incubator-brooklyn-pull-requests/203/) ABORTED

              </div></li><li><div>
                @sjcorbett Merged this, working on a YAML blueprint to demonstrate

              </div></li></ol></div><div><b>github_pulls_reviews:</b> <ol><li><div>
                I didn't mean to push this. `cluster.resize` returns before the DNS entity is updated. I guess I can wait for a predicate testing expected DNS entries size to eventually be true. Any other suggestions?

              </div></li><li><div>
                Brilliant

              </div></li><li><div>
                Could this go in an attribute, too?

              </div></li><li><div><div><b>body:</b> Perhaps better to use an explicit mutex `Object` instead? Also, do we still need the synchronisation, since the sensor data is now pushed out only once changed, so there shouldn't be inconsistencies? It's really just enforcing serialisation of calls to `update()` now, right?

                </div><div><b>label:</b> code-design
                </div></div></li><li><div>
                Instead of `Joiner` use `Iterables#toString(Iterable)`

              </div></li><li><div>
                Why do we have to recreate the maps every time?

              </div></li><li><div>
                Maybe this should go in `Cidr` or `Networking` as a convenience?

              </div></li><li><div>
                The `appendTemplate` method might be kept, but in the parent, since it seems useful?

              </div></li><li><div>
                It's still there, just obscured by the diff.

              </div></li><li><div><div><b>body:</b> Why do you think it is better to synchronise on an explicit Object?

I'm not really comfortable enough with Brooklyn's concurrency model to know for sure that `update` won't be called concurrently. If `MemberTrackingPolicy.onEntityChange` is guaranteed to be called synchronously then we should be able to drop the `synchronized` statement.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> Simplicity. We can just follow `onEntityChange` and track members we know are usable with `HasHostnameAndValidLifecycle`. There's no need to track entities to remove from maps and multi-maps. I could be convinced that this is grossly wasteful but figured it will be called rarely so is excusable.

                </div><div><b>label:</b> code-design
                </div></div></li><li><div><div><b>body:</b> I'd prefer `setAttribute(getAttribute(SERIAL) + 1)`, with the type being `Long` rather than `AtomicLong`.
At some point we may hook in to setAttribute for more efficient persistence or a datagrid...

                </div><div><b>label:</b> code-design
                </div></div></li></ol></div><div><b>jira_issues:</b> <ol><li><div><div><b>summary:</b> When no web-console credentials configured, "Reload properties" makes it inaccessible
                </div><div><b>description:</b> I ran `brooklyn launch`, where my brooklyn.properties had no web-console security credentials. I then clicked the "Reload properties" button on the front page of the web-console. After that, I could not log in.

The log showed me:

    2014-10-17 11:28:00,886 INFO  Starting Brooklyn web-console with passwordless access on localhost and protected access from any other interfaces
    2014-10-17 11:28:02,812 INFO  Started Brooklyn console at http://127.0.0.1:8089/, running classpath://brooklyn.war
    2014-10-17 11:28:03,247 INFO  REST using security provider brooklyn.rest.security.provider.BrooklynUserWithRandomPasswordSecurityProvider
    2014-10-17 11:28:03,247 INFO  Allowing access to web console from localhost or with brooklyn:Kg6GATxF6s
    
    2014-10-17 11:28:08,860 INFO  Reloading brooklyn properties from Builder{defaultLocationMetadataUrl=classpath://brooklyn/location-metadata.properties, globalLocationMetadataUrl=/Users/aled/.brooklyn/location-metadata.properties, globalPropertiesFile=/Users/aled/.brooklyn/brooklyn.properties}
    2014-10-17 11:28:08,860 WARN  When reloading, mgmt context LocalManagementContext[pf7oiGWN-xPf4Z8z7] properties are fixed, so reload will be of limited utility
    2014-10-17 11:28:08,863 INFO  Reloading additional brooklyn properties from {brooklyn.catalog.mode=LOAD_BROOKLYN_CATALOG_URL}
    2014-10-17 11:28:08,864 INFO  REST using security provider brooklyn.rest.security.provider.ExplicitUsersSecurityProvider

                </div></div></li></ol></div><div><b>jira_issues_comments:</b> <ol><li><div>
                In 0.10.0, we changed the Brooklyn default behaviour (for classic; not sure about karaf off-hand!): if no credentials are defined, then no credentials are required to login.

Reloading properties thus does not break login.
              </div></li></ol></div></div></html>